> rest-express@1.0.0 dev
> tsx server/index.ts

Database migrations disabled - schema already applied
[EmailService] Initializing email service
[EmailService] Email service initialized successfully
[OpenAI] Service initialized with API key: API key is set
Database module not found, creating a mock implementation
Database module not found, creating a mock implementation
[Auth] Setting up authentication...
[Auth] Setting up PostgreSQL session store
[Auth] PostgreSQL session store initialized successfully
[Auth] Authentication setup completed
[2025-05-06T06:53:28.032Z] [INFO] [KY3P-BATCH-UPDATE] Registering KY3P batch update routes
[2025-05-06T06:53:28.033Z] [INFO] Registering KY3P batch update routes
[2025-05-06T06:53:28.033Z] [INFO] [UnifiedKY3P] Registering unified KY3P update routes
[Routes] Registered KY3P field key router
[Routes] Registered KY3P field key router
[2025-05-06T06:53:28.033Z] [INFO] Registering KY3P field update routes
[2025-05-06T06:53:28.034Z] [INFO] [OpenBankingRoutes] Setting up routes...
[Routes] Setting up unified form submission router
[Routes] Successfully registered unified form submission router
[Routes] Setting up transactional form submission router
[Routes] Successfully registered transactional form submission router
[Routes] Routes setup completed
[INFO] Unified WebSocket server initialized successfully with details: {
  clients: 0,
  path: '/ws',
  id: 'fs9h51',
  timestamp: '2025-05-06T06:53:28.037Z'
}
6:53:28 AM [info] [ServerStartup] WebSocket server initialized with unified implementation
[2025-05-06T06:53:28.061Z] [INFO] [TaskWebSocket] WebSocket server registered with unified implementation
6:53:28 AM [info] [ServerStartup] WebSocket server registered with task-update utility
[TaskBroadcast] WebSocket server reference set up
[TaskBroadcast] WebSocket server active with 0 connected clients
6:53:28 AM [info] [ServerStartup] WebSocket server registered with task-broadcast utility
6:53:28 AM [info] Setting up Vite development server
[ENV] Using PORT=5000 from environment (override: yes)
[ENV] Environment=development (production: no)
6:53:28 AM [express] Server running on 0.0.0.0:5000
6:53:28 AM [express] Environment: development
[Deployment] Server running on 0.0.0.0:5000
[Deployment] Environment: development
[Deployment] Port forwarding: Custom port: 5000
[Deployment] Development mode: Hot reloading enabled
6:53:28 AM [express] Starting periodic task reconciliation system...
[PeriodicTaskReconciliation] Stopped periodic reconciliation system
[PeriodicTaskReconciliation] Starting periodic reconciliation system (interval: 300000ms)
6:53:28 AM [express] Task reconciliation system initialized successfully
6:53:29 AM [info] [ServerStartup] WebSocket server active with 0 connected clients
[2025-05-06T06:53:40.081Z] New client connected to the pool (1/3)
[Current Company] Fetching company for user: { userId: 8, companyId: 1 }
[Current Company] Found company: {
  id: 1,
  name: 'Invela',
  onboardingCompleted: true,
  riskScore: 0,
  chosenScore: 10,
  isDemo: null
}
6:53:40 AM [info] GET /api/companies/current 200 in 148ms :: {"id":1,"name":"Invela","category":"Invela","is_demo":null,"revenue_tier":"sm...
[INFO] [WebSocket] Client connected: client-1746514425315-aimhq76
[Auth] Returning user session data
6:53:45 AM [info] GET /api/companies/current 304 in 36ms :: {"id":1,"name":"Invela","category":"Invela","is_demo":null,"revenue_tier":"sm...
[INFO] [WebSocket] Received message from client client-1746514425315-aimhq76: {
  type: 'authenticate',
  userId: 8,
  companyId: 1,
  clientId: 'ws_1746514424761_rreru1d2r',
  timestamp: '2025-05-06T06:53:45.682Z'
}
[INFO] [WebSocket] Authentication from client client-1746514425315-aimhq76: { userId: 8, companyId: 1, hasToken: true }
[PeriodicTaskReconciliation] Reconciling batch of 10 tasks: [
  685, 679, 697, 699,
  691, 702, 710, 714,
  707, 687
]
[Task Progress] Calculated progress for task 685 (company_kyb): 30/30 = 100%
[Task Progress] Calculated progress for task 679 (open_banking): 44/44 = 100%
[Task Progress] Calculated progress for task 697 (company_kyb): 30/30 = 100%
[Task Progress] Calculated progress for task 699 (open_banking): 0/44 = 0%
[Task Progress] Calculated progress for task 691 (open_banking): 0/44 = 0%
[Task Progress] Calculated progress for task 702 (ky3p): 0/0 = 0%
[Task Progress] Calculated progress for task 710 (ky3p): 0/120 = 0%
[Task Progress] Calculated progress for task 714 (ky3p): 0/0 = 0%
[Task Progress] Calculated progress for task 707 (open_banking): 0/44 = 0%
[Task Progress] Calculated progress for task 687 (open_banking): 44/44 = 100%
[INFO] [WebSocket] Received message from client client-1746514425315-aimhq76: {
  type: 'ping',
  timestamp: '2025-05-06T06:54:05.761Z',
  connectionId: 'ws_1746514424761_rreru1d2r'
}
[2025-05-06T06:54:08.506Z] New client connected to the pool (2/3)
[2025-05-06T06:54:09.480Z] New client connected to the pool (3/3)
[Auth] Returning user session data
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 8, company_id: 1, email: 'evan.navarro@invela.com' }
[2025-05-06T06:54:22.135Z] [INFO] Performing dynamic task unlocking check for company {"companyId":1,"userId":8}
6:54:22 AM [info] GET /api/companies/current 304 in 31ms :: {"id":1,"name":"Invela","category":"Invela","is_demo":null,"revenue_tier":"sm...
[2025-05-06T06:54:22.177Z] [INFO] No completed KYB tasks found, skipping security task unlock check {"companyId":1}
[Tasks] Automatically unlocking all tasks for company { userId: 8, companyId: 1, requestedBy: 'automatic_task_unlock' }
[2025-05-06T06:54:22.179Z] [INFO] [TaskDependencies] Unlocking ALL tasks for company {"companyId":1}
[2025-05-06T06:54:22.210Z] [INFO] [TaskDependencies] Found tasks to unlock {"companyId":1,"count":1,"taskIds":[172],"taskTypes":["user_onboarding"],"ky3pTaskCount":0,"ky3pTaskIds":[]}
[2025-05-06T06:54:22.241Z] [WARN] [UnifiedProgressCalc] Unknown task type for progress calculation: user_onboarding {"taskId":172,"taskType":"user_onboarding"}
[INFO] [WebSocket] Client connected: client-1746514462245-thf48qp
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  effectiveHasResponses: false,
  timestamp: '2025-05-06T06:54:22.273Z'
}
[STATUS DETERMINATION] Task has 0% progress and no responses, setting to NOT_STARTED
[2025-05-06T06:54:22.306Z] [INFO] [ProgressUpdate] Updated task 172 progress to 0% and status to not_started {"taskId":172,"taskType":"user_onboarding","progress":0,"status":"not_started","previousStatus":"not_started"}
[2025-05-06T06:54:22.306Z] [INFO] Successfully retrieved unified WebSocket server for broadcast
[WebSocket] Broadcast task_update to 2 clients (0 errors) { messageId: 'msg_1746514462307_an9gg0is2' }
[2025-05-06T06:54:22.307Z] [INFO] Successfully broadcasted task_update message
[2025-05-06T06:54:22.307Z] [INFO] [ProgressUpdate] Broadcasted progress update for task 172 {"taskId":172,"progress":0,"status":"not_started"}
[2025-05-06T06:54:22.307Z] [INFO] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":1,"taskId":172,"taskType":"user_onboarding","isKy3pTask":false,"calculatedProgress":0,"previousProgress":0,"wasPreserved":false}
[2025-05-06T06:54:22.307Z] [INFO] [TaskDependencies] Successfully unlocked all tasks {"companyId":1,"count":1}
[Tasks] Successfully unlocked all tasks for company: 1
[Network Visualization] Fetching network data for company: 1
[Tasks] KYB tasks found: { count: 0 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 8',
    condition2: 'tasks.created_by = 8',
    condition3: "tasks.company_id = 1 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('evan.navarro@invela.com')"
  }
}
[INFO] [WebSocket] Received message from client client-1746514462245-thf48qp: {
  type: 'authenticate',
  data: { timestamp: '2025-05-06T06:54:22.226Z' }
}
[INFO] [WebSocket] Authentication from client client-1746514462245-thf48qp: { userId: undefined, companyId: undefined, hasToken: true }
[Tasks] Tasks found: { count: 74 }
[Network Visualization] Found network relationships: { count: 85 }
[Network Visualization] Returning visualization data: { centerNode: 'Invela', nodeCount: 85 }
6:54:22 AM [info] GET /api/tasks 200 in 328ms :: [{"id":750,"title":"1. KYB Form: DevTest15","description":"Complete KYB verif...
6:54:22 AM [info] GET /api/network/visualization 304 in 147ms :: {"center":{"id":1,"name":"Invela","riskScore":0,"riskBucket":"none","accredit...
6:54:22 AM [info] GET /api/tasks 304 in 33ms :: [{"id":750,"title":"1. KYB Form: DevTest15","description":"Complete KYB verif...
[INFO] [WebSocket] Client connected: client-1746514462752-by1girs
[INFO] [WebSocket] Received message from client client-1746514462752-by1girs: {
  type: 'authenticate',
  userId: null,
  companyId: null,
  clientId: 'ws_1746514461709_achnit9ez',
  timestamp: '2025-05-06T06:54:22.730Z'
}
[INFO] [WebSocket] Authentication from client client-1746514462752-by1girs: { userId: null, companyId: null, hasToken: true }
[INFO] [WebSocket] Client connected: client-1746514463260-hkz3rvl
[Auth] Returning user session data
6:54:23 AM [info] GET /api/companies/current 304 in 31ms :: {"id":1,"name":"Invela","category":"Invela","is_demo":null,"revenue_tier":"sm...
[INFO] [WebSocket] Received message from client client-1746514463260-hkz3rvl: {
  type: 'authenticate',
  userId: 8,
  companyId: 1,
  clientId: 'ws_1746514462758_3o7de8ash',
  timestamp: '2025-05-06T06:54:23.610Z'
}
[INFO] [WebSocket] Authentication from client client-1746514463260-hkz3rvl: { userId: 8, companyId: 1, hasToken: true }
6:54:25 AM [info] GET /api/companies/current 304 in 32ms :: {"id":1,"name":"Invela","category":"Invela","is_demo":null,"revenue_tier":"sm...
[INFO] [WebSocket] Received message from client client-1746514425315-aimhq76: {
  type: 'ping',
  timestamp: '2025-05-06T06:54:25.760Z',
  connectionId: 'ws_1746514424761_rreru1d2r'
}
6:54:28 AM [info] GET /api/companies/current 304 in 30ms :: {"id":1,"name":"Invela","category":"Invela","is_demo":null,"revenue_tier":"sm...
6:54:31 AM [info] GET /api/companies/current 304 in 31ms :: {"id":1,"name":"Invela","category":"Invela","is_demo":null,"revenue_tier":"sm...
[Auth] Processing logout request
[Auth] Clearing user 8 from cache during logout
[Auth] Clearing company 1 from cache during logout
[Cache] Invalidating company cache for company 1
[Auth] Cache invalidation result for company 1: true
[Auth] Broadcasting cache invalidation WebSocket message
[WebSocket] Broadcast cache_invalidation to 4 clients (0 errors) { messageId: 'msg_1746514473088_1xds6t5mb' }
[2025-05-06T06:54:33.088Z] [INFO] Successfully broadcasted cache_invalidation message
[Auth] Logout successful for user: 8
[Auth] Session successfully destroyed
[Auth] Unauthenticated user session
6:54:39 AM [warn] GET /api/companies/current 401 in 1ms :: {"error":"Unauthorized","message":"Authentication required","details":{"authe...
[INFO] [WebSocket] Received message from client client-1746514463260-hkz3rvl: {
  type: 'ping',
  timestamp: '2025-05-06T06:54:43.241Z',
  connectionId: 'ws_1746514462758_3o7de8ash'
}
[Auth] Processing login request
[Auth] Login request body: { email: '14@e.com', hasPassword: true, passwordLength: 9 }
[Auth] Login attempt for: 14@e.com
[Auth] Password received (first 4 chars): pass
[Auth] Looking up user by email: 14@e.com
[Auth] User lookup result: {
  found: true,
  userId: 312,
  hasPassword: true,
  passwordLength: 60,
  passwordStart: '$2b$'
}
[Auth] Found user, checking password
[Auth] Comparing passwords:
[Auth] - Stored hash length: 60
[Auth] - Stored hash format check: true
[Auth] - Supplied password length: 9
[Auth] - Stored hash: $2b$10$ULynh4XdjgebCIwXdK/9DOBPmj3g5b5RYkv40VV6XE8enAEALCEzS
[Auth] - Supplied password (first 4 chars): pass
[Auth] Starting to hash password
[Auth] Password hashed successfully: { hashLength: 60, startsWithBcrypt: true, rounds: 10 }
[Auth] - Test hash generated: $2b$10$oS8jz8isl/RxkuqAc3Fjd.LPzNjo4vfTHHSzChKNE1GGeEOyXGQsG
[Auth] Password comparison result: false
[Auth] Password validation result: false
[Auth] Login failed: Invalid password
[Auth] Login failed: Invalid email or password
[INFO] [WebSocket] Received message from client client-1746514425315-aimhq76: {
  type: 'ping',
  timestamp: '2025-05-06T06:54:45.761Z',
  connectionId: 'ws_1746514424761_rreru1d2r'
}
[INFO] [WebSocket] Received message from client client-1746514462245-thf48qp: { type: 'ping' }
[Invite Debug] Starting validation for code: D3CEFE
[Invite Debug] Found valid invitation: {
  id: 320,
  email: '15@e.com',
  status: 'pending',
  expires_at: 2025-05-10T19:19:10.000Z
}
6:54:57 AM [info] GET /api/invitations/D3CEFE/validate 200 in 38ms :: {"valid":true,"invitation":{"email":"15@e.com","invitee_name":"John Doe","com...
[Account Setup] Processing setup request for: 15@e.com
[Account Setup] Updated user: { id: 313, email: '15@e.com', onboarding_completed: false }
[Account Setup] Updated task status: { taskId: 749, status: 'completed', progress: 100 }
[INFO] [WebSocket] Broadcast task_update to 4 clients
[Auth] Serializing user: 313
[Account Setup] Login successful for user ID: 313
6:55:02 AM [info] POST /api/account/setup 200 in 350ms :: {"id":313,"email":"15@e.com","full_name":"John Doe","first_name":"John","last...
[Current Company] Fetching company for user: { userId: 313, companyId: 270 }
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 313, company_id: 270, email: '15@e.com' }
[2025-05-06T06:55:02.951Z] [INFO] Performing dynamic task unlocking check for company {"companyId":270,"userId":313}
[Current Company] Found company: {
  id: 270,
  name: 'DevTest15',
  onboardingCompleted: false,
  riskScore: null,
  chosenScore: null,
  isDemo: true
}
[2025-05-06T06:55:02.982Z] [INFO] No completed KYB tasks found, skipping security task unlock check {"companyId":270}
[Tasks] Automatically unlocking all tasks for company { userId: 313, companyId: 270, requestedBy: 'automatic_task_unlock' }
[2025-05-06T06:55:02.983Z] [INFO] [TaskDependencies] Unlocking ALL tasks for company {"companyId":270}
6:55:02 AM [info] GET /api/companies/current 200 in 61ms :: {"id":270,"name":"DevTest15","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T06:55:03.014Z] [INFO] [TaskDependencies] Found tasks to unlock {"companyId":270,"count":3,"taskIds":[751,750,752],"taskTypes":["ky3p","company_kyb","open_banking"],"ky3pTaskCount":1,"ky3pTaskIds":[751]}
[2025-05-06T06:55:03.014Z] [INFO] [TaskDependencies] Processing KY3P task {"taskId":751,"taskType":"ky3p","currentProgress":60,"currentStatus":"in_progress","timestamp":"2025-05-06T06:55:03.014Z"}
[2025-05-06T06:55:03.044Z] [INFO] [UnifiedProgressCalc] Preserving existing progress for task 751 (ky3p): 60% {"taskId":751,"taskType":"ky3p","existingProgress":60,"operation":"preserve-existing"}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 60,
  currentStatus: 'in_progress',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  effectiveHasResponses: true,
  timestamp: '2025-05-06T06:55:03.076Z'
}
[STATUS DETERMINATION] Task has partial progress or responses, setting to IN_PROGRESS
[2025-05-06T06:55:03.107Z] [INFO] [ProgressUpdate] Updated task 751 progress to 60% and status to in_progress {"taskId":751,"taskType":"ky3p","progress":60,"status":"in_progress","previousStatus":"in_progress"}
[WebSocket] Broadcast task_update to 4 clients (0 errors) { messageId: 'msg_1746514503108_4itfk1ujj' }
[2025-05-06T06:55:03.108Z] [INFO] Successfully broadcasted task_update message
[2025-05-06T06:55:03.109Z] [INFO] [ProgressUpdate] Broadcasted progress update for task 751 {"taskId":751,"progress":60,"status":"in_progress"}
[2025-05-06T06:55:03.109Z] [INFO] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":270,"taskId":751,"taskType":"ky3p","isKy3pTask":true,"calculatedProgress":60,"previousProgress":60,"wasPreserved":true}
[2025-05-06T06:55:03.201Z] [INFO] [UnifiedProgressCalc] Calculated progress for task 750 (company_kyb): 0/30 = 0% {"taskId":750,"taskType":"company_kyb","totalFields":"30","completedFields":"0","progress":0}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  effectiveHasResponses: false,
  timestamp: '2025-05-06T06:55:03.233Z'
}
[STATUS DETERMINATION] Task has 0% progress and no responses, setting to NOT_STARTED
[2025-05-06T06:55:03.265Z] [INFO] [ProgressUpdate] Updated task 750 progress to 0% and status to not_started {"taskId":750,"taskType":"company_kyb","progress":0,"status":"not_started","previousStatus":"not_started"}
[WebSocket] Broadcast task_update to 4 clients (0 errors) { messageId: 'msg_1746514503265_0rc4la2m5' }
[2025-05-06T06:55:03.266Z] [INFO] Successfully broadcasted task_update message
[2025-05-06T06:55:03.266Z] [INFO] [ProgressUpdate] Broadcasted progress update for task 750 {"taskId":750,"progress":0,"status":"not_started"}
[2025-05-06T06:55:03.266Z] [INFO] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":270,"taskId":750,"taskType":"company_kyb","isKy3pTask":false,"calculatedProgress":0,"previousProgress":0,"wasPreserved":false}
6:55:03 AM [info] GET /api/companies/current 304 in 31ms :: {"id":270,"name":"DevTest15","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T06:55:03.358Z] [INFO] [UnifiedProgressCalc] Calculated progress for task 752 (open_banking): 0/44 = 0% {"taskId":752,"taskType":"open_banking","totalFields":"44","completedFields":"0","progress":0}
[INFO] [WebSocket] Received message from client client-1746514463260-hkz3rvl: {
  type: 'ping',
  timestamp: '2025-05-06T06:55:03.242Z',
  connectionId: 'ws_1746514462758_3o7de8ash'
}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  effectiveHasResponses: false,
  timestamp: '2025-05-06T06:55:03.389Z'
}
[STATUS DETERMINATION] Task has 0% progress and no responses, setting to NOT_STARTED
[2025-05-06T06:55:03.421Z] [INFO] [ProgressUpdate] Updated task 752 progress to 0% and status to not_started {"taskId":752,"taskType":"open_banking","progress":0,"status":"not_started","previousStatus":"not_started"}
[WebSocket] Broadcast task_update to 4 clients (0 errors) { messageId: 'msg_1746514503422_ny76fu9bm' }
[2025-05-06T06:55:03.422Z] [INFO] Successfully broadcasted task_update message
[2025-05-06T06:55:03.422Z] [INFO] [ProgressUpdate] Broadcasted progress update for task 752 {"taskId":752,"progress":0,"status":"not_started"}
[2025-05-06T06:55:03.422Z] [INFO] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":270,"taskId":752,"taskType":"open_banking","isKy3pTask":false,"calculatedProgress":0,"previousProgress":0,"wasPreserved":false}
[2025-05-06T06:55:03.422Z] [INFO] [TaskDependencies] Successfully unlocked all tasks {"companyId":270,"count":3}
[Tasks] Successfully unlocked all tasks for company: 270
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 313',
    condition2: 'tasks.created_by = 313',
    condition3: "tasks.company_id = 270 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('15@e.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
6:55:03 AM [info] GET /api/tasks 200 in 567ms :: [{"id":750,"title":"1. KYB Form: DevTest15","description":"Complete KYB verif...
6:55:03 AM [info] GET /api/tasks 304 in 32ms :: [{"id":750,"title":"1. KYB Form: DevTest15","description":"Complete KYB verif...
[INFO] [WebSocket] Received message from client client-1746514425315-aimhq76: {
  type: 'ping',
  timestamp: '2025-05-06T06:55:05.760Z',
  connectionId: 'ws_1746514424761_rreru1d2r'
}
6:55:06 AM [info] GET /api/companies/current 304 in 32ms :: {"id":270,"name":"DevTest15","category":"FinTech","is_demo":true,"revenue_tie...
[User Onboarding] Completing onboarding for user: 313
[User Onboarding] Updated user onboarding status: { id: 313, onboarding_completed: true }
6:55:08 AM [info] POST /api/user/complete-onboarding 200 in 65ms :: {"id":313,"email":"15@e.com","full_name":"John Doe","first_name":"John","last...
[Auth] Returning user session data
6:55:08 AM [info] GET /api/tasks 304 in 30ms :: [{"id":750,"title":"1. KYB Form: DevTest15","description":"Complete KYB verif...
6:55:08 AM [info] GET /api/tasks 304 in 33ms :: [{"id":750,"title":"1. KYB Form: DevTest15","description":"Complete KYB verif...
6:55:09 AM [info] GET /api/companies/current 304 in 32ms :: {"id":270,"name":"DevTest15","category":"FinTech","is_demo":true,"revenue_tie...
6:55:12 AM [info] GET /api/companies/current 304 in 33ms :: {"id":270,"name":"DevTest15","category":"FinTech","is_demo":true,"revenue_tie...
6:55:15 AM [info] GET /api/companies/current 304 in 33ms :: {"id":270,"name":"DevTest15","category":"FinTech","is_demo":true,"revenue_tie...
6:55:18 AM [info] GET /api/companies/current 304 in 32ms :: {"id":270,"name":"DevTest15","category":"FinTech","is_demo":true,"revenue_tie...
6:55:21 AM [info] GET /api/companies/current 304 in 31ms :: {"id":270,"name":"DevTest15","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746514462245-thf48qp: { type: 'ping' }
[INFO] [WebSocket] Received message from client client-1746514463260-hkz3rvl: {
  type: 'ping',
  timestamp: '2025-05-06T06:55:23.242Z',
  connectionId: 'ws_1746514462758_3o7de8ash'
}
6:55:23 AM [info] GET /api/tasks 304 in 32ms :: [{"id":750,"title":"1. KYB Form: DevTest15","description":"Complete KYB verif...
6:55:24 AM [info] GET /api/companies/current 304 in 34ms :: {"id":270,"name":"DevTest15","category":"FinTech","is_demo":true,"revenue_tie...
6:55:27 AM [info] GET /api/companies/current 304 in 32ms :: {"id":270,"name":"DevTest15","category":"FinTech","is_demo":true,"revenue_tie...
6:55:30 AM [info] GET /api/companies/current 304 in 32ms :: {"id":270,"name":"DevTest15","category":"FinTech","is_demo":true,"revenue_tie...
6:55:33 AM [info] GET /api/companies/current 304 in 32ms :: {"id":270,"name":"DevTest15","category":"FinTech","is_demo":true,"revenue_tie...
6:55:36 AM [info] GET /api/companies/current 304 in 31ms :: {"id":270,"name":"DevTest15","category":"FinTech","is_demo":true,"revenue_tie...
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 313, company_id: 270, email: '15@e.com' }
[2025-05-06T06:55:39.184Z] [INFO] Performing dynamic task unlocking check for company {"companyId":270,"userId":313}
6:55:39 AM [info] GET /api/companies/current 304 in 32ms :: {"id":270,"name":"DevTest15","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T06:55:39.214Z] [INFO] No completed KYB tasks found, skipping security task unlock check {"companyId":270}
[Tasks] Automatically unlocking all tasks for company { userId: 313, companyId: 270, requestedBy: 'automatic_task_unlock' }
[2025-05-06T06:55:39.215Z] [INFO] [TaskDependencies] Unlocking ALL tasks for company {"companyId":270}
[2025-05-06T06:55:39.246Z] [INFO] [TaskDependencies] Found tasks to unlock {"companyId":270,"count":3,"taskIds":[750,751,752],"taskTypes":["company_kyb","ky3p","open_banking"],"ky3pTaskCount":1,"ky3pTaskIds":[751]}
[2025-05-06T06:55:39.336Z] [INFO] [UnifiedProgressCalc] Calculated progress for task 750 (company_kyb): 0/30 = 0% {"taskId":750,"taskType":"company_kyb","totalFields":"30","completedFields":"0","progress":0}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  effectiveHasResponses: false,
  timestamp: '2025-05-06T06:55:39.367Z'
}
[STATUS DETERMINATION] Task has 0% progress and no responses, setting to NOT_STARTED
[2025-05-06T06:55:39.399Z] [INFO] [ProgressUpdate] Updated task 750 progress to 0% and status to not_started {"taskId":750,"taskType":"company_kyb","progress":0,"status":"not_started","previousStatus":"not_started"}
[WebSocket] Broadcast task_update to 4 clients (0 errors) { messageId: 'msg_1746514539399_kty60k7zh' }
[2025-05-06T06:55:39.400Z] [INFO] Successfully broadcasted task_update message
[2025-05-06T06:55:39.400Z] [INFO] [ProgressUpdate] Broadcasted progress update for task 750 {"taskId":750,"progress":0,"status":"not_started"}
[2025-05-06T06:55:39.400Z] [INFO] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":270,"taskId":750,"taskType":"company_kyb","isKy3pTask":false,"calculatedProgress":0,"previousProgress":0,"wasPreserved":false}
[2025-05-06T06:55:39.400Z] [INFO] [TaskDependencies] Processing KY3P task {"taskId":751,"taskType":"ky3p","currentProgress":60,"currentStatus":"in_progress","timestamp":"2025-05-06T06:55:39.400Z"}
[2025-05-06T06:55:39.429Z] [INFO] [UnifiedProgressCalc] Not preserving progress for KY3P task that was unlocked via dependencies: 751 {"taskId":751,"taskType":"ky3p","existingProgress":60,"operation":"recalculate-ky3p-progress"}
[2025-05-06T06:55:39.489Z] [INFO] [UnifiedProgressCalc] Calculated progress for task 751 (ky3p): 10/10 = 100% {"taskId":751,"taskType":"ky3p","totalFields":10,"completedFields":"10","progress":100}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 100,
  currentStatus: 'in_progress',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  effectiveHasResponses: true,
  timestamp: '2025-05-06T06:55:39.519Z'
}
[STATUS DETERMINATION] Task has 100% progress but is not submitted, setting to READY_FOR_SUBMISSION
[2025-05-06T06:55:39.550Z] [INFO] [ProgressUpdate] Updated task 751 progress to 100% and status to ready_for_submission {"taskId":751,"taskType":"ky3p","progress":100,"status":"ready_for_submission","previousStatus":"in_progress"}
[WebSocket] Broadcast task_update to 4 clients (0 errors) { messageId: 'msg_1746514539551_3hq60nj2w' }
[2025-05-06T06:55:39.551Z] [INFO] Successfully broadcasted task_update message
[2025-05-06T06:55:39.551Z] [INFO] [ProgressUpdate] Broadcasted progress update for task 751 {"taskId":751,"progress":100,"status":"ready_for_submission"}
[2025-05-06T06:55:39.551Z] [INFO] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":270,"taskId":751,"taskType":"ky3p","isKy3pTask":true,"calculatedProgress":100,"previousProgress":60,"wasPreserved":false}
[2025-05-06T06:55:39.639Z] [INFO] [UnifiedProgressCalc] Calculated progress for task 752 (open_banking): 0/44 = 0% {"taskId":752,"taskType":"open_banking","totalFields":"44","completedFields":"0","progress":0}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  effectiveHasResponses: false,
  timestamp: '2025-05-06T06:55:39.669Z'
}
[STATUS DETERMINATION] Task has 0% progress and no responses, setting to NOT_STARTED
[2025-05-06T06:55:39.700Z] [INFO] [ProgressUpdate] Updated task 752 progress to 0% and status to not_started {"taskId":752,"taskType":"open_banking","progress":0,"status":"not_started","previousStatus":"not_started"}
[WebSocket] Broadcast task_update to 4 clients (0 errors) { messageId: 'msg_1746514539701_nkfs0q7ny' }
[2025-05-06T06:55:39.701Z] [INFO] Successfully broadcasted task_update message
[2025-05-06T06:55:39.701Z] [INFO] [ProgressUpdate] Broadcasted progress update for task 752 {"taskId":752,"progress":0,"status":"not_started"}
[2025-05-06T06:55:39.701Z] [INFO] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":270,"taskId":752,"taskType":"open_banking","isKy3pTask":false,"calculatedProgress":0,"previousProgress":0,"wasPreserved":false}
[2025-05-06T06:55:39.701Z] [INFO] [TaskDependencies] Successfully unlocked all tasks {"companyId":270,"count":3}
[Tasks] Successfully unlocked all tasks for company: 270
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 313',
    condition2: 'tasks.created_by = 313',
    condition3: "tasks.company_id = 270 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('15@e.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
6:55:39 AM [info] GET /api/tasks 200 in 609ms :: [{"id":751,"title":"2. S&P KY3P Security Assessment: DevTest15","description"...
[INFO] [WebSocket] Received message from client client-1746514425315-aimhq76: {
  type: 'ping',
  timestamp: '2025-05-06T06:55:39.762Z',
  connectionId: 'ws_1746514424761_rreru1d2r'
}
6:55:40 AM [info] GET /api/companies/current 304 in 31ms :: {"id":270,"name":"DevTest15","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Client connected: client-1746514540521-cgw2na8
[INFO] [WebSocket] Received message from client client-1746514540521-cgw2na8: {
  type: 'authenticate',
  userId: null,
  companyId: null,
  clientId: 'ws_1746465182841_cysidkymn',
  timestamp: '2025-05-06T06:55:40.499Z'
}
[INFO] [WebSocket] Authentication from client client-1746514540521-cgw2na8: { userId: null, companyId: null, hasToken: true }
6:55:42 AM [info] GET /api/companies/current 304 in 32ms :: {"id":270,"name":"DevTest15","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746514463260-hkz3rvl: {
  type: 'ping',
  timestamp: '2025-05-06T06:55:43.242Z',
  connectionId: 'ws_1746514462758_3o7de8ash'
}
6:55:43 AM [info]