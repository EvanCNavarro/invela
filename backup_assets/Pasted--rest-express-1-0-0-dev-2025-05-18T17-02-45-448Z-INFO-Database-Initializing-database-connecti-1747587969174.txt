> rest-express@1.0.0 dev
[2025-05-18T17:02:45.448Z] [INFO] [Database] Initializing database connection with optimized settings for Neon PostgreSQL {"module":"Database"}
Database migrations disabled - schema already applied
[EmailService] Initializing email service
[EmailService] Email service initialized successfully
[OpenAI] Service initialized with API key: API key is set
[2025-05-18T17:02:45.541Z] [INFO] [NeonConnectionService] Initializing Neon Connection Service {"module":"NeonConnectionService"}
[WebSocketService] Initialized in fallback mode (WebSocket server not available)
[Auth] Setting up authentication...
[Auth] Setting up PostgreSQL session store
[Auth] PostgreSQL session store initialized successfully
[Auth] Authentication setup completed
[Routes] Registered KY3P form submission fix routes
[2025-05-18T17:02:45.661Z] [INFO] [App] [KY3P-BATCH-UPDATE] Registering KY3P batch update routes 
[2025-05-18T17:02:45.661Z] [INFO] [App] Registering KY3P batch update routes 
[2025-05-18T17:02:45.661Z] [INFO] [App] [UnifiedKY3P] Registering unified KY3P update routes 
[Routes] Registered KY3P field key router
[Routes] Registered KY3P field key router
[2025-05-18T17:02:45.662Z] [INFO] [App] Registering KY3P field update routes 
[Routes] Setting up unified clear fields router
[Routes] Successfully registered unified clear fields router
[Routes] Setting up task broadcast router
[Routes] Successfully registered task broadcast router
[2025-05-18T17:02:45.663Z] [INFO] [App] [OpenBankingRoutes] Setting up routes... 
[Routes] Setting up transaction-based unified form submission router
[Routes] Successfully registered transaction-based unified form submission router
[Routes] Setting up unified form submission router
[Routes] Successfully registered unified form submission router
[Routes] Setting up transactional form submission router
[Routes] Successfully registered transactional form submission router
[Routes] Routes setup completed
[2025-05-18T17:02:45.664Z] [INFO] [App] [WebSocket] Setting up unified WebSocket server on path /ws 
[2025-05-18T17:02:45.664Z] [INFO] [WebSocket] Unified WebSocket server initialized successfully {"module":"WebSocket","clients":0,"path":"/ws","id":"75w1xk","timestamp":"2025-05-18T17:02:45.664Z"}
[2025-05-18T17:02:45.664Z] [INFO] [App] [WebSocket] Unified WebSocket server initialized successfully 
[2025-05-18T17:02:45.665Z] [WARN] [App] [WebSocket] Form submission WebSocket initialization function not found 
[2025-05-18T17:02:45.665Z] [INFO] [App] [ServerStartup] WebSocket server initialized with unified implementation 
[2025-05-18T17:02:45.665Z] [INFO] [App] [TaskWebSocket] WebSocket server registered with unified implementation 
[2025-05-18T17:02:45.665Z] [INFO] [App] [ServerStartup] WebSocket server registered with task-update utility 
[TaskBroadcast] WebSocket server reference set up
[TaskBroadcast] WebSocket server active with 0 connected clients
[2025-05-18T17:02:45.665Z] [INFO] [App] [ServerStartup] WebSocket server registered with task-broadcast utility 
[2025-05-18T17:02:45.665Z] [INFO] [App] Setting up Vite development server 
[2025-05-18T17:02:45.666Z] [INFO] [App] [ENV] Server will listen on PORT=5000 (deployment mode: no) 
[2025-05-18T17:02:45.667Z] [INFO] [App] [ENV] Environment=development (NODE_ENV explicitly set) 
[2025-05-18T17:02:45.678Z] [INFO] [App] Server running on 0.0.0.0:5000 
[2025-05-18T17:02:45.678Z] [INFO] [App] Environment: development 
[Deployment] Server running on 0.0.0.0:5000
[Deployment] Environment: development
[Deployment] Port forwarding: Custom port: 5000
[Deployment] Development mode: Hot reloading enabled
[2025-05-18T17:02:45.678Z] [INFO] [App] Starting periodic task reconciliation system... 
[PeriodicTaskReconciliation] Stopped periodic reconciliation system
[PeriodicTaskReconciliation] Starting periodic reconciliation system (interval: 300000ms)
[2025-05-18T17:02:45.678Z] [INFO] [App] Task reconciliation system initialized successfully 
[2025-05-18T17:02:46.665Z] [INFO] [App] [ServerStartup] WebSocket server active with 0 connected clients 
[2025-05-18T17:02:46.715Z] [INFO] [Database] New database connection established {"module":"Database"}
[2025-05-18T17:02:48.566Z] [INFO] [Database] New database connection established {"module":"Database"}
[2025-05-18T17:02:55.678Z] [INFO] [App] Running background health checks... 
[2025-05-18T17:02:55.679Z] [StartupChecks] Running application startup health checks... 
[2025-05-18T17:02:55.679Z] [StartupChecks] Database health check attempt 1/3 
[2025-05-18T17:02:55.680Z] [INFO] [NeonConnectionService] Creating minimal connection pool for Neon PostgreSQL {"module":"NeonConnectionService"}
[2025-05-18T17:02:55.902Z] [INFO] [NeonConnectionService] New client connected to the pool {"module":"NeonConnectionService"}
[2025-05-18T17:02:55.931Z] [INFO] [NeonConnectionService] Connection pool initialized successfully {"module":"NeonConnectionService"}
[2025-05-18T17:02:55.960Z] [DBConnectionService] Database connection check successful 
[2025-05-18T17:02:55.960Z] [StartupChecks] Database health check passed 
[2025-05-18T17:02:55.960Z] [StartupChecks] All startup health checks passed! 
[2025-05-18T17:02:55.960Z] [INFO] [App] All background health checks passed successfully. 
[2025-05-18T17:03:11.795Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1747587791795-4cpg4ve","clients":1}
[2025-05-18T17:03:11.807Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1747587791807-w2pqm4g","clients":2}
[2025-05-18T17:03:11.861Z] [WARN] [App] GET /api/companies/current 401 in 4ms :: {"error":"Unauthorized","message":"Authentication required","details":{"authe... 
[2025-05-18T17:03:11.863Z] [WARN] [App] GET /api/tasks 401 in 1ms :: {"error":"Unauthorized","message":"Authentication required","details":{"authe... 
[2025-05-18T17:03:11.865Z] [WARN] [App] GET /api/companies/1 401 in 1ms :: {"error":"Unauthorized","message":"Authentication required","details":{"authe... 
[2025-05-18T17:03:11.866Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1747587791866-5t0mox2","clients":3}
[Auth] Unauthenticated user session
[2025-05-18T17:03:11.893Z] [INFO] [WebSocket] Received message from client client-1747587791795-4cpg4ve {"module":"WebSocket","type":"authenticate","data":{"timestamp":"2025-05-18T17:03:11.892Z"}}
[2025-05-18T17:03:11.894Z] [INFO] [WebSocket] Authentication from client client-1747587791795-4cpg4ve {"module":"WebSocket","hasToken":true}
[2025-05-18T17:03:11.923Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1747587791923-278ul6a","clients":4}
[2025-05-18T17:03:11.934Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1747587791934-lfxchu5","clients":5}
[2025-05-18T17:03:11.942Z] [INFO] [WebSocket] Received message from client client-1747587791866-5t0mox2 {"module":"WebSocket","type":"authenticate","userId":null,"companyId":null,"clientId":"ws_1747587791232_fbbnk0hb2","timestamp":"2025-05-18T17:03:11.941Z"}
[2025-05-18T17:03:11.942Z] [INFO] [WebSocket] Authentication from client client-1747587791866-5t0mox2 {"module":"WebSocket","userId":null,"companyId":null,"hasToken":true}
[2025-05-18T17:03:12.178Z] [INFO] [WebSocket] Client disconnected {"module":"WebSocket","clientId":"client-1747587791923-278ul6a","code":1001,"reason":"","remainingClients":4}
[2025-05-18T17:03:12.180Z] [INFO] [WebSocket] Client disconnected {"module":"WebSocket","clientId":"client-1747587791795-4cpg4ve","code":1001,"reason":"","remainingClients":3}
[2025-05-18T17:03:12.180Z] [INFO] [WebSocket] Client disconnected {"module":"WebSocket","clientId":"client-1747587791934-lfxchu5","code":1001,"reason":"","remainingClients":2}
[2025-05-18T17:03:12.180Z] [INFO] [WebSocket] Client disconnected {"module":"WebSocket","clientId":"client-1747587791807-w2pqm4g","code":1001,"reason":"","remainingClients":1}
[2025-05-18T17:03:12.180Z] [INFO] [WebSocket] Client disconnected {"module":"WebSocket","clientId":"client-1747587791866-5t0mox2","code":1001,"reason":"","remainingClients":0}
[PeriodicTaskReconciliation] Reconciling batch of 10 tasks: [
  963, 964, 965, 968,
  969, 973, 972, 967,
  971, 981
]
[Task Progress] Calculated progress for task 963 (company_kyb): 0/30 = 0%
[Task Progress] Calculated progress for task 964 (ky3p): 0/0 = 0%
[Task Progress] Calculated progress for task 965 (open_banking): 0/44 = 0%
[Task Progress] Calculated progress for task 968 (ky3p): 0/0 = 0%
[Task Progress] Calculated progress for task 969 (open_banking): 0/44 = 0%
[Task Progress] Calculated progress for task 973 (open_banking): 0/44 = 0%
[Task Progress] Calculated progress for task 972 (ky3p): 0/0 = 0%
[Task Progress] Calculated progress for task 967 (company_kyb): 0/30 = 0%
[Task Progress] Calculated progress for task 971 (company_kyb): 30/30 = 100%
[Task Progress] Calculated progress for task 981 (ky3p): 0/0 = 0%
[2025-05-18T17:04:38.142Z] [ERROR] [NeonConnectionService] Pool error event: {"module":"NeonConnectionService","length":116,"name":"error","severity":"FATAL","code":"57P01","file":"postgres.c","line":"3318","routine":"ProcessInterrupts","client":{"_events":{},"_eventsCount":1,"connectionParameters":{"user":"neondb_owner","database":"neondb","port":5432,"host":"ep-wild-water-a4ulbqlb.us-east-1.aws.neon.tech","binary":false,"ssl":{},"client_encoding":"","isDomainSocket":false,"statement_timeout":false,"lock_timeout":false,"idle_in_transaction_session_timeout":false,"query_timeout":false,"connect_timeout":180},"user":"neondb_owner","database":"neondb","port":5432,"host":"ep-wild-water-a4ulbqlb.us-east-1.aws.neon.tech","_types":{"_types":{"arrayParser":{},"builtins":{"BOOL":16,"BYTEA":17,"CHAR":18,"INT8":20,"INT2":21,"INT4":23,"REGPROC":24,"TEXT":25,"OID":26,"TID":27,"XID":28,"CID":29,"JSON":114,"XML":142,"PG_NODE_TREE":194,"SMGR":210,"PATH":602,"POLYGON":604,"CIDR":650,"FLOAT4":700,"FLOAT8":701,"ABSTIME":702,"RELTIME":703,"TINTERVAL":704,"CIRCLE":718,"MACADDR8":774,"MONEY":790,"MACADDR":829,"INET":869,"ACLITEM":1033,"BPCHAR":1042,"VARCHAR":1043,"DATE":1082,"TIME":1083,"TIMESTAMP":1114,"TIMESTAMPTZ":1184,"INTERVAL":1186,"TIMETZ":1266,"BIT":1560,"VARBIT":1562,"NUMERIC":1700,"REFCURSOR":1790,"REGPROCEDURE":2202,"REGOPER":2203,"REGOPERATOR":2204,"REGCLASS":2205,"REGTYPE":2206,"UUID":2950,"TXID_SNAPSHOT":2970,"PG_LSN":3220,"PG_NDISTINCT":3361,"PG_DEPENDENCIES":3402,"TSVECTOR":3614,"TSQUERY":3615,"GTSVECTOR":3642,"REGCONFIG":3734,"REGDICTIONARY":3769,"JSONB":3802,"REGNAMESPACE":4089,"REGROLE":4096}},"text":{},"binary":{}},"_ending":true,"_ended":false,"_connecting":false,"_connected":true,"_connectionError":false,"_queryable":false,"enableChannelBinding":false,"connection":{"_events":{"end":[null,null]},"_eventsCount":23,"stream":{"_tlsOptions":{"pipe":false,"secureContext":{"context":{}},"isServer":false,"requestCert":true,"rejectUnauthorized":true},"_secureEstablished":true,"_securePending":false,"_newSessionPending":false,"_controlReleased":true,"secureConnecting":false,"_SNICallback":null,"servername":"ep-wild-water-a4ulbqlb.us-east-1.aws.neon.tech","alpnProtocol":false,"authorized":true,"authorizationError":null,"encrypted":true,"_events":{"end":[null,null],"newListener":[null,null]},"_eventsCount":6,"connecting":false,"_hadError":false,"_parent":{"connecting":false,"_hadError":false,"_parent":null,"_host":"ep-wild-water-a4ulbqlb.us-east-1.aws.neon.tech","_closeAfterHandlingError":false,"_events":{"close":[null,null,null],"error":[null,null]},"_readableState":{"highWaterMark":16384,"buffer":[],"bufferIndex":0,"length":0,"pipes":[],"awaitDrainWriters":null},"_writableState":{"highWaterMark":16384,"length":0,"corked":0,"writelen":0,"bufferedIndex":0,"pendingcb":0},"allowHalfOpen":false,"_eventsCount":4,"_sockname":null,"_pendingData":null,"_pendingEncoding":"","server":null,"_server":null,"autoSelectFamilyAttemptedAddresses":["23.23.229.9:5432"]},"_host":null,"_closeAfterHandlingError":false,"_readableState":{"highWaterMark":16384,"buffer":[],"bufferIndex":0,"length":0,"pipes":[],"awaitDrainWriters":null},"_writableState":{"highWaterMark":16384,"length":0,"corked":0,"writelen":0,"bufferedIndex":0,"pendingcb":0},"allowHalfOpen":false,"_sockname":null,"_pendingData":null,"_pendingEncoding":"","_server":null,"ssl":null,"_requestCert":true,"_rejectUnauthorized":true},"_keepAlive":false,"_keepAliveInitialDelayMillis":0,"lastBuffer":false,"parsedStatements":{},"ssl":{},"_ending":false,"_emitMessage":false,"_connecting":true},"queryQueue":[],"binary":false,"processID":986548501,"secretKey":-890344756,"ssl":{},"_connectionTimeoutMillis":180000,"_connectionCallback":null,"connectionTimeoutHandle":{"_idleTimeout":-1,"_idlePrev":null,"_idleNext":null,"_idleStart":11953,"_onTimeout":null,"_repeat":null,"_destroyed":true},"saslSession":null,"activeQuery":null,"readyForQuery":true,"hasExecuted":true,"_poolUseCount":2}}
[2025-05-18T17:04:38.143Z] [ERROR] [Database] Client-specific error: {"module":"Database","message":"terminating connection due to administrator command","code":"57P01"}
[2025-05-18T17:04:38.147Z] [ERROR] [Database] Database pool error: {"module":"Database","message":"terminating connection due to administrator command","code":"57P01","stack":"error: terminating connection due to administrator command\n    at Parser.parseErrorMessage (/home/runner/workspace/node_modules/pg-protocol/src/parser.ts:369:69)\n    at Parser.handlePacket (/home/runner/workspace/node_modules/pg-protocol/src/parser.ts:187:21)\n    at Parser.parse (/home/runner/workspace/node_modules/pg-protocol/src/parser.ts:102:30)\n    at TLSSocket.<anonymous> (/home/runner/workspace/node_modules/pg-protocol/src/index.ts:7:48)\n    at TLSSocket.emit (node:events:518:28)\n    at addChunk (node:internal/streams/readable:561:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:512:3)\n    at Readable.push (node:internal/streams/readable:392:5)\n    at TLSWrap.onStreamRead (node:internal/stream_base_commons:191:23)"}
[2025-05-18T17:04:38.148Z] [ERROR] [Database] Client-specific error: {"module":"Database","message":"terminating connection due to administrator command","code":"57P01"}
[2025-05-18T17:04:38.148Z] [ERROR] [Database] Database pool error: {"module":"Database","message":"terminating connection due to administrator command","code":"57P01","stack":"error: terminating connection due to administrator command\n    at Parser.parseErrorMessage (/home/runner/workspace/node_modules/pg-protocol/src/parser.ts:369:69)\n    at Parser.handlePacket (/home/runner/workspace/node_modules/pg-protocol/src/parser.ts:187:21)\n    at Parser.parse (/home/runner/workspace/node_modules/pg-protocol/src/parser.ts:102:30)\n    at TLSSocket.<anonymous> (/home/runner/workspace/node_modules/pg-protocol/src/index.ts:7:48)\n    at TLSSocket.emit (node:events:518:28)\n    at addChunk (node:internal/streams/readable:561:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:512:3)\n    at Readable.push (node:internal/streams/readable:392:5)\n    at TLSWrap.onStreamRead (node:internal/stream_base_commons:191:23)"}