> rest-express@1.0.0 dev
> tsx server/index.ts

[EmailService] Initializing email service
[EmailService] Email service initialized successfully
[Auth] Setting up authentication...
[Auth] Authentication setup completed
[Routes] Routes setup completed
[WebSocket] Server initialized on path: /ws
10:59:59 PM [info] Setting up Vite development server
10:59:59 PM [express] Server running on port 5000
[2025-02-26T22:59:59.543Z] New client connected to the pool
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[2025-02-26T23:00:02.623Z] New client connected to the pool
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[2025-02-26T23:00:02.979Z] New client connected to the pool
[2025-02-26T23:00:03.036Z] New client connected to the pool
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
New WebSocket client connected
[Auth] Deserializing user: 129
[Auth] Unauthenticated user session
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
WebSocket client disconnected with code 1001 and reason: 
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
New WebSocket client connected
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Returning user session data
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Auth] Returning user session data
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 129, company_id: 95, email: 'evancnavarro@gmail.com' }
[Current Company] Fetching company for user: { userId: 129, companyId: 95 }
[Tasks] KYB tasks found: {
  count: 1,
  tasks: [
    {
      id: 143,
      company_id: 95,
      task_scope: 'company',
      task_type: 'company_kyb',
      assigned_to: null,
      status: 'in_progress'
    }
  ]
}
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 129',
    condition2: 'tasks.created_by = 129',
    condition3: "tasks.company_id = 95 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('evancnavarro@gmail.com')"
  }
}
[Current Company] Found company: { id: 95, name: 'Wealthfront', onboardingCompleted: false }
[Tasks] Tasks found: {
  count: 3,
  tasks: [
    {
      id: 145,
      title: 'Company CARD: Wealthfront',
      assigned_to: 129,
      company_id: 95,
      task_scope: 'company',
      task_type: 'company_card',
      status: 'not_started'
    },
    {
      id: 143,
      title: 'Company KYB: Wealthfront',
      assigned_to: null,
      company_id: 95,
      task_scope: 'company',
      task_type: 'company_kyb',
      status: 'in_progress'
    },
    {
      id: 144,
      title: 'New User Invitation: evancnavarro@gmail.com',
      assigned_to: 129,
      company_id: 95,
      task_scope: 'user',
      task_type: 'user_onboarding',
      status: 'completed'
    }
  ]
}
11:00:10 PM [info] GET /api/companies/current 304 in 60ms :: {"id":95,"name":"Wealthfront","description":"FinTech partner company Wealthfr...
11:00:10 PM [info] GET /api/tasks 304 in 92ms :: [{"id":145,"title":"Company CARD: Wealthfront","description":"Provide Complia...
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
New WebSocket client connected
[Auth] Deserializing user: 129
[Current Company] Fetching company for user: { userId: 129, companyId: 95 }
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 129, company_id: 95, email: 'evancnavarro@gmail.com' }
[Current Company] Found company: { id: 95, name: 'Wealthfront', onboardingCompleted: false }
[Tasks] KYB tasks found: {
  count: 1,
  tasks: [
    {
      id: 143,
      company_id: 95,
      task_scope: 'company',
      task_type: 'company_kyb',
      assigned_to: null,
      status: 'in_progress'
    }
  ]
}
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 129',
    condition2: 'tasks.created_by = 129',
    condition3: "tasks.company_id = 95 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('evancnavarro@gmail.com')"
  }
}
11:00:10 PM [info] GET /api/companies/current 304 in 61ms :: {"id":95,"name":"Wealthfront","description":"FinTech partner company Wealthfr...
[Tasks] Tasks found: {
  count: 3,
  tasks: [
    {
      id: 145,
      title: 'Company CARD: Wealthfront',
      assigned_to: 129,
      company_id: 95,
      task_scope: 'company',
      task_type: 'company_card',
      status: 'not_started'
    },
    {
      id: 143,
      title: 'Company KYB: Wealthfront',
      assigned_to: null,
      company_id: 95,
      task_scope: 'company',
      task_type: 'company_kyb',
      status: 'in_progress'
    },
    {
      id: 144,
      title: 'New User Invitation: evancnavarro@gmail.com',
      assigned_to: 129,
      company_id: 95,
      task_scope: 'user',
      task_type: 'user_onboarding',
      status: 'completed'
    }
  ]
}
11:00:11 PM [info] GET /api/tasks 304 in 98ms :: [{"id":145,"title":"Company CARD: Wealthfront","description":"Provide Complia...
[Auth] Deserializing user: 129
[Auth] Deserializing user: 129
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 129, company_id: 95, email: 'evancnavarro@gmail.com' }
[Tasks] KYB tasks found: {
  count: 1,
  tasks: [
    {
      id: 143,
      company_id: 95,
      task_scope: 'company',
      task_type: 'company_kyb',
      assigned_to: null,
      status: 'in_progress'
    }
  ]
}
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 129',
    condition2: 'tasks.created_by = 129',
    condition3: "tasks.company_id = 95 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('evancnavarro@gmail.com')"
  }
}
[Auth] Deserializing user: 129
[Tasks] Tasks found: {
  count: 3,
  tasks: [
    {
      id: 145,
      title: 'Company CARD: Wealthfront',
      assigned_to: 129,
      company_id: 95,
      task_scope: 'company',
      task_type: 'company_card',
      status: 'not_started'
    },
    {
      id: 143,
      title: 'Company KYB: Wealthfront',
      assigned_to: null,
      company_id: 95,
      task_scope: 'company',
      task_type: 'company_kyb',
      status: 'in_progress'
    },
    {
      id: 144,
      title: 'New User Invitation: evancnavarro@gmail.com',
      assigned_to: 129,
      company_id: 95,
      task_scope: 'user',
      task_type: 'user_onboarding',
      status: 'completed'
    }
  ]
}
11:00:11 PM [info] GET /api/tasks 304 in 89ms :: [{"id":145,"title":"Company CARD: Wealthfront","description":"Provide Complia...
[Auth] Deserializing user: 129
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 129, company_id: 95, email: 'evancnavarro@gmail.com' }
New WebSocket client connected
[Tasks] KYB tasks found: {
  count: 1,
  tasks: [
    {
      id: 143,
      company_id: 95,
      task_scope: 'company',
      task_type: 'company_kyb',
      assigned_to: null,
      status: 'in_progress'
    }
  ]
}
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 129',
    condition2: 'tasks.created_by = 129',
    condition3: "tasks.company_id = 95 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('evancnavarro@gmail.com')"
  }
}
[Tasks] Tasks found: {
  count: 3,
  tasks: [
    {
      id: 145,
      title: 'Company CARD: Wealthfront',
      assigned_to: 129,
      company_id: 95,
      task_scope: 'company',
      task_type: 'company_card',
      status: 'not_started'
    },
    {
      id: 143,
      title: 'Company KYB: Wealthfront',
      assigned_to: null,
      company_id: 95,
      task_scope: 'company',
      task_type: 'company_kyb',
      status: 'in_progress'
    },
    {
      id: 144,
      title: 'New User Invitation: evancnavarro@gmail.com',
      assigned_to: 129,
      company_id: 95,
      task_scope: 'user',
      task_type: 'user_onboarding',
      status: 'completed'
    }
  ]
}
11:00:11 PM [info] GET /api/tasks 304 in 92ms :: [{"id":145,"title":"Company CARD: Wealthfront","description":"Provide Complia...
New WebSocket client connected
WebSocket client disconnected with code 1005 and reason: 
[Auth] Deserializing user: 129
11:00:12 PM [info] GET /api/tasks/card/Wealthfront 200 in 37ms
[Auth] Deserializing user: 129
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 129, company_id: 95, email: 'evancnavarro@gmail.com' }
[Tasks] KYB tasks found: {
  count: 1,
  tasks: [
    {
      id: 143,
      company_id: 95,
      task_scope: 'company',
      task_type: 'company_kyb',
      assigned_to: null,
      status: 'in_progress'
    }
  ]
}
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 129',
    condition2: 'tasks.created_by = 129',
    condition3: "tasks.company_id = 95 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('evancnavarro@gmail.com')"
  }
}
[Tasks] Tasks found: {
  count: 3,
  tasks: [
    {
      id: 145,
      title: 'Company CARD: Wealthfront',
      assigned_to: 129,
      company_id: 95,
      task_scope: 'company',
      task_type: 'company_card',
      status: 'not_started'
    },
    {
      id: 143,
      title: 'Company KYB: Wealthfront',
      assigned_to: null,
      company_id: 95,
      task_scope: 'company',
      task_type: 'company_kyb',
      status: 'in_progress'
    },
    {
      id: 144,
      title: 'New User Invitation: evancnavarro@gmail.com',
      assigned_to: 129,
      company_id: 95,
      task_scope: 'user',
      task_type: 'user_onboarding',
      status: 'completed'
    }
  ]
}
11:00:12 PM [info] GET /api/tasks 304 in 91ms :: [{"id":145,"title":"Company CARD: Wealthfront","description":"Provide Complia...
New WebSocket client connected
[Auth] Deserializing user: 129
[Current Company] Fetching company for user: { userId: 129, companyId: 95 }
[Current Company] Found company: { id: 95, name: 'Wealthfront', onboardingCompleted: false }
[Auth] Deserializing user: 129
11:00:16 PM [info] GET /api/companies/current 304 in 64ms :: {"id":95,"name":"Wealthfront","description":"FinTech partner company Wealthfr...
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 129, company_id: 95, email: 'evancnavarro@gmail.com' }
[Tasks] KYB tasks found: {
  count: 1,
  tasks: [
    {
      id: 143,
      company_id: 95,
      task_scope: 'company',
      task_type: 'company_kyb',
      assigned_to: null,
      status: 'in_progress'
    }
  ]
}
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 129',
    condition2: 'tasks.created_by = 129',
    condition3: "tasks.company_id = 95 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('evancnavarro@gmail.com')"
  }
}
[Tasks] Tasks found: {
  count: 3,
  tasks: [
    {
      id: 145,
      title: 'Company CARD: Wealthfront',
      assigned_to: 129,
      company_id: 95,
      task_scope: 'company',
      task_type: 'company_card',
      status: 'not_started'
    },
    {
      id: 143,
      title: 'Company KYB: Wealthfront',
      assigned_to: null,
      company_id: 95,
      task_scope: 'company',
      task_type: 'company_kyb',
      status: 'in_progress'
    },
    {
      id: 144,
      title: 'New User Invitation: evancnavarro@gmail.com',
      assigned_to: 129,
      company_id: 95,
      task_scope: 'user',
      task_type: 'user_onboarding',
      status: 'completed'
    }
  ]
}
11:00:16 PM [info] GET /api/tasks 304 in 92ms :: [{"id":145,"title":"Company CARD: Wealthfront","description":"Provide Complia...
[Auth] Deserializing user: 129
[Current Company] Fetching company for user: { userId: 129, companyId: 95 }
[Current Company] Found company: { id: 95, name: 'Wealthfront', onboardingCompleted: false }
11:00:17 PM [info] GET /api/companies/current 304 in 59ms :: {"id":95,"name":"Wealthfront","description":"FinTech partner company Wealthfr...
[Auth] Deserializing user: 129
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 129, company_id: 95, email: 'evancnavarro@gmail.com' }
[Tasks] KYB tasks found: {
  count: 1,
  tasks: [
    {
      id: 143,
      company_id: 95,
      task_scope: 'company',
      task_type: 'company_kyb',
      assigned_to: null,
      status: 'in_progress'
    }
  ]
}
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 129',
    condition2: 'tasks.created_by = 129',
    condition3: "tasks.company_id = 95 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('evancnavarro@gmail.com')"
  }
}
[Tasks] Tasks found: {
  count: 3,
  tasks: [
    {
      id: 145,
      title: 'Company CARD: Wealthfront',
      assigned_to: 129,
      company_id: 95,
      task_scope: 'company',
      task_type: 'company_card',
      status: 'not_started'
    },
    {
      id: 143,
      title: 'Company KYB: Wealthfront',
      assigned_to: null,
      company_id: 95,
      task_scope: 'company',
      task_type: 'company_kyb',
      status: 'in_progress'
    },
    {
      id: 144,
      title: 'New User Invitation: evancnavarro@gmail.com',
      assigned_to: 129,
      company_id: 95,
      task_scope: 'user',
      task_type: 'user_onboarding',
      status: 'completed'
    }
  ]
}
11:00:18 PM [info] GET /api/tasks 304 in 89ms :: [{"id":145,"title":"Company CARD: Wealthfront","description":"Provide Complia...