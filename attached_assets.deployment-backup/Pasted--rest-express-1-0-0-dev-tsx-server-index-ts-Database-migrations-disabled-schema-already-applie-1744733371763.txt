> rest-express@1.0.0 dev
> tsx server/index.ts

Database migrations disabled - schema already applied
[EmailService] Initializing email service
[EmailService] Email service initialized successfully
[Auth] Setting up authentication...
[Auth] Authentication setup completed
[Routes] Routes setup completed
[WebSocket] Server initialized on path: /ws
4:05:01 PM [info] Setting up Vite development server
4:05:01 PM [express] Server running on port 5000
[Auth] Unauthenticated user session
[2025-04-15T16:06:00.533Z] New client connected to the pool (1/3)
[Auth] Deserializing user: 210
[2025-04-15T16:06:02.188Z] New client connected to the pool (2/3)
[2025-04-15T16:06:04.860Z] New client connected to the pool (3/3)
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Returning user session data
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 210, company_id: 169, email: 'e.vancnavarr.o@gmail.com' }
[Current Company] Fetching company for user: { userId: 210, companyId: 169 }
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 210',
    condition2: 'tasks.created_by = 210',
    condition3: "tasks.company_id = 169 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('e.vancnavarr.o@gmail.com')"
  }
}
[Current Company] Found company: {
  id: 169,
  name: 'DevelopmentTesting',
  onboardingCompleted: false,
  riskScore: null
}
[Tasks] Tasks found: { count: 4 }
4:06:25 PM [info] GET /api/companies/current 304 in 86ms :: {"id":169,"name":"DevelopmentTesting","description":"FinTech partner company ...
4:06:25 PM [info] GET /api/tasks 200 in 119ms :: [{"id":347,"title":"New User Invitation: e.vancnavarr.o@gmail.com","descripti...
New WebSocket client connected
4:06:27 PM [info] GET /api/tasks 304 in 32ms :: [{"id":347,"title":"New User Invitation: e.vancnavarr.o@gmail.com","descripti...
New WebSocket client connected
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Returning user session data
[Network Visualization] Fetching network data for company: 169
4:06:54 PM [info] GET /api/tasks 200 in 32ms :: [{"id":347,"title":"New User Invitation: e.vancnavarr.o@gmail.com","descripti...
4:06:54 PM [info] GET /api/companies/current 304 in 32ms :: {"id":169,"name":"DevelopmentTesting","description":"FinTech partner company ...
[Network Visualization] Found network relationships: { count: 2 }
[Network Visualization] Returning visualization data: { centerNode: 'DevelopmentTesting', nodeCount: 2 }
4:06:54 PM [info] GET /api/network/visualization 304 in 133ms :: {"center":{"id":169,"name":"DevelopmentTesting","riskScore":0,"riskBucket":"l...
New WebSocket client connected
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 210, company_id: 169, email: 'e.vancnavarr.o@gmail.com' }
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 210',
    condition2: 'tasks.created_by = 210',
    condition3: "tasks.company_id = 169 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('e.vancnavarr.o@gmail.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
4:06:56 PM [info] GET /api/tasks 304 in 92ms :: [{"id":347,"title":"New User Invitation: e.vancnavarr.o@gmail.com","descripti...
4:07:01 PM [info] GET /api/tasks 304 in 31ms :: [{"id":347,"title":"New User Invitation: e.vancnavarr.o@gmail.com","descripti...
New WebSocket client connected
[Tasks] Using cached task data for user: 210
4:07:08 PM [info] GET /api/tasks 304 in 31ms :: [{"id":347,"title":"New User Invitation: e.vancnavarr.o@gmail.com","descripti...
[WebSocket] Received pong
4:07:14 PM [info] GET /api/tasks 304 in 30ms :: [{"id":347,"title":"New User Invitation: e.vancnavarr.o@gmail.com","descripti...
[WebSocket] Received pong
[WebSocket] Received message: {
  type: 'pong',
  payload: { timestamp: '2025-04-15T16:07:16.384Z' },
  connectionId: 'ws-1'
}
4:07:21 PM [info] GET /api/tasks 304 in 31ms :: [{"id":347,"title":"New User Invitation: e.vancnavarr.o@gmail.com","descripti...
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 210, company_id: 169, email: 'e.vancnavarr.o@gmail.com' }
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 210',
    condition2: 'tasks.created_by = 210',
    condition3: "tasks.company_id = 169 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('e.vancnavarr.o@gmail.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
4:07:28 PM [info] GET /api/tasks 304 in 98ms :: [{"id":347,"title":"New User Invitation: e.vancnavarr.o@gmail.com","descripti...
4:07:33 PM [info] GET /api/tasks 304 in 31ms :: [{"id":347,"title":"New User Invitation: e.vancnavarr.o@gmail.com","descripti...
[Auth] Using cached user data: 210
4:07:38 PM [info] GET /api/tasks 304 in 31ms :: [{"id":347,"title":"New User Invitation: e.vancnavarr.o@gmail.com","descripti...
[WebSocket] Received pong
[Tasks] Using cached task data for user: 210
4:07:44 PM [info] GET /api/tasks 304 in 31ms :: [{"id":347,"title":"New User Invitation: e.vancnavarr.o@gmail.com","descripti...
[Auth] Processing /api/auth/user request
[Auth] Request authentication state: {
  isAuthenticated: true,
  hasUser: true,
  sessionID: 'OhfH_cP-qDZlt8kxQNrOJEJfml-zZ3fl'
}
[Auth] Returning user session data: { id: 210, email: 'e.vancnavarr.o@gmail.com', company_id: 169 }
4:07:46 PM [info] GET /api/tasks 304 in 31ms :: [{"id":347,"title":"New User Invitation: e.vancnavarr.o@gmail.com","descripti...
[Files] Starting file fetch request
[Files] Request parameters: {
  companyId: '169',
  userId: 210,
  query: { company_id: '169', page: '1', pageSize: '5' },
  user: {
    id: 210,
    email: 'e.vancnavarr.o@gmail.com',
    full_name: 'John Doe',
    first_name: 'John',
    last_name: 'Doe',
    password: '$2b$10$1WfQz57HicQ4mh2szQyfZev.mMO8BtK24MMvCrxZNZL9c0jlb/RHy',
    company_id: 169,
    onboarding_user_completed: true,
    created_at: 2025-04-13T14:38:35.821Z,
    updated_at: 2025-04-13T14:45:22.913Z
  }
}
[Files] Executing database query for company: 169
[Files] Query results: {
  recordCount: 5,
  totalFiles: 7,
  page: 1,
  pageSize: 5,
  firstRecord: {
    id: 669,
    name: 'kyb_form_348_2025-04-15T160146.csv',
    size: 2940,
    type: 'text/csv',
    path: '/uploads/kyb_348_1744732906646.csv',
    status: 'active',
    user_id: 210,
    company_id: 169,
    document_category: null,
    classification_status: 'pending',
    classification_confidence: null,
    created_at: 2025-04-15T16:01:46.646Z,
    updated_at: 2025-04-15T16:01:46.646Z,
    upload_time: 2025-04-15T16:01:46.662Z,
    download_count: 0,
    version: 1,
    metadata: {
      fields: [Array],
      taskId: 348,
      taskType: 'kyb',
      formVersion: '1.0',
      submissionDate: '2025-04-15T16:01:46.646Z'
    }
  },
  lastRecord: {
    id: 665,
    name: 'kyb_form_348_2025-04-15T151320.csv',
    size: 2940,
    type: 'text/csv',
    path: '/uploads/kyb_348_1744730000742.csv',
    status: 'active',
    user_id: 210,
    company_id: 169,
    document_category: null,
    classification_status: 'pending',
    classification_confidence: null,
    created_at: 2025-04-15T15:13:20.742Z,
    updated_at: 2025-04-15T15:13:20.742Z,
    upload_time: 2025-04-15T15:13:20.757Z,
    download_count: 0,
    version: 1,
    metadata: {
      fields: [Array],
      taskId: 348,
      taskType: 'kyb',
      formVersion: '1.0',
      submissionDate: '2025-04-15T15:13:20.742Z'
    }
  }
}
4:07:47 PM [info] GET /api/files 200 in 114ms :: {"data":[{"id":669,"name":"kyb_form_348_2025-04-15T160146.csv","size":2940,"t...
4:07:47 PM [info] GET /api/tasks 304 in 32ms :: [{"id":347,"title":"New User Invitation: e.vancnavarr.o@gmail.com","descripti...
[WebSocket] Received pong
[WebSocket] Received message: {
  type: 'pong',
  payload: { timestamp: '2025-04-15T16:07:47.153Z' },
  connectionId: 'ws-1'
}
4:07:52 PM [info] GET /api/tasks 304 in 36ms :: [{"id":347,"title":"New User Invitation: e.vancnavarr.o@gmail.com","descripti...
[Files] Starting file fetch request
[Files] Request parameters: {
  companyId: '169',
  userId: 210,
  query: { company_id: '169', page: '1', pageSize: '5' },
  user: {
    id: 210,
    email: 'e.vancnavarr.o@gmail.com',
    full_name: 'John Doe',
    first_name: 'John',
    last_name: 'Doe',
    password: '$2b$10$1WfQz57HicQ4mh2szQyfZev.mMO8BtK24MMvCrxZNZL9c0jlb/RHy',
    company_id: 169,
    onboarding_user_completed: true,
    created_at: 2025-04-13T14:38:35.821Z,
    updated_at: 2025-04-13T14:45:22.913Z
  }
}
[Files] Executing database query for company: 169
[Files] Query results: {
  recordCount: 5,
  totalFiles: 7,
  page: 1,
  pageSize: 5,
  firstRecord: {
    id: 669,
    name: 'kyb_form_348_2025-04-15T160146.csv',
    size: 2940,
    type: 'text/csv',
    path: '/uploads/kyb_348_1744732906646.csv',
    status: 'active',
    user_id: 210,
    company_id: 169,
    document_category: null,
    classification_status: 'pending',
    classification_confidence: null,
    created_at: 2025-04-15T16:01:46.646Z,
    updated_at: 2025-04-15T16:01:46.646Z,
    upload_time: 2025-04-15T16:01:46.662Z,
    download_count: 0,
    version: 1,
    metadata: {
      fields: [Array],
      taskId: 348,
      taskType: 'kyb',
      formVersion: '1.0',
      submissionDate: '2025-04-15T16:01:46.646Z'
    }
  },
  lastRecord: {
    id: 665,
    name: 'kyb_form_348_2025-04-15T151320.csv',
    size: 2940,
    type: 'text/csv',
    path: '/uploads/kyb_348_1744730000742.csv',
    status: 'active',
    user_id: 210,
    company_id: 169,
    document_category: null,
    classification_status: 'pending',
    classification_confidence: null,
    created_at: 2025-04-15T15:13:20.742Z,
    updated_at: 2025-04-15T15:13:20.742Z,
    upload_time: 2025-04-15T15:13:20.757Z,
    download_count: 0,
    version: 1,
    metadata: {
      fields: [Array],
      taskId: 348,
      taskType: 'kyb',
      formVersion: '1.0',
      submissionDate: '2025-04-15T15:13:20.742Z'
    }
  }
}
4:07:54 PM [info] GET /api/files 304 in 91ms :: {"data":[{"id":669,"name":"kyb_form_348_2025-04-15T160146.csv","size":2940,"t...
4:07:55 PM [info] GET /api/tasks 304 in 31ms :: [{"id":347,"title":"New User Invitation: e.vancnavarr.o@gmail.com","descripti...
[Files] Starting file fetch request
[Files] Request parameters: {
  companyId: '169',
  userId: 210,
  query: { company_id: '169', page: '1', pageSize: '5' },
  user: {
    id: 210,
    email: 'e.vancnavarr.o@gmail.com',
    full_name: 'John Doe',
    first_name: 'John',
    last_name: 'Doe',
    password: '$2b$10$1WfQz57HicQ4mh2szQyfZev.mMO8BtK24MMvCrxZNZL9c0jlb/RHy',
    company_id: 169,
    onboarding_user_completed: true,
    created_at: 2025-04-13T14:38:35.821Z,
    updated_at: 2025-04-13T14:45:22.913Z
  }
}
[Files] Executing database query for company: 169
[Files] Query results: {
  recordCount: 5,
  totalFiles: 7,
  page: 1,
  pageSize: 5,
  firstRecord: {
    id: 669,
    name: 'kyb_form_348_2025-04-15T160146.csv',
    size: 2940,
    type: 'text/csv',
    path: '/uploads/kyb_348_1744732906646.csv',
    status: 'active',
    user_id: 210,
    company_id: 169,
    document_category: null,
    classification_status: 'pending',
    classification_confidence: null,
    created_at: 2025-04-15T16:01:46.646Z,
    updated_at: 2025-04-15T16:01:46.646Z,
    upload_time: 2025-04-15T16:01:46.662Z,
    download_count: 0,
    version: 1,
    metadata: {
      fields: [Array],
      taskId: 348,
      taskType: 'kyb',
      formVersion: '1.0',
      submissionDate: '2025-04-15T16:01:46.646Z'
    }
  },
  lastRecord: {
    id: 665,
    name: 'kyb_form_348_2025-04-15T151320.csv',
    size: 2940,
    type: 'text/csv',
    path: '/uploads/kyb_348_1744730000742.csv',
    status: 'active',
    user_id: 210,
    company_id: 169,
    document_category: null,
    classification_status: 'pending',
    classification_confidence: null,
    created_at: 2025-04-15T15:13:20.742Z,
    updated_at: 2025-04-15T15:13:20.742Z,
    upload_time: 2025-04-15T15:13:20.757Z,
    download_count: 0,
    version: 1,
    metadata: {
      fields: [Array],
      taskId: 348,
      taskType: 'kyb',
      formVersion: '1.0',
      submissionDate: '2025-04-15T15:13:20.742Z'
    }
  }
}
4:07:55 PM [info] GET /api/files 304 in 91ms :: {"data":[{"id":669,"name":"kyb_form_348_2025-04-15T160146.csv","size":2940,"t...
[WebSocket] Received pong
[Tasks] Using cached task data for user: 210
4:07:56 PM [info] GET /api/tasks 304 in 31ms :: [{"id":347,"title":"New User Invitation: e.vancnavarr.o@gmail.com","descripti...
[WebSocket] Received pong
[WebSocket] Received message: {
  type: 'pong',
  payload: { timestamp: '2025-04-15T16:07:59.981Z' },
  connectionId: 'ws-1'
}
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 210, company_id: 169, email: 'e.vancnavarr.o@gmail.com' }
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 210',
    condition2: 'tasks.created_by = 210',
    condition3: "tasks.company_id = 169 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('e.vancnavarr.o@gmail.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
4:08:01 PM [info] GET /api/tasks 200 in 103ms :: [{"id":347,"title":"New User Invitation: e.vancnavarr.o@gmail.com","descripti...
[Tasks Routes] Fetching task by ID (special .json endpoint): { taskId: 348, timestamp: '2025-04-15T16:08:05.605Z' }
[Tasks Routes] Task found by ID (special .json endpoint): {
  taskId: 348,
  title: '1. KYB Form: DevelopmentTesting',
  type: 'company_kyb',
  timestamp: '2025-04-15T16:08:05.635Z'
}
4:08:05 PM [info] GET /api/tasks.json/348 200 in 62ms :: {"id":348,"title":"1. KYB Form: DevelopmentTesting","description":"Complete K...
[Auth] Using cached user data: 210
[Auth] Returning user session data
[Task Templates API] Fetching template for task type: company_kyb, user: 210
[Task Templates API] Found template: 1 (KYB Form) for task type: company_kyb
Suppressing further connection logs. Pool size: 3
[Task Templates API] Retrieved 9 configuration items for template ID: 1
4:08:05 PM [info] GET /api/task-templates/by-type/company_kyb 304 in 110ms :: {"id":1,"name":"KYB Form","description":"Know Your Business form for company ...
4:08:06 PM [info] GET /api/companies/current 304 in 32ms :: {"id":169,"name":"DevelopmentTesting","description":"FinTech partner company ...
[Auth] Using cached user data: 210
[KYB API DIAGNOSTIC] Starting field fetch
[KYB API DIAGNOSTIC] Schema check passed: kyb_fields table exists
[KYB API DIAGNOSTIC] Field count: 30
[KYB API DIAGNOSTIC] Fields fetched successfully: {
  count: 30,
  fieldKeys: [
    'legalEntityName',
    'registrationNumber',
    'incorporationDate',
    'businessType',
    'jurisdiction',
    'registeredAddress',
    'companyPhone',
    'contactEmail',
    'directorsAndOfficers',
    'ultimateBeneficialOwners',
    'authorizedSigners',
    'governmentOwnership',
    'priorNames',
    'externalAudit',
    'controlEnvironment',
    'corporateRegistration',
    'goodStanding',
    'licenses',
    'annualRecurringRevenue',
    'monthlyRecurringRevenue',
    'marketCapitalization',
    'lifetimeCustomerValue',
    'financialStatements',
    'operationalPolicies',
    'dataVolume',
    'dataTypes',
    'sanctionsCheck',
    'dueDiligence',
    'investigationsIncidents',
    'regulatoryActions'
  ],
  groups: [
    'companyProfile',
    'governanceLeadership',
    'financialProfile',
    'operationsCompliance'
  ],
  sampleField: {
    id: 1,
    key: 'legalEntityName',
    type: 'TEXT',
    group: 'companyProfile'
  }
}
4:08:06 PM [info] GET /api/kyb/fields 304 in 241ms :: {"fields":[{"id":1,"field_key":"legalEntityName","display_name":"Legal Entity...
[KYB API Debug] Loading progress for task: 348
[KYB API Debug] Retrieved task: {
  id: 348,
  status: 'ready_for_submission',
  progress: 100,
  metadata: [
    'company_id',
    'created_at',
    'statusFlow',
    'created_via',
    'formVersion',
    'kybFormFile',
    'lastUpdated',
    'status_flow',
    'company_name',
    'created_by_id',
    'submissionDate',
    'prerequisite_for'
  ],
  timestamp: '2025-04-15T16:08:06.687Z'
}
[KYB API Debug] Retrieved responses: {
  responseCount: 30,
  fields: [
    { field: 'externalAudit', status: 'COMPLETE', hasValue: true },
    {
      field: 'monthlyRecurringRevenue',
      status: 'COMPLETE',
      hasValue: true
    },
    {
      field: 'marketCapitalization',
      status: 'COMPLETE',
      hasValue: true
    },
    {
      field: 'lifetimeCustomerValue',
      status: 'COMPLETE',
      hasValue: true
    },
    {
      field: 'financialStatements',
      status: 'COMPLETE',
      hasValue: true
    },
    {
      field: 'operationalPolicies',
      status: 'COMPLETE',
      hasValue: true
    },
    { field: 'legalEntityName', status: 'COMPLETE', hasValue: true },
    { field: 'registrationNumber', status: 'COMPLETE', hasValue: true },
    { field: 'incorporationDate', status: 'COMPLETE', hasValue: true },
    { field: 'businessType', status: 'COMPLETE', hasValue: true },
    { field: 'dataVolume', status: 'COMPLETE', hasValue: true },
    { field: 'dataTypes', status: 'COMPLETE', hasValue: true },
    { field: 'sanctionsCheck', status: 'COMPLETE', hasValue: true },
    { field: 'dueDiligence', status: 'COMPLETE', hasValue: true },
    {
      field: 'investigationsIncidents',
      status: 'COMPLETE',
      hasValue: true
    },
    { field: 'regulatoryActions', status: 'COMPLETE', hasValue: true },
    { field: 'jurisdiction', status: 'COMPLETE', hasValue: true },
    { field: 'registeredAddress', status: 'COMPLETE', hasValue: true },
    { field: 'companyPhone', status: 'COMPLETE', hasValue: true },
    { field: 'contactEmail', status: 'COMPLETE', hasValue: true },
    {
      field: 'directorsAndOfficers',
      status: 'COMPLETE',
      hasValue: true
    },
    {
      field: 'ultimateBeneficialOwners',
      status: 'COMPLETE',
      hasValue: true
    },
    { field: 'authorizedSigners', status: 'COMPLETE', hasValue: true },
    {
      field: 'governmentOwnership',
      status: 'COMPLETE',
      hasValue: true
    },
    { field: 'priorNames', status: 'COMPLETE', hasValue: true },
    { field: 'controlEnvironment', status: 'COMPLETE', hasValue: true },
    {
      field: 'corporateRegistration',
      status: 'COMPLETE',
      hasValue: true
    },
    { field: 'goodStanding', status: 'COMPLETE', hasValue: true },
    { field: 'licenses', status: 'COMPLETE', hasValue: true },
    {
      field: 'annualRecurringRevenue',
      status: 'COMPLETE',
      hasValue: true
    }
  ],
  timestamp: '2025-04-15T16:08:06.725Z'
}
[KYB API Debug] Retrieved task data: {
  id: 348,
  responseCount: 30,
  progress: 100,
  status: 'ready_for_submission',
  formDataKeys: [
    'externalAudit',
    'monthlyRecurringRevenue',
    'marketCapitalization',
    'lifetimeCustomerValue',
    'financialStatements',
    'operationalPolicies',
    'legalEntityName',
    'registrationNumber',
    'incorporationDate',
    'businessType',
    'dataVolume',
    'dataTypes',
    'sanctionsCheck',
    'dueDiligence',
    'investigationsIncidents',
    'regulatoryActions',
    'jurisdiction',
    'registeredAddress',
    'companyPhone',
    'contactEmail',
    'directorsAndOfficers',
    'ultimateBeneficialOwners',
    'authorizedSigners',
    'governmentOwnership',
    'priorNames',
    'controlEnvironment',
    'corporateRegistration',
    'goodStanding',
    'licenses',
    'annualRecurringRevenue'
  ],
  formData: {
    externalAudit: 'asdf',
    monthlyRecurringRevenue: 'asdf',
    marketCapitalization: 'asdf',
    lifetimeCustomerValue: 'asdf',
    financialStatements: 'asdf',
    operationalPolicies: 'asdf',
    legalEntityName: 'asdfasdf',
    registrationNumber: 'bcdefghijk',
    incorporationDate: 'ab',
    businessType: 'ff',
    dataVolume: 'asdf',
    dataTypes: 'asdf',
    sanctionsCheck: 'asdf',
    dueDiligence: 'asdf',
    investigationsIncidents: 'asdf',
    regulatoryActions: 'asdf',
    jurisdiction: 'asd',
    registeredAddress: 'dd',
    companyPhone: 'ff',
    contactEmail: 'AASFD',
    directorsAndOfficers: 'asdf',
    ultimateBeneficialOwners: 'asdf',
    authorizedSigners: 'asdf',
    governmentOwnership: 'asdf',
    priorNames: 'r',
    controlEnvironment: 'asdf',
    corporateRegistration: 'asdf',
    goodStanding: 'asdf',
    licenses: 'asdf',
    annualRecurringRevenue: 'asdf'
  }
}
4:08:06 PM [info] GET /api/kyb/progress/348 304 in 102ms :: {"formData":{"externalAudit":"asdf","monthlyRecurringRevenue":"asdf","marketC...
[KYB API Debug] Loading progress for task: 348
[KYB API Debug] Retrieved task: {
  id: 348,
  status: 'ready_for_submission',
  progress: 100,
  metadata: [
    'company_id',
    'created_at',
    'statusFlow',
    'created_via',
    'formVersion',
    'kybFormFile',
    'lastUpdated',
    'status_flow',
    'company_name',
    'created_by_id',
    'submissionDate',
    'prerequisite_for'
  ],
  timestamp: '2025-04-15T16:08:06.990Z'
}
[KYB API Debug] Retrieved responses: {
  responseCount: 30,
  fields: [
    { field: 'externalAudit', status: 'COMPLETE', hasValue: true },
    {
      field: 'monthlyRecurringRevenue',
      status: 'COMPLETE',
      hasValue: true
    },
    {
      field: 'marketCapitalization',
      status: 'COMPLETE',
      hasValue: true
    },
    {
      field: 'lifetimeCustomerValue',
      status: 'COMPLETE',
      hasValue: true
    },
    {
      field: 'financialStatements',
      status: 'COMPLETE',
      hasValue: true
    },
    {
      field: 'operationalPolicies',
      status: 'COMPLETE',
      hasValue: true
    },
    { field: 'legalEntityName', status: 'COMPLETE', hasValue: true },
    { field: 'registrationNumber', status: 'COMPLETE', hasValue: true },
    { field: 'incorporationDate', status: 'COMPLETE', hasValue: true },
    { field: 'businessType', status: 'COMPLETE', hasValue: true },
    { field: 'dataVolume', status: 'COMPLETE', hasValue: true },
    { field: 'dataTypes', status: 'COMPLETE', hasValue: true },
    { field: 'sanctionsCheck', status: 'COMPLETE', hasValue: true },
    { field: 'dueDiligence', status: 'COMPLETE', hasValue: true },
    {
      field: 'investigationsIncidents',
      status: 'COMPLETE',
      hasValue: true
    },
    { field: 'regulatoryActions', status: 'COMPLETE', hasValue: true },
    { field: 'jurisdiction', status: 'COMPLETE', hasValue: true },
    { field: 'registeredAddress', status: 'COMPLETE', hasValue: true },
    { field: 'companyPhone', status: 'COMPLETE', hasValue: true },
    { field: 'contactEmail', status: 'COMPLETE', hasValue: true },
    {
      field: 'directorsAndOfficers',
      status: 'COMPLETE',
      hasValue: true
    },
    {
      field: 'ultimateBeneficialOwners',
      status: 'COMPLETE',
      hasValue: true
    },
    { field: 'authorizedSigners', status: 'COMPLETE', hasValue: true },
    {
      field: 'governmentOwnership',
      status: 'COMPLETE',
      hasValue: true
    },
    { field: 'priorNames', status: 'COMPLETE', hasValue: true },
    { field: 'controlEnvironment', status: 'COMPLETE', hasValue: true },
    {
      field: 'corporateRegistration',
      status: 'COMPLETE',
      hasValue: true
    },
    { field: 'goodStanding', status: 'COMPLETE', hasValue: true },
    { field: 'licenses', status: 'COMPLETE', hasValue: true },
    {
      field: 'annualRecurringRevenue',
      status: 'COMPLETE',
      hasValue: true
    }
  ],
  timestamp: '2025-04-15T16:08:07.023Z'
}
[KYB API Debug] Retrieved task data: {
  id: 348,
  responseCount: 30,
  progress: 100,
  status: 'ready_for_submission',
  formDataKeys: [
    'externalAudit',
    'monthlyRecurringRevenue',
    'marketCapitalization',
    'lifetimeCustomerValue',
    'financialStatements',
    'operationalPolicies',
    'legalEntityName',
    'registrationNumber',
    'incorporationDate',
    'businessType',
    'dataVolume',
    'dataTypes',
    'sanctionsCheck',
    'dueDiligence',
    'investigationsIncidents',
    'regulatoryActions',
    'jurisdiction',
    'registeredAddress',
    'companyPhone',
    'contactEmail',
    'directorsAndOfficers',
    'ultimateBeneficialOwners',
    'authorizedSigners',
    'governmentOwnership',
    'priorNames',
    'controlEnvironment',
    'corporateRegistration',
    'goodStanding',
    'licenses',
    'annualRecurringRevenue'
  ],
  formData: {
    externalAudit: 'asdf',
    monthlyRecurringRevenue: 'asdf',
    marketCapitalization: 'asdf',
    lifetimeCustomerValue: 'asdf',
    financialStatements: 'asdf',
    operationalPolicies: 'asdf',
    legalEntityName: 'asdfasdf',
    registrationNumber: 'bcdefghijk',
    incorporationDate: 'ab',
    businessType: 'ff',
    dataVolume: 'asdf',
    dataTypes: 'asdf',
    sanctionsCheck: 'asdf',
    dueDiligence: 'asdf',
    investigationsIncidents: 'asdf',
    regulatoryActions: 'asdf',
    jurisdiction: 'asd',
    registeredAddress: 'dd',
    companyPhone: 'ff',
    contactEmail: 'AASFD',
    directorsAndOfficers: 'asdf',
    ultimateBeneficialOwners: 'asdf',
    authorizedSigners: 'asdf',
    governmentOwnership: 'asdf',
    priorNames: 'r',
    controlEnvironment: 'asdf',
    corporateRegistration: 'asdf',
    goodStanding: 'asdf',
    licenses: 'asdf',
    annualRecurringRevenue: 'asdf'
  }
}
4:08:07 PM [info] GET /api/kyb/progress/348 304 in 98ms :: {"formData":{"externalAudit":"asdf","monthlyRecurringRevenue":"asdf","marketC...
[Info] Saving KYB form data { taskId: 348 }
[Info] Converting KYB fields to CSV {
  fieldCount: 30,
  formDataKeys: 31,
  sampleKeys: [
    'legalEntityName',
    'registrationNumber',
    'incorporationDate',
    'businessType',
    'jurisdiction'
  ]
}
[Info] CSV generation complete {
  rows: 31,
  previewLines: [
    'Field,Label,Question,Response',
    'legalEntityName,Legal Entity Name,What is the registered business name?,asdfasdf',
    "registrationNumber,Registration Number,What is your company's entity registration number (e.g.  EIN or State Entity ID)?,bcdefghijk"
  ],
  totalLength: 2940
}
[Error] Transaction failed during KYB submission {
  error: 'current transaction is aborted, commands ignored until end of transaction block',
  stack: 'error: current transaction is aborted, commands ignored until end of transaction block\n' +
    '    at cn.parseErrorMessage (file:///home/runner/workspace/node_modules/@neondatabase/serverless/index.mjs:1182:6)\n' +
    '    at cn.handlePacket (file:///home/runner/workspace/node_modules/@neondatabase/serverless/index.mjs:1143:13)\n' +
    '    at cn.parse (file:///home/runner/workspace/node_modules/@neondatabase/serverless/index.mjs:1127:36)\n' +
    '    at v.<anonymous> (file:///home/runner/workspace/node_modules/@neondatabase/serverless/index.mjs:1190:16)\n' +
    '    at v.emit (file:///home/runner/workspace/node_modules/@neondatabase/serverless/index.mjs:397:12)\n' +
    '    at WebSocket.<anonymous> (file:///home/runner/workspace/node_modules/@neondatabase/serverless/index.mjs:987:80)\n' +
    '    at callListener (/home/runner/workspace/node_modules/ws/lib/event-target.js:290:14)\n' +
    '    at WebSocket.onMessage (/home/runner/workspace/node_modules/ws/lib/event-target.js:209:9)\n' +
    '    at WebSocket.emit (node:events:518:28)\n' +
    '    at Receiver.receiverOnMessage (/home/runner/workspace/node_modules/ws/lib/websocket.js:1220:20)\n' +
    '    at Receiver.emit (node:events:518:28)\n' +
    '    at Receiver.dataMessage (/home/runner/workspace/node_modules/ws/lib/receiver.js:569:14)\n' +
    '    at Receiver.getData (/home/runner/workspace/node_modules/ws/lib/receiver.js:496:10)\n' +
    '    at Receiver.startLoop (/home/runner/workspace/node_modules/ws/lib/receiver.js:167:16)\n' +
    '    at Receiver._write (/home/runner/workspace/node_modules/ws/lib/receiver.js:94:10)\n' +
    '    at writeOrBuffer (node:internal/streams/writable:572:12)\n' +
    '    at _write (node:internal/streams/writable:501:10)\n' +
    '    at Writable.write (node:internal/streams/writable:510:10)\n' +
    '    at TLSSocket.socketOnData (/home/runner/workspace/node_modules/ws/lib/websocket.js:1355:35)\n' +
    '    at TLSSocket.emit (node:events:518:28)\n' +
    '    at addChunk (node:internal/streams/readable:561:12)\n' +
    '    at readableAddChunkPushByteMode (node:internal/streams/readable:512:3)\n' +
    '    at Readable.push (node:internal/streams/readable:392:5)\n' +
    '    at TLSWrap.onStreamRead (node:internal/stream_base_commons:191:23)',
  taskId: 348
}
4:08:18 PM [error] POST /api/kyb/save 500 in 376ms :: {"error":"Transaction failed","details":"current transaction is aborted, comm...
[WebSocket] Received pong
[WebSocket] Received pong
[WebSocket] Received message: {
  type: 'pong',
  payload: { timestamp: '2025-04-15T16:08:32.159Z' },
  connectionId: 'ws-1'
}
[WebSocket] Received pong
[WebSocket] Received pong
[WebSocket] Received message: {
  type: 'pong',
  payload: { timestamp: '2025-04-15T16:08:44.981Z' },
  connectionId: 'ws-1'
}
[WebSocket] Received pong
[WebSocket] Received pong
[WebSocket] Received message: {
  type: 'pong',
  payload: { timestamp: '2025-04-15T16:09:17.336Z' },
  connectionId: 'ws-1'
}
[WebSocket] Received pong