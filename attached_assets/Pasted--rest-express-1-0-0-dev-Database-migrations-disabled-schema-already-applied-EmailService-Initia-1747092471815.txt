> rest-express@1.0.0 dev
Database migrations disabled - schema already applied
[EmailService] Initializing email service
[EmailService] Email service initialized successfully
[OpenAI] Service initialized with API key: API key is set
[WebSocketService] Initialized in fallback mode (WebSocket server not available)
[Auth] Setting up authentication...
[Auth] Setting up PostgreSQL session store
[Auth] PostgreSQL session store initialized successfully
[Auth] Authentication setup completed
[Routes] Registered KY3P form submission fix routes
[2025-05-12T23:26:20.299Z] [INFO] [App] [KY3P-BATCH-UPDATE] Registering KY3P batch update routes 
[2025-05-12T23:26:20.300Z] [INFO] [App] Registering KY3P batch update routes 
[2025-05-12T23:26:20.300Z] [INFO] [App] [UnifiedKY3P] Registering unified KY3P update routes 
[Routes] Registered KY3P field key router
[Routes] Registered KY3P field key router
[2025-05-12T23:26:20.300Z] [INFO] [App] Registering KY3P field update routes 
[Routes] Setting up unified clear fields router
[Routes] Successfully registered unified clear fields router
[Routes] Setting up task broadcast router
[Routes] Successfully registered task broadcast router
[2025-05-12T23:26:20.301Z] [INFO] [App] [OpenBankingRoutes] Setting up routes... 
[Routes] Setting up transaction-based unified form submission router
[Routes] Successfully registered transaction-based unified form submission router
[Routes] Setting up unified form submission router
[Routes] Successfully registered unified form submission router
[Routes] Setting up transactional form submission router
[Routes] Successfully registered transactional form submission router
[Routes] Routes setup completed
[2025-05-12T23:26:20.303Z] [INFO] [App] [WebSocket] Setting up unified WebSocket server on path /ws 
[2025-05-12T23:26:20.304Z] [INFO] [WebSocket] Unified WebSocket server initialized successfully {"module":"WebSocket","clients":0,"path":"/ws","id":"zbczg3","timestamp":"2025-05-12T23:26:20.304Z"}
[2025-05-12T23:26:20.304Z] [INFO] [App] [WebSocket] Unified WebSocket server initialized successfully 
[2025-05-12T23:26:20.304Z] [WARN] [App] [WebSocket] Form submission WebSocket initialization function not found 
[2025-05-12T23:26:20.304Z] [INFO] [App] [ServerStartup] WebSocket server initialized with unified implementation 
[2025-05-12T23:26:20.304Z] [INFO] [App] [TaskWebSocket] WebSocket server registered with unified implementation 
[2025-05-12T23:26:20.304Z] [INFO] [App] [ServerStartup] WebSocket server registered with task-update utility 
[TaskBroadcast] WebSocket server reference set up
[TaskBroadcast] WebSocket server active with 0 connected clients
[2025-05-12T23:26:20.304Z] [INFO] [App] [ServerStartup] WebSocket server registered with task-broadcast utility 
[2025-05-12T23:26:20.305Z] [INFO] [App] Setting up Vite development server 
[2025-05-12T23:26:20.306Z] [INFO] [App] [ENV] Server will listen on PORT=5000 (deployment mode: no) 
[2025-05-12T23:26:20.306Z] [INFO] [App] [ENV] Environment=development (NODE_ENV explicitly set) 
[2025-05-12T23:26:20.318Z] [INFO] [App] Server running on 0.0.0.0:5000 
[2025-05-12T23:26:20.318Z] [INFO] [App] Environment: development 
[Deployment] Server running on 0.0.0.0:5000
[Deployment] Environment: development
[Deployment] Port forwarding: Custom port: 5000
[Deployment] Development mode: Hot reloading enabled
[2025-05-12T23:26:20.318Z] [INFO] [App] Starting periodic task reconciliation system... 
[PeriodicTaskReconciliation] Stopped periodic reconciliation system
[PeriodicTaskReconciliation] Starting periodic reconciliation system (interval: 300000ms)
[2025-05-12T23:26:20.319Z] [INFO] [App] Task reconciliation system initialized successfully 
[2025-05-12T23:26:20.361Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1747092380361-vf6271a","clients":1}
[2025-05-12T23:26:20.894Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1747092380894-mejzwsv","clients":2}
[2025-05-12T23:26:21.176Z] New client connected to the pool (1/3)
[Auth] Returning user session data
[2025-05-12T23:26:21.305Z] [INFO] [App] [ServerStartup] WebSocket server active with 2 connected clients 
[2025-05-12T23:26:21.374Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1747092381374-3vhr9cl","clients":3}
[Current Company] Fetching company for user: { userId: 328, companyId: 285 }
[2025-05-12T23:26:21.491Z] [INFO] [WebSocket] Received message from client client-1747092381374-3vhr9cl {"module":"WebSocket","type":"authenticate","data":{"timestamp":"2025-05-12T23:26:21.321Z"}}
[2025-05-12T23:26:21.491Z] [INFO] [WebSocket] Authentication from client client-1747092381374-3vhr9cl {"module":"WebSocket","hasToken":true}
[Current Company] Found company: {
  id: 285,
  name: 'DevTest30',
  onboardingCompleted: false,
  riskScore: null,
  chosenScore: null,
  isDemo: true
}
[2025-05-12T23:26:21.523Z] [INFO] [App] GET /api/companies/current 304 in 65ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-12T23:26:21.639Z] [INFO] [WebSocket] Received message from client client-1747092380894-mejzwsv {"module":"WebSocket","type":"authenticate","userId":328,"companyId":285,"clientId":"ws_1747092379215_x0ifnt8ea","timestamp":"2025-05-12T23:26:21.470Z"}
[2025-05-12T23:26:21.639Z] [INFO] [WebSocket] Authentication from client client-1747092380894-mejzwsv {"module":"WebSocket","userId":328,"companyId":285,"hasToken":true}
[2025-05-12T23:26:21.924Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1747092381924-47i9iou","clients":4}
[2025-05-12T23:26:22.804Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1747092382803-2bepxs7","clients":5}
[2025-05-12T23:26:22.920Z] [INFO] [WebSocket] Received message from client client-1747092382803-2bepxs7 {"module":"WebSocket","type":"authenticate","userId":null,"companyId":null,"clientId":"ws_1747092078405_eqgi0euyi","timestamp":"2025-05-12T23:26:22.750Z"}
[2025-05-12T23:26:22.920Z] [INFO] [WebSocket] Authentication from client client-1747092382803-2bepxs7 {"module":"WebSocket","userId":null,"companyId":null,"hasToken":true}
[2025-05-12T23:26:28.600Z] [INFO] [WebSocket] Client disconnected {"module":"WebSocket","clientId":"client-1747092382803-2bepxs7","code":1001,"reason":"","remainingClients":4}
[2025-05-12T23:26:28.600Z] [INFO] [WebSocket] Client disconnected {"module":"WebSocket","clientId":"client-1747092381374-3vhr9cl","code":1001,"reason":"","remainingClients":3}
[2025-05-12T23:26:28.600Z] [INFO] [WebSocket] Client disconnected {"module":"WebSocket","clientId":"client-1747092381924-47i9iou","code":1001,"reason":"","remainingClients":2}
[2025-05-12T23:26:28.601Z] [INFO] [WebSocket] Client disconnected {"module":"WebSocket","clientId":"client-1747092380894-mejzwsv","code":1001,"reason":"","remainingClients":1}
[2025-05-12T23:26:28.601Z] [INFO] [WebSocket] Client disconnected {"module":"WebSocket","clientId":"client-1747092380361-vf6271a","code":1001,"reason":"","remainingClients":0}
[2025-05-12T23:26:33.271Z] New client connected to the pool (2/3)
[2025-05-12T23:26:35.083Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1747092395083-hd51mr7","clients":1}
[2025-05-12T23:26:35.105Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1747092395105-tkxm3dt","clients":2}
[Auth] Unauthenticated user session
[2025-05-12T23:26:35.192Z] [INFO] [WebSocket] Received message from client client-1747092395083-hd51mr7 {"module":"WebSocket","type":"authenticate","data":{"timestamp":"2025-05-12T23:26:35.191Z"}}
[2025-05-12T23:26:35.192Z] [INFO] [WebSocket] Authentication from client client-1747092395083-hd51mr7 {"module":"WebSocket","hasToken":true}
[2025-05-12T23:26:35.240Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1747092395240-glpw2sg","clients":3}
[2025-05-12T23:26:35.577Z] [INFO] [WebSocket] Client disconnected {"module":"WebSocket","clientId":"client-1747092395105-tkxm3dt","code":1001,"reason":"","remainingClients":2}
[2025-05-12T23:26:35.578Z] [INFO] [WebSocket] Client disconnected {"module":"WebSocket","clientId":"client-1747092395083-hd51mr7","code":1001,"reason":"","remainingClients":1}
[2025-05-12T23:26:35.578Z] [INFO] [WebSocket] Client disconnected {"module":"WebSocket","clientId":"client-1747092395240-glpw2sg","code":1001,"reason":"","remainingClients":0}
[PeriodicTaskReconciliation] Reconciling batch of 10 tasks: [
  740, 679, 710, 691,
  764, 707, 759, 698,
  718, 693
]
[Task Progress] Calculated progress for task 740 (open_banking): 0/44 = 0%
[Task Progress] Calculated progress for task 679 (open_banking): 44/44 = 100%
[Task Progress] Calculated progress for task 710 (ky3p): 0/120 = 0%
[Task Progress] Calculated progress for task 691 (open_banking): 0/44 = 0%
[Task Progress] Calculated progress for task 764 (open_banking): 44/44 = 100%
[2025-05-12T23:26:51.171Z] New client connected to the pool (3/3)
[Task Progress] Calculated progress for task 707 (open_banking): 0/44 = 0%
[Task Progress] Calculated progress for task 759 (ky3p): 0/0 = 0%
[Task Progress] Calculated progress for task 698 (ky3p): 0/0 = 0%
[Task Progress] Calculated progress for task 718 (ky3p): 1/120 = 1%
[Task Progress] Calculated progress for task 693 (company_kyb): 5/30 = 17%
[Auth] Returning user session data
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 328, company_id: 285, email: '30@e.com' }
[2025-05-12T23:26:59.905Z] [INFO] [App] Performing dynamic task unlocking check for company {"companyId":285,"userId":328}
[2025-05-12T23:26:59.930Z] [INFO] [App] GET /api/companies/current 304 in 31ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-12T23:26:59.941Z] [INFO] [App] No completed KYB tasks found, skipping security task unlock check {"companyId":285}
[Tasks] Automatically unlocking all tasks for company { userId: 328, companyId: 285, requestedBy: 'automatic_task_unlock' }
[2025-05-12T23:26:59.942Z] [INFO] [App] [TaskDependencies] Unlocking ALL tasks for company {"companyId":285}
[2025-05-12T23:26:59.976Z] [INFO] [App] [TaskDependencies] Found user onboarding task that needs completion {"taskId":809,"userEmail":"30@e.com","currentStatus":"completed","currentProgress":100}
[2025-05-12T23:26:59.976Z] [INFO] [App] [TaskDependencies] Found tasks to unlock {"companyId":285,"count":4,"taskIds":[810,811,812,809],"taskTypes":["company_kyb","ky3p","open_banking","user_onboarding"],"ky3pTaskCount":1,"ky3pTaskIds":[811]}
[UnifiedProgress] Starting progress update for task 810 (company_kyb) {
  taskId: 810,
  taskType: 'company_kyb',
  diagnosticId: 'prog-1747092419977-390',
  metadata: [
    'locked',
    'prerequisite_completed',
    'prerequisite_completed_at',
    'dependencyUnlockOperation',
    'previousProgress',
    'previousStatus',
    'isKy3pTask',
    'isUserOnboardingTask'
  ]
}
[2025-05-12T23:27:00.006Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1747092420006-bxqb5vl","clients":1}
[UnifiedProgressCalc] Calculating progress for task 810 (company_kyb)
[2025-05-12T23:27:00.132Z] [INFO] [WebSocket] Received message from client client-1747092420006-bxqb5vl {"module":"WebSocket","type":"authenticate","data":{"timestamp":"2025-05-12T23:26:59.962Z"}}
[2025-05-12T23:27:00.132Z] [INFO] [WebSocket] Authentication from client client-1747092420006-bxqb5vl {"module":"WebSocket","hasToken":true}
[UnifiedProgressCalc] Task 810 (company_kyb) progress: 0/30 = 0%
[2025-05-12T23:27:00.200Z] [INFO] [WebSocket] Broadcast message of type 'task_updated' sent to 1 clients {"module":"WebSocket","messageType":"task_updated","recipients":1,"totalClients":1,"filtered":false}
[2025-05-12T23:27:00.200Z] [DEBUG] [App] [UnifiedProgressCalc] Successfully broadcast task update using unified implementation {"taskId":810,"messageId":"msg_1747092420200_3glkate2"}
[2025-05-12T23:27:00.200Z] [INFO] [App] [UnifiedProgressCalc] Successfully broadcast task update for task 810 {"progress":0,"status":"not_started","messageId":"msg_1747092420200_3glkate2"}
[2025-05-12T23:27:00.201Z] [INFO] [App] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":285,"taskId":810,"taskType":"company_kyb","isKy3pTask":false,"calculatedProgress":0,"previousProgress":0,"wasPreserved":false}
[2025-05-12T23:27:00.201Z] [INFO] [App] [TaskDependencies] Processing KY3P task {"taskId":811,"taskType":"ky3p","currentProgress":0,"currentStatus":"not_started","timestamp":"2025-05-12T23:27:00.201Z"}
[UnifiedProgress] Starting progress update for task 811 (ky3p) {
  taskId: 811,
  taskType: 'ky3p',
  diagnosticId: 'prog-1747092420201-847',
  metadata: [
    'locked',
    'prerequisite_completed',
    'prerequisite_completed_at',
    'dependencyUnlockOperation',
    'previousProgress',
    'previousStatus',
    'isKy3pTask',
    'isUserOnboardingTask'
  ]
}
[UnifiedProgressCalc] Calculating progress for task 811 (ky3p)
[KY3P Progress] Calculated progress for task 811: {
  taskId: 811,
  taskType: 'ky3p',
  normalizedTaskType: 'ky3p',
  totalFields: 120,
  completedFields: 0,
  progress: 0,
  timeStamp: '2025-05-12T23:27:00.429Z'
}
[UnifiedProgressCalc] Task 811 (ky3p) progress: 0/120 = 0%
[2025-05-12T23:27:00.463Z] [INFO] [WebSocket] Broadcast message of type 'task_updated' sent to 1 clients {"module":"WebSocket","messageType":"task_updated","recipients":1,"totalClients":1,"filtered":false}
[2025-05-12T23:27:00.463Z] [DEBUG] [App] [UnifiedProgressCalc] Successfully broadcast task update using unified implementation {"taskId":811,"messageId":"msg_1747092420463_eo6vsywy"}
[2025-05-12T23:27:00.463Z] [INFO] [App] [UnifiedProgressCalc] Successfully broadcast task update for task 811 {"progress":0,"status":"not_started","messageId":"msg_1747092420463_eo6vsywy"}
[2025-05-12T23:27:00.463Z] [INFO] [App] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":285,"taskId":811,"taskType":"ky3p","isKy3pTask":true,"calculatedProgress":0,"previousProgress":0,"wasPreserved":false}
[UnifiedProgress] Starting progress update for task 812 (open_banking) {
  taskId: 812,
  taskType: 'open_banking',
  diagnosticId: 'prog-1747092420464-895',
  metadata: [
    'locked',
    'prerequisite_completed',
    'prerequisite_completed_at',
    'dependencyUnlockOperation',
    'previousProgress',
    'previousStatus',
    'isKy3pTask',
    'isUserOnboardingTask'
  ]
}
[UnifiedProgressCalc] Calculating progress for task 812 (open_banking)
[2025-05-12T23:27:00.539Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1747092420539-0o0zmnf","clients":2}
[UnifiedProgressCalc] Task 812 (open_banking) progress: 0/44 = 0%
[2025-05-12T23:27:00.617Z] [INFO] [WebSocket] Broadcast message of type 'task_updated' sent to 2 clients {"module":"WebSocket","messageType":"task_updated","recipients":2,"totalClients":2,"filtered":false}
[2025-05-12T23:27:00.617Z] [DEBUG] [App] [UnifiedProgressCalc] Successfully broadcast task update using unified implementation {"taskId":812,"messageId":"msg_1747092420616_svt8k2w3"}
[2025-05-12T23:27:00.617Z] [INFO] [App] [UnifiedProgressCalc] Successfully broadcast task update for task 812 {"progress":0,"status":"not_started","messageId":"msg_1747092420616_svt8k2w3"}
[2025-05-12T23:27:00.617Z] [INFO] [App] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":285,"taskId":812,"taskType":"open_banking","isKy3pTask":false,"calculatedProgress":0,"previousProgress":0,"wasPreserved":false}
[2025-05-12T23:27:00.617Z] [INFO] [App] [TaskDependencies] Setting User Onboarding task as completed {"taskId":809,"userEmail":"30@e.com","timestamp":"2025-05-12T23:27:00.617Z"}
[2025-05-12T23:27:00.650Z] [INFO] [App] Our WebSocket server not initialized, falling back to unified implementation 
[2025-05-12T23:27:00.650Z] [INFO] [WebSocket] Broadcast message of type 'task_updated' sent to 2 clients {"module":"WebSocket","messageType":"task_updated","recipients":2,"totalClients":2,"filtered":false}
[2025-05-12T23:27:00.651Z] [INFO] [App] Successfully broadcast task update using unified implementation {"taskId":809,"status":"completed"}
[2025-05-12T23:27:00.651Z] [INFO] [App] [TaskDependencies] Successfully unlocked all tasks {"companyId":285,"count":4}
[Tasks] Successfully unlocked all tasks for company: 285
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 328',
    condition2: 'tasks.created_by = 328',
    condition3: "tasks.company_id = 285 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('30@e.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
[2025-05-12T23:27:00.745Z] [INFO] [App] GET /api/tasks 200 in 841ms :: [{"id":810,"title":"1. KYB Form: DevTest30","description":"Complete KYB verif... 
[2025-05-12T23:27:00.928Z] [INFO] [App] GET /api/tasks 304 in 32ms :: [{"id":810,"title":"1. KYB Form: DevTest30","description":"Complete KYB verif... 
[2025-05-12T23:27:01.061Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1747092421061-gv4lk0d","clients":3}
[2025-05-12T23:27:01.182Z] [INFO] [WebSocket] Received message from client client-1747092421061-gv4lk0d {"module":"WebSocket","type":"authenticate","userId":null,"companyId":null,"clientId":"ws_1747092419126_lx3g1kl8r","timestamp":"2025-05-12T23:27:01.011Z"}
[2025-05-12T23:27:01.182Z] [INFO] [WebSocket] Authentication from client client-1747092421061-gv4lk0d {"module":"WebSocket","userId":null,"companyId":null,"hasToken":true}
[2025-05-12T23:27:01.556Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1747092421556-mx0lyoq","clients":4}
[2025-05-12T23:27:02.064Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1747092422064-79qikg2","clients":5}
[2025-05-12T23:27:02.563Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1747092422563-7l90cgw","clients":6}
[Auth] Returning user session data
[2025-05-12T23:27:02.939Z] [INFO] [App] GET /api/companies/current 304 in 34ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-12T23:27:03.058Z] [INFO] [WebSocket] Received message from client client-1747092422563-7l90cgw {"module":"WebSocket","type":"authenticate","userId":328,"companyId":285,"clientId":"ws_1747092421220_wtpqgfm9r","timestamp":"2025-05-12T23:27:02.888Z"}
[2025-05-12T23:27:03.058Z] [INFO] [WebSocket] Authentication from client client-1747092422563-7l90cgw {"module":"WebSocket","userId":328,"companyId":285,"hasToken":true}
[2025-05-12T23:27:03.460Z] [INFO] [App] GET /api/companies/current 304 in 31ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-12T23:27:06.448Z] [INFO] [App] GET /api/companies/current 304 in 31ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-12T23:27:09.453Z] [INFO] [App] GET /api/companies/current 304 in 31ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-12T23:27:12.458Z] [INFO] [App] GET /api/companies/current 304 in 32ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-12T23:27:15.449Z] [INFO] [App] GET /api/companies/current 304 in 33ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-12T23:27:16.677Z] [INFO] [App] GET /api/companies/current 304 in 56ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-12T23:27:18.198Z] [INFO] [App] GET /api/companies/current 304 in 56ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-12T23:27:21.150Z] [INFO] [App] GET /api/companies/current 304 in 34ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-12T23:27:22.690Z] [INFO] [WebSocket] Received message from client client-1747092422563-7l90cgw {"module":"WebSocket","type":"ping","timestamp":"2025-05-12T23:27:22.519Z","connectionId":"ws_1747092421220_wtpqgfm9r"}
[Current Company] Updating company 285 with data: { numEmployees: 'small', revenueTier: '0-10m' }
[Current Company] Request headers: { contentType: 'application/json', methodOverride: 'PATCH' }
[Current Company] Method override header: PATCH, treating as PATCH: true
[Current Company] Setting num_employees to: small
[Current Company] Setting revenue_tier to: 0-10m
[Current Company] Executing update with data: { num_employees: 'small', revenue_tier: '0-10m' }
[Current Company] Error updating company: error: invalid input syntax for type integer: "small"
    at file:///home/runner/workspace/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/runner/workspace/node_modules/src/neon-serverless/session.ts:102:18)
    at async <anonymous> (/home/runner/workspace/server/routes.ts:1153:32) {
  length: 148,
  severity: 'ERROR',
  code: '22P02',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: "unnamed portal parameter $1 = '...'",
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'numutils.c',
  line: '616',
  routine: 'pg_strtoint32_safe'
}
[2025-05-12T23:27:23.799Z] [ERROR] [App] POST /api/companies/current 500 in 86ms :: {"message":"Error updating company data","code":"SERVER_ERROR","details":"inv... 
[Current Company] Fetching company for user: { userId: 328, companyId: 285 }
[Current Company] Found company: {
  id: 285,
  name: 'DevTest30',
  onboardingCompleted: false,
  riskScore: null,
  chosenScore: null,
  isDemo: true
}
[2025-05-12T23:27:24.148Z] [INFO] [App] GET /api/companies/current 304 in 60ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[Current Company] Using cached company data: 285
[2025-05-12T23:27:27.119Z] [INFO] [App] GET /api/companies/current 304 in 30ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-12T23:27:30.120Z] [INFO] [App] GET /api/companies/current 304 in 30ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-12T23:27:30.132Z] [INFO] [WebSocket] Received message from client client-1747092420006-bxqb5vl {"module":"WebSocket","type":"ping"}
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 328, company_id: 285, email: '30@e.com' }
[2025-05-12T23:27:30.901Z] [INFO] [App] Performing dynamic task unlocking check for company {"companyId":285,"userId":328}
[2025-05-12T23:27:30.930Z] [INFO] [App] No completed KYB tasks found, skipping security task unlock check {"companyId":285}
[Tasks] Automatically unlocking all tasks for company { userId: 328, companyId: 285, requestedBy: 'automatic_task_unlock' }
[2025-05-12T23:27:30.930Z] [INFO] [App] [TaskDependencies] Unlocking ALL tasks for company {"companyId":285}
[2025-05-12T23:27:30.960Z] [INFO] [App] [TaskDependencies] Found user onboarding task that needs completion {"taskId":809,"userEmail":"30@e.com","currentStatus":"completed","currentProgress":100}
[2025-05-12T23:27:30.960Z] [INFO] [App] [TaskDependencies] Found tasks to unlock {"companyId":285,"count":4,"taskIds":[810,811,812,809],"taskTypes":["company_kyb","ky3p","open_banking","user_onboarding"],"ky3pTaskCount":1,"ky3pTaskIds":[811]}
[UnifiedProgress] Starting progress update for task 810 (company_kyb) {
  taskId: 810,
  taskType: 'company_kyb',
  diagnosticId: 'prog-1747092450961-681',
  metadata: [
    'locked',
    'prerequisite_completed',
    'prerequisite_completed_at',
    'dependencyUnlockOperation',
    'previousProgress',
    'previousStatus',
    'isKy3pTask',
    'isUserOnboardingTask'
  ]
}
[UnifiedProgressCalc] Calculating progress for task 810 (company_kyb)
[UnifiedProgressCalc] Task 810 (company_kyb) progress: 0/30 = 0%
[2025-05-12T23:27:31.105Z] [INFO] [WebSocket] Broadcast message of type 'task_updated' sent to 6 clients {"module":"WebSocket","messageType":"task_updated","recipients":6,"totalClients":6,"filtered":false}
[2025-05-12T23:27:31.106Z] [DEBUG] [App] [UnifiedProgressCalc] Successfully broadcast task update using unified implementation {"taskId":810,"messageId":"msg_1747092451105_7pmuspdf"}
[2025-05-12T23:27:31.106Z] [INFO] [App] [UnifiedProgressCalc] Successfully broadcast task update for task 810 {"progress":0,"status":"not_started","messageId":"msg_1747092451105_7pmuspdf"}
[2025-05-12T23:27:31.106Z] [INFO] [App] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":285,"taskId":810,"taskType":"company_kyb","isKy3pTask":false,"calculatedProgress":0,"previousProgress":0,"wasPreserved":false}
[2025-05-12T23:27:31.106Z] [INFO] [App] [TaskDependencies] Processing KY3P task {"taskId":811,"taskType":"ky3p","currentProgress":0,"currentStatus":"not_started","timestamp":"2025-05-12T23:27:31.106Z"}
[UnifiedProgress] Starting progress update for task 811 (ky3p) {
  taskId: 811,
  taskType: 'ky3p',
  diagnosticId: 'prog-1747092451106-18',
  metadata: [
    'locked',
    'prerequisite_completed',
    'prerequisite_completed_at',
    'dependencyUnlockOperation',
    'previousProgress',
    'previousStatus',
    'isKy3pTask',
    'isUserOnboardingTask'
  ]
}
[UnifiedProgressCalc] Calculating progress for task 811 (ky3p)
[KY3P Progress] Calculated progress for task 811: {
  taskId: 811,
  taskType: 'ky3p',
  normalizedTaskType: 'ky3p',
  totalFields: 120,
  completedFields: 0,
  progress: 0,
  timeStamp: '2025-05-12T23:27:31.222Z'
}
[UnifiedProgressCalc] Task 811 (ky3p) progress: 0/120 = 0%
[2025-05-12T23:27:31.250Z] [INFO] [WebSocket] Broadcast message of type 'task_updated' sent to 6 clients {"module":"WebSocket","messageType":"task_updated","recipients":6,"totalClients":6,"filtered":false}
[2025-05-12T23:27:31.250Z] [DEBUG] [App] [UnifiedProgressCalc] Successfully broadcast task update using unified implementation {"taskId":811,"messageId":"msg_1747092451250_7rxvlo10"}
[2025-05-12T23:27:31.250Z] [INFO] [App] [UnifiedProgressCalc] Successfully broadcast task update for task 811 {"progress":0,"status":"not_started","messageId":"msg_1747092451250_7rxvlo10"}
[2025-05-12T23:27:31.250Z] [INFO] [App] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":285,"taskId":811,"taskType":"ky3p","isKy3pTask":true,"calculatedProgress":0,"previousProgress":0,"wasPreserved":false}
[UnifiedProgress] Starting progress update for task 812 (open_banking) {
  taskId: 812,
  taskType: 'open_banking',
  diagnosticId: 'prog-1747092451251-811',
  metadata: [
    'locked',
    'prerequisite_completed',
    'prerequisite_completed_at',
    'dependencyUnlockOperation',
    'previousProgress',
    'previousStatus',
    'isKy3pTask',
    'isUserOnboardingTask'
  ]
}
[UnifiedProgressCalc] Calculating progress for task 812 (open_banking)
[UnifiedProgressCalc] Task 812 (open_banking) progress: 0/44 = 0%
[2025-05-12T23:27:31.395Z] [INFO] [WebSocket] Broadcast message of type 'task_updated' sent to 6 clients {"module":"WebSocket","messageType":"task_updated","recipients":6,"totalClients":6,"filtered":false}
[2025-05-12T23:27:31.395Z] [DEBUG] [App] [UnifiedProgressCalc] Successfully broadcast task update using unified implementation {"taskId":812,"messageId":"msg_1747092451395_atsrir4i"}
[2025-05-12T23:27:31.395Z] [INFO] [App] [UnifiedProgressCalc] Successfully broadcast task update for task 812 {"progress":0,"status":"not_started","messageId":"msg_1747092451395_atsrir4i"}
[2025-05-12T23:27:31.395Z] [INFO] [App] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":285,"taskId":812,"taskType":"open_banking","isKy3pTask":false,"calculatedProgress":0,"previousProgress":0,"wasPreserved":false}
[2025-05-12T23:27:31.395Z] [INFO] [App] [TaskDependencies] Setting User Onboarding task as completed {"taskId":809,"userEmail":"30@e.com","timestamp":"2025-05-12T23:27:31.395Z"}
[2025-05-12T23:27:31.425Z] [INFO] [App] Our WebSocket server not initialized, falling back to unified implementation 
[2025-05-12T23:27:31.426Z] [INFO] [WebSocket] Broadcast message of type 'task_updated' sent to 6 clients {"module":"WebSocket","messageType":"task_updated","recipients":6,"totalClients":6,"filtered":false}
[2025-05-12T23:27:31.426Z] [INFO] [App] Successfully broadcast task update using unified implementation {"taskId":809,"status":"completed"}
[2025-05-12T23:27:31.426Z] [INFO] [App] [TaskDependencies] Successfully unlocked all tasks {"companyId":285,"count":4}
[Tasks] Successfully unlocked all tasks for company: 285
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 328',
    condition2: 'tasks.created_by = 328',
    condition3: "tasks.company_id = 285 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('30@e.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
[2025-05-12T23:27:31.514Z] [INFO] [App] GET /api/tasks 200 in 614ms :: [{"id":810,"title":"1. KYB Form: DevTest30","description":"Complete KYB verif... 
[2025-05-12T23:27:31.688Z] [INFO] [WebSocket] Received message from client client-1747092421556-mx0lyoq {"module":"WebSocket","type":"ping","timestamp":"2025-05-12T23:27:31.518Z","connectionId":"ws_1747092421517_xxzo2ivgw"}
[2025-05-12T23:27:32.186Z] [INFO] [WebSocket] Received message from client client-1747092422064-79qikg2 {"module":"WebSocket","type":"ping","timestamp":"2025-05-12T23:27:32.016Z","connectionId":"ws_1747092420485_xhiofdxx2"}
[2025-05-12T23:27:33.121Z] [INFO] [App] GET /api/companies/current 304 in 30ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-12T23:27:36.133Z] [INFO] [App] GET /api/companies/current 304 in 30ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-12T23:27:39.120Z] [INFO] [App] GET /api/companies/current 304 in 30ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-12T23:27:42.129Z] [INFO] [App] GET /api/companies/current 304 in 34ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-12T23:27:42.687Z] [INFO] [WebSocket] Received message from client client-1747092422563-7l90cgw {"module":"WebSocket","type":"ping","timestamp":"2025-05-12T23:27:42.517Z","connectionId":"ws_1747092421220_wtpqgfm9r"}
[2025-05-12T23:27:45.146Z] [INFO] [App] GET /api/companies/current 304 in 53ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-12T23:27:46.723Z] [INFO] [App] GET /api/tasks 304 in 30ms :: [{"id":810,"title":"1. KYB Form: DevTest30","description":"Complete KYB verif... 
[2025-05-12T23:27:48.119Z] [INFO] [App] GET /api/companies/current 304 in 30ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 