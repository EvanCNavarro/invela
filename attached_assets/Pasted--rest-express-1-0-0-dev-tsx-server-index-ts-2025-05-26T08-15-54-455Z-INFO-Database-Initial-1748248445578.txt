> rest-express@1.0.0 dev
> tsx server/index.ts

[2025-05-26T08:15:54.455Z] [INFO] [Database] Initializing database connection with Neon PostgreSQL optimizations {"module":"Database","poolSize":3,"idleTimeout":600000,"connectionTimeout":180000}
[2025-05-26T08:15:54.459Z] [INFO] [Database] Database configuration completed successfully {"module":"Database","schemasLoaded":102,"timestamp":"2025-05-26T08:15:54.459Z"}
[EmailService] Initializing email service
[EmailService] Email service initialized successfully
[OpenAI] Service initialized with API key: API key is set
[2025-05-26T08:15:54.591Z] [INFO] [NeonConnectionService] Initializing Neon Connection Service {"module":"NeonConnectionService"}
[WebSocketService] Initialized in fallback mode (WebSocket server not available)
[Routes] Registering demo API routes with priority...
[Routes] Demo API routes registered successfully with priority
[2025-05-26T08:15:54.707Z] [INFO] [App] [KY3P-BATCH-UPDATE] Registering KY3P batch update routes 
[2025-05-26T08:15:54.707Z] [INFO] [App] Registering KY3P batch update routes 
[2025-05-26T08:15:54.707Z] [INFO] [App] [UnifiedKY3P] Registering unified KY3P update routes 
[Routes] Registered KY3P field key router
[2025-05-26T08:15:54.708Z] [INFO] [App] Registering KY3P field update routes 
[2025-05-26T08:15:54.708Z] [INFO] [App] [OpenBankingRoutes] Setting up routes... 
[Routes] Setting up transaction-based unified form submission router
[Routes] Successfully registered transaction-based unified form submission router
[Routes] Setting up unified form submission router
[Routes] Successfully registered unified form submission router
[Routes] Setting up transactional form submission router
[Routes] Successfully registered transactional form submission router
[Routes] Route registration completed: 13 modules initialized [DemoAPI, CompanySearch, KYB, KY3P-SubmissionFix, TaskProgress, UnifiedFormUpdate, KY3P-Fixed, KY3P-DemoAutofill, KY3P-BatchUpdate, KY3P-UnifiedUpdate, KY3P-FieldKey, UnifiedClearFields, TaskBroadcast]
[2025-05-26T08:15:54.711Z] [INFO] [App] [WebSocket] Setting up unified WebSocket server on path /ws 
[2025-05-26T08:15:54.711Z] [INFO] [WebSocket] Unified WebSocket server initialized successfully {"module":"WebSocket","clients":0,"path":"/ws","id":"479n6i","timestamp":"2025-05-26T08:15:54.711Z"}
[2025-05-26T08:15:54.711Z] [INFO] [App] [WebSocket] Unified WebSocket server initialized successfully 
[2025-05-26T08:15:54.711Z] [INFO] [App] [WebSocket] Unified WebSocket server handles form submission broadcasting 
[2025-05-26T08:15:54.711Z] [INFO] [App] [WebSocket] Skipping redundant WebSocket server initialization for deployment compatibility 
[2025-05-26T08:15:54.711Z] [INFO] [App] [ServerStartup] WebSocket server initialized with unified implementation 
[2025-05-26T08:15:54.712Z] [INFO] [App] [TaskWebSocket] WebSocket server registered with unified implementation 
[2025-05-26T08:15:54.712Z] [INFO] [App] [ServerStartup] WebSocket server registered with task-update utility 
[2025-05-26T08:15:54.712Z] [INFO] [TaskBroadcast] WebSocket server reference established {"module":"TaskBroadcast"}
[2025-05-26T08:15:54.712Z] [INFO] [TaskBroadcast] WebSocket server initialized {"module":"TaskBroadcast","connectedClients":0,"status":"active"}
[2025-05-26T08:15:54.712Z] [INFO] [App] [ServerStartup] WebSocket server registered with task-broadcast utility 
[2025-05-26T08:15:54.712Z] [INFO] [App] Setting up Vite development server 
[2025-05-26T08:15:54.714Z] [INFO] [App] [ProductionConfig] Applying Replit-optimized production configuration... 
[2025-05-26T08:15:54.714Z] [INFO] [App] [ProductionConfig] Applied memory optimization: max-old-space-size=1024MB 
[2025-05-26T08:15:54.714Z] [INFO] [App] [ProductionConfig] Enabled package layer optimization for deployment size reduction 
[2025-05-26T08:15:54.714Z] [INFO] [App] [ProductionConfig] Environment explicitly set to production 
[2025-05-26T08:15:54.714Z] [INFO] [App] [ProductionConfig] Production configuration applied successfully 
[2025-05-26T08:15:54.714Z] [INFO] [App] [ProductionConfig] All Replit deployment optimizations applied successfully 
[2025-05-26T08:15:54.714Z] [INFO] [App] [ENV] Server will listen on PORT=8080 (forced production mode) 
[2025-05-26T08:15:54.714Z] [INFO] [App] [ENV] Environment=production (forced production) 
[2025-05-26T08:15:54.714Z] [INFO] [App] [ENV] Deployment approach: Replit forced configuration for consistent Cloud Run deployment 
[2025-05-26T08:15:54.731Z] [INFO] [App] Server running on 0.0.0.0:8080 
[2025-05-26T08:15:54.731Z] [INFO] [App] Environment: production 
[Deployment] Server running on 0.0.0.0:8080
[Deployment] Environment: production
[Deployment] Port forwarding: Using Autoscale standard port (8080)
[Deployment] Production mode: Optimized for deployment
[2025-05-26T08:15:54.731Z] [INFO] [App] Starting periodic task reconciliation system... 
[2025-05-26T08:15:54.731Z] [INFO] [PeriodicTaskReconciliation] Periodic reconciliation system stopped {"module":"PeriodicTaskReconciliation","status":"inactive"}
[2025-05-26T08:15:54.731Z] [INFO] [PeriodicTaskReconciliation] Periodic reconciliation system started {"module":"PeriodicTaskReconciliation","intervalMs":300000,"cacheCleanupIntervalMs":900000,"status":"active"}
[2025-05-26T08:15:54.731Z] [INFO] [App] Task reconciliation system initialized successfully 
[2025-05-26T08:15:55.349Z] [INFO] [Database] Successfully established new database connection {"module":"Database"}
[2025-05-26T08:15:55.949Z] [INFO] [App] [ServerStartup] WebSocket server active with 0 connected clients 
[2025-05-26T08:15:58.322Z] [INFO] [App] GET /api/health 200 in 118ms 
[2025-05-26T08:15:58.519Z] [INFO] [Database] Successfully established new database connection {"module":"Database"}
[2025-05-26T08:16:04.732Z] [INFO] [App] Running background health checks... 
[2025-05-26T08:16:04.732Z] [StartupChecks] Running application startup health checks... 
[2025-05-26T08:16:04.732Z] [StartupChecks] Database health check attempt 1/3 
[2025-05-26T08:16:04.733Z] [INFO] [NeonConnectionService] Creating minimal connection pool for Neon PostgreSQL {"module":"NeonConnectionService"}
[2025-05-26T08:16:04.991Z] [INFO] [NeonConnectionService] New client connected to the pool {"module":"NeonConnectionService"}
[2025-05-26T08:16:05.022Z] [INFO] [NeonConnectionService] Connection pool initialized successfully {"module":"NeonConnectionService"}
[2025-05-26T08:16:05.051Z] [DBConnectionService] Database connection check successful 
[2025-05-26T08:16:05.051Z] [StartupChecks] Database health check passed 
[2025-05-26T08:16:05.051Z] [StartupChecks] All startup health checks passed! 
[2025-05-26T08:16:05.051Z] [INFO] [App] All background health checks passed successfully. 
[2025-05-26T08:16:20.745Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1748247380744-i37p4os","clients":1}
[2025-05-26T08:16:20.868Z] [INFO] [WebSocket] Received message from client client-1748247380744-i37p4os {"module":"WebSocket","type":"authenticate","data":{"timestamp":"2025-05-26T08:16:20.758Z"}}
[2025-05-26T08:16:20.868Z] [INFO] [WebSocket] Authentication from client client-1748247380744-i37p4os {"module":"WebSocket","hasToken":true}
[2025-05-26T08:16:21.247Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1748247381247-1mefrud","clients":2}
[2025-05-26T08:16:21.752Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1748247381752-42lx0r3","clients":3}
[2025-05-26T08:16:22.265Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1748247382265-40b3qyv","clients":4}
[2025-05-26T08:16:22.770Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1748247382770-38kflwl","clients":5}
[2025-05-26T08:16:23.083Z] [INFO] [WebSocket] Received message from client client-1748247382770-38kflwl {"module":"WebSocket","type":"authenticate","userId":"406","companyId":"365","clientId":"ws_1748247382043_434jxn916","timestamp":"2025-05-26T08:16:22.967Z"}
[2025-05-26T08:16:23.083Z] [INFO] [WebSocket] Authentication from client client-1748247382770-38kflwl {"module":"WebSocket","userId":"406","companyId":"365","hasToken":true}
[2025-05-26T08:16:24.787Z] [INFO] [PeriodicTaskReconciliation] Reconciling batch of tasks {"module":"PeriodicTaskReconciliation","batchSize":10,"taskIds":[967,971,981,978,976,980,982,977,984,986]}
[Task Progress] Calculated progress for task 967 (company_kyb): 0/30 = 0%
[Task Progress] Calculated progress for task 971 (company_kyb): 30/30 = 100%
[Task Progress] Calculated progress for task 981 (ky3p): 0/0 = 0%
[Task Progress] Calculated progress for task 978 (open_banking): 0/44 = 0%
[Task Progress] Calculated progress for task 976 (company_kyb): 0/30 = 0%
[Task Progress] Calculated progress for task 980 (company_kyb): 30/30 = 100%
[Task Progress] Calculated progress for task 982 (open_banking): 0/44 = 0%
[Task Progress] Calculated progress for task 977 (ky3p): 0/0 = 0%
[Task Progress] Calculated progress for task 984 (company_kyb): 30/30 = 100%
[Task Progress] Calculated progress for task 986 (open_banking): 44/44 = 100%
[2025-05-26T08:16:43.154Z] [INFO] [WebSocket] Received message from client client-1748247382770-38kflwl {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:16:43.042Z","connectionId":"ws_1748247382043_434jxn916"}
[2025-05-26T08:16:51.159Z] [INFO] [WebSocket] Received message from client client-1748247380744-i37p4os {"module":"WebSocket","type":"ping"}
[2025-05-26T08:16:52.156Z] [INFO] [WebSocket] Received message from client client-1748247381752-42lx0r3 {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:16:52.042Z","connectionId":"ws_1748247381770_w4a3c93fv"}
[2025-05-26T08:16:53.157Z] [INFO] [WebSocket] Received message from client client-1748247382265-40b3qyv {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:16:53.043Z","connectionId":"ws_1748247381258_lm896mb22"}
[2025-05-26T08:17:02.896Z] [INFO] [WebSocket] Received message from client client-1748247382770-38kflwl {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:17:02.783Z","connectionId":"ws_1748247382043_434jxn916"}
[2025-05-26T08:17:09.248Z] [INFO] [WebSocket] Client disconnected {"module":"WebSocket","clientId":"client-1748247382265-40b3qyv","code":1001,"reason":"","remainingClients":4}
[2025-05-26T08:17:09.249Z] [INFO] [WebSocket] Client disconnected {"module":"WebSocket","clientId":"client-1748247380744-i37p4os","code":1001,"reason":"","remainingClients":3}
[2025-05-26T08:17:09.249Z] [INFO] [WebSocket] Client disconnected {"module":"WebSocket","clientId":"client-1748247381752-42lx0r3","code":1001,"reason":"","remainingClients":2}
[2025-05-26T08:17:09.249Z] [INFO] [WebSocket] Client disconnected {"module":"WebSocket","clientId":"client-1748247381247-1mefrud","code":1001,"reason":"","remainingClients":1}
[2025-05-26T08:17:09.249Z] [INFO] [WebSocket] Client disconnected {"module":"WebSocket","clientId":"client-1748247382770-38kflwl","code":1001,"reason":"","remainingClients":0}
[2025-05-26T08:17:11.106Z] [INFO] [Database] Successfully established new database connection {"module":"Database"}
[2025-05-26T08:17:20.476Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1748247440476-k7j4k14","clients":1}
[2025-05-26T08:17:20.598Z] [INFO] [WebSocket] Received message from client client-1748247440476-k7j4k14 {"module":"WebSocket","type":"authenticate","data":{"timestamp":"2025-05-26T08:17:20.488Z"}}
[2025-05-26T08:17:20.598Z] [INFO] [WebSocket] Authentication from client client-1748247440476-k7j4k14 {"module":"WebSocket","hasToken":true}
[2025-05-26T08:17:20.976Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1748247440976-y94byy2","clients":2}
[2025-05-26T08:17:21.479Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1748247441479-kt6kw0b","clients":3}
[2025-05-26T08:17:21.986Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1748247441986-jx2kqzj","clients":4}
[2025-05-26T08:17:22.485Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1748247442485-d3hsg62","clients":5}
[2025-05-26T08:17:22.787Z] [INFO] [WebSocket] Received message from client client-1748247442485-d3hsg62 {"module":"WebSocket","type":"authenticate","userId":"406","companyId":"365","clientId":"ws_1748247441010_29r52jy4x","timestamp":"2025-05-26T08:17:22.680Z"}
[2025-05-26T08:17:22.787Z] [INFO] [WebSocket] Authentication from client client-1748247442485-d3hsg62 {"module":"WebSocket","userId":"406","companyId":"365","hasToken":true}
[DemoAPI] Company creation request received at: 2025-05-26T08:17:27.642Z
[DemoAPI] Request method: POST
[DemoAPI] Request headers: {
  'content-type': 'application/json',
  'content-length': '128',
  'user-agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) Ap...',
  origin: 'https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev:8080'
}
[DemoAPI] Full request body received: {
  "name": "LifeScience Partners",
  "type": "live",
  "persona": "accredited-data-recipient",
  "riskProfile": 14,
  "companySize": "extra-large"
}
[DemoAPI] Validating input parameters...
[DemoAPI] Input validation passed successfully
[DemoAPI] Extracted and validated fields: {
  name: 'LifeScience Partners',
  type: 'live',
  persona: 'accredited-data-recipient',
  companySize: 'extra-large',
  riskProfile: 14
}
[DemoAPI] ✅ IMMEDIATE ENTERPRISE DETECTION - CREATING LARGE ENTERPRISE
[2025-05-26T08:17:27.645Z] [INFO] [App] Successfully retrieved unified WebSocket server for broadcast 
[WebSocket] Broadcast demo_action_start to 5 clients (0 errors) { messageId: 'msg_1748247447645_bmp2isnz5' }
[2025-05-26T08:17:27.646Z] [INFO] [App] Successfully broadcasted demo_action_start message 
[DemoAPI] Immediate enterprise generated: $1.8B, 19300 employees
[DemoAPI] Starting database insert operation for enterprise company
[DemoAPI] Database connection status check...
[DemoAPI] Database connection verified successfully
[DemoAPI] Preparing company data for database insertion...
[DemoAPI] Generated risk clusters that sum to 14: {"Dark Web Data":2,"Cyber Security":2,"Public Sentiment":2,"Data Access Scope":1,"Financial Stability":2,"Potential Liability":5}
[DemoAPI] Selected legal structure: Private Limited Company
[DemoAPI] Company data prepared: {
  "name": "LifeScience Partners",
  "description": "Enterprise FinTech specializing in advanced financial technology solutions",
  "category": "FinTech",
  "revenue": "$1.8B",
  "num_employees": 19300,
  "revenue_tier": "xlarge",
  "is_demo": true,
  "available_tabs": [
    "dashboard",
    "task-center",
    "file-vault",
    "insights"
  ],
  "accreditation_status": "APPROVED",
  "website_url": "https://lifesciencepartners.com",
  "hq_address": "1345 Avenue of the Americas, Midtown Manhattan, New York, NY 10105",
  "founders_and_leadership": "Enterprise Leadership Team",
  "legal_structure": "Private Limited Company",
  "risk_clusters": {
    "Dark Web Data": 2,
    "Cyber Security": 2,
    "Public Sentiment": 2,
    "Data Access Scope": 1,
    "Financial Stability": 2,
    "Potential Liability": 5
  },
  "key_clients_partners": "Fortune 500 Companies",
  "investors": "Institutional Investors",
  "certifications_compliance": "SOC 2 Type II, ISO 27001",
  "incorporation_year": 2020,
  "risk_score": 14
}
[DemoAPI] Resolving company name uniqueness before database insertion...
[CompanyNameUtils] Starting comprehensive company name resolution {
  timestamp: '2025-05-26T08:17:27.697Z',
  module: 'CompanyNameUtils',
  operation: 'Starting comprehensive company name resolution',
  requestedName: 'LifeScience Partners',
  options: {
    maxAttempts: 5,
    suffixStyle: 'professional',
    preserveOriginal: true,
    isDemoContext: true
  }
}
[CompanyNameUtils] Starting company name uniqueness check {
  timestamp: '2025-05-26T08:17:27.698Z',
  module: 'CompanyNameUtils',
  operation: 'Starting company name uniqueness check',
  companyName: 'LifeScience Partners',
  nameLength: 20
}
[CompanyNameUtils] Company name is unique and available {
  timestamp: '2025-05-26T08:17:27.745Z',
  module: 'CompanyNameUtils',
  operation: 'Company name is unique and available',
  companyName: 'LifeScience Partners',
  duration: 47
}
[DemoAPI] Company name resolution completed: {
  originalName: 'LifeScience Partners',
  finalName: 'LifeScience Partners',
  wasModified: false,
  resolutionStrategy: 'original',
  processingTime: 48
}
[DemoAPI] Executing database insert with unique company name...
[DemoAPI] Database insert completed successfully
[DemoAPI] ✅ Enterprise company created successfully: {
  id: 369,
  name: 'LifeScience Partners',
  description: 'Enterprise FinTech specializing in advanced financial technology solutions',
  category: 'FinTech',
  logo_id: null,
  stock_ticker: null,
  website_url: 'https://lifesciencepartners.com',
  legal_structure: 'Private Limited Company',
  market_position: null,
  hq_address: '1345 Avenue of the Americas, Midtown Manhattan, New York, NY 10105',
  products_services: null,
  incorporation_year: 2020,
  founders_and_leadership: 'Enterprise Leadership Team',
  num_employees: 19300,
  revenue: '$1.8B',
  revenue_tier: 'xlarge',
  key_clients_partners: 'Fortune 500 Companies',
  investors: 'Institutional Investors',
  funding_stage: null,
  exit_strategy_history: null,
  certifications_compliance: 'SOC 2 Type II, ISO 27001',
  risk_score: 14,
  chosen_score: null,
  risk_clusters: {
    'Dark Web Data': 2,
    'Cyber Security': 2,
    'Public Sentiment': 2,
    'Data Access Scope': 1,
    'Financial Stability': 2,
    'Potential Liability': 5
  },
  risk_configuration: null,
  risk_priorities: null,
  accreditation_status: 'APPROVED',
  onboarding_company_completed: true,
  registry_date: 2025-05-26T08:17:27.762Z,
  files_public: [],
  files_private: [],
  available_tabs: [ 'dashboard', 'task-center', 'file-vault', 'insights' ],
  is_demo: true,
  created_at: 2025-05-26T08:17:27.762Z,
  updated_at: 2025-05-26T08:17:27.762Z
}
[2025-05-26T08:17:27.823Z] [INFO] [App] POST /api/demo/company/create 200 in 182ms :: {"success":true,"company":{"id":369,"name":"LifeScience Partners","descriptio... 
[DemoAPI] Creating user: {
  fullName: 'Nathan Rodriguez',
  email: 'nrodriguez@lifescience.com',
  role: 'Accredited Data Recipient',
  companyId: 369
}
[DemoAPI] Parsed company ID: 369
[2025-05-26T08:17:28.335Z] [INFO] [App] POST /api/demo/user/create 200 in 352ms :: {"success":true,"userId":411,"userData":{"fullName":"Nathan Rodriguez","email... 
[DemoAPI] Setting up authentication: { userId: 411, email: 'nrodriguez@lifescience.com' }
[2025-05-26T08:17:28.525Z] [INFO] [App] POST /api/demo/auth/setup 200 in 31ms :: {"success":true,"credentials":{"loginUrl":"/login","email":"nrodriguez@lifesc... 
[DemoAPI] [EmailInvite] Starting invitation process: {
  userEmail: 'nrodriguez@lifescience.com',
  userName: 'Nathan Rodriguez',
  companyName: 'LifeScience Partners',
  hasLoginCredentials: true,
  timestamp: '2025-05-26T08:17:28.691Z'
}
[DemoAPI] [EmailInvite] Fetching user and company data...
[DemoAPI] [EmailInvite] User found: {
  userId: 411,
  companyId: 369,
  fullName: 'Nathan Rodriguez',
  duration: 36
}
[DemoAPI] [EmailInvite] Company verified: {
  companyId: 369,
  companyName: 'LifeScience Partners',
  isDemo: true,
  duration: 76
}
[DemoAPI] [EmailInvite] Generated invitation code: { codeLength: 6, codeFormat: 'hex-uppercase', duration: 77 }
[DemoAPI] [EmailInvite] Creating invitation record...
[DemoAPI] [EmailInvite] Invitation record created: {
  invitationId: 405,
  code: '81F55E',
  expiresAt: 2025-06-02T08:17:28.768Z,
  duration: 117
}
[DemoAPI] [EmailInvite] Creating onboarding task...
[DemoAPI] [EmailInvite] Onboarding task created: {
  taskId: 1005,
  status: 'email_sent',
  assignedTo: 411,
  dueDate: 2025-06-09T08:17:28.808Z,
  duration: 154
}
[DemoAPI] [EmailInvite] Preparing email content...
[DemoAPI] [EmailInvite] Email prepared: {
  recipientEmail: 'nrodriguez@lifescience.com',
  subject: 'Welcome to Invela Trust Network - Your Demo Access is Ready!',
  invitationCode: '81F55E',
  messageId: 'demo_invite_1748247448845_405',
  emailSent: true,
  duration: 154
}
[DemoAPI] [EmailInvite] Process completed successfully: {
  userId: 411,
  companyId: 369,
  invitationId: 405,
  taskId: 1005,
  invitationCode: '81F55E',
  totalDuration: 154
}
[WebSocket] Broadcast demo_email_sent to 5 clients (0 errors) { messageId: 'msg_1748247448845_dewwgeoy2' }
[2025-05-26T08:17:28.846Z] [INFO] [App] Successfully broadcasted demo_email_sent message 
[2025-05-26T08:17:28.885Z] [INFO] [App] POST /api/demo/email/send-invitation 200 in 194ms :: {"success":true,"emailSent":true,"messageId":"demo_invite_1748247448845_405",... 
[DemoAPI] [Finalize] Starting demo environment finalization: {
  userId: 411,
  companyId: 369,
  demoType: 'accredited-data-recipient',
  timestamp: '2025-05-26T08:17:29.039Z'
}
[DemoAPI] [Finalize] Verifying user and company data...
[DemoAPI] [Finalize] User verification successful: {
  userId: 411,
  email: 'nrodriguez@lifescience.com',
  companyId: 369,
  fullName: 'Nathan Rodriguez',
  duration: 30
}
[DemoAPI] [Finalize] Setting up demo environment...
[DemoAPI] [Finalize] Environment configuration prepared: {
  environmentId: 'env_demo_1748247449069_411',
  config: {
    type: 'accredited-data-recipient',
    features: {
      demoDataAccess: true,
      tutorialMode: true,
      limitedFunctionality: false
    },
    permissions: {
      canInviteUsers: true,
      canModifySettings: true,
      canAccessAllTabs: true
    }
  },
  duration: 30
}
[DemoAPI] [Finalize] Initiating automatic user authentication...
[DemoAPI] [Finalize] Demo finalization completed successfully: {
  userId: 411,
  email: 'nrodriguez@lifescience.com',
  companyId: 369,
  environmentId: 'env_demo_1748247449069_411',
  authenticated: true,
  totalDuration: 91,
  timestamp: '2025-05-26T08:17:29.130Z'
}
[WebSocket] Broadcast demo_completed to 5 clients (0 errors) { messageId: 'msg_1748247449130_un374iytq' }
[2025-05-26T08:17:29.131Z] [INFO] [App] Successfully broadcasted demo_completed message 
[2025-05-26T08:17:29.162Z] [INFO] [App] POST /api/demo/environment/finalize 200 in 123ms :: {"success":true,"demoReady":true,"authenticated":true,"loginRequired":false,"... 
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 411, company_id: 369, email: 'nrodriguez@lifescience.com' }
[2025-05-26T08:17:31.827Z] [INFO] [App] Performing dynamic task unlocking check for company {"companyId":369,"userId":411}
[Current Company] Fetching company for user: { userId: 411, companyId: 369 }
[2025-05-26T08:17:31.860Z] [INFO] [App] No completed KYB tasks found, skipping security task unlock check {"companyId":369}
[Tasks] Automatically unlocking all tasks for company { userId: 411, companyId: 369, requestedBy: 'automatic_task_unlock' }
[Current Company] Found company: {
  id: 369,
  name: 'LifeScience Partners',
  onboardingCompleted: true,
  riskScore: 14,
  chosenScore: null,
  isDemo: true
}
[Current Company] Onboarding status check: {
  userId: 411,
  companyId: 369,
  userOnboardingStatus: false,
  companyOnboardingStatus: true,
  timestamp: '2025-05-26T08:17:31.861Z'
}
[2025-05-26T08:17:31.862Z] [INFO] [App] [TaskDependencies] Unlocking ALL tasks for company {"companyId":369}
[2025-05-26T08:17:31.896Z] [INFO] [App] [TaskDependencies] Found user onboarding task that needs completion {"taskId":1005,"userEmail":"nrodriguez@lifescience.com","currentStatus":"email_sent","currentProgress":25}
[2025-05-26T08:17:31.896Z] [INFO] [App] [TaskDependencies] Found tasks to unlock {"companyId":369,"count":1,"taskIds":[1005],"taskTypes":["user_onboarding"],"ky3pTaskCount":0,"ky3pTaskIds":[]}
[2025-05-26T08:17:31.896Z] [INFO] [App] [TaskDependencies] Setting User Onboarding task as completed {"taskId":1005,"userEmail":"nrodriguez@lifescience.com","timestamp":"2025-05-26T08:17:31.896Z"}
[2025-05-26T08:17:31.900Z] [INFO] [App] GET /api/companies/current 200 in 69ms :: {"id":369,"name":"LifeScience Partners","category":"FinTech","is_demo":true,"... 
[2025-05-26T08:17:31.933Z] [DEBUG] [App] Broadcasting task update with object format {"taskId":1005,"status":"completed"}
[WebSocket] Broadcast task_update to 5 clients (0 errors) { messageId: 'msg_1748247451933_dek1xr1dl' }
[2025-05-26T08:17:31.936Z] [INFO] [App] Successfully broadcasted task_update message 
[2025-05-26T08:17:31.936Z] [INFO] [App] [TaskDependencies] Successfully unlocked all tasks {"companyId":369,"count":1}
[Tasks] Successfully unlocked all tasks for company: 369
[Tasks] KYB tasks found: { count: 0 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 411',
    condition2: 'tasks.created_by = 411',
    condition3: "tasks.company_id = 369 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('nrodriguez@lifescience.com')"
  }
}
[Tasks] Tasks found: { count: 1 }
[2025-05-26T08:17:32.030Z] [INFO] [App] GET /api/tasks 200 in 204ms :: [{"id":1005,"title":"Demo Invitation: nrodriguez@lifescience.com","descriptio... 
[2025-05-26T08:17:32.085Z] [INFO] [App] [TabTutorials] Status request for tab "dashboard" from authenticated user ID: 411 
[2025-05-26T08:17:32.085Z] [INFO] [App] [TabTutorials] Normalizing tab name from 'dashboard' to canonical form 
[2025-05-26T08:17:32.085Z] [INFO] [App] [TabTutorials] Tab name already in canonical form: 'dashboard' 
[2025-05-26T08:17:32.085Z] [INFO] [App] [TabTutorials] Checking tutorial status for tab: dashboard (raw: dashboard), user: 411 
[2025-05-26T08:17:32.122Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1748247452122-vl72jvf","clients":6}
[2025-05-26T08:17:32.123Z] [INFO] [App] [TabTutorials] No tutorial status found for dashboard for user 411 
[2025-05-26T08:17:32.153Z] [INFO] [App] GET /api/user-tab-tutorials/dashboard/status 304 in 69ms :: {"exists":false,"completed":false,"currentStep":0,"tabName":"dashboard"} 
[2025-05-26T08:17:32.242Z] [INFO] [WebSocket] Received message from client client-1748247452122-vl72jvf {"module":"WebSocket","type":"authenticate","userId":null,"companyId":null,"clientId":"ws_1748247439679_fwbwxyz5y","timestamp":"2025-05-26T08:17:32.132Z"}
[2025-05-26T08:17:32.242Z] [INFO] [WebSocket] Authentication from client client-1748247452122-vl72jvf {"module":"WebSocket","userId":null,"companyId":null,"hasToken":true}
[Relationships] Fetching network for company: 369
[Relationships] Found network members: { count: 0 }
[2025-05-26T08:17:32.428Z] [INFO] [App] GET /api/relationships 304 in 68ms :: [] 
[Current Company] Using cached company data: 369
[2025-05-26T08:17:42.632Z] [INFO] [WebSocket] Received message from client client-1748247442485-d3hsg62 {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:17:42.497Z","connectionId":"ws_1748247441010_29r52jy4x"}
[2025-05-26T08:17:50.606Z] [INFO] [WebSocket] Received message from client client-1748247440476-k7j4k14 {"module":"WebSocket","type":"ping"}
[2025-05-26T08:17:51.596Z] [INFO] [WebSocket] Received message from client client-1748247441479-kt6kw0b {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:17:51.489Z","connectionId":"ws_1748247441489_ktjpxr5f2"}
[2025-05-26T08:17:52.105Z] [INFO] [WebSocket] Received message from client client-1748247441986-jx2kqzj {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:17:51.996Z","connectionId":"ws_1748247440987_0yjtwc4bc"}
[2025-05-26T08:18:02.125Z] [INFO] [App] GET /api/companies/current 304 in 33ms :: {"id":369,"name":"LifeScience Partners","category":"FinTech","is_demo":true,"... [sampled: request 11] 
[2025-05-26T08:18:02.605Z] [INFO] [WebSocket] Received message from client client-1748247442485-d3hsg62 {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:18:02.496Z","connectionId":"ws_1748247441010_29r52jy4x"}
[2025-05-26T08:18:20.600Z] [INFO] [WebSocket] Received message from client client-1748247440476-k7j4k14 {"module":"WebSocket","type":"ping"}
[2025-05-26T08:18:21.603Z] [INFO] [WebSocket] Received message from client client-1748247441479-kt6kw0b {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:18:21.490Z","connectionId":"ws_1748247441489_ktjpxr5f2"}
[2025-05-26T08:18:22.104Z] [INFO] [WebSocket] Received message from client client-1748247441986-jx2kqzj {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:18:21.997Z","connectionId":"ws_1748247440987_0yjtwc4bc"}
[2025-05-26T08:18:22.603Z] [INFO] [WebSocket] Received message from client client-1748247442485-d3hsg62 {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:18:22.495Z","connectionId":"ws_1748247441010_29r52jy4x"}
[Current Company] Fetching company for user: { userId: 411, companyId: 369 }
[Current Company] Found company: {
  id: 369,
  name: 'LifeScience Partners',
  onboardingCompleted: true,
  riskScore: 14,
  chosenScore: null,
  isDemo: true
}
[Current Company] Onboarding status check: {
  userId: 411,
  companyId: 369,
  userOnboardingStatus: false,
  companyOnboardingStatus: true,
  timestamp: '2025-05-26T08:18:32.114Z'
}
[2025-05-26T08:18:32.146Z] [INFO] [App] GET /api/companies/current 304 in 61ms :: {"id":369,"name":"LifeScience Partners","category":"FinTech","is_demo":true,"... [sampled: request 21] 
[2025-05-26T08:18:42.603Z] [INFO] [WebSocket] Received message from client client-1748247442485-d3hsg62 {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:18:42.495Z","connectionId":"ws_1748247441010_29r52jy4x"}
[2025-05-26T08:18:50.599Z] [INFO] [WebSocket] Received message from client client-1748247440476-k7j4k14 {"module":"WebSocket","type":"ping"}
[2025-05-26T08:18:51.599Z] [INFO] [WebSocket] Received message from client client-1748247441479-kt6kw0b {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:18:51.490Z","connectionId":"ws_1748247441489_ktjpxr5f2"}
[2025-05-26T08:18:52.105Z] [INFO] [WebSocket] Received message from client client-1748247441986-jx2kqzj {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:18:51.997Z","connectionId":"ws_1748247440987_0yjtwc4bc"}
[2025-05-26T08:19:02.120Z] [INFO] [App] GET /api/companies/current 304 in 30ms :: {"id":369,"name":"LifeScience Partners","category":"FinTech","is_demo":true,"... [sampled: request 31] 
[2025-05-26T08:19:02.603Z] [INFO] [WebSocket] Received message from client client-1748247442485-d3hsg62 {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:19:02.495Z","connectionId":"ws_1748247441010_29r52jy4x"}
[Current Company] Using cached company data: 369
[2025-05-26T08:19:21.151Z] [INFO] [WebSocket] Received message from client client-1748247440476-k7j4k14 {"module":"WebSocket","type":"ping"}
[2025-05-26T08:19:22.152Z] [INFO] [WebSocket] Received message from client client-1748247441479-kt6kw0b {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:19:22.043Z","connectionId":"ws_1748247441489_ktjpxr5f2"}
[2025-05-26T08:19:22.156Z] [INFO] [WebSocket] Received message from client client-1748247441986-jx2kqzj {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:19:22.043Z","connectionId":"ws_1748247440987_0yjtwc4bc"}
[2025-05-26T08:19:23.158Z] [INFO] [WebSocket] Received message from client client-1748247442485-d3hsg62 {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:19:23.042Z","connectionId":"ws_1748247441010_29r52jy4x"}
[2025-05-26T08:19:29.119Z] [INFO] [App] GET /api/companies/current 304 in 31ms :: {"id":369,"name":"LifeScience Partners","category":"FinTech","is_demo":true,"... [sampled: request 41] 
[Current Company] Fetching company for user: { userId: 411, companyId: 369 }
[Current Company] Found company: {
  id: 369,
  name: 'LifeScience Partners',
  onboardingCompleted: true,
  riskScore: 14,
  chosenScore: null,
  isDemo: true
}
[Current Company] Onboarding status check: {
  userId: 411,
  companyId: 369,
  userOnboardingStatus: false,
  companyOnboardingStatus: true,
  timestamp: '2025-05-26T08:19:32.122Z'
}
[2025-05-26T08:19:32.243Z] [INFO] [WebSocket] Received message from client client-1748247452122-vl72jvf {"module":"WebSocket","type":"ping"}
[2025-05-26T08:19:42.639Z] [INFO] [WebSocket] Received message from client client-1748247442485-d3hsg62 {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:19:42.496Z","connectionId":"ws_1748247441010_29r52jy4x"}
[2025-05-26T08:19:50.617Z] [INFO] [WebSocket] Received message from client client-1748247440476-k7j4k14 {"module":"WebSocket","type":"ping"}
[2025-05-26T08:19:51.598Z] [INFO] [WebSocket] Received message from client client-1748247441479-kt6kw0b {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:19:51.490Z","connectionId":"ws_1748247441489_ktjpxr5f2"}
[2025-05-26T08:19:52.110Z] [INFO] [WebSocket] Received message from client client-1748247441986-jx2kqzj {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:19:51.997Z","connectionId":"ws_1748247440987_0yjtwc4bc"}
[2025-05-26T08:19:59.118Z] [INFO] [App] GET /api/companies/current 304 in 31ms :: {"id":369,"name":"LifeScience Partners","category":"FinTech","is_demo":true,"... [sampled: request 51] 
[2025-05-26T08:20:02.606Z] [INFO] [WebSocket] Received message from client client-1748247442485-d3hsg62 {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:20:02.496Z","connectionId":"ws_1748247441010_29r52jy4x"}
[2025-05-26T08:20:20.602Z] [INFO] [WebSocket] Received message from client client-1748247440476-k7j4k14 {"module":"WebSocket","type":"ping"}
[2025-05-26T08:20:21.603Z] [INFO] [WebSocket] Received message from client client-1748247441479-kt6kw0b {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:20:21.491Z","connectionId":"ws_1748247441489_ktjpxr5f2"}
[2025-05-26T08:20:22.112Z] [INFO] [WebSocket] Received message from client client-1748247441986-jx2kqzj {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:20:21.997Z","connectionId":"ws_1748247440987_0yjtwc4bc"}
[2025-05-26T08:20:22.606Z] [INFO] [WebSocket] Received message from client client-1748247442485-d3hsg62 {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:20:22.496Z","connectionId":"ws_1748247441010_29r52jy4x"}
[2025-05-26T08:20:29.137Z] [INFO] [App] GET /api/companies/current 304 in 33ms :: {"id":369,"name":"LifeScience Partners","category":"FinTech","is_demo":true,"... [sampled: request 61] 
[Current Company] Fetching company for user: { userId: 411, companyId: 369 }
[Current Company] Found company: {
  id: 369,
  name: 'LifeScience Partners',
  onboardingCompleted: true,
  riskScore: 14,
  chosenScore: null,
  isDemo: true
}
[Current Company] Onboarding status check: {
  userId: 411,
  companyId: 369,
  userOnboardingStatus: false,
  companyOnboardingStatus: true,
  timestamp: '2025-05-26T08:20:32.260Z'
}
[2025-05-26T08:20:43.149Z] [INFO] [WebSocket] Received message from client client-1748247442485-d3hsg62 {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:20:43.042Z","connectionId":"ws_1748247441010_29r52jy4x"}
[2025-05-26T08:20:51.151Z] [INFO] [WebSocket] Received message from client client-1748247440476-k7j4k14 {"module":"WebSocket","type":"ping"}
[2025-05-26T08:20:52.153Z] [INFO] [WebSocket] Received message from client client-1748247441479-kt6kw0b {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:20:52.043Z","connectionId":"ws_1748247441489_ktjpxr5f2"}
[2025-05-26T08:20:52.154Z] [INFO] [WebSocket] Received message from client client-1748247441986-jx2kqzj {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:20:52.043Z","connectionId":"ws_1748247440987_0yjtwc4bc"}
[2025-05-26T08:20:54.760Z] [INFO] [PeriodicTaskReconciliation] Reconciling batch of tasks {"module":"PeriodicTaskReconciliation","batchSize":10,"taskIds":[1000,999,964,965,963,1001,973,968,967,972]}
[Task Progress] Calculated progress for task 1000 (ky3p): 0/0 = 0%
[Task Progress] Calculated progress for task 999 (company_kyb): 0/30 = 0%
[Task Progress] Calculated progress for task 964 (ky3p): 0/0 = 0%
[Task Progress] Calculated progress for task 965 (open_banking): 0/44 = 0%
[Task Progress] Calculated progress for task 963 (company_kyb): 0/30 = 0%
[Task Progress] Calculated progress for task 1001 (open_banking): 0/44 = 0%
[Task Progress] Calculated progress for task 973 (open_banking): 0/44 = 0%
[Task Progress] Calculated progress for task 968 (ky3p): 0/0 = 0%
[Task Progress] Calculated progress for task 967 (company_kyb): 0/30 = 0%
[Task Progress] Calculated progress for task 972 (ky3p): 0/0 = 0%
[2025-05-26T08:20:59.253Z] [INFO] [App] GET /api/companies/current 304 in 32ms :: {"id":369,"name":"LifeScience Partners","category":"FinTech","is_demo":true,"... [sampled: request 71] 
[2025-05-26T08:21:03.150Z] [INFO] [WebSocket] Received message from client client-1748247442485-d3hsg62 {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:21:03.042Z","connectionId":"ws_1748247441010_29r52jy4x"}
[2025-05-26T08:21:21.156Z] [INFO] [WebSocket] Received message from client client-1748247440476-k7j4k14 {"module":"WebSocket","type":"ping"}
[2025-05-26T08:21:22.165Z] [INFO] [WebSocket] Received message from client client-1748247441479-kt6kw0b {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:21:22.043Z","connectionId":"ws_1748247441489_ktjpxr5f2"}
[2025-05-26T08:21:22.166Z] [INFO] [WebSocket] Received message from client client-1748247441986-jx2kqzj {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:21:22.043Z","connectionId":"ws_1748247440987_0yjtwc4bc"}
[2025-05-26T08:21:23.152Z] [INFO] [WebSocket] Received message from client client-1748247442485-d3hsg62 {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:21:23.043Z","connectionId":"ws_1748247441010_29r52jy4x"}
[2025-05-26T08:21:29.256Z] [INFO] [App] GET /api/companies/current 304 in 31ms :: {"id":369,"name":"LifeScience Partners","category":"FinTech","is_demo":true,"... [sampled: request 81] 
[2025-05-26T08:21:33.158Z] [INFO] [WebSocket] Received message from client client-1748247452122-vl72jvf {"module":"WebSocket","type":"ping"}
[2025-05-26T08:22:32.161Z] [INFO] [WebSocket] Received message from client client-1748247441479-kt6kw0b {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:22:32.049Z","connectionId":"ws_1748247441489_ktjpxr5f2"}
[2025-05-26T08:22:32.162Z] [INFO] [WebSocket] Received message from client client-1748247442485-d3hsg62 {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:22:32.048Z","connectionId":"ws_1748247441010_29r52jy4x"}
[2025-05-26T08:22:32.162Z] [INFO] [WebSocket] Received message from client client-1748247440476-k7j4k14 {"module":"WebSocket","type":"ping"}
[2025-05-26T08:22:32.163Z] [INFO] [WebSocket] Client disconnected {"module":"WebSocket","clientId":"client-1748247440476-k7j4k14","code":1005,"reason":"","remainingClients":5}
[2025-05-26T08:22:32.164Z] [INFO] [WebSocket] Received message from client client-1748247441986-jx2kqzj {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:22:32.049Z","connectionId":"ws_1748247440987_0yjtwc4bc"}
[Current Company] Fetching company for user: { userId: 411, companyId: 369 }
[Current Company] Found company: {
  id: 369,
  name: 'LifeScience Partners',
  onboardingCompleted: true,
  riskScore: 14,
  chosenScore: null,
  isDemo: true
}
[Current Company] Onboarding status check: {
  userId: 411,
  companyId: 369,
  userOnboardingStatus: false,
  companyOnboardingStatus: true,
  timestamp: '2025-05-26T08:22:32.270Z'
}
[2025-05-26T08:22:34.566Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1748247754566-2s2kfv8","clients":6}
[2025-05-26T08:22:34.690Z] [INFO] [WebSocket] Received message from client client-1748247754566-2s2kfv8 {"module":"WebSocket","type":"authenticate","data":{"timestamp":"2025-05-26T08:22:34.576Z"}}
[2025-05-26T08:22:34.690Z] [INFO] [WebSocket] Authentication from client client-1748247754566-2s2kfv8 {"module":"WebSocket","hasToken":true}
[2025-05-26T08:22:42.614Z] [INFO] [WebSocket] Received message from client client-1748247442485-d3hsg62 {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:22:42.496Z","connectionId":"ws_1748247441010_29r52jy4x"}
[2025-05-26T08:22:51.611Z] [INFO] [WebSocket] Received message from client client-1748247441479-kt6kw0b {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:22:51.490Z","connectionId":"ws_1748247441489_ktjpxr5f2"}
[2025-05-26T08:22:52.107Z] [INFO] [WebSocket] Received message from client client-1748247441986-jx2kqzj {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:22:51.997Z","connectionId":"ws_1748247440987_0yjtwc4bc"}
[2025-05-26T08:22:56.127Z] [INFO] [App] GET /api/companies/current 304 in 30ms :: {"id":369,"name":"LifeScience Partners","category":"FinTech","is_demo":true,"... [sampled: request 91] 
[2025-05-26T08:23:02.605Z] [INFO] [WebSocket] Received message from client client-1748247442485-d3hsg62 {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:23:02.496Z","connectionId":"ws_1748247441010_29r52jy4x"}
[2025-05-26T08:23:04.692Z] [INFO] [WebSocket] Received message from client client-1748247754566-2s2kfv8 {"module":"WebSocket","type":"ping"}
[Current Company] Using cached company data: 369
[2025-05-26T08:23:21.600Z] [INFO] [WebSocket] Received message from client client-1748247441479-kt6kw0b {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:23:21.491Z","connectionId":"ws_1748247441489_ktjpxr5f2"}
[2025-05-26T08:23:22.111Z] [INFO] [WebSocket] Received message from client client-1748247441986-jx2kqzj {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:23:21.997Z","connectionId":"ws_1748247440987_0yjtwc4bc"}
[2025-05-26T08:23:22.606Z] [INFO] [WebSocket] Received message from client client-1748247442485-d3hsg62 {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:23:22.497Z","connectionId":"ws_1748247441010_29r52jy4x"}
[Current Company] Using cached company data: 369
[2025-05-26T08:23:26.116Z] [INFO] [App] GET /api/companies/current 304 in 30ms :: {"id":369,"name":"LifeScience Partners","category":"FinTech","is_demo":true,"... [sampled: request 101] 
[2025-05-26T08:23:32.242Z] [INFO] [WebSocket] Received message from client client-1748247452122-vl72jvf {"module":"WebSocket","type":"ping"}
[2025-05-26T08:23:34.773Z] [INFO] [WebSocket] Received message from client client-1748247754566-2s2kfv8 {"module":"WebSocket","type":"ping"}
[Current Company] Fetching company for user: { userId: 411, companyId: 369 }
[Current Company] Found company: {
  id: 369,
  name: 'LifeScience Partners',
  onboardingCompleted: true,
  riskScore: 14,
  chosenScore: null,
  isDemo: true
}
[Current Company] Onboarding status check: {
  userId: 411,
  companyId: 369,
  userOnboardingStatus: false,
  companyOnboardingStatus: true,
  timestamp: '2025-05-26T08:23:35.120Z'
}
[2025-05-26T08:23:42.604Z] [INFO] [WebSocket] Received message from client client-1748247442485-d3hsg62 {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:23:42.496Z","connectionId":"ws_1748247441010_29r52jy4x"}
[2025-05-26T08:23:51.599Z] [INFO] [WebSocket] Received message from client client-1748247441479-kt6kw0b {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:23:51.491Z","connectionId":"ws_1748247441489_ktjpxr5f2"}
[2025-05-26T08:23:52.109Z] [INFO] [WebSocket] Received message from client client-1748247441986-jx2kqzj {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:23:51.997Z","connectionId":"ws_1748247440987_0yjtwc4bc"}
[2025-05-26T08:23:56.129Z] [INFO] [App] GET /api/companies/current 304 in 31ms :: {"id":369,"name":"LifeScience Partners","category":"FinTech","is_demo":true,"... [sampled: request 111] 
[Current Company] Using cached company data: 369
[2025-05-26T08:24:02.605Z] [INFO] [WebSocket] Received message from client client-1748247442485-d3hsg62 {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:24:02.496Z","connectionId":"ws_1748247441010_29r52jy4x"}
[2025-05-26T08:24:04.694Z] [INFO] [WebSocket] Received message from client client-1748247754566-2s2kfv8 {"module":"WebSocket","type":"ping"}
[2025-05-26T08:24:21.599Z] [INFO] [WebSocket] Received message from client client-1748247441479-kt6kw0b {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:24:21.491Z","connectionId":"ws_1748247441489_ktjpxr5f2"}
[2025-05-26T08:24:22.109Z] [INFO] [WebSocket] Received message from client client-1748247441986-jx2kqzj {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:24:21.997Z","connectionId":"ws_1748247440987_0yjtwc4bc"}
[2025-05-26T08:24:22.604Z] [INFO] [WebSocket] Received message from client client-1748247442485-d3hsg62 {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:24:22.496Z","connectionId":"ws_1748247441010_29r52jy4x"}
[Current Company] Using cached company data: 369
[2025-05-26T08:24:26.247Z] [INFO] [App] GET /api/companies/current 304 in 31ms :: {"id":369,"name":"LifeScience Partners","category":"FinTech","is_demo":true,"... [sampled: request 121] 
[2025-05-26T08:24:35.155Z] [INFO] [WebSocket] Received message from client client-1748247754566-2s2kfv8 {"module":"WebSocket","type":"ping"}
[Current Company] Fetching company for user: { userId: 411, companyId: 369 }
[Current Company] Found company: {
  id: 369,
  name: 'LifeScience Partners',
  onboardingCompleted: true,
  riskScore: 14,
  chosenScore: null,
  isDemo: true
}
[Current Company] Onboarding status check: {
  userId: 411,
  companyId: 369,
  userOnboardingStatus: false,
  companyOnboardingStatus: true,
  timestamp: '2025-05-26T08:24:35.253Z'
}
[2025-05-26T08:24:43.178Z] [INFO] [WebSocket] Received message from client client-1748247442485-d3hsg62 {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:24:43.044Z","connectionId":"ws_1748247441010_29r52jy4x"}
[2025-05-26T08:24:52.157Z] [INFO] [WebSocket] Received message from client client-1748247441479-kt6kw0b {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:24:52.043Z","connectionId":"ws_1748247441489_ktjpxr5f2"}
[2025-05-26T08:24:52.157Z] [INFO] [WebSocket] Received message from client client-1748247441986-jx2kqzj {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:24:52.043Z","connectionId":"ws_1748247440987_0yjtwc4bc"}
[2025-05-26T08:24:56.297Z] [INFO] [App] GET /api/companies/current 304 in 30ms :: {"id":369,"name":"LifeScience Partners","category":"FinTech","is_demo":true,"... [sampled: request 131] 
[2025-05-26T08:25:03.153Z] [INFO] [WebSocket] Received message from client client-1748247442485-d3hsg62 {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:25:03.042Z","connectionId":"ws_1748247441010_29r52jy4x"}
[2025-05-26T08:25:05.151Z] [INFO] [WebSocket] Received message from client client-1748247754566-2s2kfv8 {"module":"WebSocket","type":"ping"}
[Current Company] Using cached company data: 369
[2025-05-26T08:25:22.152Z] [INFO] [WebSocket] Received message from client client-1748247441479-kt6kw0b {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:25:22.043Z","connectionId":"ws_1748247441489_ktjpxr5f2"}
[2025-05-26T08:25:22.152Z] [INFO] [WebSocket] Received message from client client-1748247441986-jx2kqzj {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:25:22.043Z","connectionId":"ws_1748247440987_0yjtwc4bc"}
[2025-05-26T08:25:23.151Z] [INFO] [WebSocket] Received message from client client-1748247442485-d3hsg62 {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:25:23.043Z","connectionId":"ws_1748247441010_29r52jy4x"}
[2025-05-26T08:25:32.514Z] [INFO] [App] GET /api/companies/current 304 in 37ms :: {"id":369,"name":"LifeScience Partners","category":"FinTech","is_demo":true,"... [sampled: request 141] 
[2025-05-26T08:25:33.156Z] [INFO] [WebSocket] Received message from client client-1748247452122-vl72jvf {"module":"WebSocket","type":"ping"}
[2025-05-26T08:25:35.160Z] [INFO] [WebSocket] Received message from client client-1748247754566-2s2kfv8 {"module":"WebSocket","type":"ping"}
[2025-05-26T08:25:54.762Z] [INFO] [PeriodicTaskReconciliation] Reconciling batch of tasks {"module":"PeriodicTaskReconciliation","batchSize":10,"taskIds":[999,963,1000,964,965,968,967,972,969,1001]}
[Task Progress] Calculated progress for task 999 (company_kyb): 0/30 = 0%
[Task Progress] Calculated progress for task 963 (company_kyb): 0/30 = 0%
[Task Progress] Calculated progress for task 1000 (ky3p): 0/0 = 0%
[Task Progress] Calculated progress for task 964 (ky3p): 0/0 = 0%
[Task Progress] Calculated progress for task 965 (open_banking): 0/44 = 0%
[Task Progress] Calculated progress for task 968 (ky3p): 0/0 = 0%
[Task Progress] Calculated progress for task 967 (company_kyb): 0/30 = 0%
[Task Progress] Calculated progress for task 972 (ky3p): 0/0 = 0%
[Task Progress] Calculated progress for task 969 (open_banking): 0/44 = 0%
[Task Progress] Calculated progress for task 1001 (open_banking): 0/44 = 0%
[2025-05-26T08:26:32.162Z] [INFO] [WebSocket] Received message from client client-1748247442485-d3hsg62 {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:26:32.045Z","connectionId":"ws_1748247441010_29r52jy4x"}
[2025-05-26T08:26:32.162Z] [INFO] [WebSocket] Received message from client client-1748247441479-kt6kw0b {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:26:32.045Z","connectionId":"ws_1748247441489_ktjpxr5f2"}
[2025-05-26T08:26:32.162Z] [INFO] [WebSocket] Received message from client client-1748247754566-2s2kfv8 {"module":"WebSocket","type":"ping"}
[2025-05-26T08:26:32.163Z] [INFO] [WebSocket] Received message from client client-1748247441986-jx2kqzj {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:26:32.045Z","connectionId":"ws_1748247440987_0yjtwc4bc"}
[Current Company] Fetching company for user: { userId: 411, companyId: 369 }
[Current Company] Found company: {
  id: 369,
  name: 'LifeScience Partners',
  onboardingCompleted: true,
  riskScore: 14,
  chosenScore: null,
  isDemo: true
}
[Current Company] Onboarding status check: {
  userId: 411,
  companyId: 369,
  userOnboardingStatus: false,
  companyOnboardingStatus: true,
  timestamp: '2025-05-26T08:26:32.348Z'
}
[2025-05-26T08:27:32.157Z] [INFO] [WebSocket] Received message from client client-1748247754566-2s2kfv8 {"module":"WebSocket","type":"ping"}
[2025-05-26T08:27:32.162Z] [INFO] [WebSocket] Received message from client client-1748247442485-d3hsg62 {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:27:32.047Z","connectionId":"ws_1748247441010_29r52jy4x"}
[2025-05-26T08:27:32.163Z] [INFO] [WebSocket] Received message from client client-1748247441479-kt6kw0b {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:27:32.047Z","connectionId":"ws_1748247441489_ktjpxr5f2"}
[2025-05-26T08:27:32.163Z] [INFO] [WebSocket] Received message from client client-1748247441986-jx2kqzj {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:27:32.047Z","connectionId":"ws_1748247440987_0yjtwc4bc"}
[2025-05-26T08:27:33.158Z] [INFO] [WebSocket] Received message from client client-1748247452122-vl72jvf {"module":"WebSocket","type":"ping"}
[2025-05-26T08:28:32.168Z] [INFO] [WebSocket] Received message from client client-1748247442485-d3hsg62 {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:28:32.009Z","connectionId":"ws_1748247441010_29r52jy4x"}
[2025-05-26T08:28:32.169Z] [INFO] [WebSocket] Received message from client client-1748247754566-2s2kfv8 {"module":"WebSocket","type":"ping"}
[2025-05-26T08:28:32.173Z] [INFO] [WebSocket] Received message from client client-1748247441479-kt6kw0b {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:28:32.009Z","connectionId":"ws_1748247441489_ktjpxr5f2"}
[2025-05-26T08:28:32.173Z] [INFO] [WebSocket] Received message from client client-1748247441986-jx2kqzj {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:28:32.009Z","connectionId":"ws_1748247440987_0yjtwc4bc"}
[Current Company] Fetching company for user: { userId: 411, companyId: 369 }
[Current Company] Found company: {
  id: 369,
  name: 'LifeScience Partners',
  onboardingCompleted: true,
  riskScore: 14,
  chosenScore: null,
  isDemo: true
}
[Current Company] Onboarding status check: {
  userId: 411,
  companyId: 369,
  userOnboardingStatus: false,
  companyOnboardingStatus: true,
  timestamp: '2025-05-26T08:28:32.293Z'
}
[2025-05-26T08:28:34.686Z] [INFO] [WebSocket] Received message from client client-1748247754566-2s2kfv8 {"module":"WebSocket","type":"ping"}
[2025-05-26T08:28:42.605Z] [INFO] [WebSocket] Received message from client client-1748247442485-d3hsg62 {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:28:42.450Z","connectionId":"ws_1748247441010_29r52jy4x"}
[2025-05-26T08:28:50.119Z] [INFO] [App] GET /api/companies/current 304 in 31ms :: {"id":369,"name":"LifeScience Partners","category":"FinTech","is_demo":true,"... [sampled: request 151] 
[2025-05-26T08:28:51.603Z] [INFO] [WebSocket] Received message from client client-1748247441479-kt6kw0b {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:28:51.445Z","connectionId":"ws_1748247441489_ktjpxr5f2"}
[Complete Onboarding] Processing request for user: { userId: 411, companyId: 369, timestamp: '2025-05-26T08:28:51.995Z' }
[Complete Onboarding] Successfully updated user record: {
  userId: 411,
  companyId: 369,
  userOnboardingStatus: true,
  elapsedMs: 70
}
[2025-05-26T08:28:52.107Z] [INFO] [WebSocket] Received message from client client-1748247441986-jx2kqzj {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:28:51.951Z","connectionId":"ws_1748247440987_0yjtwc4bc"}
[updateOnboardingTaskStatus] Error updating task status: TypeError: undefined is not a function
    at Array.find (<anonymous>)
    at updateOnboardingTaskStatus (/home/runner/workspace/server/routes.ts:3582:139)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async <anonymous> (/home/runner/workspace/server/routes.ts:2952:27)
[Complete Onboarding] Successfully completed onboarding for user: { userId: 411, taskId: undefined, elapsedMs: 143 }
[Cache] Invalidating company cache for company 369
[2025-05-26T08:28:52.201Z] [INFO] [App] POST /api/users/complete-onboarding 200 in 207ms :: {"message":"Onboarding completed successfully","success":true,"user":{"id":41... 
[Company API] Updating company 369 with data: { revenue: 10000000, revenue_tier: 'medium', num_employees: 625 }
[Company API] Processed update data: { revenue: 10000000, revenue_tier: 'medium', num_employees: 625 }
[Company API] Successfully updated company 369
[2025-05-26T08:28:52.467Z] [INFO] [App] PATCH /api/companies/current 200 in 72ms :: {"success":true,"message":"Company updated successfully","data":{"id":369,"na... 
[Current Company] Fetching company for user: { userId: 411, companyId: 369 }
[Current Company] Found company: {
  id: 369,
  name: 'LifeScience Partners',
  onboardingCompleted: true,
  riskScore: 14,
  chosenScore: null,
  isDemo: true
}
[Current Company] Onboarding status check: {
  userId: 411,
  companyId: 369,
  userOnboardingStatus: true,
  companyOnboardingStatus: true,
  timestamp: '2025-05-26T08:28:52.690Z'
}
[2025-05-26T08:28:52.886Z] [INFO] [Database] Successfully established new database connection {"module":"Database"}
[2025-05-26T08:29:02.607Z] [INFO] [WebSocket] Received message from client client-1748247442485-d3hsg62 {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:29:02.450Z","connectionId":"ws_1748247441010_29r52jy4x"}
[DemoAPI] Company creation request received at: 2025-05-26T08:29:04.441Z
[DemoAPI] Request method: POST
[DemoAPI] Request headers: {
  'content-type': 'application/json',
  'content-length': '126',
  'user-agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) Ap...',
  origin: 'https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev:8080'
}
[DemoAPI] Full request body received: {
  "name": "Sterling Trust Solutions",
  "type": "live",
  "persona": "accredited-data-recipient",
  "riskProfile": 13,
  "companySize": "small"
}
[DemoAPI] Validating input parameters...
[DemoAPI] Input validation passed successfully
[DemoAPI] Extracted and validated fields: {
  name: 'Sterling Trust Solutions',
  type: 'live',
  persona: 'accredited-data-recipient',
  companySize: 'small',
  riskProfile: 13
}
[WebSocket] Broadcast demo_action_start to 6 clients (0 errors) { messageId: 'msg_1748248144442_o4c4sf7mt' }
[2025-05-26T08:29:04.442Z] [INFO] [App] Successfully broadcasted demo_action_start message 
[DemoAPI] Generating company data for: { persona: 'accredited-data-recipient', companySize: 'small' }
[DemoAPI] IMPLEMENTING DIRECT FIX for size: small
[DemoAPI] Generated company data: {
  category: 'FinTech',
  accreditation_status: 'APPROVED',
  is_demo: true,
  available_tabs: [ 'dashboard', 'task-center', 'file-vault', 'insights' ],
  revenue: '$9.8M',
  num_employees: 43,
  revenue_tier: 'small'
}
[DemoAPI] Generating comprehensive business details...
[DemoAPI] Business Details - Persona: accredited-data-recipient, Mapped Type: fintech
[DemoAPI] Generated business details: {
  website: 'https://www.securepay.com',
  hasAddress: true,
  hasLeadership: true,
  hasClients: true,
  hasInvestors: true,
  hasCertifications: true
}
[DemoAPI] Assembled complete company data for insertion
[DemoAPI] Business details verification: {
  websiteIncluded: true,
  addressIncluded: true,
  productsIncluded: true,
  leadershipIncluded: true,
  clientsIncluded: true,
  investorsIncluded: true,
  certificationsIncluded: true,
  riskClustersIncluded: true
}
[DemoAPI] Final insert values: {
  "name": "Sterling Trust Solutions",
  "description": "Professional fintech company specializing in secure data management and compliance",
  "category": "FinTech",
  "accreditation_status": "APPROVED",
  "is_demo": true,
  "available_tabs": [
    "dashboard",
    "task-center",
    "file-vault",
    "insights"
  ],
  "revenue": "$9.8M",
  "num_employees": 43,
  "revenue_tier": "small",
  "risk_score": 13,
  "risk_clusters": {
    "Dark Web Data": 2,
    "Cyber Security": 1,
    "Public Sentiment": 2,
    "Data Access Scope": 2,
    "Financial Stability": 1,
    "Potential Liability": 5
  },
  "website_url": "https://www.securepay.com",
  "hq_address": "1250 Broadway, Suite 2700, New York, NY 10001",
  "products_services": "Digital payment processing, fraud detection systems, compliance automation platform",
  "founders_and_leadership": "David Thompson (CEO, Former Bank of America SVP), Lisa Wang (CTO, Ex-Microsoft Principal), Robert Kim (CFO, Former Citigroup VP)",
  "key_clients_partners": "PNC Bank, US Bank, TD Bank, HSBC, Barclays",
  "investors": "Seed funding from financial services veterans, early-stage VC firms",
  "certifications_compliance": "SOX Compliance, FISMA Moderate, FedRAMP Authorized, NIST Cybersecurity Framework",
  "legal_structure": "Corporation",
  "market_position": "Growing Business",
  "incorporation_year": 2014,
  "funding_stage": "Series B"
}
[WebSocket] Broadcast demo_action_complete to 6 clients (0 errors) { messageId: 'msg_1748248144484_m0knfhajw' }
[2025-05-26T08:29:04.485Z] [INFO] [App] Successfully broadcasted demo_action_complete message 
[2025-05-26T08:29:04.517Z] [INFO] [App] POST /api/demo/company/create 200 in 76ms :: {"success":true,"companyId":370,"companyData":{"name":"Sterling Trust Solutio... 
[DemoAPI] Creating user: {
  fullName: 'Ella Rodriguez',
  email: 'erodriguez@sterlingtrustsolutions.com',
  role: 'Accredited Data Recipient',
  companyId: 370
}
[2025-05-26T08:29:04.685Z] [INFO] [WebSocket] Received message from client client-1748247754566-2s2kfv8 {"module":"WebSocket","type":"ping"}
[DemoAPI] Parsed company ID: 370
[2025-05-26T08:29:04.976Z] [INFO] [App] POST /api/demo/user/create 200 in 300ms :: {"success":true,"userId":412,"userData":{"fullName":"Ella Rodriguez","email":... 
[DemoAPI] Setting up authentication: { userId: 412, email: 'erodriguez@sterlingtrustsolutions.com' }
[2025-05-26T08:29:05.161Z] [INFO] [App] POST /api/demo/auth/setup 200 in 29ms :: {"success":true,"credentials":{"loginUrl":"/login","email":"erodriguez@sterli... 
[DemoAPI] [EmailInvite] Starting invitation process: {
  userEmail: 'erodriguez@sterlingtrustsolutions.com',
  userName: 'Ella Rodriguez',
  companyName: 'Sterling Trust Solutions',
  hasLoginCredentials: true,
  timestamp: '2025-05-26T08:29:05.322Z'
}
[DemoAPI] [EmailInvite] Fetching user and company data...
[DemoAPI] [EmailInvite] User found: {
  userId: 412,
  companyId: 370,
  fullName: 'Ella Rodriguez',
  duration: 30
}
[DemoAPI] [EmailInvite] Company verified: {
  companyId: 370,
  companyName: 'Sterling Trust Solutions',
  isDemo: true,
  duration: 59
}
[DemoAPI] [EmailInvite] Generated invitation code: { codeLength: 6, codeFormat: 'hex-uppercase', duration: 60 }
[DemoAPI] [EmailInvite] Creating invitation record...
[DemoAPI] [EmailInvite] Invitation record created: {
  invitationId: 406,
  code: '12943E',
  expiresAt: 2025-06-02T08:29:05.382Z,
  duration: 96
}
[DemoAPI] [EmailInvite] Creating onboarding task...
[DemoAPI] [EmailInvite] Onboarding task created: {
  taskId: 1006,
  status: 'email_sent',
  assignedTo: 412,
  dueDate: 2025-06-09T08:29:05.419Z,
  duration: 131
}
[DemoAPI] [EmailInvite] Preparing email content...
[DemoAPI] [EmailInvite] Email prepared: {
  recipientEmail: 'erodriguez@sterlingtrustsolutions.com',
  subject: 'Welcome to Invela Trust Network - Your Demo Access is Ready!',
  invitationCode: '12943E',
  messageId: 'demo_invite_1748248145454_406',
  emailSent: true,
  duration: 132
}
[DemoAPI] [EmailInvite] Process completed successfully: {
  userId: 412,
  companyId: 370,
  invitationId: 406,
  taskId: 1006,
  invitationCode: '12943E',
  totalDuration: 132
}
[WebSocket] Broadcast demo_email_sent to 6 clients (0 errors) { messageId: 'msg_1748248145454_trzfz4t7y' }
[2025-05-26T08:29:05.454Z] [INFO] [App] Successfully broadcasted demo_email_sent message 
[2025-05-26T08:29:05.492Z] [INFO] [App] POST /api/demo/email/send-invitation 200 in 170ms :: {"success":true,"emailSent":true,"messageId":"demo_invite_1748248145454_406",... 
[DemoAPI] [Finalize] Starting demo environment finalization: {
  userId: 412,
  companyId: 370,
  demoType: 'accredited-data-recipient',
  timestamp: '2025-05-26T08:29:05.655Z'
}
[DemoAPI] [Finalize] Verifying user and company data...
[DemoAPI] [Finalize] User verification successful: {
  userId: 412,
  email: 'erodriguez@sterlingtrustsolutions.com',
  companyId: 370,
  fullName: 'Ella Rodriguez',
  duration: 38
}
[DemoAPI] [Finalize] Setting up demo environment...
[DemoAPI] [Finalize] Environment configuration prepared: {
  environmentId: 'env_demo_1748248145693_412',
  config: {
    type: 'accredited-data-recipient',
    features: {
      demoDataAccess: true,
      tutorialMode: true,
      limitedFunctionality: false
    },
    permissions: {
      canInviteUsers: true,
      canModifySettings: true,
      canAccessAllTabs: true
    }
  },
  duration: 38
}
[DemoAPI] [Finalize] Initiating automatic user authentication...
[DemoAPI] [Finalize] Demo finalization completed successfully: {
  userId: 412,
  email: 'erodriguez@sterlingtrustsolutions.com',
  companyId: 370,
  environmentId: 'env_demo_1748248145693_412',
  authenticated: true,
  totalDuration: 109,
  timestamp: '2025-05-26T08:29:05.764Z'
}
[WebSocket] Broadcast demo_completed to 6 clients (0 errors) { messageId: 'msg_1748248145764_ewnwopgqj' }
[2025-05-26T08:29:05.765Z] [INFO] [App] Successfully broadcasted demo_completed message 
[2025-05-26T08:29:05.800Z] [INFO] [App] POST /api/demo/environment/finalize 200 in 145ms :: {"success":true,"demoReady":true,"authenticated":true,"loginRequired":false,"... 
[Current Company] Fetching company for user: { userId: 412, companyId: 370 }
[Tasks] ====== Starting task fetch =====
[Tasks] User details: {
  id: 412,
  company_id: 370,
  email: 'erodriguez@sterlingtrustsolutions.com'
}
[2025-05-26T08:29:08.130Z] [INFO] [App] Performing dynamic task unlocking check for company {"companyId":370,"userId":412}
[Current Company] Found company: {
  id: 370,
  name: 'Sterling Trust Solutions',
  onboardingCompleted: true,
  riskScore: 13,
  chosenScore: null,
  isDemo: true
}
[Current Company] Onboarding status check: {
  userId: 412,
  companyId: 370,
  userOnboardingStatus: false,
  companyOnboardingStatus: true,
  timestamp: '2025-05-26T08:29:08.157Z'
}
[2025-05-26T08:29:08.159Z] [INFO] [App] No completed KYB tasks found, skipping security task unlock check {"companyId":370}
[Tasks] Automatically unlocking all tasks for company { userId: 412, companyId: 370, requestedBy: 'automatic_task_unlock' }
[2025-05-26T08:29:08.160Z] [INFO] [App] [TaskDependencies] Unlocking ALL tasks for company {"companyId":370}
[2025-05-26T08:29:08.189Z] [INFO] [App] [TaskDependencies] Found user onboarding task that needs completion {"taskId":1006,"userEmail":"erodriguez@sterlingtrustsolutions.com","currentStatus":"email_sent","currentProgress":25}
[2025-05-26T08:29:08.189Z] [INFO] [App] [TaskDependencies] Found tasks to unlock {"companyId":370,"count":1,"taskIds":[1006],"taskTypes":["user_onboarding"],"ky3pTaskCount":0,"ky3pTaskIds":[]}
[2025-05-26T08:29:08.189Z] [INFO] [App] [TaskDependencies] Setting User Onboarding task as completed {"taskId":1006,"userEmail":"erodriguez@sterlingtrustsolutions.com","timestamp":"2025-05-26T08:29:08.189Z"}
[2025-05-26T08:29:08.219Z] [DEBUG] [App] Broadcasting task update with object format {"taskId":1006,"status":"completed"}
[WebSocket] Broadcast task_update to 6 clients (0 errors) { messageId: 'msg_1748248148219_7a7xehqvs' }
[2025-05-26T08:29:08.220Z] [INFO] [App] Successfully broadcasted task_update message 
[2025-05-26T08:29:08.220Z] [INFO] [App] [TaskDependencies] Successfully unlocked all tasks {"companyId":370,"count":1}
[Tasks] Successfully unlocked all tasks for company: 370
[Tasks] KYB tasks found: { count: 0 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 412',
    condition2: 'tasks.created_by = 412',
    condition3: "tasks.company_id = 370 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('erodriguez@sterlingtrustsolutions.com')"
  }
}
[Tasks] Tasks found: { count: 1 }
[2025-05-26T08:29:08.311Z] [INFO] [App] GET /api/tasks 200 in 182ms :: [{"id":1006,"title":"Demo Invitation: erodriguez@sterlingtrustsolutions.com",... 
[2025-05-26T08:29:08.380Z] [INFO] [App] [TabTutorials] Status request for tab "dashboard" from authenticated user ID: 412 
[2025-05-26T08:29:08.380Z] [INFO] [App] [TabTutorials] Normalizing tab name from 'dashboard' to canonical form 
[2025-05-26T08:29:08.380Z] [INFO] [App] [TabTutorials] Tab name already in canonical form: 'dashboard' 
[2025-05-26T08:29:08.380Z] [INFO] [App] [TabTutorials] Checking tutorial status for tab: dashboard (raw: dashboard), user: 412 
[2025-05-26T08:29:08.410Z] [INFO] [App] [TabTutorials] No tutorial status found for dashboard for user 412 
[2025-05-26T08:29:08.440Z] [INFO] [App] GET /api/user-tab-tutorials/dashboard/status 304 in 60ms :: {"exists":false,"completed":false,"currentStep":0,"tabName":"dashboard"} 
[Relationships] Fetching network for company: 370
[Relationships] Found network members: { count: 0 }
[2025-05-26T08:29:08.687Z] [INFO] [App] GET /api/relationships 304 in 60ms :: [] 
[Current Company] Using cached company data: 370
[2025-05-26T08:29:21.601Z] [INFO] [WebSocket] Received message from client client-1748247441479-kt6kw0b {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:29:21.444Z","connectionId":"ws_1748247441489_ktjpxr5f2"}
[2025-05-26T08:29:22.116Z] [INFO] [WebSocket] Received message from client client-1748247441986-jx2kqzj {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:29:21.951Z","connectionId":"ws_1748247440987_0yjtwc4bc"}
[2025-05-26T08:29:22.608Z] [INFO] [WebSocket] Received message from client client-1748247442485-d3hsg62 {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:29:22.450Z","connectionId":"ws_1748247441010_29r52jy4x"}
[Current Company] Using cached company data: 370
[2025-05-26T08:29:29.421Z] [INFO] [App] GET /api/companies/current 304 in 30ms :: {"id":370,"name":"Sterling Trust Solutions","category":"FinTech","is_demo":tr... [sampled: request 161] 
[2025-05-26T08:29:32.243Z] [INFO] [WebSocket] Received message from client client-1748247452122-vl72jvf {"module":"WebSocket","type":"ping"}
[2025-05-26T08:29:34.688Z] [INFO] [WebSocket] Received message from client client-1748247754566-2s2kfv8 {"module":"WebSocket","type":"ping"}
[2025-05-26T08:29:42.609Z] [INFO] [WebSocket] Received message from client client-1748247442485-d3hsg62 {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:29:42.450Z","connectionId":"ws_1748247441010_29r52jy4x"}
[2025-05-26T08:29:51.620Z] [INFO] [WebSocket] Received message from client client-1748247441479-kt6kw0b {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:29:51.445Z","connectionId":"ws_1748247441489_ktjpxr5f2"}
[2025-05-26T08:29:52.110Z] [INFO] [WebSocket] Received message from client client-1748247441986-jx2kqzj {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:29:51.951Z","connectionId":"ws_1748247440987_0yjtwc4bc"}
[2025-05-26T08:29:59.501Z] [INFO] [App] GET /api/companies/current 304 in 31ms :: {"id":370,"name":"Sterling Trust Solutions","category":"FinTech","is_demo":tr... [sampled: request 171] 
[2025-05-26T08:30:02.607Z] [INFO] [WebSocket] Received message from client client-1748247442485-d3hsg62 {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:30:02.449Z","connectionId":"ws_1748247441010_29r52jy4x"}
[2025-05-26T08:30:04.689Z] [INFO] [WebSocket] Received message from client client-1748247754566-2s2kfv8 {"module":"WebSocket","type":"ping"}
[Current Company] Fetching company for user: { userId: 412, companyId: 370 }
[Current Company] Found company: {
  id: 370,
  name: 'Sterling Trust Solutions',
  onboardingCompleted: true,
  riskScore: 13,
  chosenScore: null,
  isDemo: true
}
[Current Company] Onboarding status check: {
  userId: 412,
  companyId: 370,
  userOnboardingStatus: false,
  companyOnboardingStatus: true,
  timestamp: '2025-05-26T08:30:08.414Z'
}
[2025-05-26T08:30:21.610Z] [INFO] [WebSocket] Received message from client client-1748247441479-kt6kw0b {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:30:21.444Z","connectionId":"ws_1748247441489_ktjpxr5f2"}
[2025-05-26T08:30:22.107Z] [INFO] [WebSocket] Received message from client client-1748247441986-jx2kqzj {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:30:21.950Z","connectionId":"ws_1748247440987_0yjtwc4bc"}
[2025-05-26T08:30:22.605Z] [INFO] [WebSocket] Received message from client client-1748247442485-d3hsg62 {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:30:22.449Z","connectionId":"ws_1748247441010_29r52jy4x"}
[Current Company] Using cached company data: 370
[2025-05-26T08:30:29.417Z] [INFO] [App] GET /api/companies/current 304 in 31ms :: {"id":370,"name":"Sterling Trust Solutions","category":"FinTech","is_demo":tr... [sampled: request 181] 
[2025-05-26T08:30:34.687Z] [INFO] [WebSocket] Received message from client client-1748247754566-2s2kfv8 {"module":"WebSocket","type":"ping"}
[2025-05-26T08:30:42.609Z] [INFO] [WebSocket] Received message from client client-1748247442485-d3hsg62 {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:30:42.450Z","connectionId":"ws_1748247441010_29r52jy4x"}
[2025-05-26T08:30:51.600Z] [INFO] [WebSocket] Received message from client client-1748247441479-kt6kw0b {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:30:51.444Z","connectionId":"ws_1748247441489_ktjpxr5f2"}
[2025-05-26T08:30:52.106Z] [INFO] [WebSocket] Received message from client client-1748247441986-jx2kqzj {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:30:51.950Z","connectionId":"ws_1748247440987_0yjtwc4bc"}
[PeriodicTaskReconciliation] Cleaned up 20 expired entries from cache
[2025-05-26T08:30:54.761Z] [INFO] [PeriodicTaskReconciliation] Reconciling batch of tasks {"module":"PeriodicTaskReconciliation","batchSize":10,"taskIds":[1000,964,999,963,965,972,969,1001,973,968]}
[Task Progress] Calculated progress for task 1000 (ky3p): 0/0 = 0%
[Task Progress] Calculated progress for task 964 (ky3p): 0/0 = 0%
[Task Progress] Calculated progress for task 999 (company_kyb): 0/30 = 0%
[Task Progress] Calculated progress for task 963 (company_kyb): 0/30 = 0%
[Task Progress] Calculated progress for task 965 (open_banking): 0/44 = 0%
[Task Progress] Calculated progress for task 972 (ky3p): 0/0 = 0%
[Task Progress] Calculated progress for task 969 (open_banking): 0/44 = 0%
[Task Progress] Calculated progress for task 1001 (open_banking): 0/44 = 0%
[Task Progress] Calculated progress for task 973 (open_banking): 0/44 = 0%
[Task Progress] Calculated progress for task 968 (ky3p): 0/0 = 0%
[2025-05-26T08:30:59.411Z] [INFO] [App] GET /api/companies/current 304 in 31ms :: {"id":370,"name":"Sterling Trust Solutions","category":"FinTech","is_demo":tr... [sampled: request 191] 
[2025-05-26T08:31:03.171Z] [INFO] [WebSocket] Received message from client client-1748247442485-d3hsg62 {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:31:02.995Z","connectionId":"ws_1748247441010_29r52jy4x"}
[2025-05-26T08:31:05.177Z] [INFO] [WebSocket] Received message from client client-1748247754566-2s2kfv8 {"module":"WebSocket","type":"ping"}
[Current Company] Fetching company for user: { userId: 412, companyId: 370 }
[Current Company] Found company: {
  id: 370,
  name: 'Sterling Trust Solutions',
  onboardingCompleted: true,
  riskScore: 13,
  chosenScore: null,
  isDemo: true
}
[Current Company] Onboarding status check: {
  userId: 412,
  companyId: 370,
  userOnboardingStatus: false,
  companyOnboardingStatus: true,
  timestamp: '2025-05-26T08:31:09.243Z'
}
[2025-05-26T08:31:22.156Z] [INFO] [WebSocket] Received message from client client-1748247441479-kt6kw0b {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:31:21.996Z","connectionId":"ws_1748247441489_ktjpxr5f2"}
[2025-05-26T08:31:22.164Z] [INFO] [WebSocket] Received message from client client-1748247441986-jx2kqzj {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:31:21.996Z","connectionId":"ws_1748247440987_0yjtwc4bc"}
[2025-05-26T08:31:23.192Z] [INFO] [WebSocket] Received message from client client-1748247442485-d3hsg62 {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:31:22.996Z","connectionId":"ws_1748247441010_29r52jy4x"}
[2025-05-26T08:31:30.252Z] [INFO] [App] GET /api/companies/current 304 in 30ms :: {"id":370,"name":"Sterling Trust Solutions","category":"FinTech","is_demo":tr... [sampled: request 201] 
[2025-05-26T08:31:33.167Z] [INFO] [WebSocket] Received message from client client-1748247452122-vl72jvf {"module":"WebSocket","type":"ping"}
[2025-05-26T08:31:35.153Z] [INFO] [WebSocket] Received message from client client-1748247754566-2s2kfv8 {"module":"WebSocket","type":"ping"}
[2025-05-26T08:31:43.153Z] [INFO] [WebSocket] Received message from client client-1748247442485-d3hsg62 {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:31:42.996Z","connectionId":"ws_1748247441010_29r52jy4x"}
[2025-05-26T08:31:52.154Z] [INFO] [WebSocket] Received message from client client-1748247441479-kt6kw0b {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:31:51.995Z","connectionId":"ws_1748247441489_ktjpxr5f2"}
[2025-05-26T08:31:52.159Z] [INFO] [WebSocket] Received message from client client-1748247441986-jx2kqzj {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:31:51.995Z","connectionId":"ws_1748247440987_0yjtwc4bc"}
[2025-05-26T08:32:00.252Z] [INFO] [App] GET /api/companies/current 304 in 33ms :: {"id":370,"name":"Sterling Trust Solutions","category":"FinTech","is_demo":tr... [sampled: request 211] 
[2025-05-26T08:32:32.167Z] [INFO] [WebSocket] Received message from client client-1748247442485-d3hsg62 {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:32:31.996Z","connectionId":"ws_1748247441010_29r52jy4x"}
[2025-05-26T08:32:32.167Z] [INFO] [WebSocket] Received message from client client-1748247754566-2s2kfv8 {"module":"WebSocket","type":"ping"}
[2025-05-26T08:32:32.168Z] [INFO] [WebSocket] Received message from client client-1748247441479-kt6kw0b {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:32:31.996Z","connectionId":"ws_1748247441489_ktjpxr5f2"}
[2025-05-26T08:32:32.169Z] [INFO] [WebSocket] Received message from client client-1748247441986-jx2kqzj {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:32:31.996Z","connectionId":"ws_1748247440987_0yjtwc4bc"}
[Current Company] Fetching company for user: { userId: 412, companyId: 370 }
[Current Company] Found company: {
  id: 370,
  name: 'Sterling Trust Solutions',
  onboardingCompleted: true,
  riskScore: 13,
  chosenScore: null,
  isDemo: true
}
[Current Company] Onboarding status check: {
  userId: 412,
  companyId: 370,
  userOnboardingStatus: true,
  companyOnboardingStatus: true,
  timestamp: '2025-05-26T08:32:32.270Z'
}
[2025-05-26T08:32:34.689Z] [INFO] [WebSocket] Received message from client client-1748247754566-2s2kfv8 {"module":"WebSocket","type":"ping"}
[Current Company] Using cached company data: 370
[2025-05-26T08:32:42.610Z] [INFO] [WebSocket] Received message from client client-1748247442485-d3hsg62 {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:32:42.448Z","connectionId":"ws_1748247441010_29r52jy4x"}
[2025-05-26T08:32:51.278Z] [INFO] [WebSocket] Client disconnected {"module":"WebSocket","clientId":"client-1748247440976-y94byy2","code":1001,"reason":"","remainingClients":5}
[2025-05-26T08:32:51.279Z] [INFO] [WebSocket] Client disconnected {"module":"WebSocket","clientId":"client-1748247754566-2s2kfv8","code":1001,"reason":"","remainingClients":4}
[2025-05-26T08:32:51.279Z] [INFO] [WebSocket] Client disconnected {"module":"WebSocket","clientId":"client-1748247452122-vl72jvf","code":1001,"reason":"","remainingClients":3}
[2025-05-26T08:32:51.280Z] [INFO] [WebSocket] Client disconnected {"module":"WebSocket","clientId":"client-1748247441986-jx2kqzj","code":1001,"reason":"","remainingClients":2}
[2025-05-26T08:32:51.280Z] [INFO] [WebSocket] Client disconnected {"module":"WebSocket","clientId":"client-1748247441479-kt6kw0b","code":1001,"reason":"","remainingClients":1}
[2025-05-26T08:32:51.283Z] [INFO] [WebSocket] Client disconnected {"module":"WebSocket","clientId":"client-1748247442485-d3hsg62","code":1001,"reason":"","remainingClients":0}
[2025-05-26T08:32:52.623Z] [INFO] [Database] Successfully established new database connection {"module":"Database"}
[Tasks] ====== Starting task fetch =====
[Tasks] User details: {
  id: 412,
  company_id: 370,
  email: 'erodriguez@sterlingtrustsolutions.com'
}
[2025-05-26T08:33:02.067Z] [INFO] [App] Performing dynamic task unlocking check for company {"companyId":370,"userId":412}
[2025-05-26T08:33:02.095Z] [INFO] [App] No completed KYB tasks found, skipping security task unlock check {"companyId":370}
[Tasks] Automatically unlocking all tasks for company { userId: 412, companyId: 370, requestedBy: 'automatic_task_unlock' }
[2025-05-26T08:33:02.096Z] [INFO] [App] [TaskDependencies] Unlocking ALL tasks for company {"companyId":370}
[2025-05-26T08:33:02.101Z] [INFO] [App] GET /api/companies/current 304 in 28ms :: {"id":370,"name":"Sterling Trust Solutions","category":"FinTech","is_demo":tr... [sampled: request 221] 
[2025-05-26T08:33:02.123Z] [INFO] [App] [TaskDependencies] Found user onboarding task that needs completion {"taskId":1006,"userEmail":"erodriguez@sterlingtrustsolutions.com","currentStatus":"completed","currentProgress":100}
[2025-05-26T08:33:02.124Z] [INFO] [App] [TaskDependencies] Found tasks to unlock {"companyId":370,"count":1,"taskIds":[1006],"taskTypes":["user_onboarding"],"ky3pTaskCount":0,"ky3pTaskIds":[]}
[2025-05-26T08:33:02.124Z] [INFO] [App] [TaskDependencies] Setting User Onboarding task as completed {"taskId":1006,"userEmail":"erodriguez@sterlingtrustsolutions.com","timestamp":"2025-05-26T08:33:02.124Z"}
[2025-05-26T08:33:02.139Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1748248382139-67696od","clients":1}
[2025-05-26T08:33:02.153Z] [DEBUG] [App] Broadcasting task update with object format {"taskId":1006,"status":"completed"}
[WebSocket] Broadcast task_update to 1 clients (0 errors) { messageId: 'msg_1748248382153_iohjl9m5i' }
[2025-05-26T08:33:02.154Z] [INFO] [App] Successfully broadcasted task_update message 
[2025-05-26T08:33:02.154Z] [INFO] [App] [TaskDependencies] Successfully unlocked all tasks {"companyId":370,"count":1}
[Tasks] Successfully unlocked all tasks for company: 370
[Tasks] KYB tasks found: { count: 0 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 412',
    condition2: 'tasks.created_by = 412',
    condition3: "tasks.company_id = 370 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('erodriguez@sterlingtrustsolutions.com')"
  }
}
[Tasks] Tasks found: { count: 1 }
[2025-05-26T08:33:02.239Z] [INFO] [App] GET /api/tasks 200 in 171ms :: [{"id":1006,"title":"Demo Invitation: erodriguez@sterlingtrustsolutions.com",... 
[2025-05-26T08:33:02.265Z] [INFO] [WebSocket] Received message from client client-1748248382139-67696od {"module":"WebSocket","type":"authenticate","data":{"timestamp":"2025-05-26T08:33:02.106Z"}}
[2025-05-26T08:33:02.265Z] [INFO] [WebSocket] Authentication from client client-1748248382139-67696od {"module":"WebSocket","hasToken":true}
[2025-05-26T08:33:02.288Z] [INFO] [App] [TabTutorials] Status request for tab "dashboard" from authenticated user ID: 412 
[2025-05-26T08:33:02.288Z] [INFO] [App] [TabTutorials] Normalizing tab name from 'dashboard' to canonical form 
[2025-05-26T08:33:02.288Z] [INFO] [App] [TabTutorials] Tab name already in canonical form: 'dashboard' 
[2025-05-26T08:33:02.288Z] [INFO] [App] [TabTutorials] Checking tutorial status for tab: dashboard (raw: dashboard), user: 412 
[2025-05-26T08:33:02.317Z] [INFO] [App] [TabTutorials] No tutorial status found for dashboard for user 412 
[2025-05-26T08:33:02.347Z] [INFO] [App] GET /api/user-tab-tutorials/dashboard/status 304 in 59ms :: {"exists":false,"completed":false,"currentStep":0,"tabName":"dashboard"} 
[Relationships] Fetching network for company: 370
[Relationships] Found network members: { count: 0 }
[2025-05-26T08:33:02.600Z] [INFO] [App] GET /api/relationships 304 in 62ms :: [] 
[2025-05-26T08:33:02.631Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1748248382631-omkoxra","clients":2}
[2025-05-26T08:33:03.143Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1748248383143-raribeq","clients":3}
[2025-05-26T08:33:03.720Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1748248383720-o07ulw3","clients":4}
[2025-05-26T08:33:04.214Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1748248384213-gjq1epf","clients":5}
[2025-05-26T08:33:04.332Z] [INFO] [WebSocket] Received message from client client-1748248384213-gjq1epf {"module":"WebSocket","type":"authenticate","userId":null,"companyId":null,"clientId":"ws_1748248381294_v4ac88n0n","timestamp":"2025-05-26T08:33:04.174Z"}
[2025-05-26T08:33:04.332Z] [INFO] [WebSocket] Authentication from client client-1748248384213-gjq1epf {"module":"WebSocket","userId":null,"companyId":null,"hasToken":true}
[2025-05-26T08:33:04.788Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1748248384788-j6tk9ek","clients":6}
[2025-05-26T08:33:05.341Z] [INFO] [WebSocket] Received message from client client-1748248384788-j6tk9ek {"module":"WebSocket","type":"authenticate","userId":412,"companyId":370,"clientId":"ws_1748248382637_n1b1vm4jl","timestamp":"2025-05-26T08:33:05.177Z"}
[2025-05-26T08:33:05.341Z] [INFO] [WebSocket] Authentication from client client-1748248384788-j6tk9ek {"module":"WebSocket","userId":412,"companyId":370,"hasToken":true}
[2025-05-26T08:33:25.153Z] [INFO] [WebSocket] Received message from client client-1748248384788-j6tk9ek {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:33:24.994Z","connectionId":"ws_1748248382637_n1b1vm4jl"}
[2025-05-26T08:33:28.393Z] [INFO] [App] GET /api/companies/current 304 in 30ms :: {"id":370,"name":"Sterling Trust Solutions","category":"FinTech","is_demo":tr... [sampled: request 231] 
[2025-05-26T08:33:32.265Z] [INFO] [WebSocket] Received message from client client-1748248382139-67696od {"module":"WebSocket","type":"ping"}
[Current Company] Fetching company for user: { userId: 412, companyId: 370 }
[Current Company] Found company: {
  id: 370,
  name: 'Sterling Trust Solutions',
  onboardingCompleted: true,
  riskScore: 13,
  chosenScore: null,
  isDemo: true
}
[Current Company] Onboarding status check: {
  userId: 412,
  companyId: 370,
  userOnboardingStatus: true,
  companyOnboardingStatus: true,
  timestamp: '2025-05-26T08:33:32.322Z'
}
[2025-05-26T08:33:33.268Z] [INFO] [WebSocket] Received message from client client-1748248383143-raribeq {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:33:33.103Z","connectionId":"ws_1748248383102_jbvbv0dsp"}
[2025-05-26T08:33:33.844Z] [INFO] [WebSocket] Received message from client client-1748248383720-o07ulw3 {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:33:33.682Z","connectionId":"ws_1748248382592_co67cg9kq"}
[2025-05-26T08:33:44.914Z] [INFO] [WebSocket] Received message from client client-1748248384788-j6tk9ek {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:33:44.748Z","connectionId":"ws_1748248382637_n1b1vm4jl"}
[DemoAPI] Company creation request received at: 2025-05-26T08:33:45.259Z
[DemoAPI] Request method: POST
[DemoAPI] Request headers: {
  'content-type': 'application/json',
  'content-length': '123',
  'user-agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) Ap...',
  origin: 'https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev:8080'
}
[DemoAPI] Full request body received: {
  "name": "Premier Trust Company",
  "type": "live",
  "persona": "accredited-data-recipient",
  "riskProfile": 9,
  "companySize": "medium"
}
[DemoAPI] Validating input parameters...
[DemoAPI] Input validation passed successfully
[DemoAPI] Extracted and validated fields: {
  name: 'Premier Trust Company',
  type: 'live',
  persona: 'accredited-data-recipient',
  companySize: 'medium',
  riskProfile: 9
}
[WebSocket] Broadcast demo_action_start to 6 clients (0 errors) { messageId: 'msg_1748248425260_lkqggmkwu' }
[2025-05-26T08:33:45.260Z] [INFO] [App] Successfully broadcasted demo_action_start message 
[DemoAPI] Generating company data for: { persona: 'accredited-data-recipient', companySize: 'medium' }
[DemoAPI] IMPLEMENTING DIRECT FIX for size: medium
[DemoAPI] Generated company data: {
  category: 'FinTech',
  accreditation_status: 'APPROVED',
  is_demo: true,
  available_tabs: [ 'dashboard', 'task-center', 'file-vault', 'insights' ],
  revenue: '$23M',
  num_employees: 980,
  revenue_tier: 'medium'
}
[DemoAPI] Generating comprehensive business details...
[DemoAPI] Business Details - Persona: accredited-data-recipient, Mapped Type: fintech
[DemoAPI] Generated business details: {
  website: 'https://www.techsecure.co',
  hasAddress: true,
  hasLeadership: true,
  hasClients: true,
  hasInvestors: true,
  hasCertifications: true
}
[DemoAPI] Assembled complete company data for insertion
[DemoAPI] Business details verification: {
  websiteIncluded: true,
  addressIncluded: true,
  productsIncluded: true,
  leadershipIncluded: true,
  clientsIncluded: true,
  investorsIncluded: true,
  certificationsIncluded: true,
  riskClustersIncluded: true
}
[DemoAPI] Final insert values: {
  "name": "Premier Trust Company",
  "description": "Professional fintech company specializing in secure data management and compliance",
  "category": "FinTech",
  "accreditation_status": "APPROVED",
  "is_demo": true,
  "available_tabs": [
    "dashboard",
    "task-center",
    "file-vault",
    "insights"
  ],
  "revenue": "$23M",
  "num_employees": 980,
  "revenue_tier": "medium",
  "risk_score": 9,
  "risk_clusters": {
    "Dark Web Data": 1,
    "Cyber Security": 1,
    "Public Sentiment": 1,
    "Data Access Scope": 1,
    "Financial Stability": 1,
    "Potential Liability": 4
  },
  "website_url": "https://www.techsecure.co",
  "hq_address": "2100 McKinney Avenue, Suite 1600, Dallas, TX 75201",
  "products_services": "API-driven financial services, secure data analytics, automated compliance workflows",
  "founders_and_leadership": "David Thompson (CEO, Former Bank of America SVP), Lisa Wang (CTO, Ex-Microsoft Principal), Robert Kim (CFO, Former Citigroup VP)",
  "key_clients_partners": "Citigroup, Capital One, PayPal, Square, Stripe",
  "investors": "QED Investors, Nyca Partners, FinTech Collective, Commerce Ventures",
  "certifications_compliance": "SOC 2 Type II, ISO 27001, PCI DSS Level 1, GDPR Compliant, CCPA Compliant",
  "legal_structure": "Corporation",
  "market_position": "Established Player",
  "incorporation_year": 2008,
  "funding_stage": "Series C"
}
[WebSocket] Broadcast demo_action_complete to 6 clients (0 errors) { messageId: 'msg_1748248425294_96rn86i6s' }
[2025-05-26T08:33:45.294Z] [INFO] [App] Successfully broadcasted demo_action_complete message 
[2025-05-26T08:33:45.325Z] [INFO] [App] POST /api/demo/company/create 200 in 66ms :: {"success":true,"companyId":371,"companyData":{"name":"Premier Trust Company"... 
[DemoAPI] Creating user: {
  fullName: 'Casey Gray',
  email: 'cgray@premiertrustcompany.com',
  role: 'Accredited Data Recipient',
  companyId: 371
}
[DemoAPI] Parsed company ID: 371
[2025-05-26T08:33:45.790Z] [INFO] [App] POST /api/demo/user/create 200 in 299ms :: {"success":true,"userId":413,"userData":{"fullName":"Casey Gray","email":"cgr... 
[DemoAPI] Setting up authentication: { userId: 413, email: 'cgray@premiertrustcompany.com' }
[2025-05-26T08:33:46.876Z] [INFO] [App] POST /api/demo/auth/setup 200 in 30ms :: {"success":true,"credentials":{"loginUrl":"/login","email":"cgray@premiertrus... 
[DemoAPI] [EmailInvite] Starting invitation process: {
  userEmail: 'cgray@premiertrustcompany.com',
  userName: 'Casey Gray',
  companyName: 'Premier Trust Company',
  hasLoginCredentials: true,
  timestamp: '2025-05-26T08:33:47.150Z'
}
[DemoAPI] [EmailInvite] Fetching user and company data...
[DemoAPI] [EmailInvite] User found: { userId: 413, companyId: 371, fullName: 'Casey Gray', duration: 30 }
[DemoAPI] [EmailInvite] Company verified: {
  companyId: 371,
  companyName: 'Premier Trust Company',
  isDemo: true,
  duration: 60
}
[DemoAPI] [EmailInvite] Generated invitation code: { codeLength: 6, codeFormat: 'hex-uppercase', duration: 60 }
[DemoAPI] [EmailInvite] Creating invitation record...
[DemoAPI] [EmailInvite] Invitation record created: {
  invitationId: 407,
  code: 'F3F195',
  expiresAt: 2025-06-02T08:33:47.210Z,
  duration: 91
}
[DemoAPI] [EmailInvite] Creating onboarding task...
[DemoAPI] [EmailInvite] Onboarding task created: {
  taskId: 1007,
  status: 'email_sent',
  assignedTo: 413,
  dueDate: 2025-06-09T08:33:47.241Z,
  duration: 122
}
[DemoAPI] [EmailInvite] Preparing email content...
[DemoAPI] [EmailInvite] Email prepared: {
  recipientEmail: 'cgray@premiertrustcompany.com',
  subject: 'Welcome to Invela Trust Network - Your Demo Access is Ready!',
  invitationCode: 'F3F195',
  messageId: 'demo_invite_1748248427272_407',
  emailSent: true,
  duration: 122
}
[DemoAPI] [EmailInvite] Process completed successfully: {
  userId: 413,
  companyId: 371,
  invitationId: 407,
  taskId: 1007,
  invitationCode: 'F3F195',
  totalDuration: 122
}
[WebSocket] Broadcast demo_email_sent to 6 clients (0 errors) { messageId: 'msg_1748248427273_fastwvvug' }
[2025-05-26T08:33:47.273Z] [INFO] [App] Successfully broadcasted demo_email_sent message 
[2025-05-26T08:33:47.303Z] [INFO] [App] POST /api/demo/email/send-invitation 200 in 153ms :: {"success":true,"emailSent":true,"messageId":"demo_invite_1748248427272_407",... 
[DemoAPI] [Finalize] Starting demo environment finalization: {
  userId: 413,
  companyId: 371,
  demoType: 'accredited-data-recipient',
  timestamp: '2025-05-26T08:33:47.942Z'
}
[DemoAPI] [Finalize] Verifying user and company data...
[DemoAPI] [Finalize] User verification successful: {
  userId: 413,
  email: 'cgray@premiertrustcompany.com',
  companyId: 371,
  fullName: 'Casey Gray',
  duration: 32
}
[DemoAPI] [Finalize] Setting up demo environment...
[DemoAPI] [Finalize] Environment configuration prepared: {
  environmentId: 'env_demo_1748248427974_413',
  config: {
    type: 'accredited-data-recipient',
    features: {
      demoDataAccess: true,
      tutorialMode: true,
      limitedFunctionality: false
    },
    permissions: {
      canInviteUsers: true,
      canModifySettings: true,
      canAccessAllTabs: true
    }
  },
  duration: 32
}
[DemoAPI] [Finalize] Initiating automatic user authentication...
[DemoAPI] [Finalize] Demo finalization completed successfully: {
  userId: 413,
  email: 'cgray@premiertrustcompany.com',
  companyId: 371,
  environmentId: 'env_demo_1748248427974_413',
  authenticated: true,
  totalDuration: 98,
  timestamp: '2025-05-26T08:33:48.040Z'
}
[WebSocket] Broadcast demo_completed to 6 clients (0 errors) { messageId: 'msg_1748248428040_zp2olc3jv' }
[2025-05-26T08:33:48.041Z] [INFO] [App] Successfully broadcasted demo_completed message 
[2025-05-26T08:33:48.073Z] [INFO] [App] POST /api/demo/environment/finalize 200 in 132ms :: {"success":true,"demoReady":true,"authenticated":true,"loginRequired":false,"... 
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 413, company_id: 371, email: 'cgray@premiertrustcompany.com' }
[2025-05-26T08:33:50.689Z] [INFO] [App] Performing dynamic task unlocking check for company {"companyId":371,"userId":413}
[Current Company] Fetching company for user: { userId: 413, companyId: 371 }
[2025-05-26T08:33:50.717Z] [INFO] [App] No completed KYB tasks found, skipping security task unlock check {"companyId":371}
[Tasks] Automatically unlocking all tasks for company { userId: 413, companyId: 371, requestedBy: 'automatic_task_unlock' }
[2025-05-26T08:33:50.718Z] [INFO] [App] [TaskDependencies] Unlocking ALL tasks for company {"companyId":371}
[Current Company] Found company: {
  id: 371,
  name: 'Premier Trust Company',
  onboardingCompleted: true,
  riskScore: 9,
  chosenScore: null,
  isDemo: true
}
[Current Company] Onboarding status check: {
  userId: 413,
  companyId: 371,
  userOnboardingStatus: false,
  companyOnboardingStatus: true,
  timestamp: '2025-05-26T08:33:50.727Z'
}
[2025-05-26T08:33:50.746Z] [INFO] [App] [TaskDependencies] Found user onboarding task that needs completion {"taskId":1007,"userEmail":"cgray@premiertrustcompany.com","currentStatus":"email_sent","currentProgress":25}
[2025-05-26T08:33:50.746Z] [INFO] [App] [TaskDependencies] Found tasks to unlock {"companyId":371,"count":1,"taskIds":[1007],"taskTypes":["user_onboarding"],"ky3pTaskCount":0,"ky3pTaskIds":[]}
[2025-05-26T08:33:50.746Z] [INFO] [App] [TaskDependencies] Setting User Onboarding task as completed {"taskId":1007,"userEmail":"cgray@premiertrustcompany.com","timestamp":"2025-05-26T08:33:50.746Z"}
[2025-05-26T08:33:50.775Z] [DEBUG] [App] Broadcasting task update with object format {"taskId":1007,"status":"completed"}
[WebSocket] Broadcast task_update to 6 clients (0 errors) { messageId: 'msg_1748248430775_sbzzty19o' }
[2025-05-26T08:33:50.775Z] [INFO] [App] Successfully broadcasted task_update message 
[2025-05-26T08:33:50.775Z] [INFO] [App] [TaskDependencies] Successfully unlocked all tasks {"companyId":371,"count":1}
[Tasks] Successfully unlocked all tasks for company: 371
[Tasks] KYB tasks found: { count: 0 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 413',
    condition2: 'tasks.created_by = 413',
    condition3: "tasks.company_id = 371 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('cgray@premiertrustcompany.com')"
  }
}
[Tasks] Tasks found: { count: 1 }
[2025-05-26T08:33:50.862Z] [INFO] [App] GET /api/tasks 200 in 174ms :: [{"id":1007,"title":"Demo Invitation: cgray@premiertrustcompany.com","descrip... 
[2025-05-26T08:33:50.939Z] [INFO] [App] [TabTutorials] Status request for tab "dashboard" from authenticated user ID: 413 
[2025-05-26T08:33:50.939Z] [INFO] [App] [TabTutorials] Normalizing tab name from 'dashboard' to canonical form 
[2025-05-26T08:33:50.939Z] [INFO] [App] [TabTutorials] Tab name already in canonical form: 'dashboard' 
[2025-05-26T08:33:50.939Z] [INFO] [App] [TabTutorials] Checking tutorial status for tab: dashboard (raw: dashboard), user: 413 
[2025-05-26T08:33:50.967Z] [INFO] [App] [TabTutorials] No tutorial status found for dashboard for user 413 
[2025-05-26T08:33:50.996Z] [INFO] [App] GET /api/user-tab-tutorials/dashboard/status 304 in 58ms :: {"exists":false,"completed":false,"currentStep":0,"tabName":"dashboard"} 
[Relationships] Fetching network for company: 371
[Relationships] Found network members: { count: 0 }
[2025-05-26T08:33:51.265Z] [INFO] [App] GET /api/relationships 304 in 57ms :: [] 
[2025-05-26T08:34:02.266Z] [INFO] [WebSocket] Received message from client client-1748248382139-67696od {"module":"WebSocket","type":"ping"}
[2025-05-26T08:34:03.269Z] [INFO] [WebSocket] Received message from client client-1748248383143-raribeq {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:34:03.103Z","connectionId":"ws_1748248383102_jbvbv0dsp"}
[2025-05-26T08:34:03.839Z] [INFO] [WebSocket] Received message from client client-1748248383720-o07ulw3 {"module":"WebSocket","type":"ping","timestamp":"2025-05-26T08:34:03.680Z","connectionId":"ws_1748248382592_co67cg9kq"}