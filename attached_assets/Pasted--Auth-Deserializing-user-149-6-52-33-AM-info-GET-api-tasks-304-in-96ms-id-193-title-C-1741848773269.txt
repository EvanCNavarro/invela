[Auth] Deserializing user: 149
6:52:33 AM [info] GET /api/tasks 304 in 96ms :: [{"id":193,"title":"Company CARD: DataTechCompany","description":"Provide Com...
[Current Company] Fetching company for user: { userId: 149, companyId: 112 }
[Current Company] Found company: { id: 112, name: 'DataTechCompany', onboardingCompleted: false }
6:52:33 AM [info] GET /api/companies/current 304 in 64ms :: {"id":112,"name":"DataTechCompany","description":"FinTech partner company Dat...
[Auth] Deserializing user: 149
[Auth] Deserializing user: 149
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 149, company_id: 112, email: 'ev.ancnav.a.r.ro@gmail.com' }
[Files] PDF file received: {
  originalname: 'SOC 2 Type II Report 2022 Cyient (1).pdf',
  filename: '1741848753373-x9kssknsm7m.pdf',
  mimetype: 'application/pdf',
  size: 1259898
}
[Files] Creating database record for: SOC 2 Type II Report 2022 Cyient (1).pdf
[Current Company] Fetching company for user: { userId: 149, companyId: 112 }
[Tasks] KYB tasks found: {
  count: 1,
  tasks: [
    {
      id: 192,
      company_id: 112,
      task_scope: 'company',
      task_type: 'company_kyb',
      assigned_to: null,
      status: 'submitted'
    }
  ]
}
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 149',
    condition2: 'tasks.created_by = 149',
    condition3: "tasks.company_id = 112 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('ev.ancnav.a.r.ro@gmail.com')"
  }
}
[Files] Database error: error: column "document_category" of relation "files" does not exist
    at file:///home/runner/workspace/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/runner/workspace/node_modules/src/neon-serverless/session.ts:102:18)
    at async <anonymous> (/home/runner/workspace/server/routes/files.ts:112:30) {
  length: 136,
  severity: 'ERROR',
  code: '42703',
  detail: undefined,
  hint: undefined,
  position: '167',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'parse_target.c',
  line: '1065',
  routine: 'checkInsertTargets'
}
[Files] Database error details: error: column "document_category" of relation "files" does not exist
    at file:///home/runner/workspace/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/runner/workspace/node_modules/src/neon-serverless/session.ts:102:18)
    at async <anonymous> (/home/runner/workspace/server/routes/files.ts:112:30)
[Files] Cleaned up file after database error: /home/runner/workspace/uploads/1741848753373-x9kssknsm7m.pdf
[Files] Server error: error: column "document_category" of relation "files" does not exist
    at file:///home/runner/workspace/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/runner/workspace/node_modules/src/neon-serverless/session.ts:102:18)
    at async <anonymous> (/home/runner/workspace/server/routes/files.ts:112:30) {
  length: 136,
  severity: 'ERROR',
  code: '42703',
  detail: undefined,
  hint: undefined,
  position: '167',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'parse_target.c',
  line: '1065',
  routine: 'checkInsertTargets'
}
[Files] Server error details: error: column "document_category" of relation "files" does not exist
    at file:///home/runner/workspace/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/runner/workspace/node_modules/src/neon-serverless/session.ts:102:18)
    at async <anonymous> (/home/runner/workspace/server/routes/files.ts:112:30)
[Current Company] Found company: { id: 112, name: 'DataTechCompany', onboardingCompleted: false }
[Tasks] Tasks found: {
  count: 3,
  tasks: [
    {
      id: 193,
      title: 'Company CARD: DataTechCompany',
      assigned_to: null,
      company_id: 112,
      task_scope: 'company',
      task_type: 'company_card',
      status: 'not_started'
    },
    {
      id: 194,
      title: 'New User Invitation: ev.ancnav.a.r.ro@gmail.com',
      assigned_to: 149,
      company_id: 112,
      task_scope: 'user',
      task_type: 'user_onboarding',
      status: 'completed'
    },
    {
      id: 192,
      title: 'Company KYB: DataTechCompany',
      assigned_to: null,
      company_id: 112,
      task_scope: 'company',
      task_type: 'company_kyb',
      status: 'submitted'
    }
  ]
}
6:52:35 AM [info] GET /api/companies/current 304 in 70ms :: {"id":112,"name":"DataTechCompany","description":"FinTech partner company Dat...
6:52:35 AM [info] GET /api/tasks 304 in 91ms :: [{"id":193,"title":"Company CARD: DataTechCompany","description":"Provide Com...
[2025-03-13T06:52:35.390Z] New client connected to the pool
6:52:35 AM [error] POST /api/files 500 in 2066ms :: {"error":"Server error","detail":"column \"document_category\" of relation \"...
[WebSocket] Received pong from client
[Auth] Deserializing user: 149
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 149, company_id: 112, email: 'ev.ancnav.a.r.ro@gmail.com' }
[Tasks] KYB tasks found: {
  count: 1,
  tasks: [
    {
      id: 192,
      company_id: 112,
      task_scope: 'company',
      task_type: 'company_kyb',
      assigned_to: null,
      status: 'submitted'
    }
  ]
}
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 149',
    condition2: 'tasks.created_by = 149',
    condition3: "tasks.company_id = 112 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('ev.ancnav.a.r.ro@gmail.com')"
  }
}
[Auth] Deserializing user: 149
[Tasks] Tasks found: {
  count: 3,
  tasks: [
    {
      id: 193,
      title: 'Company CARD: DataTechCompany',
      assigned_to: null,
      company_id: 112,
      task_scope: 'company',
      task_type: 'company_card',
      status: 'not_started'
    },
    {
      id: 194,
      title: 'New User Invitation: ev.ancnav.a.r.ro@gmail.com',
      assigned_to: 149,
      company_id: 112,
      task_scope: 'user',
      task_type: 'user_onboarding',
      status: 'completed'
    },
    {
      id: 192,
      title: 'Company KYB: DataTechCompany',
      assigned_to: null,
      company_id: 112,
      task_scope: 'company',
      task_type: 'company_kyb',
      status: 'submitted'
    }
  ]
}
[Current Company] Fetching company for user: { userId: 149, companyId: 112 }
6:52:38 AM [info] GET /api/tasks 304 in 92ms :: [{"id":193,"title":"Company CARD: DataTechCompany","description":"Provide Com...
[Current Company] Found company: { id: 112, name: 'DataTechCompany', onboardingCompleted: false }
6:52:38 AM [info] GET /api/companies/current 304 in 61ms :: {"id":112,"name":"DataTechCompany","description":"FinTech partner company Dat...
[WebSocket] Received pong from client
[WebSocket] Received pong from client
[Auth] Deserializing user: 149
[Auth] Deserializing user: 149
[Current Company] Fetching company for user: { userId: 149, companyId: 112 }
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 149, company_id: 112, email: 'ev.ancnav.a.r.ro@gmail.com' }
[Current Company] Found company: { id: 112, name: 'DataTechCompany', onboardingCompleted: false }
[Tasks] KYB tasks found: {
  count: 1,
  tasks: [
    {
      id: 192,
      company_id: 112,
      task_scope: 'company',
      task_type: 'company_kyb',
      assigned_to: null,
      status: 'submitted'
    }
  ]
}
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 149',
    condition2: 'tasks.created_by = 149',
    condition3: "tasks.company_id = 112 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('ev.ancnav.a.r.ro@gmail.com')"
  }
}
6:52:40 AM [info] GET /api/companies/current 304 in 61ms :: {"id":112,"name":"DataTechCompany","description":"FinTech partner company Dat...
[Tasks] Tasks found: {
  count: 3,
  tasks: [
    {
      id: 193,
      title: 'Company CARD: DataTechCompany',
      assigned_to: null,
      company_id: 112,
      task_scope: 'company',
      task_type: 'company_card',
      status: 'not_started'
    },
    {
      id: 194,
      title: 'New User Invitation: ev.ancnav.a.r.ro@gmail.com',
      assigned_to: 149,
      company_id: 112,
      task_scope: 'user',
      task_type: 'user_onboarding',
      status: 'completed'
    },
    {
      id: 192,
      title: 'Company KYB: DataTechCompany',
      assigned_to: null,
      company_id: 112,
      task_scope: 'company',
      task_type: 'company_kyb',
      status: 'submitted'
    }
  ]
}
6:52:40 AM [info] GET /api/tasks 304 in 91ms :: [{"id":193,"title":"Company CARD: DataTechCompany","description":"Provide Com...
[Auth] Deserializing user: 149
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 149, company_id: 112, email: 'ev.ancnav.a.r.ro@gmail.com' }
[Auth] Deserializing user: 149
[Tasks] KYB tasks found: {
  count: 1,
  tasks: [
    {
      id: 192,
      company_id: 112,
      task_scope: 'company',
      task_type: 'company_kyb',
      assigned_to: null,
      status: 'submitted'
    }
  ]
}
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 149',
    condition2: 'tasks.created_by = 149',
    condition3: "tasks.company_id = 112 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('ev.ancnav.a.r.ro@gmail.com')"
  }
}
[Current Company] Fetching company for user: { userId: 149, companyId: 112 }
[Tasks] Tasks found: {
  count: 3,
  tasks: [
    {
      id: 193,
      title: 'Company CARD: DataTechCompany',
      assigned_to: null,
      company_id: 112,
      task_scope: 'company',
      task_type: 'company_card',
      status: 'not_started'
    },
    {
      id: 194,
      title: 'New User Invitation: ev.ancnav.a.r.ro@gmail.com',
      assigned_to: 149,
      company_id: 112,
      task_scope: 'user',
      task_type: 'user_onboarding',
      status: 'completed'
    },
    {
      id: 192,
      title: 'Company KYB: DataTechCompany',
      assigned_to: null,
      company_id: 112,
      task_scope: 'company',
      task_type: 'company_kyb',
      status: 'submitted'
    }
  ]
}