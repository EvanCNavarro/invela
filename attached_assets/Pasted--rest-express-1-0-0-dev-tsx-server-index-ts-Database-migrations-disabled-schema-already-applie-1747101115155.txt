> rest-express@1.0.0 dev
> tsx server/index.ts

Database migrations disabled - schema already applied
[EmailService] Initializing email service
[EmailService] Email service initialized successfully
[OpenAI] Service initialized with API key: API key is set
[WebSocketService] Initialized in fallback mode (WebSocket server not available)
[Auth] Setting up authentication...
[Auth] Setting up PostgreSQL session store
[Auth] PostgreSQL session store initialized successfully
[Auth] Authentication setup completed
[Routes] Registered KY3P form submission fix routes
[2025-05-13T01:44:58.860Z] [INFO] [App] [KY3P-BATCH-UPDATE] Registering KY3P batch update routes 
[2025-05-13T01:44:58.860Z] [INFO] [App] Registering KY3P batch update routes 
[2025-05-13T01:44:58.860Z] [INFO] [App] [UnifiedKY3P] Registering unified KY3P update routes 
[Routes] Registered KY3P field key router
[Routes] Registered KY3P field key router
[2025-05-13T01:44:58.861Z] [INFO] [App] Registering KY3P field update routes 
[Routes] Setting up unified clear fields router
[Routes] Successfully registered unified clear fields router
[Routes] Setting up task broadcast router
[Routes] Successfully registered task broadcast router
[2025-05-13T01:44:58.862Z] [INFO] [App] [OpenBankingRoutes] Setting up routes... 
[Routes] Setting up transaction-based unified form submission router
[Routes] Successfully registered transaction-based unified form submission router
[Routes] Setting up unified form submission router
[Routes] Successfully registered unified form submission router
[Routes] Setting up transactional form submission router
[Routes] Successfully registered transactional form submission router
[Routes] Routes setup completed
[2025-05-13T01:44:58.864Z] [INFO] [App] [WebSocket] Setting up unified WebSocket server on path /ws 
[2025-05-13T01:44:58.864Z] [INFO] [WebSocket] Unified WebSocket server initialized successfully {"module":"WebSocket","clients":0,"path":"/ws","id":"5rkv24","timestamp":"2025-05-13T01:44:58.864Z"}
[2025-05-13T01:44:58.864Z] [INFO] [App] [WebSocket] Unified WebSocket server initialized successfully 
[2025-05-13T01:44:58.864Z] [WARN] [App] [WebSocket] Form submission WebSocket initialization function not found 
[2025-05-13T01:44:58.864Z] [INFO] [App] [ServerStartup] WebSocket server initialized with unified implementation 
[2025-05-13T01:44:58.864Z] [INFO] [App] [TaskWebSocket] WebSocket server registered with unified implementation 
[2025-05-13T01:44:58.864Z] [INFO] [App] [ServerStartup] WebSocket server registered with task-update utility 
[TaskBroadcast] WebSocket server reference set up
[TaskBroadcast] WebSocket server active with 0 connected clients
[2025-05-13T01:44:58.865Z] [INFO] [App] [ServerStartup] WebSocket server registered with task-broadcast utility 
[2025-05-13T01:44:58.865Z] [INFO] [App] Setting up Vite development server 
[2025-05-13T01:44:58.866Z] [INFO] [App] [ENV] Server will listen on PORT=5000 (deployment mode: no) 
[2025-05-13T01:44:58.866Z] [INFO] [App] [ENV] Environment=development (NODE_ENV explicitly set) 
[2025-05-13T01:44:58.876Z] [INFO] [App] Server running on 0.0.0.0:5000 
[2025-05-13T01:44:58.876Z] [INFO] [App] Environment: development 
[Deployment] Server running on 0.0.0.0:5000
[Deployment] Environment: development
[Deployment] Port forwarding: Custom port: 5000
[Deployment] Development mode: Hot reloading enabled
[2025-05-13T01:44:58.878Z] [INFO] [App] Starting periodic task reconciliation system... 
[PeriodicTaskReconciliation] Stopped periodic reconciliation system
[PeriodicTaskReconciliation] Starting periodic reconciliation system (interval: 300000ms)
[2025-05-13T01:44:58.878Z] [INFO] [App] Task reconciliation system initialized successfully 
[2025-05-13T01:44:59.615Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1747100699615-yj1nzdc","clients":1}
[2025-05-13T01:45:00.317Z] [INFO] [App] [ServerStartup] WebSocket server active with 1 connected clients 
[2025-05-13T01:45:00.417Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1747100700417-7x0pnvx","clients":2}
[2025-05-13T01:45:02.455Z] [INFO] [WebSocket] Received message from client client-1747100700417-7x0pnvx {"module":"WebSocket","type":"authenticate","data":{"timestamp":"2025-05-13T01:45:00.387Z"}}
[2025-05-13T01:45:02.455Z] [INFO] [WebSocket] Authentication from client client-1747100700417-7x0pnvx {"module":"WebSocket","hasToken":true}
[2025-05-13T01:45:03.072Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1747100703072-2oo23zn","clients":3}
[2025-05-13T01:45:03.236Z] [INFO] [WebSocket] Received message from client client-1747100703072-2oo23zn {"module":"WebSocket","type":"authenticate","userId":null,"companyId":null,"clientId":"ws_1747100418315_sbk7i8k6i","timestamp":"2025-05-13T01:45:03.042Z"}
[2025-05-13T01:45:03.236Z] [INFO] [WebSocket] Authentication from client client-1747100703072-2oo23zn {"module":"WebSocket","userId":null,"companyId":null,"hasToken":true}
[2025-05-13T01:45:04.368Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1747100704368-m59h3p6","clients":4}
[2025-05-13T01:45:04.974Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1747100704974-6thikzu","clients":5}
[2025-05-13T01:45:05.376Z] New client connected to the pool (1/3)
[Auth] Returning user session data
[Current Company] Fetching company for user: { userId: 328, companyId: 285 }
[Current Company] Found company: {
  id: 285,
  name: 'DevTest30',
  onboardingCompleted: false,
  riskScore: null,
  chosenScore: null,
  isDemo: true
}
[2025-05-13T01:45:05.811Z] [INFO] [App] GET /api/companies/current 200 in 68ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-13T01:45:05.930Z] [INFO] [WebSocket] Received message from client client-1747100704974-6thikzu {"module":"WebSocket","type":"authenticate","userId":328,"companyId":285,"clientId":"ws_1747100701258_sh747ojoo","timestamp":"2025-05-13T01:45:05.778Z"}
[2025-05-13T01:45:05.930Z] [INFO] [WebSocket] Authentication from client client-1747100704974-6thikzu {"module":"WebSocket","userId":328,"companyId":285,"hasToken":true}
[2025-05-13T01:45:06.678Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1747100706677-490rf2o","clients":6}
[2025-05-13T01:45:06.707Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1747100706707-fuf8lhx","clients":7}
[Auth] Unauthenticated user session
[2025-05-13T01:45:06.742Z] [INFO] [WebSocket] Received message from client client-1747100706677-490rf2o {"module":"WebSocket","type":"authenticate","data":{"timestamp":"2025-05-13T01:45:06.741Z"}}
[2025-05-13T01:45:06.743Z] [INFO] [WebSocket] Authentication from client client-1747100706677-490rf2o {"module":"WebSocket","hasToken":true}
[2025-05-13T01:45:06.810Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1747100706810-28q12kc","clients":8}
[2025-05-13T01:45:07.104Z] [INFO] [WebSocket] Client disconnected {"module":"WebSocket","clientId":"client-1747100706707-fuf8lhx","code":1001,"reason":"","remainingClients":7}
[2025-05-13T01:45:07.105Z] [INFO] [WebSocket] Client disconnected {"module":"WebSocket","clientId":"client-1747100706677-490rf2o","code":1001,"reason":"","remainingClients":6}
[2025-05-13T01:45:07.105Z] [INFO] [WebSocket] Client disconnected {"module":"WebSocket","clientId":"client-1747100706810-28q12kc","code":1001,"reason":"","remainingClients":5}
[2025-05-13T01:45:25.415Z] [INFO] [WebSocket] Received message from client client-1747100704974-6thikzu {"module":"WebSocket","type":"ping","timestamp":"2025-05-13T01:45:25.260Z","connectionId":"ws_1747100701258_sh747ojoo"}
[PeriodicTaskReconciliation] Reconciling batch of 10 tasks: [
  710, 679, 740, 691,
  764, 707, 759, 698,
  718, 693
]
[Task Progress] Calculated progress for task 710 (ky3p): 0/120 = 0%
[Task Progress] Calculated progress for task 679 (open_banking): 44/44 = 100%
[Task Progress] Calculated progress for task 740 (open_banking): 0/44 = 0%
[Task Progress] Calculated progress for task 691 (open_banking): 0/44 = 0%
[Task Progress] Calculated progress for task 764 (open_banking): 44/44 = 100%
[Task Progress] Calculated progress for task 707 (open_banking): 0/44 = 0%
[Task Progress] Calculated progress for task 759 (ky3p): 0/0 = 0%
[Task Progress] Calculated progress for task 698 (ky3p): 0/0 = 0%
[Task Progress] Calculated progress for task 718 (ky3p): 1/120 = 1%
[Task Progress] Calculated progress for task 693 (company_kyb): 5/30 = 17%
[2025-05-13T01:45:30.410Z] [INFO] [WebSocket] Received message from client client-1747100699615-yj1nzdc {"module":"WebSocket","type":"ping","timestamp":"2025-05-13T01:45:30.258Z","connectionId":"ws_1747100419633_fythoi2zj"}
[2025-05-13T01:45:31.413Z] [INFO] [WebSocket] Received message from client client-1747100700417-7x0pnvx {"module":"WebSocket","type":"ping"}
[2025-05-13T01:45:35.413Z] [INFO] [WebSocket] Received message from client client-1747100704368-m59h3p6 {"module":"WebSocket","type":"ping","timestamp":"2025-05-13T01:45:35.259Z","connectionId":"ws_1747100420946_hk3khucij"}
[2025-05-13T01:45:45.411Z] [INFO] [WebSocket] Received message from client client-1747100704974-6thikzu {"module":"WebSocket","type":"ping","timestamp":"2025-05-13T01:45:45.258Z","connectionId":"ws_1747100701258_sh747ojoo"}
[2025-05-13T01:45:57.542Z] [INFO] [App] GET /api/companies/current 304 in 31ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-13T01:46:00.416Z] [INFO] [WebSocket] Received message from client client-1747100699615-yj1nzdc {"module":"WebSocket","type":"ping","timestamp":"2025-05-13T01:46:00.261Z","connectionId":"ws_1747100419633_fythoi2zj"}
[2025-05-13T01:46:01.413Z] [INFO] [WebSocket] Received message from client client-1747100700417-7x0pnvx {"module":"WebSocket","type":"ping"}
[2025-05-13T01:46:05.414Z] [INFO] [WebSocket] Received message from client client-1747100704368-m59h3p6 {"module":"WebSocket","type":"ping","timestamp":"2025-05-13T01:46:05.260Z","connectionId":"ws_1747100420946_hk3khucij"}
[2025-05-13T01:46:05.415Z] [INFO] [WebSocket] Received message from client client-1747100704974-6thikzu {"module":"WebSocket","type":"ping","timestamp":"2025-05-13T01:46:05.260Z","connectionId":"ws_1747100701258_sh747ojoo"}
1:46:19 AM [vite] hmr update /src/components/modals/WelcomeModal.tsx, /src/index.css?v=2KrQsbORitCTCoxpNVVkB
[2025-05-13T01:46:25.411Z] [INFO] [WebSocket] Received message from client client-1747100704974-6thikzu {"module":"WebSocket","type":"ping","timestamp":"2025-05-13T01:46:25.258Z","connectionId":"ws_1747100701258_sh747ojoo"}
[2025-05-13T01:46:30.415Z] [INFO] [WebSocket] Received message from client client-1747100699615-yj1nzdc {"module":"WebSocket","type":"ping","timestamp":"2025-05-13T01:46:30.258Z","connectionId":"ws_1747100419633_fythoi2zj"}
[2025-05-13T01:46:31.413Z] [INFO] [WebSocket] Received message from client client-1747100700417-7x0pnvx {"module":"WebSocket","type":"ping"}
[2025-05-13T01:46:35.412Z] [INFO] [WebSocket] Received message from client client-1747100704368-m59h3p6 {"module":"WebSocket","type":"ping","timestamp":"2025-05-13T01:46:35.258Z","connectionId":"ws_1747100420946_hk3khucij"}
[2025-05-13T01:46:45.411Z] [INFO] [WebSocket] Received message from client client-1747100704974-6thikzu {"module":"WebSocket","type":"ping","timestamp":"2025-05-13T01:46:45.258Z","connectionId":"ws_1747100701258_sh747ojoo"}
[Current Company] Fetching company for user: { userId: 328, companyId: 285 }
[Current Company] Found company: {
  id: 285,
  name: 'DevTest30',
  onboardingCompleted: false,
  riskScore: null,
  chosenScore: null,
  isDemo: true
}
[2025-05-13T01:46:57.522Z] [INFO] [App] GET /api/companies/current 304 in 62ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-13T01:47:00.415Z] [INFO] [WebSocket] Received message from client client-1747100699615-yj1nzdc {"module":"WebSocket","type":"ping","timestamp":"2025-05-13T01:47:00.259Z","connectionId":"ws_1747100419633_fythoi2zj"}
[2025-05-13T01:47:01.411Z] [INFO] [WebSocket] Received message from client client-1747100700417-7x0pnvx {"module":"WebSocket","type":"ping"}
[2025-05-13T01:47:03.411Z] [INFO] [WebSocket] Received message from client client-1747100703072-2oo23zn {"module":"WebSocket","type":"ping"}
[2025-05-13T01:47:05.412Z] [INFO] [WebSocket] Received message from client client-1747100704368-m59h3p6 {"module":"WebSocket","type":"ping","timestamp":"2025-05-13T01:47:05.258Z","connectionId":"ws_1747100420946_hk3khucij"}
[2025-05-13T01:47:05.412Z] [INFO] [WebSocket] Received message from client client-1747100704974-6thikzu {"module":"WebSocket","type":"ping","timestamp":"2025-05-13T01:47:05.258Z","connectionId":"ws_1747100701258_sh747ojoo"}
[2025-05-13T01:47:09.463Z] [INFO] [App] GET /api/companies/current 304 in 37ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 328, company_id: 285, email: '30@e.com' }
[2025-05-13T01:47:09.611Z] [INFO] [App] Performing dynamic task unlocking check for company {"companyId":285,"userId":328}
[2025-05-13T01:47:09.641Z] [INFO] [App] No completed KYB tasks found, skipping security task unlock check {"companyId":285}
[Tasks] Automatically unlocking all tasks for company { userId: 328, companyId: 285, requestedBy: 'automatic_task_unlock' }
[2025-05-13T01:47:09.643Z] [INFO] [App] [TaskDependencies] Unlocking ALL tasks for company {"companyId":285}
[2025-05-13T01:47:09.674Z] [INFO] [App] [TaskDependencies] Found user onboarding task that needs completion {"taskId":809,"userEmail":"30@e.com","currentStatus":"completed","currentProgress":100}
[2025-05-13T01:47:09.674Z] [INFO] [App] [TaskDependencies] Found tasks to unlock {"companyId":285,"count":4,"taskIds":[810,811,812,809],"taskTypes":["company_kyb","ky3p","open_banking","user_onboarding"],"ky3pTaskCount":1,"ky3pTaskIds":[811]}
[UnifiedProgress] Starting progress update for task 810 (company_kyb) {
  taskId: 810,
  taskType: 'company_kyb',
  diagnosticId: 'prog-1747100829676-614',
  metadata: [
    'locked',
    'prerequisite_completed',
    'prerequisite_completed_at',
    'dependencyUnlockOperation',
    'previousProgress',
    'previousStatus',
    'isKy3pTask',
    'isUserOnboardingTask'
  ]
}
[UnifiedProgressCalc] Calculating progress for task 810 (company_kyb)
[2025-05-13T01:47:09.841Z] New client connected to the pool (2/3)
[UnifiedProgressCalc] Task 810 (company_kyb) progress: 0/30 = 0%
[2025-05-13T01:47:09.944Z] [INFO] [WebSocket] Broadcast message of type 'task_updated' sent to 5 clients {"module":"WebSocket","messageType":"task_updated","recipients":5,"totalClients":5,"filtered":false}
[2025-05-13T01:47:09.944Z] [DEBUG] [App] [UnifiedProgressCalc] Successfully broadcast task update using unified implementation {"taskId":810,"messageId":"msg_1747100829943_0x4jqo8a"}
[2025-05-13T01:47:09.944Z] [INFO] [App] [UnifiedProgressCalc] Successfully broadcast task update for task 810 {"progress":0,"status":"not_started","messageId":"msg_1747100829943_0x4jqo8a"}
[2025-05-13T01:47:09.944Z] [INFO] [App] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":285,"taskId":810,"taskType":"company_kyb","isKy3pTask":false,"calculatedProgress":0,"previousProgress":0,"wasPreserved":false}
[2025-05-13T01:47:09.944Z] [INFO] [App] [TaskDependencies] Processing KY3P task {"taskId":811,"taskType":"ky3p","currentProgress":0,"currentStatus":"not_started","timestamp":"2025-05-13T01:47:09.944Z"}
[UnifiedProgress] Starting progress update for task 811 (ky3p) {
  taskId: 811,
  taskType: 'ky3p',
  diagnosticId: 'prog-1747100829946-445',
  metadata: [
    'locked',
    'prerequisite_completed',
    'prerequisite_completed_at',
    'dependencyUnlockOperation',
    'previousProgress',
    'previousStatus',
    'isKy3pTask',
    'isUserOnboardingTask'
  ]
}
[2025-05-13T01:47:09.976Z] [INFO] [App] GET /api/companies/current 304 in 31ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[UnifiedProgressCalc] Calculating progress for task 811 (ky3p)
[KY3P Progress] Calculated progress for task 811: {
  taskId: 811,
  taskType: 'ky3p',
  normalizedTaskType: 'ky3p',
  totalFields: 120,
  completedFields: 0,
  progress: 0,
  timeStamp: '2025-05-13T01:47:10.067Z'
}
[UnifiedProgressCalc] Task 811 (ky3p) progress: 0/120 = 0%
[2025-05-13T01:47:10.097Z] [INFO] [WebSocket] Broadcast message of type 'task_updated' sent to 5 clients {"module":"WebSocket","messageType":"task_updated","recipients":5,"totalClients":5,"filtered":false}
[2025-05-13T01:47:10.097Z] [DEBUG] [App] [UnifiedProgressCalc] Successfully broadcast task update using unified implementation {"taskId":811,"messageId":"msg_1747100830097_rlpd53nl"}
[2025-05-13T01:47:10.097Z] [INFO] [App] [UnifiedProgressCalc] Successfully broadcast task update for task 811 {"progress":0,"status":"not_started","messageId":"msg_1747100830097_rlpd53nl"}
[2025-05-13T01:47:10.097Z] [INFO] [App] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":285,"taskId":811,"taskType":"ky3p","isKy3pTask":true,"calculatedProgress":0,"previousProgress":0,"wasPreserved":false}
[UnifiedProgress] Starting progress update for task 812 (open_banking) {
  taskId: 812,
  taskType: 'open_banking',
  diagnosticId: 'prog-1747100830098-578',
  metadata: [
    'locked',
    'prerequisite_completed',
    'prerequisite_completed_at',
    'dependencyUnlockOperation',
    'previousProgress',
    'previousStatus',
    'isKy3pTask',
    'isUserOnboardingTask'
  ]
}
[UnifiedProgressCalc] Calculating progress for task 812 (open_banking)
[UnifiedProgressCalc] Task 812 (open_banking) progress: 0/44 = 0%
[2025-05-13T01:47:10.257Z] [INFO] [WebSocket] Broadcast message of type 'task_updated' sent to 5 clients {"module":"WebSocket","messageType":"task_updated","recipients":5,"totalClients":5,"filtered":false}
[2025-05-13T01:47:10.257Z] [DEBUG] [App] [UnifiedProgressCalc] Successfully broadcast task update using unified implementation {"taskId":812,"messageId":"msg_1747100830256_3y9xfewr"}
[2025-05-13T01:47:10.257Z] [INFO] [App] [UnifiedProgressCalc] Successfully broadcast task update for task 812 {"progress":0,"status":"not_started","messageId":"msg_1747100830256_3y9xfewr"}
[2025-05-13T01:47:10.257Z] [INFO] [App] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":285,"taskId":812,"taskType":"open_banking","isKy3pTask":false,"calculatedProgress":0,"previousProgress":0,"wasPreserved":false}
[2025-05-13T01:47:10.257Z] [INFO] [App] [TaskDependencies] Setting User Onboarding task as completed {"taskId":809,"userEmail":"30@e.com","timestamp":"2025-05-13T01:47:10.257Z"}
[2025-05-13T01:47:10.301Z] [INFO] [App] Our WebSocket server not initialized, falling back to unified implementation 
[2025-05-13T01:47:10.302Z] [INFO] [WebSocket] Broadcast message of type 'task_updated' sent to 5 clients {"module":"WebSocket","messageType":"task_updated","recipients":5,"totalClients":5,"filtered":false}
[2025-05-13T01:47:10.302Z] [INFO] [App] Successfully broadcast task update using unified implementation {"taskId":809,"status":"completed"}
[2025-05-13T01:47:10.302Z] [INFO] [App] [TaskDependencies] Successfully unlocked all tasks {"companyId":285,"count":4}
[Tasks] Successfully unlocked all tasks for company: 285
[2025-05-13T01:47:10.303Z] [INFO] [App] GET /api/companies/current 304 in 32ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 328',
    condition2: 'tasks.created_by = 328',
    condition3: "tasks.company_id = 285 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('30@e.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
[2025-05-13T01:47:10.408Z] [INFO] [App] GET /api/tasks 200 in 799ms :: [{"id":810,"title":"1. KYB Form: DevTest30","description":"Complete KYB verif... 
[2025-05-13T01:47:13.308Z] [INFO] [App] GET /api/companies/current 304 in 32ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-13T01:47:16.309Z] [INFO] [App] GET /api/companies/current 304 in 32ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-13T01:47:19.302Z] [INFO] [App] GET /api/companies/current 304 in 31ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
1:47:19 AM [vite] hmr update /src/components/modals/WelcomeModal.tsx, /src/index.css?v=2KrQsbORitCTCoxpNVVkB (x2)
[2025-05-13T01:47:22.314Z] [INFO] [App] GET /api/companies/current 304 in 32ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-13T01:47:25.412Z] [INFO] [WebSocket] Received message from client client-1747100704974-6thikzu {"module":"WebSocket","type":"ping","timestamp":"2025-05-13T01:47:25.258Z","connectionId":"ws_1747100701258_sh747ojoo"}
[2025-05-13T01:47:25.476Z] [INFO] [App] GET /api/companies/current 304 in 31ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-13T01:47:28.482Z] [INFO] [App] GET /api/companies/current 304 in 32ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-13T01:47:30.410Z] [INFO] [WebSocket] Received message from client client-1747100699615-yj1nzdc {"module":"WebSocket","type":"ping","timestamp":"2025-05-13T01:47:30.258Z","connectionId":"ws_1747100419633_fythoi2zj"}
1:47:30 AM [vite] hmr update /src/components/modals/WelcomeModal.tsx, /src/index.css?v=2KrQsbORitCTCoxpNVVkB (x3)
[2025-05-13T01:47:31.410Z] [INFO] [WebSocket] Received message from client client-1747100700417-7x0pnvx {"module":"WebSocket","type":"ping"}
[2025-05-13T01:47:31.475Z] [INFO] [App] GET /api/companies/current 304 in 31ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-13T01:47:34.485Z] [INFO] [App] GET /api/companies/current 304 in 32ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-13T01:47:35.413Z] [INFO] [WebSocket] Received message from client client-1747100704368-m59h3p6 {"module":"WebSocket","type":"ping","timestamp":"2025-05-13T01:47:35.258Z","connectionId":"ws_1747100420946_hk3khucij"}
[2025-05-13T01:47:37.472Z] [INFO] [App] GET /api/companies/current 304 in 31ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
1:47:39 AM [vite] hmr update /src/components/modals/WelcomeModal.tsx, /src/index.css?v=2KrQsbORitCTCoxpNVVkB (x4)
[2025-05-13T01:47:40.477Z] [INFO] [App] GET /api/companies/current 304 in 34ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-13T01:47:43.496Z] [INFO] [App] GET /api/companies/current 304 in 46ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-13T01:47:45.412Z] [INFO] [WebSocket] Received message from client client-1747100704974-6thikzu {"module":"WebSocket","type":"ping","timestamp":"2025-05-13T01:47:45.258Z","connectionId":"ws_1747100701258_sh747ojoo"}
[2025-05-13T01:47:46.485Z] [INFO] [App] GET /api/companies/current 304 in 30ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-13T01:47:49.478Z] [INFO] [App] GET /api/companies/current 304 in 32ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-13T01:47:52.486Z] [INFO] [App] GET /api/companies/current 304 in 32ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
1:47:52 AM [vite] hmr update /src/components/modals/WelcomeModal.tsx, /src/index.css?v=2KrQsbORitCTCoxpNVVkB (x5)
[2025-05-13T01:47:55.490Z] [INFO] [App] GET /api/companies/current 304 in 36ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[Current Company] Fetching company for user: { userId: 328, companyId: 285 }
[Current Company] Found company: {
  id: 285,
  name: 'DevTest30',
  onboardingCompleted: false,
  riskScore: null,
  chosenScore: null,
  isDemo: true
}
[2025-05-13T01:47:58.517Z] [INFO] [App] GET /api/companies/current 304 in 62ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
1:47:58 AM [vite] hmr update /src/components/modals/WelcomeModal.tsx, /src/index.css?v=2KrQsbORitCTCoxpNVVkB (x6)
[2025-05-13T01:48:00.413Z] [INFO] [WebSocket] Received message from client client-1747100699615-yj1nzdc {"module":"WebSocket","type":"ping","timestamp":"2025-05-13T01:48:00.258Z","connectionId":"ws_1747100419633_fythoi2zj"}
[2025-05-13T01:48:01.409Z] [INFO] [WebSocket] Received message from client client-1747100700417-7x0pnvx {"module":"WebSocket","type":"ping"}
[2025-05-13T01:48:01.485Z] [INFO] [App] GET /api/companies/current 304 in 32ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-13T01:48:04.499Z] [INFO] [App] GET /api/companies/current 304 in 42ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-13T01:48:05.410Z] [INFO] [WebSocket] Received message from client client-1747100704368-m59h3p6 {"module":"WebSocket","type":"ping","timestamp":"2025-05-13T01:48:05.258Z","connectionId":"ws_1747100420946_hk3khucij"}
[2025-05-13T01:48:05.411Z] [INFO] [WebSocket] Received message from client client-1747100704974-6thikzu {"module":"WebSocket","type":"ping","timestamp":"2025-05-13T01:48:05.258Z","connectionId":"ws_1747100701258_sh747ojoo"}
[2025-05-13T01:48:06.617Z] [INFO] [WebSocket] Client disconnected {"module":"WebSocket","clientId":"client-1747100699615-yj1nzdc","code":1001,"reason":"","remainingClients":4}
[2025-05-13T01:48:06.617Z] [INFO] [WebSocket] Client disconnected {"module":"WebSocket","clientId":"client-1747100704368-m59h3p6","code":1001,"reason":"","remainingClients":3}
[2025-05-13T01:48:06.617Z] [INFO] [WebSocket] Client disconnected {"module":"WebSocket","clientId":"client-1747100704974-6thikzu","code":1001,"reason":"","remainingClients":2}
[2025-05-13T01:48:06.617Z] [INFO] [WebSocket] Client disconnected {"module":"WebSocket","clientId":"client-1747100700417-7x0pnvx","code":1001,"reason":"","remainingClients":1}
[2025-05-13T01:48:06.617Z] [INFO] [WebSocket] Client disconnected {"module":"WebSocket","clientId":"client-1747100703072-2oo23zn","code":1001,"reason":"","remainingClients":0}
[2025-05-13T01:48:08.422Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1747100888422-cggrgdw","clients":1}
[Auth] Unauthenticated user session
[2025-05-13T01:48:08.452Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1747100888452-jhxwvpw","clients":2}
[2025-05-13T01:48:08.534Z] [INFO] [WebSocket] Received message from client client-1747100888422-cggrgdw {"module":"WebSocket","type":"authenticate","data":{"timestamp":"2025-05-13T01:48:08.534Z"}}
[2025-05-13T01:48:08.535Z] [INFO] [WebSocket] Authentication from client client-1747100888422-cggrgdw {"module":"WebSocket","hasToken":true}
[2025-05-13T01:48:08.609Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1747100888609-t6qrq3m","clients":3}
[2025-05-13T01:48:09.049Z] [INFO] [WebSocket] Client disconnected {"module":"WebSocket","clientId":"client-1747100888609-t6qrq3m","code":1001,"reason":"","remainingClients":2}
[2025-05-13T01:48:09.049Z] [INFO] [WebSocket] Client disconnected {"module":"WebSocket","clientId":"client-1747100888422-cggrgdw","code":1001,"reason":"","remainingClients":1}
[2025-05-13T01:48:09.050Z] [INFO] [WebSocket] Client disconnected {"module":"WebSocket","clientId":"client-1747100888452-jhxwvpw","code":1001,"reason":"","remainingClients":0}
[Auth] Returning user session data
[2025-05-13T01:48:33.847Z] [INFO] [App] GET /api/companies/current 304 in 36ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-13T01:48:33.873Z] New client connected to the pool (3/3)
[2025-05-13T01:48:33.903Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1747100913903-gfv0xyu","clients":1}
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 328, company_id: 285, email: '30@e.com' }
[2025-05-13T01:48:33.948Z] [INFO] [App] Performing dynamic task unlocking check for company {"companyId":285,"userId":328}
[2025-05-13T01:48:33.980Z] [INFO] [App] No completed KYB tasks found, skipping security task unlock check {"companyId":285}
[Tasks] Automatically unlocking all tasks for company { userId: 328, companyId: 285, requestedBy: 'automatic_task_unlock' }
[2025-05-13T01:48:33.981Z] [INFO] [App] [TaskDependencies] Unlocking ALL tasks for company {"companyId":285}
[2025-05-13T01:48:34.015Z] [INFO] [App] [TaskDependencies] Found user onboarding task that needs completion {"taskId":809,"userEmail":"30@e.com","currentStatus":"completed","currentProgress":100}
[2025-05-13T01:48:34.015Z] [INFO] [App] [TaskDependencies] Found tasks to unlock {"companyId":285,"count":4,"taskIds":[810,811,812,809],"taskTypes":["company_kyb","ky3p","open_banking","user_onboarding"],"ky3pTaskCount":1,"ky3pTaskIds":[811]}
[UnifiedProgress] Starting progress update for task 810 (company_kyb) {
  taskId: 810,
  taskType: 'company_kyb',
  diagnosticId: 'prog-1747100914016-116',
  metadata: [
    'locked',
    'prerequisite_completed',
    'prerequisite_completed_at',
    'dependencyUnlockOperation',
    'previousProgress',
    'previousStatus',
    'isKy3pTask',
    'isUserOnboardingTask'
  ]
}
[2025-05-13T01:48:34.020Z] [INFO] [WebSocket] Received message from client client-1747100913903-gfv0xyu {"module":"WebSocket","type":"authenticate","data":{"timestamp":"2025-05-13T01:48:33.867Z"}}
[2025-05-13T01:48:34.020Z] [INFO] [WebSocket] Authentication from client client-1747100913903-gfv0xyu {"module":"WebSocket","hasToken":true}
[UnifiedProgressCalc] Calculating progress for task 810 (company_kyb)
[UnifiedProgressCalc] Task 810 (company_kyb) progress: 0/30 = 0%
[2025-05-13T01:48:34.174Z] [INFO] [WebSocket] Broadcast message of type 'task_updated' sent to 1 clients {"module":"WebSocket","messageType":"task_updated","recipients":1,"totalClients":1,"filtered":false}
[2025-05-13T01:48:34.174Z] [DEBUG] [App] [UnifiedProgressCalc] Successfully broadcast task update using unified implementation {"taskId":810,"messageId":"msg_1747100914174_s5oouxhj"}
[2025-05-13T01:48:34.174Z] [INFO] [App] [UnifiedProgressCalc] Successfully broadcast task update for task 810 {"progress":0,"status":"not_started","messageId":"msg_1747100914174_s5oouxhj"}
[2025-05-13T01:48:34.174Z] [INFO] [App] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":285,"taskId":810,"taskType":"company_kyb","isKy3pTask":false,"calculatedProgress":0,"previousProgress":0,"wasPreserved":false}
[2025-05-13T01:48:34.174Z] [INFO] [App] [TaskDependencies] Processing KY3P task {"taskId":811,"taskType":"ky3p","currentProgress":0,"currentStatus":"not_started","timestamp":"2025-05-13T01:48:34.174Z"}
[UnifiedProgress] Starting progress update for task 811 (ky3p) {
  taskId: 811,
  taskType: 'ky3p',
  diagnosticId: 'prog-1747100914175-254',
  metadata: [
    'locked',
    'prerequisite_completed',
    'prerequisite_completed_at',
    'dependencyUnlockOperation',
    'previousProgress',
    'previousStatus',
    'isKy3pTask',
    'isUserOnboardingTask'
  ]
}
[UnifiedProgressCalc] Calculating progress for task 811 (ky3p)
[KY3P Progress] Calculated progress for task 811: {
  taskId: 811,
  taskType: 'ky3p',
  normalizedTaskType: 'ky3p',
  totalFields: 120,
  completedFields: 0,
  progress: 0,
  timeStamp: '2025-05-13T01:48:34.304Z'
}
[UnifiedProgressCalc] Task 811 (ky3p) progress: 0/120 = 0%
[2025-05-13T01:48:34.337Z] [INFO] [WebSocket] Broadcast message of type 'task_updated' sent to 1 clients {"module":"WebSocket","messageType":"task_updated","recipients":1,"totalClients":1,"filtered":false}
[2025-05-13T01:48:34.337Z] [DEBUG] [App] [UnifiedProgressCalc] Successfully broadcast task update using unified implementation {"taskId":811,"messageId":"msg_1747100914336_ngleel2a"}
[2025-05-13T01:48:34.337Z] [INFO] [App] [UnifiedProgressCalc] Successfully broadcast task update for task 811 {"progress":0,"status":"not_started","messageId":"msg_1747100914336_ngleel2a"}
[2025-05-13T01:48:34.337Z] [INFO] [App] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":285,"taskId":811,"taskType":"ky3p","isKy3pTask":true,"calculatedProgress":0,"previousProgress":0,"wasPreserved":false}
[UnifiedProgress] Starting progress update for task 812 (open_banking) {
  taskId: 812,
  taskType: 'open_banking',
  diagnosticId: 'prog-1747100914337-844',
  metadata: [
    'locked',
    'prerequisite_completed',
    'prerequisite_completed_at',
    'dependencyUnlockOperation',
    'previousProgress',
    'previousStatus',
    'isKy3pTask',
    'isUserOnboardingTask'
  ]
}
[2025-05-13T01:48:34.384Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1747100914384-7kc7jlt","clients":2}
[UnifiedProgressCalc] Calculating progress for task 812 (open_banking)
[UnifiedProgressCalc] Task 812 (open_banking) progress: 0/44 = 0%
[2025-05-13T01:48:34.609Z] [INFO] [WebSocket] Broadcast message of type 'task_updated' sent to 2 clients {"module":"WebSocket","messageType":"task_updated","recipients":2,"totalClients":2,"filtered":false}
[2025-05-13T01:48:34.609Z] [DEBUG] [App] [UnifiedProgressCalc] Successfully broadcast task update using unified implementation {"taskId":812,"messageId":"msg_1747100914609_9n8r3vdd"}
[2025-05-13T01:48:34.609Z] [INFO] [App] [UnifiedProgressCalc] Successfully broadcast task update for task 812 {"progress":0,"status":"not_started","messageId":"msg_1747100914609_9n8r3vdd"}
[2025-05-13T01:48:34.609Z] [INFO] [App] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":285,"taskId":812,"taskType":"open_banking","isKy3pTask":false,"calculatedProgress":0,"previousProgress":0,"wasPreserved":false}
[2025-05-13T01:48:34.610Z] [INFO] [App] [TaskDependencies] Setting User Onboarding task as completed {"taskId":809,"userEmail":"30@e.com","timestamp":"2025-05-13T01:48:34.610Z"}
[2025-05-13T01:48:34.641Z] [INFO] [App] Our WebSocket server not initialized, falling back to unified implementation 
[2025-05-13T01:48:34.641Z] [INFO] [WebSocket] Broadcast message of type 'task_updated' sent to 2 clients {"module":"WebSocket","messageType":"task_updated","recipients":2,"totalClients":2,"filtered":false}
[2025-05-13T01:48:34.641Z] [INFO] [App] Successfully broadcast task update using unified implementation {"taskId":809,"status":"completed"}
[2025-05-13T01:48:34.641Z] [INFO] [App] [TaskDependencies] Successfully unlocked all tasks {"companyId":285,"count":4}
[Tasks] Successfully unlocked all tasks for company: 285
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 328',
    condition2: 'tasks.created_by = 328',
    condition3: "tasks.company_id = 285 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('30@e.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
[2025-05-13T01:48:34.746Z] [INFO] [App] GET /api/tasks 200 in 799ms :: [{"id":810,"title":"1. KYB Form: DevTest30","description":"Complete KYB verif... 
[2025-05-13T01:48:34.873Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1747100914873-dcx87rz","clients":3}
[2025-05-13T01:48:34.932Z] [INFO] [App] GET /api/tasks 304 in 32ms :: [{"id":810,"title":"1. KYB Form: DevTest30","description":"Complete KYB verif... 
[2025-05-13T01:48:34.996Z] [INFO] [WebSocket] Received message from client client-1747100914873-dcx87rz {"module":"WebSocket","type":"authenticate","userId":null,"companyId":null,"clientId":"ws_1747100913062_n8e9dyamh","timestamp":"2025-05-13T01:48:34.837Z"}
[2025-05-13T01:48:34.997Z] [INFO] [WebSocket] Authentication from client client-1747100914873-dcx87rz {"module":"WebSocket","userId":null,"companyId":null,"hasToken":true}
[2025-05-13T01:48:35.362Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1747100915362-zv8qo1q","clients":4}
[2025-05-13T01:48:35.865Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1747100915865-3zj42mq","clients":5}
[2025-05-13T01:48:36.363Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1747100916363-ipwc4we","clients":6}
[Auth] Returning user session data
[2025-05-13T01:48:36.726Z] [INFO] [App] GET /api/companies/current 304 in 31ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-13T01:48:36.850Z] [INFO] [WebSocket] Received message from client client-1747100916363-ipwc4we {"module":"WebSocket","type":"authenticate","userId":328,"companyId":285,"clientId":"ws_1747100915259_l1wbb4sbd","timestamp":"2025-05-13T01:48:36.699Z"}
[2025-05-13T01:48:36.850Z] [INFO] [WebSocket] Authentication from client client-1747100916363-ipwc4we {"module":"WebSocket","userId":328,"companyId":285,"hasToken":true}
[2025-05-13T01:48:37.480Z] [INFO] [App] GET /api/companies/current 304 in 38ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-13T01:48:40.496Z] [INFO] [App] GET /api/companies/current 304 in 37ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-13T01:48:43.478Z] [INFO] [App] GET /api/companies/current 304 in 32ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-13T01:48:46.474Z] [INFO] [App] GET /api/companies/current 304 in 31ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-13T01:48:49.502Z] [INFO] [App] GET /api/companies/current 304 in 52ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-13T01:48:57.410Z] [INFO] [WebSocket] Received message from client client-1747100916363-ipwc4we {"module":"WebSocket","type":"ping","timestamp":"2025-05-13T01:48:57.259Z","connectionId":"ws_1747100915259_l1wbb4sbd"}
[2025-05-13T01:48:57.552Z] [INFO] [App] GET /api/companies/current 304 in 57ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-13T01:49:04.409Z] [INFO] [WebSocket] Received message from client client-1747100913903-gfv0xyu {"module":"WebSocket","type":"ping"}
[2025-05-13T01:49:06.410Z] [INFO] [WebSocket] Received message from client client-1747100915362-zv8qo1q {"module":"WebSocket","type":"ping","timestamp":"2025-05-13T01:49:06.258Z","connectionId":"ws_1747100915327_dqi819y36"}
[2025-05-13T01:49:06.410Z] [INFO] [WebSocket] Received message from client client-1747100915865-3zj42mq {"module":"WebSocket","type":"ping","timestamp":"2025-05-13T01:49:06.259Z","connectionId":"ws_1747100914349_g0i89yama"}
[2025-05-13T01:49:17.409Z] [INFO] [WebSocket] Received message from client client-1747100916363-ipwc4we {"module":"WebSocket","type":"ping","timestamp":"2025-05-13T01:49:17.258Z","connectionId":"ws_1747100915259_l1wbb4sbd"}
[2025-05-13T01:49:34.411Z] [INFO] [WebSocket] Received message from client client-1747100913903-gfv0xyu {"module":"WebSocket","type":"ping"}
[2025-05-13T01:49:36.410Z] [INFO] [WebSocket] Received message from client client-1747100915865-3zj42mq {"module":"WebSocket","type":"ping","timestamp":"2025-05-13T01:49:36.259Z","connectionId":"ws_1747100914349_g0i89yama"}
[2025-05-13T01:49:36.410Z] [INFO] [WebSocket] Received message from client client-1747100915362-zv8qo1q {"module":"WebSocket","type":"ping","timestamp":"2025-05-13T01:49:36.259Z","connectionId":"ws_1747100915327_dqi819y36"}
[2025-05-13T01:49:37.409Z] [INFO] [WebSocket] Received message from client client-1747100916363-ipwc4we {"module":"WebSocket","type":"ping","timestamp":"2025-05-13T01:49:37.258Z","connectionId":"ws_1747100915259_l1wbb4sbd"}
[2025-05-13T01:49:57.413Z] [INFO] [WebSocket] Received message from client client-1747100916363-ipwc4we {"module":"WebSocket","type":"ping","timestamp":"2025-05-13T01:49:57.260Z","connectionId":"ws_1747100915259_l1wbb4sbd"}
[Current Company] Fetching company for user: { userId: 328, companyId: 285 }
[Current Company] Found company: {
  id: 285,
  name: 'DevTest30',
  onboardingCompleted: false,
  riskScore: null,
  chosenScore: null,
  isDemo: true
}
[2025-05-13T01:49:57.526Z] [INFO] [App] GET /api/companies/current 304 in 70ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[PeriodicTaskReconciliation] Reconciling batch of 10 tasks: [
  679, 740, 710, 691,
  764, 707, 759, 698,
  718, 693
]
[Task Progress] Calculated progress for task 679 (open_banking): 44/44 = 100%
[Task Progress] Calculated progress for task 740 (open_banking): 0/44 = 0%
[Task Progress] Calculated progress for task 710 (ky3p): 0/120 = 0%
[Task Progress] Calculated progress for task 691 (open_banking): 0/44 = 0%
[Task Progress] Calculated progress for task 764 (open_banking): 44/44 = 100%
[Task Progress] Calculated progress for task 707 (open_banking): 0/44 = 0%
[Task Progress] Calculated progress for task 759 (ky3p): 0/0 = 0%
[Task Progress] Calculated progress for task 698 (ky3p): 0/0 = 0%
[Task Progress] Calculated progress for task 718 (ky3p): 1/120 = 1%
[Task Progress] Calculated progress for task 693 (company_kyb): 5/30 = 17%
[2025-05-13T01:50:04.410Z] [INFO] [WebSocket] Received message from client client-1747100913903-gfv0xyu {"module":"WebSocket","type":"ping"}
[2025-05-13T01:50:06.414Z] [INFO] [WebSocket] Received message from client client-1747100915362-zv8qo1q {"module":"WebSocket","type":"ping","timestamp":"2025-05-13T01:50:06.258Z","connectionId":"ws_1747100915327_dqi819y36"}
[2025-05-13T01:50:06.415Z] [INFO] [WebSocket] Received message from client client-1747100915865-3zj42mq {"module":"WebSocket","type":"ping","timestamp":"2025-05-13T01:50:06.259Z","connectionId":"ws_1747100914349_g0i89yama"}
[2025-05-13T01:50:17.409Z] [INFO] [WebSocket] Received message from client client-1747100916363-ipwc4we {"module":"WebSocket","type":"ping","timestamp":"2025-05-13T01:50:17.258Z","connectionId":"ws_1747100915259_l1wbb4sbd"}
[2025-05-13T01:50:34.410Z] [INFO] [WebSocket] Received message from client client-1747100913903-gfv0xyu {"module":"WebSocket","type":"ping"}
[2025-05-13T01:50:35.412Z] [INFO] [WebSocket] Received message from client client-1747100914873-dcx87rz {"module":"WebSocket","type":"ping"}
[2025-05-13T01:50:36.412Z] [INFO] [WebSocket] Received message from client client-1747100915865-3zj42mq {"module":"WebSocket","type":"ping","timestamp":"2025-05-13T01:50:36.258Z","connectionId":"ws_1747100914349_g0i89yama"}
[2025-05-13T01:50:36.412Z] [INFO] [WebSocket] Received message from client client-1747100915362-zv8qo1q {"module":"WebSocket","type":"ping","timestamp":"2025-05-13T01:50:36.258Z","connectionId":"ws_1747100915327_dqi819y36"}
[2025-05-13T01:50:37.410Z] [INFO] [WebSocket] Received message from client client-1747100916363-ipwc4we {"module":"WebSocket","type":"ping","timestamp":"2025-05-13T01:50:37.258Z","connectionId":"ws_1747100915259_l1wbb4sbd"}
[2025-05-13T01:50:46.691Z] [INFO] [App] GET /api/companies/current 304 in 32ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
Suppressing further connection logs. Pool size: 3
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 328, company_id: 285, email: '30@e.com' }
[2025-05-13T01:50:46.769Z] [INFO] [App] Performing dynamic task unlocking check for company {"companyId":285,"userId":328}
[2025-05-13T01:50:46.799Z] [INFO] [App] No completed KYB tasks found, skipping security task unlock check {"companyId":285}
[Tasks] Automatically unlocking all tasks for company { userId: 328, companyId: 285, requestedBy: 'automatic_task_unlock' }
[2025-05-13T01:50:46.800Z] [INFO] [App] [TaskDependencies] Unlocking ALL tasks for company {"companyId":285}
[2025-05-13T01:50:46.829Z] [INFO] [App] [TaskDependencies] Found user onboarding task that needs completion {"taskId":809,"userEmail":"30@e.com","currentStatus":"completed","currentProgress":100}
[2025-05-13T01:50:46.829Z] [INFO] [App] [TaskDependencies] Found tasks to unlock {"companyId":285,"count":4,"taskIds":[810,811,812,809],"taskTypes":["company_kyb","ky3p","open_banking","user_onboarding"],"ky3pTaskCount":1,"ky3pTaskIds":[811]}
[UnifiedProgress] Starting progress update for task 810 (company_kyb) {
  taskId: 810,
  taskType: 'company_kyb',
  diagnosticId: 'prog-1747101046830-251',
  metadata: [
    'locked',
    'prerequisite_completed',
    'prerequisite_completed_at',
    'dependencyUnlockOperation',
    'previousProgress',
    'previousStatus',
    'isKy3pTask',
    'isUserOnboardingTask'
  ]
}
[2025-05-13T01:50:46.872Z] [INFO] [App] GET /api/companies/current 304 in 31ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[UnifiedProgressCalc] Calculating progress for task 810 (company_kyb)
[UnifiedProgressCalc] Task 810 (company_kyb) progress: 0/30 = 0%
[2025-05-13T01:50:46.988Z] [INFO] [WebSocket] Broadcast message of type 'task_updated' sent to 6 clients {"module":"WebSocket","messageType":"task_updated","recipients":6,"totalClients":6,"filtered":false}
[2025-05-13T01:50:46.988Z] [DEBUG] [App] [UnifiedProgressCalc] Successfully broadcast task update using unified implementation {"taskId":810,"messageId":"msg_1747101046988_lme3ajxx"}
[2025-05-13T01:50:46.988Z] [INFO] [App] [UnifiedProgressCalc] Successfully broadcast task update for task 810 {"progress":0,"status":"not_started","messageId":"msg_1747101046988_lme3ajxx"}
[2025-05-13T01:50:46.988Z] [INFO] [App] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":285,"taskId":810,"taskType":"company_kyb","isKy3pTask":false,"calculatedProgress":0,"previousProgress":0,"wasPreserved":false}
[2025-05-13T01:50:46.988Z] [INFO] [App] [TaskDependencies] Processing KY3P task {"taskId":811,"taskType":"ky3p","currentProgress":0,"currentStatus":"not_started","timestamp":"2025-05-13T01:50:46.988Z"}
[UnifiedProgress] Starting progress update for task 811 (ky3p) {
  taskId: 811,
  taskType: 'ky3p',
  diagnosticId: 'prog-1747101046989-959',
  metadata: [
    'locked',
    'prerequisite_completed',
    'prerequisite_completed_at',
    'dependencyUnlockOperation',
    'previousProgress',
    'previousStatus',
    'isKy3pTask',
    'isUserOnboardingTask'
  ]
}
[UnifiedProgressCalc] Calculating progress for task 811 (ky3p)
[KY3P Progress] Calculated progress for task 811: {
  taskId: 811,
  taskType: 'ky3p',
  normalizedTaskType: 'ky3p',
  totalFields: 120,
  completedFields: 0,
  progress: 0,
  timeStamp: '2025-05-13T01:50:47.114Z'
}
[UnifiedProgressCalc] Task 811 (ky3p) progress: 0/120 = 0%
[2025-05-13T01:50:47.143Z] [INFO] [WebSocket] Broadcast message of type 'task_updated' sent to 6 clients {"module":"WebSocket","messageType":"task_updated","recipients":6,"totalClients":6,"filtered":false}
[2025-05-13T01:50:47.143Z] [DEBUG] [App] [UnifiedProgressCalc] Successfully broadcast task update using unified implementation {"taskId":811,"messageId":"msg_1747101047143_amamzsac"}
[2025-05-13T01:50:47.143Z] [INFO] [App] [UnifiedProgressCalc] Successfully broadcast task update for task 811 {"progress":0,"status":"not_started","messageId":"msg_1747101047143_amamzsac"}
[2025-05-13T01:50:47.143Z] [INFO] [App] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":285,"taskId":811,"taskType":"ky3p","isKy3pTask":true,"calculatedProgress":0,"previousProgress":0,"wasPreserved":false}
[UnifiedProgress] Starting progress update for task 812 (open_banking) {
  taskId: 812,
  taskType: 'open_banking',
  diagnosticId: 'prog-1747101047144-438',
  metadata: [
    'locked',
    'prerequisite_completed',
    'prerequisite_completed_at',
    'dependencyUnlockOperation',
    'previousProgress',
    'previousStatus',
    'isKy3pTask',
    'isUserOnboardingTask'
  ]
}
[UnifiedProgressCalc] Calculating progress for task 812 (open_banking)
[UnifiedProgressCalc] Task 812 (open_banking) progress: 0/44 = 0%
[2025-05-13T01:50:47.302Z] [INFO] [WebSocket] Broadcast message of type 'task_updated' sent to 6 clients {"module":"WebSocket","messageType":"task_updated","recipients":6,"totalClients":6,"filtered":false}
[2025-05-13T01:50:47.302Z] [DEBUG] [App] [UnifiedProgressCalc] Successfully broadcast task update using unified implementation {"taskId":812,"messageId":"msg_1747101047302_4dq6dsi3"}
[2025-05-13T01:50:47.302Z] [INFO] [App] [UnifiedProgressCalc] Successfully broadcast task update for task 812 {"progress":0,"status":"not_started","messageId":"msg_1747101047302_4dq6dsi3"}
[2025-05-13T01:50:47.302Z] [INFO] [App] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":285,"taskId":812,"taskType":"open_banking","isKy3pTask":false,"calculatedProgress":0,"previousProgress":0,"wasPreserved":false}
[2025-05-13T01:50:47.302Z] [INFO] [App] [TaskDependencies] Setting User Onboarding task as completed {"taskId":809,"userEmail":"30@e.com","timestamp":"2025-05-13T01:50:47.302Z"}
[2025-05-13T01:50:47.332Z] [INFO] [App] Our WebSocket server not initialized, falling back to unified implementation 
[2025-05-13T01:50:47.333Z] [INFO] [WebSocket] Broadcast message of type 'task_updated' sent to 6 clients {"module":"WebSocket","messageType":"task_updated","recipients":6,"totalClients":6,"filtered":false}
[2025-05-13T01:50:47.333Z] [INFO] [App] Successfully broadcast task update using unified implementation {"taskId":809,"status":"completed"}
[2025-05-13T01:50:47.333Z] [INFO] [App] [TaskDependencies] Successfully unlocked all tasks {"companyId":285,"count":4}
[Tasks] Successfully unlocked all tasks for company: 285
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 328',
    condition2: 'tasks.created_by = 328',
    condition3: "tasks.company_id = 285 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('30@e.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
[2025-05-13T01:50:47.422Z] [INFO] [App] GET /api/tasks 200 in 653ms :: [{"id":810,"title":"1. KYB Form: DevTest30","description":"Complete KYB verif... 
[2025-05-13T01:50:49.032Z] [INFO] [App] GET /api/companies/current 304 in 30ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-13T01:50:52.034Z] [INFO] [App] GET /api/companies/current 304 in 31ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-13T01:50:55.035Z] [INFO] [App] GET /api/companies/current 304 in 30ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-13T01:50:56.483Z] [INFO] [WebSocket] Received message from client client-1747100916363-ipwc4we {"module":"WebSocket","type":"ping","timestamp":"2025-05-13T01:50:56.329Z","connectionId":"ws_1747100915259_l1wbb4sbd"}
[Current Company] Fetching company for user: { userId: 328, companyId: 285 }
[Current Company] Found company: {
  id: 285,
  name: 'DevTest30',
  onboardingCompleted: false,
  riskScore: null,
  chosenScore: null,
  isDemo: true
}
[2025-05-13T01:50:58.079Z] [INFO] [App] GET /api/companies/current 304 in 62ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-13T01:51:01.034Z] [INFO] [App] GET /api/companies/current 304 in 31ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-13T01:51:02.613Z] [INFO] [App] GET /api/tasks 304 in 30ms :: [{"id":810,"title":"1. KYB Form: DevTest30","description":"Complete KYB verif... 
[2025-05-13T01:51:04.019Z] [INFO] [WebSocket] Received message from client client-1747100913903-gfv0xyu {"module":"WebSocket","type":"ping"}
[2025-05-13T01:51:04.032Z] [INFO] [App] GET /api/companies/current 304 in 30ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-13T01:51:05.480Z] [INFO] [WebSocket] Received message from client client-1747100915362-zv8qo1q {"module":"WebSocket","type":"ping","timestamp":"2025-05-13T01:51:05.328Z","connectionId":"ws_1747100915327_dqi819y36"}
[2025-05-13T01:51:05.981Z] [INFO] [WebSocket] Received message from client client-1747100915865-3zj42mq {"module":"WebSocket","type":"ping","timestamp":"2025-05-13T01:51:05.830Z","connectionId":"ws_1747100914349_g0i89yama"}
[2025-05-13T01:51:07.045Z] [INFO] [App] GET /api/companies/current 304 in 30ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-13T01:51:10.039Z] [INFO] [App] GET /api/companies/current 304 in 33ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[Current Company] Updating company 285 with data: { numEmployees: '25', revenueTier: 'small' }
[Current Company] Request headers: { contentType: 'application/json', methodOverride: 'PATCH' }
[Current Company] Method override header: PATCH, treating as PATCH: true
[Current Company] Setting num_employees to: 25
[Current Company] Parsed num_employees as integer: 25
[Current Company] Setting revenue_tier to: small
[Current Company] Executing update with data: { num_employees: 25, revenue_tier: 'small' }
[Cache] Invalidating company cache for company 285
[Current Company] Successfully updated company 285: {
  id: 285,
  name: 'DevTest30',
  category: 'FinTech',
  is_demo: true,
  revenue_tier: 'small',
  num_employees: 25,
  onboarding_company_completed: false
}
[2025-05-13T01:51:12.800Z] [INFO] [App] POST /api/companies/current 200 in 62ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[Current Company] Fetching company for user: { userId: 328, companyId: 285 }
[Current Company] Found company: {
  id: 285,
  name: 'DevTest30',
  onboardingCompleted: false,
  riskScore: null,
  chosenScore: null,
  isDemo: true
}
[2025-05-13T01:51:13.017Z] [INFO] [App] GET /api/companies/current 200 in 61ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[Current Company] Using cached company data: 285
[2025-05-13T01:51:13.259Z] [INFO] [App] GET /api/companies/current 304 in 42ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-13T01:51:16.037Z] [INFO] [App] GET /api/companies/current 304 in 30ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-13T01:51:16.481Z] [INFO] [WebSocket] Received message from client client-1747100916363-ipwc4we {"module":"WebSocket","type":"ping","timestamp":"2025-05-13T01:51:16.329Z","connectionId":"ws_1747100915259_l1wbb4sbd"}
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 328, company_id: 285, email: '30@e.com' }
[2025-05-13T01:51:17.772Z] [INFO] [App] Performing dynamic task unlocking check for company {"companyId":285,"userId":328}
[2025-05-13T01:51:17.802Z] [INFO] [App] No completed KYB tasks found, skipping security task unlock check {"companyId":285}
[Tasks] Automatically unlocking all tasks for company { userId: 328, companyId: 285, requestedBy: 'automatic_task_unlock' }
[2025-05-13T01:51:17.803Z] [INFO] [App] [TaskDependencies] Unlocking ALL tasks for company {"companyId":285}
[2025-05-13T01:51:17.831Z] [INFO] [App] [TaskDependencies] Found user onboarding task that needs completion {"taskId":809,"userEmail":"30@e.com","currentStatus":"completed","currentProgress":100}
[2025-05-13T01:51:17.832Z] [INFO] [App] [TaskDependencies] Found tasks to unlock {"companyId":285,"count":4,"taskIds":[810,811,812,809],"taskTypes":["company_kyb","ky3p","open_banking","user_onboarding"],"ky3pTaskCount":1,"ky3pTaskIds":[811]}
[UnifiedProgress] Starting progress update for task 810 (company_kyb) {
  taskId: 810,
  taskType: 'company_kyb',
  diagnosticId: 'prog-1747101077833-94',
  metadata: [
    'locked',
    'prerequisite_completed',
    'prerequisite_completed_at',
    'dependencyUnlockOperation',
    'previousProgress',
    'previousStatus',
    'isKy3pTask',
    'isUserOnboardingTask'
  ]
}
[UnifiedProgressCalc] Calculating progress for task 810 (company_kyb)
[UnifiedProgressCalc] Task 810 (company_kyb) progress: 0/30 = 0%
[2025-05-13T01:51:17.987Z] [INFO] [WebSocket] Broadcast message of type 'task_updated' sent to 6 clients {"module":"WebSocket","messageType":"task_updated","recipients":6,"totalClients":6,"filtered":false}
[2025-05-13T01:51:17.987Z] [DEBUG] [App] [UnifiedProgressCalc] Successfully broadcast task update using unified implementation {"taskId":810,"messageId":"msg_1747101077987_kvd0j3v9"}
[2025-05-13T01:51:17.987Z] [INFO] [App] [UnifiedProgressCalc] Successfully broadcast task update for task 810 {"progress":0,"status":"not_started","messageId":"msg_1747101077987_kvd0j3v9"}
[2025-05-13T01:51:17.987Z] [INFO] [App] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":285,"taskId":810,"taskType":"company_kyb","isKy3pTask":false,"calculatedProgress":0,"previousProgress":0,"wasPreserved":false}
[2025-05-13T01:51:17.988Z] [INFO] [App] [TaskDependencies] Processing KY3P task {"taskId":811,"taskType":"ky3p","currentProgress":0,"currentStatus":"not_started","timestamp":"2025-05-13T01:51:17.987Z"}
[UnifiedProgress] Starting progress update for task 811 (ky3p) {
  taskId: 811,
  taskType: 'ky3p',
  diagnosticId: 'prog-1747101077988-144',
  metadata: [
    'locked',
    'prerequisite_completed',
    'prerequisite_completed_at',
    'dependencyUnlockOperation',
    'previousProgress',
    'previousStatus',
    'isKy3pTask',
    'isUserOnboardingTask'
  ]
}
[UnifiedProgressCalc] Calculating progress for task 811 (ky3p)
[KY3P Progress] Calculated progress for task 811: {
  taskId: 811,
  taskType: 'ky3p',
  normalizedTaskType: 'ky3p',
  totalFields: 120,
  completedFields: 0,
  progress: 0,
  timeStamp: '2025-05-13T01:51:18.132Z'
}
[UnifiedProgressCalc] Task 811 (ky3p) progress: 0/120 = 0%
[2025-05-13T01:51:18.172Z] [INFO] [WebSocket] Broadcast message of type 'task_updated' sent to 6 clients {"module":"WebSocket","messageType":"task_updated","recipients":6,"totalClients":6,"filtered":false}
[2025-05-13T01:51:18.173Z] [DEBUG] [App] [UnifiedProgressCalc] Successfully broadcast task update using unified implementation {"taskId":811,"messageId":"msg_1747101078172_jbwrvkvq"}
[2025-05-13T01:51:18.173Z] [INFO] [App] [UnifiedProgressCalc] Successfully broadcast task update for task 811 {"progress":0,"status":"not_started","messageId":"msg_1747101078172_jbwrvkvq"}
[2025-05-13T01:51:18.173Z] [INFO] [App] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":285,"taskId":811,"taskType":"ky3p","isKy3pTask":true,"calculatedProgress":0,"previousProgress":0,"wasPreserved":false}
[UnifiedProgress] Starting progress update for task 812 (open_banking) {
  taskId: 812,
  taskType: 'open_banking',
  diagnosticId: 'prog-1747101078175-720',
  metadata: [
    'locked',
    'prerequisite_completed',
    'prerequisite_completed_at',
    'dependencyUnlockOperation',
    'previousProgress',
    'previousStatus',
    'isKy3pTask',
    'isUserOnboardingTask'
  ]
}
[UnifiedProgressCalc] Calculating progress for task 812 (open_banking)
[UnifiedProgressCalc] Task 812 (open_banking) progress: 0/44 = 0%
[2025-05-13T01:51:18.324Z] [INFO] [WebSocket] Broadcast message of type 'task_updated' sent to 6 clients {"module":"WebSocket","messageType":"task_updated","recipients":6,"totalClients":6,"filtered":false}
[2025-05-13T01:51:18.324Z] [DEBUG] [App] [UnifiedProgressCalc] Successfully broadcast task update using unified implementation {"taskId":812,"messageId":"msg_1747101078324_c0p8kiho"}
[2025-05-13T01:51:18.324Z] [INFO] [App] [UnifiedProgressCalc] Successfully broadcast task update for task 812 {"progress":0,"status":"not_started","messageId":"msg_1747101078324_c0p8kiho"}
[2025-05-13T01:51:18.324Z] [INFO] [App] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":285,"taskId":812,"taskType":"open_banking","isKy3pTask":false,"calculatedProgress":0,"previousProgress":0,"wasPreserved":false}
[2025-05-13T01:51:18.324Z] [INFO] [App] [TaskDependencies] Setting User Onboarding task as completed {"taskId":809,"userEmail":"30@e.com","timestamp":"2025-05-13T01:51:18.324Z"}
[2025-05-13T01:51:18.357Z] [INFO] [App] Our WebSocket server not initialized, falling back to unified implementation 
[2025-05-13T01:51:18.357Z] [INFO] [WebSocket] Broadcast message of type 'task_updated' sent to 6 clients {"module":"WebSocket","messageType":"task_updated","recipients":6,"totalClients":6,"filtered":false}
[2025-05-13T01:51:18.357Z] [INFO] [App] Successfully broadcast task update using unified implementation {"taskId":809,"status":"completed"}
[2025-05-13T01:51:18.357Z] [INFO] [App] [TaskDependencies] Successfully unlocked all tasks {"companyId":285,"count":4}
[Tasks] Successfully unlocked all tasks for company: 285
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 328',
    condition2: 'tasks.created_by = 328',
    condition3: "tasks.company_id = 285 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('30@e.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
[2025-05-13T01:51:18.449Z] [INFO] [App] GET /api/tasks 200 in 678ms :: [{"id":810,"title":"1. KYB Form: DevTest30","description":"Complete KYB verif... 
[2025-05-13T01:51:19.051Z] [INFO] [App] GET /api/companies/current 304 in 43ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-13T01:51:22.034Z] [INFO] [App] GET /api/companies/current 304 in 31ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-13T01:51:25.038Z] [INFO] [App] GET /api/companies/current 304 in 31ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-13T01:51:28.044Z] [INFO] [App] GET /api/companies/current 304 in 30ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-13T01:51:31.038Z] [INFO] [App] GET /api/companies/current 304 in 30ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[Tasks] Using cached task data for user: 328
[2025-05-13T01:51:33.642Z] [INFO] [App] GET /api/tasks 304 in 31ms :: [{"id":810,"title":"1. KYB Form: DevTest30","description":"Complete KYB verif... 
[2025-05-13T01:51:34.020Z] [INFO] [WebSocket] Received message from client client-1747100913903-gfv0xyu {"module":"WebSocket","type":"ping"}
[2025-05-13T01:51:34.033Z] [INFO] [App] GET /api/companies/current 304 in 30ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-13T01:51:35.481Z] [INFO] [WebSocket] Received message from client client-1747100915362-zv8qo1q {"module":"WebSocket","type":"ping","timestamp":"2025-05-13T01:51:35.329Z","connectionId":"ws_1747100915327_dqi819y36"}
[2025-05-13T01:51:35.985Z] [INFO] [WebSocket] Received message from client client-1747100915865-3zj42mq {"module":"WebSocket","type":"ping","timestamp":"2025-05-13T01:51:35.831Z","connectionId":"ws_1747100914349_g0i89yama"}
[2025-05-13T01:51:36.481Z] [INFO] [WebSocket] Received message from client client-1747100916363-ipwc4we {"module":"WebSocket","type":"ping","timestamp":"2025-05-13T01:51:36.330Z","connectionId":"ws_1747100915259_l1wbb4sbd"}
[2025-05-13T01:51:37.033Z] [INFO] [App] GET /api/companies/current 304 in 30ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-13T01:51:40.039Z] [INFO] [App] GET /api/companies/current 304 in 30ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[Current Company] Using cached company data: 285
[2025-05-13T01:51:43.032Z] [INFO] [App] GET /api/companies/current 304 in 30ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-13T01:51:46.034Z] [INFO] [App] GET /api/companies/current 304 in 32ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 328, company_id: 285, email: '30@e.com' }
[2025-05-13T01:51:48.803Z] [INFO] [App] Performing dynamic task unlocking check for company {"companyId":285,"userId":328}
[2025-05-13T01:51:48.832Z] [INFO] [App] No completed KYB tasks found, skipping security task unlock check {"companyId":285}
[Tasks] Automatically unlocking all tasks for company { userId: 328, companyId: 285, requestedBy: 'automatic_task_unlock' }
[2025-05-13T01:51:48.833Z] [INFO] [App] [TaskDependencies] Unlocking ALL tasks for company {"companyId":285}
[2025-05-13T01:51:48.866Z] [INFO] [App] [TaskDependencies] Found user onboarding task that needs completion {"taskId":809,"userEmail":"30@e.com","currentStatus":"completed","currentProgress":100}
[2025-05-13T01:51:48.866Z] [INFO] [App] [TaskDependencies] Found tasks to unlock {"companyId":285,"count":4,"taskIds":[810,811,812,809],"taskTypes":["company_kyb","ky3p","open_banking","user_onboarding"],"ky3pTaskCount":1,"ky3pTaskIds":[811]}
[UnifiedProgress] Starting progress update for task 810 (company_kyb) {
  taskId: 810,
  taskType: 'company_kyb',
  diagnosticId: 'prog-1747101108867-559',
  metadata: [
    'locked',
    'prerequisite_completed',
    'prerequisite_completed_at',
    'dependencyUnlockOperation',
    'previousProgress',
    'previousStatus',
    'isKy3pTask',
    'isUserOnboardingTask'
  ]
}
[UnifiedProgressCalc] Calculating progress for task 810 (company_kyb)
[UnifiedProgressCalc] Task 810 (company_kyb) progress: 0/30 = 0%
[2025-05-13T01:51:49.014Z] [INFO] [WebSocket] Broadcast message of type 'task_updated' sent to 6 clients {"module":"WebSocket","messageType":"task_updated","recipients":6,"totalClients":6,"filtered":false}
[2025-05-13T01:51:49.014Z] [DEBUG] [App] [UnifiedProgressCalc] Successfully broadcast task update using unified implementation {"taskId":810,"messageId":"msg_1747101109013_xdahxcpc"}
[2025-05-13T01:51:49.014Z] [INFO] [App] [UnifiedProgressCalc] Successfully broadcast task update for task 810 {"progress":0,"status":"not_started","messageId":"msg_1747101109013_xdahxcpc"}
[2025-05-13T01:51:49.014Z] [INFO] [App] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":285,"taskId":810,"taskType":"company_kyb","isKy3pTask":false,"calculatedProgress":0,"previousProgress":0,"wasPreserved":false}
[2025-05-13T01:51:49.014Z] [INFO] [App] [TaskDependencies] Processing KY3P task {"taskId":811,"taskType":"ky3p","currentProgress":0,"currentStatus":"not_started","timestamp":"2025-05-13T01:51:49.014Z"}
[UnifiedProgress] Starting progress update for task 811 (ky3p) {
  taskId: 811,
  taskType: 'ky3p',
  diagnosticId: 'prog-1747101109015-13',
  metadata: [
    'locked',
    'prerequisite_completed',
    'prerequisite_completed_at',
    'dependencyUnlockOperation',
    'previousProgress',
    'previousStatus',
    'isKy3pTask',
    'isUserOnboardingTask'
  ]
}
[UnifiedProgressCalc] Calculating progress for task 811 (ky3p)
[KY3P Progress] Calculated progress for task 811: {
  taskId: 811,
  taskType: 'ky3p',
  normalizedTaskType: 'ky3p',
  totalFields: 120,
  completedFields: 0,
  progress: 0,
  timeStamp: '2025-05-13T01:51:49.130Z'
}
[UnifiedProgressCalc] Task 811 (ky3p) progress: 0/120 = 0%
[2025-05-13T01:51:49.142Z] [INFO] [App] GET /api/companies/current 304 in 32ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-13T01:51:49.159Z] [INFO] [WebSocket] Broadcast message of type 'task_updated' sent to 6 clients {"module":"WebSocket","messageType":"task_updated","recipients":6,"totalClients":6,"filtered":false}
[2025-05-13T01:51:49.159Z] [DEBUG] [App] [UnifiedProgressCalc] Successfully broadcast task update using unified implementation {"taskId":811,"messageId":"msg_1747101109159_biywf80e"}
[2025-05-13T01:51:49.159Z] [INFO] [App] [UnifiedProgressCalc] Successfully broadcast task update for task 811 {"progress":0,"status":"not_started","messageId":"msg_1747101109159_biywf80e"}
[2025-05-13T01:51:49.159Z] [INFO] [App] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":285,"taskId":811,"taskType":"ky3p","isKy3pTask":true,"calculatedProgress":0,"previousProgress":0,"wasPreserved":false}
[UnifiedProgress] Starting progress update for task 812 (open_banking) {
  taskId: 812,
  taskType: 'open_banking',
  diagnosticId: 'prog-1747101109160-267',
  metadata: [
    'locked',
    'prerequisite_completed',
    'prerequisite_completed_at',
    'dependencyUnlockOperation',
    'previousProgress',
    'previousStatus',
    'isKy3pTask',
    'isUserOnboardingTask'
  ]
}
[UnifiedProgressCalc] Calculating progress for task 812 (open_banking)
[UnifiedProgressCalc] Task 812 (open_banking) progress: 0/44 = 0%
[2025-05-13T01:51:49.307Z] [INFO] [WebSocket] Broadcast message of type 'task_updated' sent to 6 clients {"module":"WebSocket","messageType":"task_updated","recipients":6,"totalClients":6,"filtered":false}
[2025-05-13T01:51:49.307Z] [DEBUG] [App] [UnifiedProgressCalc] Successfully broadcast task update using unified implementation {"taskId":812,"messageId":"msg_1747101109307_w2op85bt"}
[2025-05-13T01:51:49.307Z] [INFO] [App] [UnifiedProgressCalc] Successfully broadcast task update for task 812 {"progress":0,"status":"not_started","messageId":"msg_1747101109307_w2op85bt"}
[2025-05-13T01:51:49.308Z] [INFO] [App] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":285,"taskId":812,"taskType":"open_banking","isKy3pTask":false,"calculatedProgress":0,"previousProgress":0,"wasPreserved":false}
[2025-05-13T01:51:49.308Z] [INFO] [App] [TaskDependencies] Setting User Onboarding task as completed {"taskId":809,"userEmail":"30@e.com","timestamp":"2025-05-13T01:51:49.308Z"}
[2025-05-13T01:51:49.339Z] [INFO] [App] Our WebSocket server not initialized, falling back to unified implementation 
[2025-05-13T01:51:49.339Z] [INFO] [WebSocket] Broadcast message of type 'task_updated' sent to 6 clients {"module":"WebSocket","messageType":"task_updated","recipients":6,"totalClients":6,"filtered":false}
[2025-05-13T01:51:49.339Z] [INFO] [App] Successfully broadcast task update using unified implementation {"taskId":809,"status":"completed"}
[2025-05-13T01:51:49.339Z] [INFO] [App] [TaskDependencies] Successfully unlocked all tasks {"companyId":285,"count":4}
[Tasks] Successfully unlocked all tasks for company: 285
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 328',
    condition2: 'tasks.created_by = 328',
    condition3: "tasks.company_id = 285 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('30@e.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
[2025-05-13T01:51:49.429Z] [INFO] [App] GET /api/tasks 200 in 627ms :: [{"id":810,"title":"1. KYB Form: DevTest30","description":"Complete KYB verif... 
[2025-05-13T01:51:52.046Z] [INFO] [App] GET /api/companies/current 304 in 33ms :: {"id":285,"name":"DevTest30","category":"FinTech","is_demo":true,"revenue_tie... 