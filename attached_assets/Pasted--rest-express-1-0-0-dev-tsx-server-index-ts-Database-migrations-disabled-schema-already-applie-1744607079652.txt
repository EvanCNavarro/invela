> rest-express@1.0.0 dev
> tsx server/index.ts

Database migrations disabled - schema already applied
[EmailService] Initializing email service
[EmailService] Email service initialized successfully
[Auth] Setting up authentication...
[Auth] Authentication setup completed
[Routes] Routes setup completed
[WebSocket] Server initialized on path: /ws
5:03:00 AM [info] Setting up Vite development server
5:03:00 AM [express] Server running on port 5000
[Auth] Unauthenticated user session
[2025-04-14T05:03:18.334Z] New client connected to the pool (1/3)
[Auth] Deserializing user: 210
[2025-04-14T05:03:18.670Z] New client connected to the pool (2/3)
[Auth] Using cached user data: 210
[2025-04-14T05:03:19.392Z] New client connected to the pool (3/3)
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
5:03:22 AM [vite] hmr update /src/components/forms/SectionContent.tsx, /src/index.css?v=a5AdlAB2hNA3y29bQml_W
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Returning user session data
New WebSocket client connected
[Task Templates API] Fetching template for task type: company_kyb, user: 210
[Task Templates API] Found template: 1 (KYB Form) for task type: company_kyb
[Task Templates API] Retrieved 9 configuration items for template ID: 1
5:03:26 AM [info] GET /api/task-templates/by-type/company_kyb 304 in 90ms :: {"id":1,"name":"KYB Form","description":"Know Your Business form for company ...
[KYB API DIAGNOSTIC] Starting field fetch
[KYB API DIAGNOSTIC] Schema check passed: kyb_fields table exists
[KYB API DIAGNOSTIC] Field count: 30
[KYB API DIAGNOSTIC] Fields fetched successfully: {
  count: 30,
  fieldKeys: [
    'legalEntityName',
    'registrationNumber',
    'incorporationDate',
    'businessType',
    'jurisdiction',
    'registeredAddress',
    'companyPhone',
    'contactEmail',
    'directorsAndOfficers',
    'ultimateBeneficialOwners',
    'authorizedSigners',
    'governmentOwnership',
    'priorNames',
    'externalAudit',
    'controlEnvironment',
    'corporateRegistration',
    'goodStanding',
    'licenses',
    'annualRecurringRevenue',
    'monthlyRecurringRevenue',
    'marketCapitalization',
    'lifetimeCustomerValue',
    'financialStatements',
    'operationalPolicies',
    'dataVolume',
    'dataTypes',
    'sanctionsCheck',
    'dueDiligence',
    'investigationsIncidents',
    'regulatoryActions'
  ],
  groups: [
    'companyProfile',
    'governanceLeadership',
    'financialProfile',
    'operationsCompliance'
  ],
  sampleField: {
    id: 1,
    key: 'legalEntityName',
    type: 'TEXT',
    group: 'companyProfile'
  }
}
5:03:26 AM [info] GET /api/kyb/fields 304 in 123ms :: {"fields":[{"id":1,"field_key":"legalEntityName","display_name":"Legal Entity...
WebSocket client disconnected with code 1001 and reason: 
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
5:03:37 AM [vite] hmr update /src/components/forms/SectionContent.tsx, /src/index.css?v=a5AdlAB2hNA3y29bQml_W (x2)
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Returning user session data
New WebSocket client connected
5:03:45 AM [vite] hmr update /src/components/forms/field-renderers/FieldRenderer.tsx, /src/index.css?v=a5AdlAB2hNA3y29bQml_W
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Task Templates API] Fetching template for task type: company_kyb, user: 210
[Task Templates API] Found template: 1 (KYB Form) for task type: company_kyb
[Task Templates API] Retrieved 9 configuration items for template ID: 1
5:04:02 AM [info] GET /api/task-templates/by-type/company_kyb 304 in 92ms :: {"id":1,"name":"KYB Form","description":"Know Your Business form for company ...
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
5:04:04 AM [vite] hmr update /src/components/forms/UniversalForm.tsx, /src/index.css?v=a5AdlAB2hNA3y29bQml_W
[KYB API DIAGNOSTIC] Starting field fetch
[KYB API DIAGNOSTIC] Schema check passed: kyb_fields table exists
[KYB API DIAGNOSTIC] Field count: 30
[KYB API DIAGNOSTIC] Fields fetched successfully: {
  count: 30,
  fieldKeys: [
    'legalEntityName',
    'registrationNumber',
    'incorporationDate',
    'businessType',
    'jurisdiction',
    'registeredAddress',
    'companyPhone',
    'contactEmail',
    'directorsAndOfficers',
    'ultimateBeneficialOwners',
    'authorizedSigners',
    'governmentOwnership',
    'priorNames',
    'externalAudit',
    'controlEnvironment',
    'corporateRegistration',
    'goodStanding',
    'licenses',
    'annualRecurringRevenue',
    'monthlyRecurringRevenue',
    'marketCapitalization',
    'lifetimeCustomerValue',
    'financialStatements',
    'operationalPolicies',
    'dataVolume',
    'dataTypes',
    'sanctionsCheck',
    'dueDiligence',
    'investigationsIncidents',
    'regulatoryActions'
  ],
  groups: [
    'companyProfile',
    'governanceLeadership',
    'financialProfile',
    'operationsCompliance'
  ],
  sampleField: {
    id: 1,
    key: 'legalEntityName',
    type: 'TEXT',
    group: 'companyProfile'
  }
}
5:04:04 AM [info] GET /api/kyb/fields 304 in 134ms :: {"fields":[{"id":1,"field_key":"legalEntityName","display_name":"Legal Entity...
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Returning user session data
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 210, company_id: 169, email: 'e.vancnavarr.o@gmail.com' }
[Current Company] Fetching company for user: { userId: 210, companyId: 169 }
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 210',
    condition2: 'tasks.created_by = 210',
    condition3: "tasks.company_id = 169 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('e.vancnavarr.o@gmail.com')"
  }
}
[Current Company] Found company: {
  id: 169,
  name: 'DevelopmentTesting',
  onboardingCompleted: false,
  riskScore: null
}
[Tasks] Tasks found: { count: 4 }
5:04:05 AM [info] GET /api/companies/current 304 in 61ms :: {"id":169,"name":"DevelopmentTesting","description":"FinTech partner company ...
5:04:05 AM [info] GET /api/tasks 200 in 97ms :: [{"id":347,"title":"New User Invitation: e.vancnavarr.o@gmail.com","descripti...
5:04:05 AM [info] GET /api/tasks 304 in 30ms :: [{"id":347,"title":"New User Invitation: e.vancnavarr.o@gmail.com","descripti...
New WebSocket client connected
New WebSocket client connected
[Task Templates API] Fetching template for task type: company_kyb, user: 210
[Task Templates API] Found template: 1 (KYB Form) for task type: company_kyb
[Task Templates API] Retrieved 9 configuration items for template ID: 1
5:04:08 AM [info] GET /api/task-templates/by-type/company_kyb 304 in 88ms :: {"id":1,"name":"KYB Form","description":"Know Your Business form for company ...
5:04:10 AM [info] GET /api/tasks 304 in 34ms :: [{"id":347,"title":"New User Invitation: e.vancnavarr.o@gmail.com","descripti...
WebSocket client disconnected with code 1001 and reason: 
[Auth] Using cached user data: 210
[Auth] Unauthenticated user session
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
5:04:17 AM [info] GET /api/tasks 304 in 39ms :: [{"id":347,"title":"New User Invitation: e.vancnavarr.o@gmail.com","descripti...
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Returning user session data
New WebSocket client connected
5:04:22 AM [info] GET /api/tasks 304 in 30ms :: [{"id":347,"title":"New User Invitation: e.vancnavarr.o@gmail.com","descripti...
[Task Templates API] Fetching template for task type: company_kyb, user: 210
[Task Templates API] Found template: 1 (KYB Form) for task type: company_kyb
[Task Templates API] Retrieved 9 configuration items for template ID: 1
5:04:23 AM [info] GET /api/task-templates/by-type/company_kyb 304 in 89ms :: {"id":1,"name":"KYB Form","description":"Know Your Business form for company ...
[KYB API DIAGNOSTIC] Starting field fetch
[KYB API DIAGNOSTIC] Schema check passed: kyb_fields table exists
[KYB API DIAGNOSTIC] Field count: 30
[KYB API DIAGNOSTIC] Fields fetched successfully: {
  count: 30,
  fieldKeys: [
    'legalEntityName',
    'registrationNumber',
    'incorporationDate',
    'businessType',
    'jurisdiction',
    'registeredAddress',
    'companyPhone',
    'contactEmail',
    'directorsAndOfficers',
    'ultimateBeneficialOwners',
    'authorizedSigners',
    'governmentOwnership',
    'priorNames',
    'externalAudit',
    'controlEnvironment',
    'corporateRegistration',
    'goodStanding',
    'licenses',
    'annualRecurringRevenue',
    'monthlyRecurringRevenue',
    'marketCapitalization',
    'lifetimeCustomerValue',
    'financialStatements',
    'operationalPolicies',
    'dataVolume',
    'dataTypes',
    'sanctionsCheck',
    'dueDiligence',
    'investigationsIncidents',
    'regulatoryActions'
  ],
  groups: [
    'companyProfile',
    'governanceLeadership',
    'financialProfile',
    'operationsCompliance'
  ],
  sampleField: {
    id: 1,
    key: 'legalEntityName',
    type: 'TEXT',
    group: 'companyProfile'
  }
}
5:04:23 AM [info] GET /api/kyb/fields 304 in 119ms :: {"fields":[{"id":1,"field_key":"legalEntityName","display_name":"Legal Entity...
5:04:28 AM [info] GET /api/tasks 304 in 30ms :: [{"id":347,"title":"New User Invitation: e.vancnavarr.o@gmail.com","descripti...
5:04:33 AM [info] GET /api/tasks 304 in 30ms :: [{"id":347,"title":"New User Invitation: e.vancnavarr.o@gmail.com","descripti...