> rest-express@1.0.0 dev
> tsx server/index.ts

Database migrations disabled - schema already applied
[EmailService] Initializing email service
[EmailService] Email service initialized successfully
[OpenAI] Service initialized with API key: API key is set
Database module not found, creating a mock implementation
Database module not found, creating a mock implementation
Database module not found, creating a mock implementation
[Auth] Setting up authentication...
[Auth] Authentication setup completed
[2025-05-04T11:07:15.017Z] [INFO] [KY3P-BATCH-UPDATE] Registering KY3P batch update routes 
[2025-05-04T11:07:15.018Z] [INFO] Registering KY3P batch update routes 
[2025-05-04T11:07:15.018Z] [INFO] [UnifiedKY3P] Registering unified KY3P update routes 
[2025-05-04T11:07:15.018Z] [INFO] Registering KY3P field update routes 
[2025-05-04T11:07:15.019Z] [INFO] [OpenBankingRoutes] Setting up routes... 
[Routes] Setting up unified form submission router
[Routes] Successfully registered unified form submission router
[Routes] Setting up transactional form submission router
[Routes] Successfully registered transactional form submission router
[Routes] Routes setup completed
[INFO] Unified WebSocket server initialized successfully with details: {
  clients: 0,
  path: '/ws',
  id: '5es7oc',
  timestamp: '2025-05-04T11:07:15.022Z'
}
11:07:15 AM [info] [ServerStartup] WebSocket server initialized with unified implementation
[2025-05-04T11:07:15.043Z] [INFO] [TaskWebSocket] WebSocket server registered with unified implementation 
11:07:15 AM [info] [ServerStartup] WebSocket server registered with task-update utility
[TaskBroadcast] WebSocket server reference set up
[TaskBroadcast] WebSocket server active with 0 connected clients
11:07:15 AM [info] [ServerStartup] WebSocket server registered with task-broadcast utility
11:07:15 AM [info] Setting up Vite development server
11:07:15 AM [express] Server running on 0.0.0.0:5000
11:07:15 AM [express] Environment: development
[Deployment] Server running on 0.0.0.0:5000
[Deployment] Environment: development
[Deployment] Port forwarding: Custom port: 5000
[Deployment] Development mode: Hot reloading enabled
11:07:15 AM [express] Starting periodic task reconciliation system...
[PeriodicTaskReconciliation] Stopped periodic reconciliation system
[PeriodicTaskReconciliation] Starting periodic reconciliation system (interval: 300000ms)
11:07:15 AM [express] Task reconciliation system initialized successfully
11:07:16 AM [info] [ServerStartup] WebSocket server active with 0 connected clients
[INFO] [WebSocket] Client connected: client-1746356836457-d9ajg2g
[INFO] [WebSocket] Client connected: client-1746356837212-tqoyzdj
[INFO] [WebSocket] Client disconnected: client-1746356836457-d9ajg2g
[INFO] [WebSocket] Client disconnected: client-1746356837212-tqoyzdj
[INFO] [WebSocket] Client connected: client-1746356847561-ra668ao
[Auth] Unauthenticated user session
[INFO] [WebSocket] Client connected: client-1746356847615-jcxzowy
[INFO] [WebSocket] Received message from client client-1746356847561-ra668ao: {
  type: 'authenticate',
  data: { timestamp: '2025-05-04T11:07:27.653Z' }
}
[INFO] [WebSocket] Authentication from client client-1746356847561-ra668ao: { userId: undefined, companyId: undefined, hasToken: false }
[INFO] [WebSocket] Client disconnected: client-1746356847615-jcxzowy
[INFO] [WebSocket] Client disconnected: client-1746356847561-ra668ao
[INFO] [WebSocket] Client connected: client-1746356850866-97n9zgs
[Auth] Unauthenticated user session
[INFO] [WebSocket] Client connected: client-1746356850920-jvpf804
[Auth] Unauthenticated user session
[INFO] [WebSocket] Received message from client client-1746356850866-97n9zgs: {
  type: 'authenticate',
  data: { timestamp: '2025-05-04T11:07:30.882Z' }
}
[INFO] [WebSocket] Authentication from client client-1746356850866-97n9zgs: { userId: undefined, companyId: undefined, hasToken: false }
[INFO] [WebSocket] Client disconnected: client-1746356850920-jvpf804
[INFO] [WebSocket] Client connected: client-1746356851288-jrllm6k
[INFO] [WebSocket] Client connected: client-1746356851303-igxw2d8
[INFO] [WebSocket] Client disconnected: client-1746356851303-igxw2d8
[INFO] [WebSocket] Client disconnected: client-1746356851288-jrllm6k
[INFO] [WebSocket] Client disconnected: client-1746356850866-97n9zgs
[2025-05-04T11:07:45.171Z] New client connected to the pool (1/3)
[PeriodicTaskReconciliation] Reconciling batch of 10 tasks: [
  683, 685, 679, 691,
  697, 699, 705, 702,
  703, 701
]
[Task Progress] Calculated progress for task 683 (open_banking): 0/44 = 0%
[Task Progress] Calculated progress for task 685 (company_kyb): 30/30 = 100%
[Task Progress] Calculated progress for task 679 (open_banking): 44/44 = 100%
[Task Progress] Calculated progress for task 691 (open_banking): 0/44 = 0%
[Task Progress] Calculated progress for task 697 (company_kyb): 30/30 = 100%
[Task Progress] Calculated progress for task 699 (open_banking): 0/44 = 0%
[Task Progress] Calculated progress for task 705 (company_kyb): 30/30 = 100%
[Task Progress] Calculated progress for task 702 (ky3p): 0/120 = 0%
[Task Progress] Calculated progress for task 703 (open_banking): 0/44 = 0%
[Task Progress] Calculated progress for task 701 (company_kyb): 30/30 = 100%
[2025-05-04T11:07:53.207Z] New client connected to the pool (2/3)
[2025-05-04T11:07:53.239Z] New client connected to the pool (3/3)
[Auth] Returning user session data
[Current Company] Fetching company for user: { userId: 310, companyId: 267 }
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 310, company_id: 267, email: '12@e.com' }
[2025-05-04T11:08:01.448Z] [INFO] Performing dynamic task unlocking check for company {"companyId":267,"userId":310}
[Current Company] Found company: {
  id: 267,
  name: 'DevTest12',
  onboardingCompleted: false,
  riskScore: null,
  chosenScore: null,
  isDemo: true
}
[2025-05-04T11:08:01.479Z] [INFO] No completed KYB tasks found, skipping security task unlock check {"companyId":267}
[Tasks] Automatically unlocking all tasks for company { userId: 310, companyId: 267, requestedBy: 'automatic_task_unlock' }
[2025-05-04T11:08:01.480Z] [INFO] [TaskDependencies] Unlocking ALL tasks for company {"companyId":267}
[2025-05-04T11:08:01.512Z] [INFO] [TaskDependencies] Found tasks to unlock {"companyId":267,"count":2,"taskIds":[738,740],"taskTypes":["company_kyb","open_banking"]}
11:08:01 AM [info] GET /api/companies/current 304 in 66ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Client connected: client-1746356881557-37hvh3e
[Task Progress] Calculated progress for task 738 (company_kyb): 30/30 = 100%
[2025-05-04T11:08:01.573Z] [INFO] [TaskDependencies] Calculated actual progress from database {"taskId":738,"taskType":"company_kyb","storedProgress":100,"calculatedProgress":100}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 100,
  currentStatus: 'ready_for_submission',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-05-04T11:08:01.573Z'
}
[STATUS DETERMINATION] Task has 100% progress but is not submitted, setting to READY_FOR_SUBMISSION
[2025-05-04T11:08:01.574Z] [INFO] [TaskDependencies] Determining correct status for task {"taskId":738,"progress":100,"currentStatus":"ready_for_submission","newStatus":"ready_for_submission"}
[2025-05-04T11:08:01.605Z] [INFO] [TaskDependencies] Unlocked task {"companyId":267,"taskId":738,"taskType":"company_kyb","progress":100,"status":"ready_for_submission"}
[2025-05-04T11:08:01.605Z] [DEBUG] Broadcasting task update with object format {"taskId":738,"status":"ready_for_submission"}
[2025-05-04T11:08:01.606Z] [INFO] Successfully retrieved unified WebSocket server for broadcast 
[WebSocket] Broadcast task_update to 1 clients (0 errors) { messageId: 'msg_1746356881606_ohlec4hnm' }
[2025-05-04T11:08:01.606Z] [INFO] Successfully broadcasted task_update message 
[Task Progress] Calculated progress for task 740 (open_banking): 0/44 = 0%
[2025-05-04T11:08:01.666Z] [INFO] [TaskDependencies] Calculated actual progress from database {"taskId":740,"taskType":"open_banking","storedProgress":0,"calculatedProgress":0}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-05-04T11:08:01.666Z'
}
[STATUS DETERMINATION] Task has 0% progress, setting to NOT_STARTED
[2025-05-04T11:08:01.667Z] [INFO] [TaskDependencies] Determining correct status for task {"taskId":740,"progress":0,"currentStatus":"not_started","newStatus":"not_started"}
[INFO] [WebSocket] Received message from client client-1746356881557-37hvh3e: {
  type: 'authenticate',
  data: { timestamp: '2025-05-04T11:08:01.505Z' }
}
[INFO] [WebSocket] Authentication from client client-1746356881557-37hvh3e: { userId: undefined, companyId: undefined, hasToken: true }
[2025-05-04T11:08:01.698Z] [INFO] [TaskDependencies] Unlocked task {"companyId":267,"taskId":740,"taskType":"open_banking","progress":0,"status":"not_started"}
[2025-05-04T11:08:01.698Z] [DEBUG] Broadcasting task update with object format {"taskId":740,"status":"not_started"}
[WebSocket] Broadcast task_update to 1 clients (0 errors) { messageId: 'msg_1746356881698_bdpofe2pa' }
[2025-05-04T11:08:01.699Z] [INFO] Successfully broadcasted task_update message 
[2025-05-04T11:08:01.699Z] [INFO] [TaskDependencies] Successfully unlocked all tasks {"companyId":267,"count":2}
[Tasks] Successfully unlocked all tasks for company: 267
11:08:01 AM [info] GET /api/companies/current 304 in 38ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 310',
    condition2: 'tasks.created_by = 310',
    condition3: "tasks.company_id = 267 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('12@e.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
11:08:01 AM [info] GET /api/tasks 200 in 348ms :: [{"id":737,"title":"New User Invitation: 12@e.com","description":"Complete us...
11:08:01 AM [info] GET /api/tasks 304 in 32ms :: [{"id":737,"title":"New User Invitation: 12@e.com","description":"Complete us...
[INFO] [WebSocket] Client connected: client-1746356882049-8ck8b11
[INFO] [WebSocket] Client connected: client-1746356882544-hpxvhr8
[INFO] [WebSocket] Received message from client client-1746356882544-hpxvhr8: {
  type: 'authenticate',
  userId: null,
  companyId: null,
  clientId: 'ws_1746356880996_ka2lq8ku6',
  timestamp: '2025-05-04T11:08:02.487Z'
}
[INFO] [WebSocket] Authentication from client client-1746356882544-hpxvhr8: { userId: null, companyId: null, hasToken: true }
11:08:04 AM [info] GET /api/companies/current 304 in 32ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:08:07 AM [info] GET /api/companies/current 304 in 34ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:08:10 AM [info] GET /api/companies/current 304 in 33ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:08:13 AM [info] GET /api/companies/current 304 in 37ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:08:16 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:08:16 AM [info] GET /api/tasks 304 in 30ms :: [{"id":737,"title":"New User Invitation: 12@e.com","description":"Complete us...
11:08:19 AM [info] GET /api/companies/current 304 in 32ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746356882049-8ck8b11: {
  type: 'ping',
  timestamp: '2025-05-04T11:08:21.994Z',
  connectionId: 'ws_1746356881043_t9jsffp9x'
}
11:08:22 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:08:25 AM [info] GET /api/companies/current 304 in 33ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:08:28 AM [info] GET /api/companies/current 304 in 33ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746356881557-37hvh3e: { type: 'ping' }
11:08:31 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 310, company_id: 267, email: '12@e.com' }
[2025-05-04T11:08:32.140Z] [INFO] Performing dynamic task unlocking check for company {"companyId":267,"userId":310}
[2025-05-04T11:08:32.171Z] [INFO] No completed KYB tasks found, skipping security task unlock check {"companyId":267}
[Tasks] Automatically unlocking all tasks for company { userId: 310, companyId: 267, requestedBy: 'automatic_task_unlock' }
[2025-05-04T11:08:32.172Z] [INFO] [TaskDependencies] Unlocking ALL tasks for company {"companyId":267}
[2025-05-04T11:08:32.201Z] [INFO] [TaskDependencies] Found tasks to unlock {"companyId":267,"count":2,"taskIds":[740,738],"taskTypes":["open_banking","company_kyb"]}
[Task Progress] Calculated progress for task 740 (open_banking): 0/44 = 0%
[2025-05-04T11:08:32.261Z] [INFO] [TaskDependencies] Calculated actual progress from database {"taskId":740,"taskType":"open_banking","storedProgress":0,"calculatedProgress":0}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-05-04T11:08:32.261Z'
}
[STATUS DETERMINATION] Task has 0% progress, setting to NOT_STARTED
[2025-05-04T11:08:32.261Z] [INFO] [TaskDependencies] Determining correct status for task {"taskId":740,"progress":0,"currentStatus":"not_started","newStatus":"not_started"}
[2025-05-04T11:08:32.292Z] [INFO] [TaskDependencies] Unlocked task {"companyId":267,"taskId":740,"taskType":"open_banking","progress":0,"status":"not_started"}
[2025-05-04T11:08:32.292Z] [DEBUG] Broadcasting task update with object format {"taskId":740,"status":"not_started"}
[WebSocket] Broadcast task_update to 3 clients (0 errors) { messageId: 'msg_1746356912293_x394xazyi' }
[2025-05-04T11:08:32.293Z] [INFO] Successfully broadcasted task_update message 
[Task Progress] Calculated progress for task 738 (company_kyb): 30/30 = 100%
[2025-05-04T11:08:32.352Z] [INFO] [TaskDependencies] Calculated actual progress from database {"taskId":738,"taskType":"company_kyb","storedProgress":100,"calculatedProgress":100}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 100,
  currentStatus: 'ready_for_submission',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-05-04T11:08:32.352Z'
}
[STATUS DETERMINATION] Task has 100% progress but is not submitted, setting to READY_FOR_SUBMISSION
[2025-05-04T11:08:32.352Z] [INFO] [TaskDependencies] Determining correct status for task {"taskId":738,"progress":100,"currentStatus":"ready_for_submission","newStatus":"ready_for_submission"}
[2025-05-04T11:08:32.384Z] [INFO] [TaskDependencies] Unlocked task {"companyId":267,"taskId":738,"taskType":"company_kyb","progress":100,"status":"ready_for_submission"}
[2025-05-04T11:08:32.384Z] [DEBUG] Broadcasting task update with object format {"taskId":738,"status":"ready_for_submission"}
[WebSocket] Broadcast task_update to 3 clients (0 errors) { messageId: 'msg_1746356912384_27dn015aq' }
[2025-05-04T11:08:32.384Z] [INFO] Successfully broadcasted task_update message 
[2025-05-04T11:08:32.385Z] [INFO] [TaskDependencies] Successfully unlocked all tasks {"companyId":267,"count":2}
[Tasks] Successfully unlocked all tasks for company: 267
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 310',
    condition2: 'tasks.created_by = 310',
    condition3: "tasks.company_id = 267 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('12@e.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
11:08:32 AM [info] GET /api/tasks 200 in 338ms :: [{"id":737,"title":"New User Invitation: 12@e.com","description":"Complete us...
11:08:34 AM [info] GET /api/companies/current 304 in 32ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:08:37 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:08:40 AM [info] GET /api/companies/current 304 in 32ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746356882049-8ck8b11: {
  type: 'ping',
  timestamp: '2025-05-04T11:08:41.993Z',
  connectionId: 'ws_1746356881043_t9jsffp9x'
}
11:08:43 AM [info] GET /api/companies/current 304 in 32ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:08:46 AM [info] GET /api/companies/current 304 in 32ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:08:47 AM [info] GET /api/tasks 304 in 31ms :: [{"id":737,"title":"New User Invitation: 12@e.com","description":"Complete us...
11:08:49 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:08:52 AM [info] GET /api/companies/current 304 in 46ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:08:55 AM [info] GET /api/companies/current 304 in 32ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Client disconnected: client-1746356881557-37hvh3e
[INFO] [WebSocket] Client disconnected: client-1746356882049-8ck8b11
[INFO] [WebSocket] Client disconnected: client-1746356882544-hpxvhr8
[INFO] [WebSocket] Client connected: client-1746356937714-5pyn1qb
[Auth] Unauthenticated user session
[INFO] [WebSocket] Client connected: client-1746356937749-0zetun0
[INFO] [WebSocket] Received message from client client-1746356937714-5pyn1qb: {
  type: 'authenticate',
  data: { timestamp: '2025-05-04T11:08:57.770Z' }
}
[INFO] [WebSocket] Authentication from client client-1746356937714-5pyn1qb: { userId: undefined, companyId: undefined, hasToken: false }
[INFO] [WebSocket] Client disconnected: client-1746356937714-5pyn1qb
[INFO] [WebSocket] Client disconnected: client-1746356937749-0zetun0
[Auth] Returning user session data
[Current Company] Fetching company for user: { userId: 310, companyId: 267 }
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 310, company_id: 267, email: '12@e.com' }
[2025-05-04T11:09:06.108Z] [INFO] Performing dynamic task unlocking check for company {"companyId":267,"userId":310}
[2025-05-04T11:09:06.139Z] [INFO] No completed KYB tasks found, skipping security task unlock check {"companyId":267}
[Tasks] Automatically unlocking all tasks for company { userId: 310, companyId: 267, requestedBy: 'automatic_task_unlock' }
[Current Company] Found company: {
  id: 267,
  name: 'DevTest12',
  onboardingCompleted: false,
  riskScore: null,
  chosenScore: null,
  isDemo: true
}
[2025-05-04T11:09:06.140Z] [INFO] [TaskDependencies] Unlocking ALL tasks for company {"companyId":267}
11:09:06 AM [info] GET /api/companies/current 304 in 72ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-04T11:09:06.179Z] [INFO] [TaskDependencies] Found tasks to unlock {"companyId":267,"count":2,"taskIds":[738,740],"taskTypes":["company_kyb","open_banking"]}
[INFO] [WebSocket] Client connected: client-1746356946231-tbkr5y5
[Task Progress] Calculated progress for task 738 (company_kyb): 30/30 = 100%
[2025-05-04T11:09:06.242Z] [INFO] [TaskDependencies] Calculated actual progress from database {"taskId":738,"taskType":"company_kyb","storedProgress":100,"calculatedProgress":100}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 100,
  currentStatus: 'ready_for_submission',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-05-04T11:09:06.242Z'
}
[STATUS DETERMINATION] Task has 100% progress but is not submitted, setting to READY_FOR_SUBMISSION
[2025-05-04T11:09:06.242Z] [INFO] [TaskDependencies] Determining correct status for task {"taskId":738,"progress":100,"currentStatus":"ready_for_submission","newStatus":"ready_for_submission"}
[2025-05-04T11:09:06.272Z] [INFO] [TaskDependencies] Unlocked task {"companyId":267,"taskId":738,"taskType":"company_kyb","progress":100,"status":"ready_for_submission"}
[2025-05-04T11:09:06.272Z] [DEBUG] Broadcasting task update with object format {"taskId":738,"status":"ready_for_submission"}
[WebSocket] Broadcast task_update to 1 clients (0 errors) { messageId: 'msg_1746356946272_s199o92y0' }
[2025-05-04T11:09:06.272Z] [INFO] Successfully broadcasted task_update message 
[Task Progress] Calculated progress for task 740 (open_banking): 0/44 = 0%
[2025-05-04T11:09:06.335Z] [INFO] [TaskDependencies] Calculated actual progress from database {"taskId":740,"taskType":"open_banking","storedProgress":0,"calculatedProgress":0}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-05-04T11:09:06.335Z'
}
[STATUS DETERMINATION] Task has 0% progress, setting to NOT_STARTED
[2025-05-04T11:09:06.335Z] [INFO] [TaskDependencies] Determining correct status for task {"taskId":740,"progress":0,"currentStatus":"not_started","newStatus":"not_started"}
[INFO] [WebSocket] Received message from client client-1746356946231-tbkr5y5: {
  type: 'authenticate',
  data: { timestamp: '2025-05-04T11:09:06.173Z' }
}
[INFO] [WebSocket] Authentication from client client-1746356946231-tbkr5y5: { userId: undefined, companyId: undefined, hasToken: true }
[2025-05-04T11:09:06.367Z] [INFO] [TaskDependencies] Unlocked task {"companyId":267,"taskId":740,"taskType":"open_banking","progress":0,"status":"not_started"}
[2025-05-04T11:09:06.367Z] [DEBUG] Broadcasting task update with object format {"taskId":740,"status":"not_started"}
[WebSocket] Broadcast task_update to 1 clients (0 errors) { messageId: 'msg_1746356946367_ci0z2up1q' }
[2025-05-04T11:09:06.367Z] [INFO] Successfully broadcasted task_update message 
[2025-05-04T11:09:06.367Z] [INFO] [TaskDependencies] Successfully unlocked all tasks {"companyId":267,"count":2}
[Tasks] Successfully unlocked all tasks for company: 267
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 310',
    condition2: 'tasks.created_by = 310',
    condition3: "tasks.company_id = 267 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('12@e.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
11:09:06 AM [info] GET /api/tasks 200 in 351ms :: [{"id":737,"title":"New User Invitation: 12@e.com","description":"Complete us...
11:09:06 AM [info] GET /api/tasks 304 in 31ms :: [{"id":737,"title":"New User Invitation: 12@e.com","description":"Complete us...
[INFO] [WebSocket] Client connected: client-1746356946720-zw5jy18
[INFO] [WebSocket] Client connected: client-1746356947211-oe6chag
[INFO] [WebSocket] Received message from client client-1746356947211-oe6chag: {
  type: 'authenticate',
  userId: null,
  companyId: null,
  clientId: 'ws_1746356945669_3l75grzxg',
  timestamp: '2025-05-04T11:09:07.155Z'
}
[INFO] [WebSocket] Authentication from client client-1746356947211-oe6chag: { userId: null, companyId: null, hasToken: true }
11:09:09 AM [info] GET /api/companies/current 304 in 32ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:09:12 AM [info] GET /api/companies/current 304 in 32ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:09:15 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:09:18 AM [info] GET /api/companies/current 304 in 32ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:09:21 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:09:21 AM [info] GET /api/tasks 304 in 31ms :: [{"id":737,"title":"New User Invitation: 12@e.com","description":"Complete us...
11:09:24 AM [info] GET /api/companies/current 304 in 32ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746356946720-zw5jy18: {
  type: 'ping',
  timestamp: '2025-05-04T11:09:26.674Z',
  connectionId: 'ws_1746356945704_29y0aivfe'
}
11:09:27 AM [info] GET /api/companies/current 304 in 30ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:09:30 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:09:33 AM [info] GET /api/companies/current 304 in 33ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746356946231-tbkr5y5: { type: 'ping' }
11:09:36 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 310, company_id: 267, email: '12@e.com' }
[2025-05-04T11:09:36.804Z] [INFO] Performing dynamic task unlocking check for company {"companyId":267,"userId":310}
[2025-05-04T11:09:36.837Z] [INFO] No completed KYB tasks found, skipping security task unlock check {"companyId":267}
[Tasks] Automatically unlocking all tasks for company { userId: 310, companyId: 267, requestedBy: 'automatic_task_unlock' }
[2025-05-04T11:09:36.838Z] [INFO] [TaskDependencies] Unlocking ALL tasks for company {"companyId":267}
[2025-05-04T11:09:36.869Z] [INFO] [TaskDependencies] Found tasks to unlock {"companyId":267,"count":2,"taskIds":[740,738],"taskTypes":["open_banking","company_kyb"]}
[Task Progress] Calculated progress for task 740 (open_banking): 0/44 = 0%
[2025-05-04T11:09:36.936Z] [INFO] [TaskDependencies] Calculated actual progress from database {"taskId":740,"taskType":"open_banking","storedProgress":0,"calculatedProgress":0}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-05-04T11:09:36.936Z'
}
[STATUS DETERMINATION] Task has 0% progress, setting to NOT_STARTED
[2025-05-04T11:09:36.936Z] [INFO] [TaskDependencies] Determining correct status for task {"taskId":740,"progress":0,"currentStatus":"not_started","newStatus":"not_started"}
[2025-05-04T11:09:36.968Z] [INFO] [TaskDependencies] Unlocked task {"companyId":267,"taskId":740,"taskType":"open_banking","progress":0,"status":"not_started"}
[2025-05-04T11:09:36.969Z] [DEBUG] Broadcasting task update with object format {"taskId":740,"status":"not_started"}
[WebSocket] Broadcast task_update to 3 clients (0 errors) { messageId: 'msg_1746356976969_fv9j6ok22' }
[2025-05-04T11:09:36.969Z] [INFO] Successfully broadcasted task_update message 
[Task Progress] Calculated progress for task 738 (company_kyb): 30/30 = 100%
[2025-05-04T11:09:37.031Z] [INFO] [TaskDependencies] Calculated actual progress from database {"taskId":738,"taskType":"company_kyb","storedProgress":100,"calculatedProgress":100}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 100,
  currentStatus: 'ready_for_submission',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-05-04T11:09:37.031Z'
}
[STATUS DETERMINATION] Task has 100% progress but is not submitted, setting to READY_FOR_SUBMISSION
[2025-05-04T11:09:37.031Z] [INFO] [TaskDependencies] Determining correct status for task {"taskId":738,"progress":100,"currentStatus":"ready_for_submission","newStatus":"ready_for_submission"}
[2025-05-04T11:09:37.063Z] [INFO] [TaskDependencies] Unlocked task {"companyId":267,"taskId":738,"taskType":"company_kyb","progress":100,"status":"ready_for_submission"}
[2025-05-04T11:09:37.063Z] [DEBUG] Broadcasting task update with object format {"taskId":738,"status":"ready_for_submission"}
[WebSocket] Broadcast task_update to 3 clients (0 errors) { messageId: 'msg_1746356977063_vyq4tqqga' }
[2025-05-04T11:09:37.064Z] [INFO] Successfully broadcasted task_update message 
[2025-05-04T11:09:37.064Z] [INFO] [TaskDependencies] Successfully unlocked all tasks {"companyId":267,"count":2}
[Tasks] Successfully unlocked all tasks for company: 267
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 310',
    condition2: 'tasks.created_by = 310',
    condition3: "tasks.company_id = 267 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('12@e.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
11:09:37 AM [info] GET /api/tasks 200 in 363ms :: [{"id":737,"title":"New User Invitation: 12@e.com","description":"Complete us...
11:09:39 AM [info] GET /api/companies/current 304 in 34ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:09:42 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:09:45 AM [info] GET /api/companies/current 304 in 32ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746356946720-zw5jy18: {
  type: 'ping',
  timestamp: '2025-05-04T11:09:46.694Z',
  connectionId: 'ws_1746356945704_29y0aivfe'
}
11:09:48 AM [info] GET /api/companies/current 304 in 34ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:09:51 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:09:52 AM [info] GET /api/tasks 304 in 31ms :: [{"id":737,"title":"New User Invitation: 12@e.com","description":"Complete us...
11:09:54 AM [info] GET /api/companies/current 304 in 33ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:09:57 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:10:00 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:10:03 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[Current Company] Fetching company for user: { userId: 310, companyId: 267 }
[INFO] [WebSocket] Received message from client client-1746356946231-tbkr5y5: { type: 'ping' }
[Current Company] Found company: {
  id: 267,
  name: 'DevTest12',
  onboardingCompleted: false,
  riskScore: null,
  chosenScore: null,
  isDemo: true
}
11:10:06 AM [info] GET /api/companies/current 304 in 65ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746356946720-zw5jy18: {
  type: 'ping',
  timestamp: '2025-05-04T11:10:06.700Z',
  connectionId: 'ws_1746356945704_29y0aivfe'
}
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 310, company_id: 267, email: '12@e.com' }
[2025-05-04T11:10:07.517Z] [INFO] Performing dynamic task unlocking check for company {"companyId":267,"userId":310}
[2025-05-04T11:10:07.547Z] [INFO] No completed KYB tasks found, skipping security task unlock check {"companyId":267}
[Tasks] Automatically unlocking all tasks for company { userId: 310, companyId: 267, requestedBy: 'automatic_task_unlock' }
[2025-05-04T11:10:07.548Z] [INFO] [TaskDependencies] Unlocking ALL tasks for company {"companyId":267}
[2025-05-04T11:10:07.578Z] [INFO] [TaskDependencies] Found tasks to unlock {"companyId":267,"count":2,"taskIds":[738,740],"taskTypes":["company_kyb","open_banking"]}
[Task Progress] Calculated progress for task 738 (company_kyb): 30/30 = 100%
[2025-05-04T11:10:07.639Z] [INFO] [TaskDependencies] Calculated actual progress from database {"taskId":738,"taskType":"company_kyb","storedProgress":100,"calculatedProgress":100}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 100,
  currentStatus: 'ready_for_submission',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-05-04T11:10:07.639Z'
}
[STATUS DETERMINATION] Task has 100% progress but is not submitted, setting to READY_FOR_SUBMISSION
[2025-05-04T11:10:07.639Z] [INFO] [TaskDependencies] Determining correct status for task {"taskId":738,"progress":100,"currentStatus":"ready_for_submission","newStatus":"ready_for_submission"}
[2025-05-04T11:10:07.670Z] [INFO] [TaskDependencies] Unlocked task {"companyId":267,"taskId":738,"taskType":"company_kyb","progress":100,"status":"ready_for_submission"}
[2025-05-04T11:10:07.670Z] [DEBUG] Broadcasting task update with object format {"taskId":738,"status":"ready_for_submission"}
[WebSocket] Broadcast task_update to 3 clients (0 errors) { messageId: 'msg_1746357007670_c5b80a23q' }
[2025-05-04T11:10:07.670Z] [INFO] Successfully broadcasted task_update message 
[Task Progress] Calculated progress for task 740 (open_banking): 0/44 = 0%
[2025-05-04T11:10:07.730Z] [INFO] [TaskDependencies] Calculated actual progress from database {"taskId":740,"taskType":"open_banking","storedProgress":0,"calculatedProgress":0}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-05-04T11:10:07.730Z'
}
[STATUS DETERMINATION] Task has 0% progress, setting to NOT_STARTED
[2025-05-04T11:10:07.730Z] [INFO] [TaskDependencies] Determining correct status for task {"taskId":740,"progress":0,"currentStatus":"not_started","newStatus":"not_started"}
[2025-05-04T11:10:07.761Z] [INFO] [TaskDependencies] Unlocked task {"companyId":267,"taskId":740,"taskType":"open_banking","progress":0,"status":"not_started"}
[2025-05-04T11:10:07.761Z] [DEBUG] Broadcasting task update with object format {"taskId":740,"status":"not_started"}
[WebSocket] Broadcast task_update to 3 clients (0 errors) { messageId: 'msg_1746357007761_x5xzdmwtu' }
[2025-05-04T11:10:07.761Z] [INFO] Successfully broadcasted task_update message 
[2025-05-04T11:10:07.761Z] [INFO] [TaskDependencies] Successfully unlocked all tasks {"companyId":267,"count":2}
[Tasks] Successfully unlocked all tasks for company: 267
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 310',
    condition2: 'tasks.created_by = 310',
    condition3: "tasks.company_id = 267 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('12@e.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
11:10:07 AM [info] GET /api/tasks 200 in 338ms :: [{"id":737,"title":"New User Invitation: 12@e.com","description":"Complete us...
11:10:09 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:10:12 AM [info] GET /api/companies/current 304 in 32ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:10:15 AM [info] GET /api/companies/current 304 in 40ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:10:18 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:10:21 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:10:23 AM [info] GET /api/tasks 304 in 32ms :: [{"id":737,"title":"New User Invitation: 12@e.com","description":"Complete us...
11:10:24 AM [info] GET /api/companies/current 304 in 32ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746356946720-zw5jy18: {
  type: 'ping',
  timestamp: '2025-05-04T11:10:26.701Z',
  connectionId: 'ws_1746356945704_29y0aivfe'
}
11:10:27 AM [info] GET /api/companies/current 304 in 36ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:10:30 AM [info] GET /api/companies/current 304 in 119ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:10:33 AM [info] GET /api/companies/current 304 in 32ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746356946231-tbkr5y5: { type: 'ping' }
11:10:36 AM [info] GET /api/companies/current 304 in 30ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 310, company_id: 267, email: '12@e.com' }
[2025-05-04T11:10:38.211Z] [INFO] Performing dynamic task unlocking check for company {"companyId":267,"userId":310}
[2025-05-04T11:10:38.241Z] [INFO] No completed KYB tasks found, skipping security task unlock check {"companyId":267}
[Tasks] Automatically unlocking all tasks for company { userId: 310, companyId: 267, requestedBy: 'automatic_task_unlock' }
[2025-05-04T11:10:38.241Z] [INFO] [TaskDependencies] Unlocking ALL tasks for company {"companyId":267}
[2025-05-04T11:10:38.273Z] [INFO] [TaskDependencies] Found tasks to unlock {"companyId":267,"count":2,"taskIds":[740,738],"taskTypes":["open_banking","company_kyb"]}
[Task Progress] Calculated progress for task 740 (open_banking): 0/44 = 0%
[2025-05-04T11:10:38.334Z] [INFO] [TaskDependencies] Calculated actual progress from database {"taskId":740,"taskType":"open_banking","storedProgress":0,"calculatedProgress":0}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-05-04T11:10:38.334Z'
}
[STATUS DETERMINATION] Task has 0% progress, setting to NOT_STARTED
[2025-05-04T11:10:38.334Z] [INFO] [TaskDependencies] Determining correct status for task {"taskId":740,"progress":0,"currentStatus":"not_started","newStatus":"not_started"}
[2025-05-04T11:10:38.365Z] [INFO] [TaskDependencies] Unlocked task {"companyId":267,"taskId":740,"taskType":"open_banking","progress":0,"status":"not_started"}
[2025-05-04T11:10:38.366Z] [DEBUG] Broadcasting task update with object format {"taskId":740,"status":"not_started"}
[WebSocket] Broadcast task_update to 3 clients (0 errors) { messageId: 'msg_1746357038366_uadkz18om' }
[2025-05-04T11:10:38.366Z] [INFO] Successfully broadcasted task_update message 
[Task Progress] Calculated progress for task 738 (company_kyb): 30/30 = 100%
[2025-05-04T11:10:38.426Z] [INFO] [TaskDependencies] Calculated actual progress from database {"taskId":738,"taskType":"company_kyb","storedProgress":100,"calculatedProgress":100}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 100,
  currentStatus: 'ready_for_submission',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-05-04T11:10:38.426Z'
}
[STATUS DETERMINATION] Task has 100% progress but is not submitted, setting to READY_FOR_SUBMISSION
[2025-05-04T11:10:38.426Z] [INFO] [TaskDependencies] Determining correct status for task {"taskId":738,"progress":100,"currentStatus":"ready_for_submission","newStatus":"ready_for_submission"}
[2025-05-04T11:10:38.457Z] [INFO] [TaskDependencies] Unlocked task {"companyId":267,"taskId":738,"taskType":"company_kyb","progress":100,"status":"ready_for_submission"}
[2025-05-04T11:10:38.457Z] [DEBUG] Broadcasting task update with object format {"taskId":738,"status":"ready_for_submission"}
[WebSocket] Broadcast task_update to 3 clients (0 errors) { messageId: 'msg_1746357038457_m43n6yoh0' }
[2025-05-04T11:10:38.457Z] [INFO] Successfully broadcasted task_update message 
[2025-05-04T11:10:38.457Z] [INFO] [TaskDependencies] Successfully unlocked all tasks {"companyId":267,"count":2}
[Tasks] Successfully unlocked all tasks for company: 267
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 310',
    condition2: 'tasks.created_by = 310',
    condition3: "tasks.company_id = 267 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('12@e.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
11:10:38 AM [info] GET /api/tasks 200 in 348ms :: [{"id":737,"title":"New User Invitation: 12@e.com","description":"Complete us...
11:10:39 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:10:42 AM [info] GET /api/companies/current 304 in 32ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:10:45 AM [info] GET /api/companies/current 304 in 32ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746356946720-zw5jy18: {
  type: 'ping',
  timestamp: '2025-05-04T11:10:46.703Z',
  connectionId: 'ws_1746356945704_29y0aivfe'
}
11:10:48 AM [info] GET /api/companies/current 304 in 39ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:10:51 AM [info] GET /api/companies/current 304 in 35ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Client connected: client-1746357051765-syawtgd
[INFO] [WebSocket] Received message from client client-1746357051765-syawtgd: {
  type: 'authenticate',
  data: { timestamp: '2025-05-04T11:10:51.727Z' }
}
[INFO] [WebSocket] Authentication from client client-1746357051765-syawtgd: { userId: undefined, companyId: undefined, hasToken: false }
[INFO] [WebSocket] Client connected: client-1746357052214-kpm1dz5
11:10:53 AM [info] GET /api/tasks 304 in 31ms :: [{"id":737,"title":"New User Invitation: 12@e.com","description":"Complete us...
11:10:54 AM [info] GET /api/companies/current 304 in 35ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:10:57 AM [info] GET /api/companies/current 304 in 36ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:11:00 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:11:03 AM [info] GET /api/companies/current 304 in 43ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[Current Company] Fetching company for user: { userId: 310, companyId: 267 }
[INFO] [WebSocket] Received message from client client-1746356946231-tbkr5y5: { type: 'ping' }
[Current Company] Found company: {
  id: 267,
  name: 'DevTest12',
  onboardingCompleted: false,
  riskScore: null,
  chosenScore: null,
  isDemo: true
}
11:11:06 AM [info] GET /api/companies/current 304 in 62ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746356946720-zw5jy18: {
  type: 'ping',
  timestamp: '2025-05-04T11:11:06.703Z',
  connectionId: 'ws_1746356945704_29y0aivfe'
}
[INFO] [WebSocket] Received message from client client-1746356947211-oe6chag: { type: 'ping' }
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 310, company_id: 267, email: '12@e.com' }
[2025-05-04T11:11:08.930Z] [INFO] Performing dynamic task unlocking check for company {"companyId":267,"userId":310}
[2025-05-04T11:11:08.960Z] [INFO] No completed KYB tasks found, skipping security task unlock check {"companyId":267}
[Tasks] Automatically unlocking all tasks for company { userId: 310, companyId: 267, requestedBy: 'automatic_task_unlock' }
[2025-05-04T11:11:08.960Z] [INFO] [TaskDependencies] Unlocking ALL tasks for company {"companyId":267}
[2025-05-04T11:11:08.990Z] [INFO] [TaskDependencies] Found tasks to unlock {"companyId":267,"count":2,"taskIds":[738,740],"taskTypes":["company_kyb","open_banking"]}
[Task Progress] Calculated progress for task 738 (company_kyb): 30/30 = 100%
[2025-05-04T11:11:09.050Z] [INFO] [TaskDependencies] Calculated actual progress from database {"taskId":738,"taskType":"company_kyb","storedProgress":100,"calculatedProgress":100}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 100,
  currentStatus: 'ready_for_submission',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-05-04T11:11:09.050Z'
}
[STATUS DETERMINATION] Task has 100% progress but is not submitted, setting to READY_FOR_SUBMISSION
[2025-05-04T11:11:09.050Z] [INFO] [TaskDependencies] Determining correct status for task {"taskId":738,"progress":100,"currentStatus":"ready_for_submission","newStatus":"ready_for_submission"}
[2025-05-04T11:11:09.082Z] [INFO] [TaskDependencies] Unlocked task {"companyId":267,"taskId":738,"taskType":"company_kyb","progress":100,"status":"ready_for_submission"}
[2025-05-04T11:11:09.082Z] [DEBUG] Broadcasting task update with object format {"taskId":738,"status":"ready_for_submission"}
[WebSocket] Broadcast task_update to 5 clients (0 errors) { messageId: 'msg_1746357069082_7u9shp9bk' }
[2025-05-04T11:11:09.082Z] [INFO] Successfully broadcasted task_update message 
[Task Progress] Calculated progress for task 740 (open_banking): 0/44 = 0%
[2025-05-04T11:11:09.141Z] [INFO] [TaskDependencies] Calculated actual progress from database {"taskId":740,"taskType":"open_banking","storedProgress":0,"calculatedProgress":0}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-05-04T11:11:09.142Z'
}
[STATUS DETERMINATION] Task has 0% progress, setting to NOT_STARTED
[2025-05-04T11:11:09.142Z] [INFO] [TaskDependencies] Determining correct status for task {"taskId":740,"progress":0,"currentStatus":"not_started","newStatus":"not_started"}
[2025-05-04T11:11:09.173Z] [INFO] [TaskDependencies] Unlocked task {"companyId":267,"taskId":740,"taskType":"open_banking","progress":0,"status":"not_started"}
[2025-05-04T11:11:09.173Z] [DEBUG] Broadcasting task update with object format {"taskId":740,"status":"not_started"}
[WebSocket] Broadcast task_update to 5 clients (0 errors) { messageId: 'msg_1746357069173_6wo9or06g' }
[2025-05-04T11:11:09.174Z] [INFO] Successfully broadcasted task_update message 
[2025-05-04T11:11:09.174Z] [INFO] [TaskDependencies] Successfully unlocked all tasks {"companyId":267,"count":2}
[Tasks] Successfully unlocked all tasks for company: 267
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 310',
    condition2: 'tasks.created_by = 310',
    condition3: "tasks.company_id = 267 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('12@e.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
11:11:09 AM [info] GET /api/tasks 200 in 344ms :: [{"id":737,"title":"New User Invitation: 12@e.com","description":"Complete us...
11:11:09 AM [info] GET /api/companies/current 304 in 36ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746357052214-kpm1dz5: {
  type: 'ping',
  timestamp: '2025-05-04T11:11:12.178Z',
  connectionId: 'ws_1746357051672_hms1rw4yd'
}
11:11:12 AM [info] GET /api/companies/current 304 in 32ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:11:15 AM [info] GET /api/companies/current 304 in 32ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:11:18 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:11:21 AM [info] GET /api/companies/current 304 in 33ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746357051765-syawtgd: { type: 'ping' }
11:11:24 AM [info] GET /api/companies/current 304 in 32ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:11:24 AM [info] GET /api/tasks 304 in 31ms :: [{"id":737,"title":"New User Invitation: 12@e.com","description":"Complete us...
[INFO] [WebSocket] Received message from client client-1746356946720-zw5jy18: {
  type: 'ping',
  timestamp: '2025-05-04T11:11:26.703Z',
  connectionId: 'ws_1746356945704_29y0aivfe'
}
11:11:27 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:11:30 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746357052214-kpm1dz5: {
  type: 'ping',
  timestamp: '2025-05-04T11:11:32.178Z',
  connectionId: 'ws_1746357051672_hms1rw4yd'
}
11:11:33 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746356946231-tbkr5y5: { type: 'ping' }
11:11:36 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:11:39 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 310, company_id: 267, email: '12@e.com' }
[2025-05-04T11:11:39.628Z] [INFO] Performing dynamic task unlocking check for company {"companyId":267,"userId":310}
[2025-05-04T11:11:39.659Z] [INFO] No completed KYB tasks found, skipping security task unlock check {"companyId":267}
[Tasks] Automatically unlocking all tasks for company { userId: 310, companyId: 267, requestedBy: 'automatic_task_unlock' }
[2025-05-04T11:11:39.660Z] [INFO] [TaskDependencies] Unlocking ALL tasks for company {"companyId":267}
[2025-05-04T11:11:39.691Z] [INFO] [TaskDependencies] Found tasks to unlock {"companyId":267,"count":2,"taskIds":[740,738],"taskTypes":["open_banking","company_kyb"]}
[Task Progress] Calculated progress for task 740 (open_banking): 0/44 = 0%
[2025-05-04T11:11:39.752Z] [INFO] [TaskDependencies] Calculated actual progress from database {"taskId":740,"taskType":"open_banking","storedProgress":0,"calculatedProgress":0}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-05-04T11:11:39.752Z'
}
[STATUS DETERMINATION] Task has 0% progress, setting to NOT_STARTED
[2025-05-04T11:11:39.752Z] [INFO] [TaskDependencies] Determining correct status for task {"taskId":740,"progress":0,"currentStatus":"not_started","newStatus":"not_started"}
[2025-05-04T11:11:39.783Z] [INFO] [TaskDependencies] Unlocked task {"companyId":267,"taskId":740,"taskType":"open_banking","progress":0,"status":"not_started"}
[2025-05-04T11:11:39.783Z] [DEBUG] Broadcasting task update with object format {"taskId":740,"status":"not_started"}
[WebSocket] Broadcast task_update to 5 clients (0 errors) { messageId: 'msg_1746357099783_mnnqwjri4' }
[2025-05-04T11:11:39.783Z] [INFO] Successfully broadcasted task_update message 
[Task Progress] Calculated progress for task 738 (company_kyb): 30/30 = 100%
[2025-05-04T11:11:39.850Z] [INFO] [TaskDependencies] Calculated actual progress from database {"taskId":738,"taskType":"company_kyb","storedProgress":100,"calculatedProgress":100}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 100,
  currentStatus: 'ready_for_submission',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-05-04T11:11:39.850Z'
}
[STATUS DETERMINATION] Task has 100% progress but is not submitted, setting to READY_FOR_SUBMISSION
[2025-05-04T11:11:39.851Z] [INFO] [TaskDependencies] Determining correct status for task {"taskId":738,"progress":100,"currentStatus":"ready_for_submission","newStatus":"ready_for_submission"}
[2025-05-04T11:11:39.882Z] [INFO] [TaskDependencies] Unlocked task {"companyId":267,"taskId":738,"taskType":"company_kyb","progress":100,"status":"ready_for_submission"}
[2025-05-04T11:11:39.882Z] [DEBUG] Broadcasting task update with object format {"taskId":738,"status":"ready_for_submission"}
[WebSocket] Broadcast task_update to 5 clients (0 errors) { messageId: 'msg_1746357099882_yo0tagy5d' }
[2025-05-04T11:11:39.882Z] [INFO] Successfully broadcasted task_update message 
[2025-05-04T11:11:39.882Z] [INFO] [TaskDependencies] Successfully unlocked all tasks {"companyId":267,"count":2}
[Tasks] Successfully unlocked all tasks for company: 267
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 310',
    condition2: 'tasks.created_by = 310',
    condition3: "tasks.company_id = 267 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('12@e.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
11:11:39 AM [info] GET /api/tasks 200 in 347ms :: [{"id":737,"title":"New User Invitation: 12@e.com","description":"Complete us...
11:11:42 AM [info] GET /api/companies/current 304 in 32ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:11:45 AM [info] GET /api/companies/current 304 in 32ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746356946720-zw5jy18: {
  type: 'ping',
  timestamp: '2025-05-04T11:11:46.703Z',
  connectionId: 'ws_1746356945704_29y0aivfe'
}
11:11:48 AM [info] GET /api/companies/current 304 in 32ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:11:51 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746357051765-syawtgd: { type: 'ping' }
[INFO] [WebSocket] Received message from client client-1746357052214-kpm1dz5: {
  type: 'ping',
  timestamp: '2025-05-04T11:11:52.179Z',
  connectionId: 'ws_1746357051672_hms1rw4yd'
}
[Current Company] Using cached company data: 267
11:11:54 AM [info] GET /api/companies/current 304 in 32ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:11:55 AM [info] GET /api/tasks 304 in 31ms :: [{"id":737,"title":"New User Invitation: 12@e.com","description":"Complete us...
11:11:57 AM [info] GET /api/companies/current 304 in 34ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:12:00 AM [info] GET /api/companies/current 304 in 33ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:12:03 AM [info] GET /api/companies/current 304 in 36ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746356946231-tbkr5y5: { type: 'ping' }
11:12:06 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746356946720-zw5jy18: {
  type: 'ping',
  timestamp: '2025-05-04T11:12:06.704Z',
  connectionId: 'ws_1746356945704_29y0aivfe'
}
[Current Company] Fetching company for user: { userId: 310, companyId: 267 }
[Current Company] Found company: {
  id: 267,
  name: 'DevTest12',
  onboardingCompleted: false,
  riskScore: null,
  chosenScore: null,
  isDemo: true
}
11:12:09 AM [info] GET /api/companies/current 304 in 67ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 310, company_id: 267, email: '12@e.com' }
[2025-05-04T11:12:10.330Z] [INFO] Performing dynamic task unlocking check for company {"companyId":267,"userId":310}
[2025-05-04T11:12:10.363Z] [INFO] No completed KYB tasks found, skipping security task unlock check {"companyId":267}
[Tasks] Automatically unlocking all tasks for company { userId: 310, companyId: 267, requestedBy: 'automatic_task_unlock' }
[2025-05-04T11:12:10.364Z] [INFO] [TaskDependencies] Unlocking ALL tasks for company {"companyId":267}
[2025-05-04T11:12:10.398Z] [INFO] [TaskDependencies] Found tasks to unlock {"companyId":267,"count":2,"taskIds":[738,740],"taskTypes":["company_kyb","open_banking"]}
[Task Progress] Calculated progress for task 738 (company_kyb): 30/30 = 100%
[2025-05-04T11:12:10.460Z] [INFO] [TaskDependencies] Calculated actual progress from database {"taskId":738,"taskType":"company_kyb","storedProgress":100,"calculatedProgress":100}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 100,
  currentStatus: 'ready_for_submission',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-05-04T11:12:10.460Z'
}
[STATUS DETERMINATION] Task has 100% progress but is not submitted, setting to READY_FOR_SUBMISSION
[2025-05-04T11:12:10.460Z] [INFO] [TaskDependencies] Determining correct status for task {"taskId":738,"progress":100,"currentStatus":"ready_for_submission","newStatus":"ready_for_submission"}
[2025-05-04T11:12:10.492Z] [INFO] [TaskDependencies] Unlocked task {"companyId":267,"taskId":738,"taskType":"company_kyb","progress":100,"status":"ready_for_submission"}
[2025-05-04T11:12:10.492Z] [DEBUG] Broadcasting task update with object format {"taskId":738,"status":"ready_for_submission"}
[WebSocket] Broadcast task_update to 5 clients (0 errors) { messageId: 'msg_1746357130492_rni0ojqq3' }
[2025-05-04T11:12:10.493Z] [INFO] Successfully broadcasted task_update message 
[Task Progress] Calculated progress for task 740 (open_banking): 0/44 = 0%
[2025-05-04T11:12:10.557Z] [INFO] [TaskDependencies] Calculated actual progress from database {"taskId":740,"taskType":"open_banking","storedProgress":0,"calculatedProgress":0}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-05-04T11:12:10.557Z'
}
[STATUS DETERMINATION] Task has 0% progress, setting to NOT_STARTED
[2025-05-04T11:12:10.557Z] [INFO] [TaskDependencies] Determining correct status for task {"taskId":740,"progress":0,"currentStatus":"not_started","newStatus":"not_started"}
[2025-05-04T11:12:10.588Z] [INFO] [TaskDependencies] Unlocked task {"companyId":267,"taskId":740,"taskType":"open_banking","progress":0,"status":"not_started"}
[2025-05-04T11:12:10.588Z] [DEBUG] Broadcasting task update with object format {"taskId":740,"status":"not_started"}
[WebSocket] Broadcast task_update to 5 clients (0 errors) { messageId: 'msg_1746357130588_4e7e46v3n' }
[2025-05-04T11:12:10.589Z] [INFO] Successfully broadcasted task_update message 
[2025-05-04T11:12:10.589Z] [INFO] [TaskDependencies] Successfully unlocked all tasks {"companyId":267,"count":2}
[Tasks] Successfully unlocked all tasks for company: 267
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 310',
    condition2: 'tasks.created_by = 310',
    condition3: "tasks.company_id = 267 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('12@e.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
11:12:10 AM [info] GET /api/tasks 200 in 357ms :: [{"id":737,"title":"New User Invitation: 12@e.com","description":"Complete us...
[INFO] [WebSocket] Received message from client client-1746357052214-kpm1dz5: {
  type: 'ping',
  timestamp: '2025-05-04T11:12:12.179Z',
  connectionId: 'ws_1746357051672_hms1rw4yd'
}
11:12:12 AM [info] GET /api/companies/current 304 in 33ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[PeriodicTaskReconciliation] Reconciling batch of 10 tasks: [
  683, 685, 679, 699,
  691, 697, 702, 703,
  701, 705
]
[Task Progress] Calculated progress for task 683 (open_banking): 0/44 = 0%
[Task Progress] Calculated progress for task 685 (company_kyb): 30/30 = 100%
Suppressing further connection logs. Pool size: 3
[Task Progress] Calculated progress for task 679 (open_banking): 44/44 = 100%
11:12:15 AM [info] GET /api/companies/current 304 in 34ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[Task Progress] Calculated progress for task 699 (open_banking): 0/44 = 0%
[Task Progress] Calculated progress for task 691 (open_banking): 0/44 = 0%
[Task Progress] Calculated progress for task 697 (company_kyb): 30/30 = 100%
[Task Progress] Calculated progress for task 702 (ky3p): 0/120 = 0%
[Task Progress] Calculated progress for task 703 (open_banking): 0/44 = 0%
[Task Progress] Calculated progress for task 701 (company_kyb): 30/30 = 100%
[Task Progress] Calculated progress for task 705 (company_kyb): 30/30 = 100%
11:12:18 AM [info] GET /api/companies/current 304 in 35ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:12:21 AM [info] GET /api/companies/current 304 in 35ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746357051765-syawtgd: { type: 'ping' }
11:12:24 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:12:25 AM [info] GET /api/tasks 304 in 31ms :: [{"id":737,"title":"New User Invitation: 12@e.com","description":"Complete us...
[INFO] [WebSocket] Received message from client client-1746356946720-zw5jy18: {
  type: 'ping',
  timestamp: '2025-05-04T11:12:26.704Z',
  connectionId: 'ws_1746356945704_29y0aivfe'
}
11:12:27 AM [info] GET /api/companies/current 304 in 38ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:12:30 AM [info] GET /api/companies/current 304 in 33ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746357052214-kpm1dz5: {
  type: 'ping',
  timestamp: '2025-05-04T11:12:32.180Z',
  connectionId: 'ws_1746357051672_hms1rw4yd'
}
11:12:33 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746356946231-tbkr5y5: { type: 'ping' }
11:12:36 AM [info] GET /api/companies/current 304 in 33ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:12:39 AM [info] GET /api/companies/current 304 in 32ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 310, company_id: 267, email: '12@e.com' }
[2025-05-04T11:12:41.039Z] [INFO] Performing dynamic task unlocking check for company {"companyId":267,"userId":310}
[2025-05-04T11:12:41.070Z] [INFO] No completed KYB tasks found, skipping security task unlock check {"companyId":267}
[Tasks] Automatically unlocking all tasks for company { userId: 310, companyId: 267, requestedBy: 'automatic_task_unlock' }
[2025-05-04T11:12:41.071Z] [INFO] [TaskDependencies] Unlocking ALL tasks for company {"companyId":267}
[2025-05-04T11:12:41.103Z] [INFO] [TaskDependencies] Found tasks to unlock {"companyId":267,"count":2,"taskIds":[740,738],"taskTypes":["open_banking","company_kyb"]}
[Task Progress] Calculated progress for task 740 (open_banking): 0/44 = 0%
[2025-05-04T11:12:41.163Z] [INFO] [TaskDependencies] Calculated actual progress from database {"taskId":740,"taskType":"open_banking","storedProgress":0,"calculatedProgress":0}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-05-04T11:12:41.163Z'
}
[STATUS DETERMINATION] Task has 0% progress, setting to NOT_STARTED
[2025-05-04T11:12:41.163Z] [INFO] [TaskDependencies] Determining correct status for task {"taskId":740,"progress":0,"currentStatus":"not_started","newStatus":"not_started"}
[2025-05-04T11:12:41.193Z] [INFO] [TaskDependencies] Unlocked task {"companyId":267,"taskId":740,"taskType":"open_banking","progress":0,"status":"not_started"}
[2025-05-04T11:12:41.194Z] [DEBUG] Broadcasting task update with object format {"taskId":740,"status":"not_started"}
[WebSocket] Broadcast task_update to 5 clients (0 errors) { messageId: 'msg_1746357161194_yqas7vs85' }
[2025-05-04T11:12:41.194Z] [INFO] Successfully broadcasted task_update message 
[Task Progress] Calculated progress for task 738 (company_kyb): 30/30 = 100%
[2025-05-04T11:12:41.254Z] [INFO] [TaskDependencies] Calculated actual progress from database {"taskId":738,"taskType":"company_kyb","storedProgress":100,"calculatedProgress":100}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 100,
  currentStatus: 'ready_for_submission',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-05-04T11:12:41.254Z'
}
[STATUS DETERMINATION] Task has 100% progress but is not submitted, setting to READY_FOR_SUBMISSION
[2025-05-04T11:12:41.254Z] [INFO] [TaskDependencies] Determining correct status for task {"taskId":738,"progress":100,"currentStatus":"ready_for_submission","newStatus":"ready_for_submission"}
[2025-05-04T11:12:41.294Z] [INFO] [TaskDependencies] Unlocked task {"companyId":267,"taskId":738,"taskType":"company_kyb","progress":100,"status":"ready_for_submission"}
[2025-05-04T11:12:41.294Z] [DEBUG] Broadcasting task update with object format {"taskId":738,"status":"ready_for_submission"}
[WebSocket] Broadcast task_update to 5 clients (0 errors) { messageId: 'msg_1746357161294_mp2indo97' }
[2025-05-04T11:12:41.294Z] [INFO] Successfully broadcasted task_update message 
[2025-05-04T11:12:41.294Z] [INFO] [TaskDependencies] Successfully unlocked all tasks {"companyId":267,"count":2}
[Tasks] Successfully unlocked all tasks for company: 267
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 310',
    condition2: 'tasks.created_by = 310',
    condition3: "tasks.company_id = 267 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('12@e.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
11:12:41 AM [info] GET /api/tasks 200 in 349ms :: [{"id":737,"title":"New User Invitation: 12@e.com","description":"Complete us...
11:12:42 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:12:45 AM [info] GET /api/companies/current 304 in 30ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746356946720-zw5jy18: {
  type: 'ping',
  timestamp: '2025-05-04T11:12:46.703Z',
  connectionId: 'ws_1746356945704_29y0aivfe'
}
[Current Company] Using cached company data: 267
11:12:48 AM [info] GET /api/companies/current 304 in 39ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:12:51 AM [info] GET /api/companies/current 304 in 32ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746357051765-syawtgd: { type: 'ping' }
[INFO] [WebSocket] Received message from client client-1746357052214-kpm1dz5: {
  type: 'ping',
  timestamp: '2025-05-04T11:12:52.180Z',
  connectionId: 'ws_1746357051672_hms1rw4yd'
}
11:12:54 AM [info] GET /api/companies/current 304 in 32ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:12:56 AM [info] GET /api/tasks 304 in 32ms :: [{"id":737,"title":"New User Invitation: 12@e.com","description":"Complete us...
11:12:57 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:13:00 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:13:03 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746356946231-tbkr5y5: { type: 'ping' }
11:13:06 AM [info] GET /api/companies/current 304 in 32ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746356946720-zw5jy18: {
  type: 'ping',
  timestamp: '2025-05-04T11:13:06.703Z',
  connectionId: 'ws_1746356945704_29y0aivfe'
}
[INFO] [WebSocket] Received message from client client-1746356947211-oe6chag: { type: 'ping' }
11:13:09 AM [info] GET /api/companies/current 304 in 33ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 310, company_id: 267, email: '12@e.com' }
[2025-05-04T11:13:11.749Z] [INFO] Performing dynamic task unlocking check for company {"companyId":267,"userId":310}
[2025-05-04T11:13:11.779Z] [INFO] No completed KYB tasks found, skipping security task unlock check {"companyId":267}
[Tasks] Automatically unlocking all tasks for company { userId: 310, companyId: 267, requestedBy: 'automatic_task_unlock' }
[2025-05-04T11:13:11.780Z] [INFO] [TaskDependencies] Unlocking ALL tasks for company {"companyId":267}
[2025-05-04T11:13:11.810Z] [INFO] [TaskDependencies] Found tasks to unlock {"companyId":267,"count":2,"taskIds":[738,740],"taskTypes":["company_kyb","open_banking"]}
[Task Progress] Calculated progress for task 738 (company_kyb): 30/30 = 100%
[2025-05-04T11:13:11.870Z] [INFO] [TaskDependencies] Calculated actual progress from database {"taskId":738,"taskType":"company_kyb","storedProgress":100,"calculatedProgress":100}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 100,
  currentStatus: 'ready_for_submission',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-05-04T11:13:11.870Z'
}
[STATUS DETERMINATION] Task has 100% progress but is not submitted, setting to READY_FOR_SUBMISSION
[2025-05-04T11:13:11.870Z] [INFO] [TaskDependencies] Determining correct status for task {"taskId":738,"progress":100,"currentStatus":"ready_for_submission","newStatus":"ready_for_submission"}
[2025-05-04T11:13:11.901Z] [INFO] [TaskDependencies] Unlocked task {"companyId":267,"taskId":738,"taskType":"company_kyb","progress":100,"status":"ready_for_submission"}
[2025-05-04T11:13:11.901Z] [DEBUG] Broadcasting task update with object format {"taskId":738,"status":"ready_for_submission"}
[WebSocket] Broadcast task_update to 5 clients (0 errors) { messageId: 'msg_1746357191901_n4yufqfwf' }
[2025-05-04T11:13:11.902Z] [INFO] Successfully broadcasted task_update message 
[Task Progress] Calculated progress for task 740 (open_banking): 0/44 = 0%
[2025-05-04T11:13:11.961Z] [INFO] [TaskDependencies] Calculated actual progress from database {"taskId":740,"taskType":"open_banking","storedProgress":0,"calculatedProgress":0}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-05-04T11:13:11.961Z'
}
[STATUS DETERMINATION] Task has 0% progress, setting to NOT_STARTED
[2025-05-04T11:13:11.961Z] [INFO] [TaskDependencies] Determining correct status for task {"taskId":740,"progress":0,"currentStatus":"not_started","newStatus":"not_started"}
[2025-05-04T11:13:11.991Z] [INFO] [TaskDependencies] Unlocked task {"companyId":267,"taskId":740,"taskType":"open_banking","progress":0,"status":"not_started"}
[2025-05-04T11:13:11.991Z] [DEBUG] Broadcasting task update with object format {"taskId":740,"status":"not_started"}
[WebSocket] Broadcast task_update to 5 clients (0 errors) { messageId: 'msg_1746357191991_tqp97ljc1' }
[2025-05-04T11:13:11.992Z] [INFO] Successfully broadcasted task_update message 
[2025-05-04T11:13:11.992Z] [INFO] [TaskDependencies] Successfully unlocked all tasks {"companyId":267,"count":2}
[Tasks] Successfully unlocked all tasks for company: 267
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 310',
    condition2: 'tasks.created_by = 310',
    condition3: "tasks.company_id = 267 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('12@e.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
11:13:12 AM [info] GET /api/tasks 200 in 334ms :: [{"id":737,"title":"New User Invitation: 12@e.com","description":"Complete us...
[Current Company] Fetching company for user: { userId: 310, companyId: 267 }
[INFO] [WebSocket] Received message from client client-1746357052214-kpm1dz5: {
  type: 'ping',
  timestamp: '2025-05-04T11:13:12.180Z',
  connectionId: 'ws_1746357051672_hms1rw4yd'
}
[Current Company] Found company: {
  id: 267,
  name: 'DevTest12',
  onboardingCompleted: false,
  riskScore: null,
  chosenScore: null,
  isDemo: true
}
11:13:12 AM [info] GET /api/companies/current 304 in 61ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:13:15 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[Current Company] Using cached company data: 267
11:13:18 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:13:21 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746357051765-syawtgd: { type: 'ping' }
11:13:24 AM [info] GET /api/companies/current 304 in 32ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746356946720-zw5jy18: {
  type: 'ping',
  timestamp: '2025-05-04T11:13:26.704Z',
  connectionId: 'ws_1746356945704_29y0aivfe'
}
11:13:27 AM [info] GET /api/tasks 304 in 33ms :: [{"id":737,"title":"New User Invitation: 12@e.com","description":"Complete us...
11:13:27 AM [info] GET /api/companies/current 304 in 32ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:13:30 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746357052214-kpm1dz5: {
  type: 'ping',
  timestamp: '2025-05-04T11:13:32.181Z',
  connectionId: 'ws_1746357051672_hms1rw4yd'
}
11:13:33 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746356946231-tbkr5y5: { type: 'ping' }
11:13:36 AM [info] GET /api/companies/current 304 in 32ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:13:39 AM [info] GET /api/companies/current 304 in 32ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:13:42 AM [info] GET /api/companies/current 304 in 41ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 310, company_id: 267, email: '12@e.com' }
[2025-05-04T11:13:42.443Z] [INFO] Performing dynamic task unlocking check for company {"companyId":267,"userId":310}
[2025-05-04T11:13:42.473Z] [INFO] No completed KYB tasks found, skipping security task unlock check {"companyId":267}
[Tasks] Automatically unlocking all tasks for company { userId: 310, companyId: 267, requestedBy: 'automatic_task_unlock' }
[2025-05-04T11:13:42.474Z] [INFO] [TaskDependencies] Unlocking ALL tasks for company {"companyId":267}
[2025-05-04T11:13:42.513Z] [INFO] [TaskDependencies] Found tasks to unlock {"companyId":267,"count":2,"taskIds":[740,738],"taskTypes":["open_banking","company_kyb"]}
[Task Progress] Calculated progress for task 740 (open_banking): 0/44 = 0%
[2025-05-04T11:13:42.592Z] [INFO] [TaskDependencies] Calculated actual progress from database {"taskId":740,"taskType":"open_banking","storedProgress":0,"calculatedProgress":0}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-05-04T11:13:42.592Z'
}
[STATUS DETERMINATION] Task has 0% progress, setting to NOT_STARTED
[2025-05-04T11:13:42.592Z] [INFO] [TaskDependencies] Determining correct status for task {"taskId":740,"progress":0,"currentStatus":"not_started","newStatus":"not_started"}
[2025-05-04T11:13:42.627Z] [INFO] [TaskDependencies] Unlocked task {"companyId":267,"taskId":740,"taskType":"open_banking","progress":0,"status":"not_started"}
[2025-05-04T11:13:42.627Z] [DEBUG] Broadcasting task update with object format {"taskId":740,"status":"not_started"}
[WebSocket] Broadcast task_update to 5 clients (0 errors) { messageId: 'msg_1746357222627_pajj6cwkv' }
[2025-05-04T11:13:42.627Z] [INFO] Successfully broadcasted task_update message 
[Task Progress] Calculated progress for task 738 (company_kyb): 30/30 = 100%
[2025-05-04T11:13:42.699Z] [INFO] [TaskDependencies] Calculated actual progress from database {"taskId":738,"taskType":"company_kyb","storedProgress":100,"calculatedProgress":100}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 100,
  currentStatus: 'ready_for_submission',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-05-04T11:13:42.699Z'
}
[STATUS DETERMINATION] Task has 100% progress but is not submitted, setting to READY_FOR_SUBMISSION
[2025-05-04T11:13:42.699Z] [INFO] [TaskDependencies] Determining correct status for task {"taskId":738,"progress":100,"currentStatus":"ready_for_submission","newStatus":"ready_for_submission"}
[2025-05-04T11:13:42.733Z] [INFO] [TaskDependencies] Unlocked task {"companyId":267,"taskId":738,"taskType":"company_kyb","progress":100,"status":"ready_for_submission"}
[2025-05-04T11:13:42.733Z] [DEBUG] Broadcasting task update with object format {"taskId":738,"status":"ready_for_submission"}
[WebSocket] Broadcast task_update to 5 clients (0 errors) { messageId: 'msg_1746357222733_p4s80vd55' }
[2025-05-04T11:13:42.733Z] [INFO] Successfully broadcasted task_update message 
[2025-05-04T11:13:42.733Z] [INFO] [TaskDependencies] Successfully unlocked all tasks {"companyId":267,"count":2}
[Tasks] Successfully unlocked all tasks for company: 267
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 310',
    condition2: 'tasks.created_by = 310',
    condition3: "tasks.company_id = 267 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('12@e.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
11:13:42 AM [info] GET /api/tasks 200 in 385ms :: [{"id":737,"title":"New User Invitation: 12@e.com","description":"Complete us...
11:13:45 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746356946720-zw5jy18: {
  type: 'ping',
  timestamp: '2025-05-04T11:13:46.703Z',
  connectionId: 'ws_1746356945704_29y0aivfe'
}
11:13:48 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:13:51 AM [info] GET /api/companies/current 304 in 30ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746357051765-syawtgd: { type: 'ping' }
[INFO] [WebSocket] Received message from client client-1746357052214-kpm1dz5: {
  type: 'ping',
  timestamp: '2025-05-04T11:13:52.181Z',
  connectionId: 'ws_1746357051672_hms1rw4yd'
}
11:13:54 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:13:57 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:13:58 AM [info] GET /api/tasks 304 in 32ms :: [{"id":737,"title":"New User Invitation: 12@e.com","description":"Complete us...
11:14:00 AM [info] GET /api/companies/current 304 in 30ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:14:03 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746356946231-tbkr5y5: { type: 'ping' }
11:14:06 AM [info] GET /api/companies/current 304 in 32ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746356946720-zw5jy18: {
  type: 'ping',
  timestamp: '2025-05-04T11:14:06.704Z',
  connectionId: 'ws_1746356945704_29y0aivfe'
}
11:14:09 AM [info] GET /api/companies/current 304 in 30ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[Current Company] Fetching company for user: { userId: 310, companyId: 267 }
[INFO] [WebSocket] Received message from client client-1746357052214-kpm1dz5: {
  type: 'ping',
  timestamp: '2025-05-04T11:14:12.181Z',
  connectionId: 'ws_1746357051672_hms1rw4yd'
}
[Current Company] Found company: {
  id: 267,
  name: 'DevTest12',
  onboardingCompleted: false,
  riskScore: null,
  chosenScore: null,
  isDemo: true
}
11:14:12 AM [info] GET /api/companies/current 304 in 63ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 310, company_id: 267, email: '12@e.com' }
[2025-05-04T11:14:13.188Z] [INFO] Performing dynamic task unlocking check for company {"companyId":267,"userId":310}
[2025-05-04T11:14:13.224Z] [INFO] No completed KYB tasks found, skipping security task unlock check {"companyId":267}
[Tasks] Automatically unlocking all tasks for company { userId: 310, companyId: 267, requestedBy: 'automatic_task_unlock' }
[2025-05-04T11:14:13.225Z] [INFO] [TaskDependencies] Unlocking ALL tasks for company {"companyId":267}
[2025-05-04T11:14:13.256Z] [INFO] [TaskDependencies] Found tasks to unlock {"companyId":267,"count":2,"taskIds":[738,740],"taskTypes":["company_kyb","open_banking"]}
[Task Progress] Calculated progress for task 738 (company_kyb): 30/30 = 100%
[2025-05-04T11:14:13.317Z] [INFO] [TaskDependencies] Calculated actual progress from database {"taskId":738,"taskType":"company_kyb","storedProgress":100,"calculatedProgress":100}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 100,
  currentStatus: 'ready_for_submission',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-05-04T11:14:13.317Z'
}
[STATUS DETERMINATION] Task has 100% progress but is not submitted, setting to READY_FOR_SUBMISSION
[2025-05-04T11:14:13.317Z] [INFO] [TaskDependencies] Determining correct status for task {"taskId":738,"progress":100,"currentStatus":"ready_for_submission","newStatus":"ready_for_submission"}
[2025-05-04T11:14:13.350Z] [INFO] [TaskDependencies] Unlocked task {"companyId":267,"taskId":738,"taskType":"company_kyb","progress":100,"status":"ready_for_submission"}
[2025-05-04T11:14:13.350Z] [DEBUG] Broadcasting task update with object format {"taskId":738,"status":"ready_for_submission"}
[WebSocket] Broadcast task_update to 5 clients (0 errors) { messageId: 'msg_1746357253351_rset235de' }
[2025-05-04T11:14:13.351Z] [INFO] Successfully broadcasted task_update message 
[Task Progress] Calculated progress for task 740 (open_banking): 0/44 = 0%
[2025-05-04T11:14:13.412Z] [INFO] [TaskDependencies] Calculated actual progress from database {"taskId":740,"taskType":"open_banking","storedProgress":0,"calculatedProgress":0}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-05-04T11:14:13.412Z'
}
[STATUS DETERMINATION] Task has 0% progress, setting to NOT_STARTED
[2025-05-04T11:14:13.412Z] [INFO] [TaskDependencies] Determining correct status for task {"taskId":740,"progress":0,"currentStatus":"not_started","newStatus":"not_started"}
[2025-05-04T11:14:13.443Z] [INFO] [TaskDependencies] Unlocked task {"companyId":267,"taskId":740,"taskType":"open_banking","progress":0,"status":"not_started"}
[2025-05-04T11:14:13.443Z] [DEBUG] Broadcasting task update with object format {"taskId":740,"status":"not_started"}
[WebSocket] Broadcast task_update to 5 clients (0 errors) { messageId: 'msg_1746357253443_ie0pm96lf' }
[2025-05-04T11:14:13.444Z] [INFO] Successfully broadcasted task_update message 
[2025-05-04T11:14:13.444Z] [INFO] [TaskDependencies] Successfully unlocked all tasks {"companyId":267,"count":2}
[Tasks] Successfully unlocked all tasks for company: 267
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 310',
    condition2: 'tasks.created_by = 310',
    condition3: "tasks.company_id = 267 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('12@e.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
11:14:13 AM [info] GET /api/tasks 200 in 348ms :: [{"id":737,"title":"New User Invitation: 12@e.com","description":"Complete us...
11:14:15 AM [info] GET /api/companies/current 304 in 34ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:14:18 AM [info] GET /api/companies/current 304 in 36ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:14:21 AM [info] GET /api/companies/current 304 in 35ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746357051765-syawtgd: { type: 'ping' }
11:14:24 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746356946720-zw5jy18: {
  type: 'ping',
  timestamp: '2025-05-04T11:14:26.704Z',
  connectionId: 'ws_1746356945704_29y0aivfe'
}
11:14:27 AM [info] GET /api/companies/current 304 in 32ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:14:28 AM [info] GET /api/tasks 304 in 33ms :: [{"id":737,"title":"New User Invitation: 12@e.com","description":"Complete us...
11:14:30 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746357052214-kpm1dz5: {
  type: 'ping',
  timestamp: '2025-05-04T11:14:32.182Z',
  connectionId: 'ws_1746357051672_hms1rw4yd'
}
11:14:33 AM [info] GET /api/companies/current 304 in 32ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746356946231-tbkr5y5: { type: 'ping' }
11:14:36 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:14:39 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:14:42 AM [info] GET /api/companies/current 304 in 32ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 310, company_id: 267, email: '12@e.com' }
[2025-05-04T11:14:43.909Z] [INFO] Performing dynamic task unlocking check for company {"companyId":267,"userId":310}
[2025-05-04T11:14:43.939Z] [INFO] No completed KYB tasks found, skipping security task unlock check {"companyId":267}
[Tasks] Automatically unlocking all tasks for company { userId: 310, companyId: 267, requestedBy: 'automatic_task_unlock' }
[2025-05-04T11:14:43.940Z] [INFO] [TaskDependencies] Unlocking ALL tasks for company {"companyId":267}
[2025-05-04T11:14:43.970Z] [INFO] [TaskDependencies] Found tasks to unlock {"companyId":267,"count":2,"taskIds":[740,738],"taskTypes":["open_banking","company_kyb"]}
[Task Progress] Calculated progress for task 740 (open_banking): 0/44 = 0%
[2025-05-04T11:14:44.034Z] [INFO] [TaskDependencies] Calculated actual progress from database {"taskId":740,"taskType":"open_banking","storedProgress":0,"calculatedProgress":0}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-05-04T11:14:44.034Z'
}
[STATUS DETERMINATION] Task has 0% progress, setting to NOT_STARTED
[2025-05-04T11:14:44.034Z] [INFO] [TaskDependencies] Determining correct status for task {"taskId":740,"progress":0,"currentStatus":"not_started","newStatus":"not_started"}
[2025-05-04T11:14:44.068Z] [INFO] [TaskDependencies] Unlocked task {"companyId":267,"taskId":740,"taskType":"open_banking","progress":0,"status":"not_started"}
[2025-05-04T11:14:44.068Z] [DEBUG] Broadcasting task update with object format {"taskId":740,"status":"not_started"}
[WebSocket] Broadcast task_update to 5 clients (0 errors) { messageId: 'msg_1746357284068_rrvc1y82n' }
[2025-05-04T11:14:44.068Z] [INFO] Successfully broadcasted task_update message 
[Task Progress] Calculated progress for task 738 (company_kyb): 30/30 = 100%
[2025-05-04T11:14:44.130Z] [INFO] [TaskDependencies] Calculated actual progress from database {"taskId":738,"taskType":"company_kyb","storedProgress":100,"calculatedProgress":100}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 100,
  currentStatus: 'ready_for_submission',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-05-04T11:14:44.130Z'
}
[STATUS DETERMINATION] Task has 100% progress but is not submitted, setting to READY_FOR_SUBMISSION
[2025-05-04T11:14:44.130Z] [INFO] [TaskDependencies] Determining correct status for task {"taskId":738,"progress":100,"currentStatus":"ready_for_submission","newStatus":"ready_for_submission"}
[2025-05-04T11:14:44.161Z] [INFO] [TaskDependencies] Unlocked task {"companyId":267,"taskId":738,"taskType":"company_kyb","progress":100,"status":"ready_for_submission"}
[2025-05-04T11:14:44.161Z] [DEBUG] Broadcasting task update with object format {"taskId":738,"status":"ready_for_submission"}
[WebSocket] Broadcast task_update to 5 clients (0 errors) { messageId: 'msg_1746357284161_za30ozwsy' }
[2025-05-04T11:14:44.161Z] [INFO] Successfully broadcasted task_update message 
[2025-05-04T11:14:44.162Z] [INFO] [TaskDependencies] Successfully unlocked all tasks {"companyId":267,"count":2}
[Tasks] Successfully unlocked all tasks for company: 267
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 310',
    condition2: 'tasks.created_by = 310',
    condition3: "tasks.company_id = 267 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('12@e.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
11:14:44 AM [info] GET /api/tasks 200 in 345ms :: [{"id":737,"title":"New User Invitation: 12@e.com","description":"Complete us...
11:14:45 AM [info] GET /api/companies/current 304 in 33ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746356946720-zw5jy18: {
  type: 'ping',
  timestamp: '2025-05-04T11:14:46.704Z',
  connectionId: 'ws_1746356945704_29y0aivfe'
}
11:14:48 AM [info] GET /api/companies/current 304 in 33ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:14:51 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746357051765-syawtgd: { type: 'ping' }
[INFO] [WebSocket] Received message from client client-1746357052214-kpm1dz5: {
  type: 'ping',
  timestamp: '2025-05-04T11:14:52.183Z',
  connectionId: 'ws_1746357051672_hms1rw4yd'
}
11:14:54 AM [info] GET /api/companies/current 304 in 34ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[Current Company] Using cached company data: 267
11:14:57 AM [info] GET /api/companies/current 304 in 33ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:14:59 AM [info] GET /api/tasks 304 in 32ms :: [{"id":737,"title":"New User Invitation: 12@e.com","description":"Complete us...
11:15:00 AM [info] GET /api/companies/current 304 in 32ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:15:03 AM [info] GET /api/companies/current 304 in 30ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746356946231-tbkr5y5: { type: 'ping' }
11:15:06 AM [info] GET /api/companies/current 304 in 33ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746356946720-zw5jy18: {
  type: 'ping',
  timestamp: '2025-05-04T11:15:06.704Z',
  connectionId: 'ws_1746356945704_29y0aivfe'
}
[INFO] [WebSocket] Received message from client client-1746356947211-oe6chag: { type: 'ping' }
11:15:09 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746357052214-kpm1dz5: {
  type: 'ping',
  timestamp: '2025-05-04T11:15:12.192Z',
  connectionId: 'ws_1746357051672_hms1rw4yd'
}
11:15:12 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 310, company_id: 267, email: '12@e.com' }
[2025-05-04T11:15:14.616Z] [INFO] Performing dynamic task unlocking check for company {"companyId":267,"userId":310}
[2025-05-04T11:15:14.646Z] [INFO] No completed KYB tasks found, skipping security task unlock check {"companyId":267}
[Tasks] Automatically unlocking all tasks for company { userId: 310, companyId: 267, requestedBy: 'automatic_task_unlock' }
[2025-05-04T11:15:14.646Z] [INFO] [TaskDependencies] Unlocking ALL tasks for company {"companyId":267}
[2025-05-04T11:15:14.676Z] [INFO] [TaskDependencies] Found tasks to unlock {"companyId":267,"count":2,"taskIds":[738,740],"taskTypes":["company_kyb","open_banking"]}
[Task Progress] Calculated progress for task 738 (company_kyb): 30/30 = 100%
[2025-05-04T11:15:14.737Z] [INFO] [TaskDependencies] Calculated actual progress from database {"taskId":738,"taskType":"company_kyb","storedProgress":100,"calculatedProgress":100}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 100,
  currentStatus: 'ready_for_submission',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-05-04T11:15:14.737Z'
}
[STATUS DETERMINATION] Task has 100% progress but is not submitted, setting to READY_FOR_SUBMISSION
[2025-05-04T11:15:14.737Z] [INFO] [TaskDependencies] Determining correct status for task {"taskId":738,"progress":100,"currentStatus":"ready_for_submission","newStatus":"ready_for_submission"}
[2025-05-04T11:15:14.767Z] [INFO] [TaskDependencies] Unlocked task {"companyId":267,"taskId":738,"taskType":"company_kyb","progress":100,"status":"ready_for_submission"}
[2025-05-04T11:15:14.767Z] [DEBUG] Broadcasting task update with object format {"taskId":738,"status":"ready_for_submission"}
[WebSocket] Broadcast task_update to 5 clients (0 errors) { messageId: 'msg_1746357314767_t992fjt81' }
[2025-05-04T11:15:14.767Z] [INFO] Successfully broadcasted task_update message 
[Task Progress] Calculated progress for task 740 (open_banking): 0/44 = 0%
[2025-05-04T11:15:14.827Z] [INFO] [TaskDependencies] Calculated actual progress from database {"taskId":740,"taskType":"open_banking","storedProgress":0,"calculatedProgress":0}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-05-04T11:15:14.827Z'
}
[STATUS DETERMINATION] Task has 0% progress, setting to NOT_STARTED
[2025-05-04T11:15:14.827Z] [INFO] [TaskDependencies] Determining correct status for task {"taskId":740,"progress":0,"currentStatus":"not_started","newStatus":"not_started"}
[2025-05-04T11:15:14.859Z] [INFO] [TaskDependencies] Unlocked task {"companyId":267,"taskId":740,"taskType":"open_banking","progress":0,"status":"not_started"}
[2025-05-04T11:15:14.859Z] [DEBUG] Broadcasting task update with object format {"taskId":740,"status":"not_started"}
[WebSocket] Broadcast task_update to 5 clients (0 errors) { messageId: 'msg_1746357314859_gnplkekfl' }
[2025-05-04T11:15:14.860Z] [INFO] Successfully broadcasted task_update message 
[2025-05-04T11:15:14.860Z] [INFO] [TaskDependencies] Successfully unlocked all tasks {"companyId":267,"count":2}
[Tasks] Successfully unlocked all tasks for company: 267
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 310',
    condition2: 'tasks.created_by = 310',
    condition3: "tasks.company_id = 267 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('12@e.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
11:15:14 AM [info] GET /api/tasks 200 in 336ms :: [{"id":737,"title":"New User Invitation: 12@e.com","description":"Complete us...
[Current Company] Fetching company for user: { userId: 310, companyId: 267 }
[Current Company] Found company: {
  id: 267,
  name: 'DevTest12',
  onboardingCompleted: false,
  riskScore: null,
  chosenScore: null,
  isDemo: true
}
11:15:15 AM [info] GET /api/companies/current 304 in 61ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:15:18 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:15:21 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746357051765-syawtgd: { type: 'ping' }
11:15:24 AM [info] GET /api/companies/current 304 in 32ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746356946720-zw5jy18: {
  type: 'ping',
  timestamp: '2025-05-04T11:15:26.704Z',
  connectionId: 'ws_1746356945704_29y0aivfe'
}
11:15:27 AM [info] GET /api/companies/current 304 in 32ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:15:30 AM [info] GET /api/tasks 304 in 32ms :: [{"id":737,"title":"New User Invitation: 12@e.com","description":"Complete us...
11:15:30 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746357052214-kpm1dz5: {
  type: 'ping',
  timestamp: '2025-05-04T11:15:32.198Z',
  connectionId: 'ws_1746357051672_hms1rw4yd'
}
11:15:33 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746356946231-tbkr5y5: { type: 'ping' }
11:15:36 AM [info] GET /api/companies/current 304 in 34ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:15:39 AM [info] GET /api/companies/current 304 in 30ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:15:42 AM [info] GET /api/companies/current 304 in 34ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 310, company_id: 267, email: '12@e.com' }
[2025-05-04T11:15:45.316Z] [INFO] Performing dynamic task unlocking check for company {"companyId":267,"userId":310}
[2025-05-04T11:15:45.346Z] [INFO] No completed KYB tasks found, skipping security task unlock check {"companyId":267}
[Tasks] Automatically unlocking all tasks for company { userId: 310, companyId: 267, requestedBy: 'automatic_task_unlock' }
[2025-05-04T11:15:45.347Z] [INFO] [TaskDependencies] Unlocking ALL tasks for company {"companyId":267}
[2025-05-04T11:15:45.377Z] [INFO] [TaskDependencies] Found tasks to unlock {"companyId":267,"count":2,"taskIds":[740,738],"taskTypes":["open_banking","company_kyb"]}
[Task Progress] Calculated progress for task 740 (open_banking): 0/44 = 0%
[2025-05-04T11:15:45.438Z] [INFO] [TaskDependencies] Calculated actual progress from database {"taskId":740,"taskType":"open_banking","storedProgress":0,"calculatedProgress":0}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-05-04T11:15:45.438Z'
}
[STATUS DETERMINATION] Task has 0% progress, setting to NOT_STARTED
[2025-05-04T11:15:45.438Z] [INFO] [TaskDependencies] Determining correct status for task {"taskId":740,"progress":0,"currentStatus":"not_started","newStatus":"not_started"}
[2025-05-04T11:15:45.470Z] [INFO] [TaskDependencies] Unlocked task {"companyId":267,"taskId":740,"taskType":"open_banking","progress":0,"status":"not_started"}
[2025-05-04T11:15:45.470Z] [DEBUG] Broadcasting task update with object format {"taskId":740,"status":"not_started"}
[WebSocket] Broadcast task_update to 5 clients (0 errors) { messageId: 'msg_1746357345470_pbf3bz556' }
[2025-05-04T11:15:45.471Z] [INFO] Successfully broadcasted task_update message 
11:15:45 AM [info] GET /api/companies/current 304 in 34ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[Task Progress] Calculated progress for task 738 (company_kyb): 30/30 = 100%
[2025-05-04T11:15:45.530Z] [INFO] [TaskDependencies] Calculated actual progress from database {"taskId":738,"taskType":"company_kyb","storedProgress":100,"calculatedProgress":100}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 100,
  currentStatus: 'ready_for_submission',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-05-04T11:15:45.530Z'
}
[STATUS DETERMINATION] Task has 100% progress but is not submitted, setting to READY_FOR_SUBMISSION
[2025-05-04T11:15:45.530Z] [INFO] [TaskDependencies] Determining correct status for task {"taskId":738,"progress":100,"currentStatus":"ready_for_submission","newStatus":"ready_for_submission"}
[2025-05-04T11:15:45.561Z] [INFO] [TaskDependencies] Unlocked task {"companyId":267,"taskId":738,"taskType":"company_kyb","progress":100,"status":"ready_for_submission"}
[2025-05-04T11:15:45.561Z] [DEBUG] Broadcasting task update with object format {"taskId":738,"status":"ready_for_submission"}
[WebSocket] Broadcast task_update to 5 clients (0 errors) { messageId: 'msg_1746357345561_dr3t6cvg8' }
[2025-05-04T11:15:45.561Z] [INFO] Successfully broadcasted task_update message 
[2025-05-04T11:15:45.562Z] [INFO] [TaskDependencies] Successfully unlocked all tasks {"companyId":267,"count":2}
[Tasks] Successfully unlocked all tasks for company: 267
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 310',
    condition2: 'tasks.created_by = 310',
    condition3: "tasks.company_id = 267 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('12@e.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
11:15:45 AM [info] GET /api/tasks 200 in 338ms :: [{"id":737,"title":"New User Invitation: 12@e.com","description":"Complete us...
[INFO] [WebSocket] Received message from client client-1746356946720-zw5jy18: {
  type: 'ping',
  timestamp: '2025-05-04T11:15:46.704Z',
  connectionId: 'ws_1746356945704_29y0aivfe'
}
11:15:48 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:15:51 AM [info] GET /api/companies/current 304 in 30ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746357051765-syawtgd: { type: 'ping' }
[INFO] [WebSocket] Received message from client client-1746357052214-kpm1dz5: {
  type: 'ping',
  timestamp: '2025-05-04T11:15:52.200Z',
  connectionId: 'ws_1746357051672_hms1rw4yd'
}
[Current Company] Using cached company data: 267
11:15:54 AM [info] GET /api/companies/current 304 in 30ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:15:57 AM [info] GET /api/companies/current 304 in 32ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:16:00 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:16:00 AM [info] GET /api/tasks 304 in 31ms :: [{"id":737,"title":"New User Invitation: 12@e.com","description":"Complete us...
[Current Company] Using cached company data: 267
11:16:03 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746356946231-tbkr5y5: { type: 'ping' }
11:16:06 AM [info] GET /api/companies/current 304 in 36ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746356946720-zw5jy18: {
  type: 'ping',
  timestamp: '2025-05-04T11:16:06.703Z',
  connectionId: 'ws_1746356945704_29y0aivfe'
}
[Current Company] Using cached company data: 267
11:16:09 AM [info] GET /api/companies/current 304 in 32ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746357052214-kpm1dz5: {
  type: 'ping',
  timestamp: '2025-05-04T11:16:12.201Z',
  connectionId: 'ws_1746357051672_hms1rw4yd'
}
11:16:12 AM [info] GET /api/companies/current 304 in 36ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:16:15 AM [info] GET /api/companies/current 304 in 37ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 310, company_id: 267, email: '12@e.com' }
[2025-05-04T11:16:16.046Z] [INFO] Performing dynamic task unlocking check for company {"companyId":267,"userId":310}
[2025-05-04T11:16:16.079Z] [INFO] No completed KYB tasks found, skipping security task unlock check {"companyId":267}
[Tasks] Automatically unlocking all tasks for company { userId: 310, companyId: 267, requestedBy: 'automatic_task_unlock' }
[2025-05-04T11:16:16.079Z] [INFO] [TaskDependencies] Unlocking ALL tasks for company {"companyId":267}
[2025-05-04T11:16:16.113Z] [INFO] [TaskDependencies] Found tasks to unlock {"companyId":267,"count":2,"taskIds":[738,740],"taskTypes":["company_kyb","open_banking"]}
[Task Progress] Calculated progress for task 738 (company_kyb): 30/30 = 100%
[2025-05-04T11:16:16.176Z] [INFO] [TaskDependencies] Calculated actual progress from database {"taskId":738,"taskType":"company_kyb","storedProgress":100,"calculatedProgress":100}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 100,
  currentStatus: 'ready_for_submission',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-05-04T11:16:16.176Z'
}
[STATUS DETERMINATION] Task has 100% progress but is not submitted, setting to READY_FOR_SUBMISSION
[2025-05-04T11:16:16.176Z] [INFO] [TaskDependencies] Determining correct status for task {"taskId":738,"progress":100,"currentStatus":"ready_for_submission","newStatus":"ready_for_submission"}
[2025-05-04T11:16:16.210Z] [INFO] [TaskDependencies] Unlocked task {"companyId":267,"taskId":738,"taskType":"company_kyb","progress":100,"status":"ready_for_submission"}
[2025-05-04T11:16:16.210Z] [DEBUG] Broadcasting task update with object format {"taskId":738,"status":"ready_for_submission"}
[WebSocket] Broadcast task_update to 5 clients (0 errors) { messageId: 'msg_1746357376210_0ojioihox' }
[2025-05-04T11:16:16.210Z] [INFO] Successfully broadcasted task_update message 
[Task Progress] Calculated progress for task 740 (open_banking): 0/44 = 0%
[2025-05-04T11:16:16.272Z] [INFO] [TaskDependencies] Calculated actual progress from database {"taskId":740,"taskType":"open_banking","storedProgress":0,"calculatedProgress":0}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-05-04T11:16:16.272Z'
}
[STATUS DETERMINATION] Task has 0% progress, setting to NOT_STARTED
[2025-05-04T11:16:16.272Z] [INFO] [TaskDependencies] Determining correct status for task {"taskId":740,"progress":0,"currentStatus":"not_started","newStatus":"not_started"}
[2025-05-04T11:16:16.303Z] [INFO] [TaskDependencies] Unlocked task {"companyId":267,"taskId":740,"taskType":"open_banking","progress":0,"status":"not_started"}
[2025-05-04T11:16:16.303Z] [DEBUG] Broadcasting task update with object format {"taskId":740,"status":"not_started"}
[WebSocket] Broadcast task_update to 5 clients (0 errors) { messageId: 'msg_1746357376304_jgsbayts0' }
[2025-05-04T11:16:16.304Z] [INFO] Successfully broadcasted task_update message 
[2025-05-04T11:16:16.304Z] [INFO] [TaskDependencies] Successfully unlocked all tasks {"companyId":267,"count":2}
[Tasks] Successfully unlocked all tasks for company: 267
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 310',
    condition2: 'tasks.created_by = 310',
    condition3: "tasks.company_id = 267 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('12@e.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
11:16:16 AM [info] GET /api/tasks 200 in 357ms :: [{"id":737,"title":"New User Invitation: 12@e.com","description":"Complete us...
[Current Company] Fetching company for user: { userId: 310, companyId: 267 }
[Current Company] Found company: {
  id: 267,
  name: 'DevTest12',
  onboardingCompleted: false,
  riskScore: null,
  chosenScore: null,
  isDemo: true
}
11:16:18 AM [info] GET /api/companies/current 304 in 65ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:16:21 AM [info] GET /api/companies/current 304 in 32ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746357051765-syawtgd: { type: 'ping' }
11:16:24 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746356946720-zw5jy18: {
  type: 'ping',
  timestamp: '2025-05-04T11:16:26.702Z',
  connectionId: 'ws_1746356945704_29y0aivfe'
}
11:16:27 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:16:30 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:16:31 AM [info] GET /api/tasks 304 in 31ms :: [{"id":737,"title":"New User Invitation: 12@e.com","description":"Complete us...
[INFO] [WebSocket] Received message from client client-1746357052214-kpm1dz5: {
  type: 'ping',
  timestamp: '2025-05-04T11:16:32.201Z',
  connectionId: 'ws_1746357051672_hms1rw4yd'
}
11:16:33 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746356946231-tbkr5y5: { type: 'ping' }
11:16:36 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:16:39 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:16:42 AM [info] GET /api/companies/current 304 in 30ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:16:45 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 310, company_id: 267, email: '12@e.com' }
[2025-05-04T11:16:46.753Z] [INFO] Performing dynamic task unlocking check for company {"companyId":267,"userId":310}
[2025-05-04T11:16:46.783Z] [INFO] No completed KYB tasks found, skipping security task unlock check {"companyId":267}
[Tasks] Automatically unlocking all tasks for company { userId: 310, companyId: 267, requestedBy: 'automatic_task_unlock' }
[2025-05-04T11:16:46.783Z] [INFO] [TaskDependencies] Unlocking ALL tasks for company {"companyId":267}
[2025-05-04T11:16:46.813Z] [INFO] [TaskDependencies] Found tasks to unlock {"companyId":267,"count":2,"taskIds":[740,738],"taskTypes":["open_banking","company_kyb"]}
[INFO] [WebSocket] Received message from client client-1746356946720-zw5jy18: {
  type: 'ping',
  timestamp: '2025-05-04T11:16:46.704Z',
  connectionId: 'ws_1746356945704_29y0aivfe'
}
[Task Progress] Calculated progress for task 740 (open_banking): 0/44 = 0%
[2025-05-04T11:16:46.873Z] [INFO] [TaskDependencies] Calculated actual progress from database {"taskId":740,"taskType":"open_banking","storedProgress":0,"calculatedProgress":0}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-05-04T11:16:46.873Z'
}
[STATUS DETERMINATION] Task has 0% progress, setting to NOT_STARTED
[2025-05-04T11:16:46.873Z] [INFO] [TaskDependencies] Determining correct status for task {"taskId":740,"progress":0,"currentStatus":"not_started","newStatus":"not_started"}
[2025-05-04T11:16:46.904Z] [INFO] [TaskDependencies] Unlocked task {"companyId":267,"taskId":740,"taskType":"open_banking","progress":0,"status":"not_started"}
[2025-05-04T11:16:46.905Z] [DEBUG] Broadcasting task update with object format {"taskId":740,"status":"not_started"}
[WebSocket] Broadcast task_update to 5 clients (0 errors) { messageId: 'msg_1746357406905_2ztb1di2p' }
[2025-05-04T11:16:46.905Z] [INFO] Successfully broadcasted task_update message 
[Task Progress] Calculated progress for task 738 (company_kyb): 30/30 = 100%
[2025-05-04T11:16:46.963Z] [INFO] [TaskDependencies] Calculated actual progress from database {"taskId":738,"taskType":"company_kyb","storedProgress":100,"calculatedProgress":100}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 100,
  currentStatus: 'ready_for_submission',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-05-04T11:16:46.963Z'
}
[STATUS DETERMINATION] Task has 100% progress but is not submitted, setting to READY_FOR_SUBMISSION
[2025-05-04T11:16:46.964Z] [INFO] [TaskDependencies] Determining correct status for task {"taskId":738,"progress":100,"currentStatus":"ready_for_submission","newStatus":"ready_for_submission"}
[2025-05-04T11:16:46.994Z] [INFO] [TaskDependencies] Unlocked task {"companyId":267,"taskId":738,"taskType":"company_kyb","progress":100,"status":"ready_for_submission"}
[2025-05-04T11:16:46.994Z] [DEBUG] Broadcasting task update with object format {"taskId":738,"status":"ready_for_submission"}
[WebSocket] Broadcast task_update to 5 clients (0 errors) { messageId: 'msg_1746357406994_ilxu04yf7' }
[2025-05-04T11:16:46.995Z] [INFO] Successfully broadcasted task_update message 
[2025-05-04T11:16:46.995Z] [INFO] [TaskDependencies] Successfully unlocked all tasks {"companyId":267,"count":2}
[Tasks] Successfully unlocked all tasks for company: 267
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 310',
    condition2: 'tasks.created_by = 310',
    condition3: "tasks.company_id = 267 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('12@e.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
11:16:47 AM [info] GET /api/tasks 200 in 335ms :: [{"id":737,"title":"New User Invitation: 12@e.com","description":"Complete us...
[Current Company] Using cached company data: 267
11:16:48 AM [info] GET /api/companies/current 304 in 33ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:16:51 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746357051765-syawtgd: { type: 'ping' }
[INFO] [WebSocket] Received message from client client-1746357052214-kpm1dz5: {
  type: 'ping',
  timestamp: '2025-05-04T11:16:52.202Z',
  connectionId: 'ws_1746357051672_hms1rw4yd'
}
11:16:54 AM [info] GET /api/companies/current 304 in 33ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:16:57 AM [info] GET /api/companies/current 304 in 34ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:17:00 AM [info] GET /api/companies/current 304 in 34ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:17:02 AM [info] GET /api/tasks 304 in 32ms :: [{"id":737,"title":"New User Invitation: 12@e.com","description":"Complete us...
11:17:03 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746356946231-tbkr5y5: { type: 'ping' }
11:17:06 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746356946720-zw5jy18: {
  type: 'ping',
  timestamp: '2025-05-04T11:17:06.704Z',
  connectionId: 'ws_1746356945704_29y0aivfe'
}
[INFO] [WebSocket] Received message from client client-1746356947211-oe6chag: { type: 'ping' }
11:17:09 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746357052214-kpm1dz5: {
  type: 'ping',
  timestamp: '2025-05-04T11:17:12.203Z',
  connectionId: 'ws_1746357051672_hms1rw4yd'
}
11:17:12 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[PeriodicTaskReconciliation] Reconciling batch of 10 tasks: [
  683, 685, 679, 699,
  691, 697, 703, 701,
  705, 702
]
[Task Progress] Calculated progress for task 683 (open_banking): 0/44 = 0%
[Task Progress] Calculated progress for task 685 (company_kyb): 30/30 = 100%
[Task Progress] Calculated progress for task 679 (open_banking): 44/44 = 100%
11:17:15 AM [info] GET /api/companies/current 304 in 33ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[Task Progress] Calculated progress for task 699 (open_banking): 0/44 = 0%
[Task Progress] Calculated progress for task 691 (open_banking): 0/44 = 0%
[Task Progress] Calculated progress for task 697 (company_kyb): 30/30 = 100%
[Task Progress] Calculated progress for task 703 (open_banking): 0/44 = 0%
[Task Progress] Calculated progress for task 701 (company_kyb): 30/30 = 100%
[Task Progress] Calculated progress for task 705 (company_kyb): 30/30 = 100%
[Task Progress] Calculated progress for task 702 (ky3p): 0/120 = 0%
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 310, company_id: 267, email: '12@e.com' }
[2025-05-04T11:17:17.448Z] [INFO] Performing dynamic task unlocking check for company {"companyId":267,"userId":310}
[2025-05-04T11:17:17.479Z] [INFO] No completed KYB tasks found, skipping security task unlock check {"companyId":267}
[Tasks] Automatically unlocking all tasks for company { userId: 310, companyId: 267, requestedBy: 'automatic_task_unlock' }
[2025-05-04T11:17:17.480Z] [INFO] [TaskDependencies] Unlocking ALL tasks for company {"companyId":267}
[2025-05-04T11:17:17.509Z] [INFO] [TaskDependencies] Found tasks to unlock {"companyId":267,"count":2,"taskIds":[738,740],"taskTypes":["company_kyb","open_banking"]}
[Task Progress] Calculated progress for task 738 (company_kyb): 30/30 = 100%
[2025-05-04T11:17:17.569Z] [INFO] [TaskDependencies] Calculated actual progress from database {"taskId":738,"taskType":"company_kyb","storedProgress":100,"calculatedProgress":100}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 100,
  currentStatus: 'ready_for_submission',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-05-04T11:17:17.569Z'
}
[STATUS DETERMINATION] Task has 100% progress but is not submitted, setting to READY_FOR_SUBMISSION
[2025-05-04T11:17:17.569Z] [INFO] [TaskDependencies] Determining correct status for task {"taskId":738,"progress":100,"currentStatus":"ready_for_submission","newStatus":"ready_for_submission"}
[2025-05-04T11:17:17.599Z] [INFO] [TaskDependencies] Unlocked task {"companyId":267,"taskId":738,"taskType":"company_kyb","progress":100,"status":"ready_for_submission"}
[2025-05-04T11:17:17.599Z] [DEBUG] Broadcasting task update with object format {"taskId":738,"status":"ready_for_submission"}
[WebSocket] Broadcast task_update to 5 clients (0 errors) { messageId: 'msg_1746357437599_vbfdy02dm' }
[2025-05-04T11:17:17.600Z] [INFO] Successfully broadcasted task_update message 
[Task Progress] Calculated progress for task 740 (open_banking): 0/44 = 0%
[2025-05-04T11:17:17.660Z] [INFO] [TaskDependencies] Calculated actual progress from database {"taskId":740,"taskType":"open_banking","storedProgress":0,"calculatedProgress":0}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-05-04T11:17:17.660Z'
}
[STATUS DETERMINATION] Task has 0% progress, setting to NOT_STARTED
[2025-05-04T11:17:17.660Z] [INFO] [TaskDependencies] Determining correct status for task {"taskId":740,"progress":0,"currentStatus":"not_started","newStatus":"not_started"}
[2025-05-04T11:17:17.690Z] [INFO] [TaskDependencies] Unlocked task {"companyId":267,"taskId":740,"taskType":"open_banking","progress":0,"status":"not_started"}
[2025-05-04T11:17:17.691Z] [DEBUG] Broadcasting task update with object format {"taskId":740,"status":"not_started"}
[WebSocket] Broadcast task_update to 5 clients (0 errors) { messageId: 'msg_1746357437691_6w5rjk72k' }
[2025-05-04T11:17:17.691Z] [INFO] Successfully broadcasted task_update message 
[2025-05-04T11:17:17.691Z] [INFO] [TaskDependencies] Successfully unlocked all tasks {"companyId":267,"count":2}
[Tasks] Successfully unlocked all tasks for company: 267
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 310',
    condition2: 'tasks.created_by = 310',
    condition3: "tasks.company_id = 267 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('12@e.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
11:17:17 AM [info] GET /api/tasks 200 in 335ms :: [{"id":737,"title":"New User Invitation: 12@e.com","description":"Complete us...
11:17:18 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[Current Company] Fetching company for user: { userId: 310, companyId: 267 }
[Current Company] Found company: {
  id: 267,
  name: 'DevTest12',
  onboardingCompleted: false,
  riskScore: null,
  chosenScore: null,
  isDemo: true
}
11:17:21 AM [info] GET /api/companies/current 304 in 64ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746357051765-syawtgd: { type: 'ping' }
11:17:24 AM [info] GET /api/companies/current 304 in 32ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746356946720-zw5jy18: {
  type: 'ping',
  timestamp: '2025-05-04T11:17:26.704Z',
  connectionId: 'ws_1746356945704_29y0aivfe'
}
11:17:27 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[Current Company] Using cached company data: 267
11:17:30 AM [info] GET /api/companies/current 304 in 32ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746357052214-kpm1dz5: {
  type: 'ping',
  timestamp: '2025-05-04T11:17:32.203Z',
  connectionId: 'ws_1746357051672_hms1rw4yd'
}
11:17:32 AM [info] GET /api/tasks 304 in 34ms :: [{"id":737,"title":"New User Invitation: 12@e.com","description":"Complete us...
11:17:33 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746356946231-tbkr5y5: { type: 'ping' }
11:17:36 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:17:39 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:17:42 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:17:45 AM [info] GET /api/companies/current 304 in 32ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746356946720-zw5jy18: {
  type: 'ping',
  timestamp: '2025-05-04T11:17:46.704Z',
  connectionId: 'ws_1746356945704_29y0aivfe'
}
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 310, company_id: 267, email: '12@e.com' }
[2025-05-04T11:17:48.140Z] [INFO] Performing dynamic task unlocking check for company {"companyId":267,"userId":310}
[2025-05-04T11:17:48.170Z] [INFO] No completed KYB tasks found, skipping security task unlock check {"companyId":267}
[Tasks] Automatically unlocking all tasks for company { userId: 310, companyId: 267, requestedBy: 'automatic_task_unlock' }
[2025-05-04T11:17:48.170Z] [INFO] [TaskDependencies] Unlocking ALL tasks for company {"companyId":267}
[2025-05-04T11:17:48.201Z] [INFO] [TaskDependencies] Found tasks to unlock {"companyId":267,"count":2,"taskIds":[740,738],"taskTypes":["open_banking","company_kyb"]}
[Task Progress] Calculated progress for task 740 (open_banking): 0/44 = 0%
[2025-05-04T11:17:48.262Z] [INFO] [TaskDependencies] Calculated actual progress from database {"taskId":740,"taskType":"open_banking","storedProgress":0,"calculatedProgress":0}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-05-04T11:17:48.262Z'
}
[STATUS DETERMINATION] Task has 0% progress, setting to NOT_STARTED
[2025-05-04T11:17:48.262Z] [INFO] [TaskDependencies] Determining correct status for task {"taskId":740,"progress":0,"currentStatus":"not_started","newStatus":"not_started"}
[2025-05-04T11:17:48.293Z] [INFO] [TaskDependencies] Unlocked task {"companyId":267,"taskId":740,"taskType":"open_banking","progress":0,"status":"not_started"}
[2025-05-04T11:17:48.293Z] [DEBUG] Broadcasting task update with object format {"taskId":740,"status":"not_started"}
[WebSocket] Broadcast task_update to 5 clients (0 errors) { messageId: 'msg_1746357468293_6j38lfwjd' }
[2025-05-04T11:17:48.294Z] [INFO] Successfully broadcasted task_update message 
[Task Progress] Calculated progress for task 738 (company_kyb): 30/30 = 100%
[2025-05-04T11:17:48.353Z] [INFO] [TaskDependencies] Calculated actual progress from database {"taskId":738,"taskType":"company_kyb","storedProgress":100,"calculatedProgress":100}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 100,
  currentStatus: 'ready_for_submission',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-05-04T11:17:48.353Z'
}
[STATUS DETERMINATION] Task has 100% progress but is not submitted, setting to READY_FOR_SUBMISSION
[2025-05-04T11:17:48.353Z] [INFO] [TaskDependencies] Determining correct status for task {"taskId":738,"progress":100,"currentStatus":"ready_for_submission","newStatus":"ready_for_submission"}
11:17:48 AM [info] GET /api/companies/current 304 in 34ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-04T11:17:48.384Z] [INFO] [TaskDependencies] Unlocked task {"companyId":267,"taskId":738,"taskType":"company_kyb","progress":100,"status":"ready_for_submission"}
[2025-05-04T11:17:48.384Z] [DEBUG] Broadcasting task update with object format {"taskId":738,"status":"ready_for_submission"}
[WebSocket] Broadcast task_update to 5 clients (0 errors) { messageId: 'msg_1746357468384_rypuk0ndu' }
[2025-05-04T11:17:48.385Z] [INFO] Successfully broadcasted task_update message 
[2025-05-04T11:17:48.385Z] [INFO] [TaskDependencies] Successfully unlocked all tasks {"companyId":267,"count":2}
[Tasks] Successfully unlocked all tasks for company: 267
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 310',
    condition2: 'tasks.created_by = 310',
    condition3: "tasks.company_id = 267 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('12@e.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
11:17:48 AM [info] GET /api/tasks 200 in 337ms :: [{"id":737,"title":"New User Invitation: 12@e.com","description":"Complete us...
11:17:51 AM [info] GET /api/companies/current 304 in 34ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:17:54 AM [info] GET /api/companies/current 304 in 30ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:17:57 AM [info] GET /api/companies/current 304 in 30ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:18:00 AM [info] GET /api/companies/current 304 in 32ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Client disconnected: client-1746357051765-syawtgd
[INFO] [WebSocket] Client disconnected: client-1746357052214-kpm1dz5
11:18:03 AM [info] GET /api/companies/current 304 in 32ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:18:03 AM [info] GET /api/tasks 304 in 32ms :: [{"id":737,"title":"New User Invitation: 12@e.com","description":"Complete us...
[INFO] [WebSocket] Received message from client client-1746356946231-tbkr5y5: { type: 'ping' }
11:18:06 AM [info] GET /api/companies/current 304 in 42ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746356946720-zw5jy18: {
  type: 'ping',
  timestamp: '2025-05-04T11:18:06.702Z',
  connectionId: 'ws_1746356945704_29y0aivfe'
}
11:18:09 AM [info] GET /api/companies/current 304 in 35ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Client disconnected: client-1746356946231-tbkr5y5
[INFO] [WebSocket] Client disconnected: client-1746356947211-oe6chag
[INFO] [WebSocket] Client disconnected: client-1746356946720-zw5jy18
[Auth] Returning user session data
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 310, company_id: 267, email: '12@e.com' }
[2025-05-04T11:18:20.399Z] [INFO] Performing dynamic task unlocking check for company {"companyId":267,"userId":310}
11:18:20 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-04T11:18:20.440Z] [INFO] No completed KYB tasks found, skipping security task unlock check {"companyId":267}
[Tasks] Automatically unlocking all tasks for company { userId: 310, companyId: 267, requestedBy: 'automatic_task_unlock' }
[2025-05-04T11:18:20.441Z] [INFO] [TaskDependencies] Unlocking ALL tasks for company {"companyId":267}
[2025-05-04T11:18:20.477Z] [INFO] [TaskDependencies] Found tasks to unlock {"companyId":267,"count":2,"taskIds":[738,740],"taskTypes":["company_kyb","open_banking"]}
[Task Progress] Calculated progress for task 738 (company_kyb): 30/30 = 100%
[2025-05-04T11:18:20.552Z] [INFO] [TaskDependencies] Calculated actual progress from database {"taskId":738,"taskType":"company_kyb","storedProgress":100,"calculatedProgress":100}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 100,
  currentStatus: 'ready_for_submission',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-05-04T11:18:20.552Z'
}
[STATUS DETERMINATION] Task has 100% progress but is not submitted, setting to READY_FOR_SUBMISSION
[2025-05-04T11:18:20.553Z] [INFO] [TaskDependencies] Determining correct status for task {"taskId":738,"progress":100,"currentStatus":"ready_for_submission","newStatus":"ready_for_submission"}
[INFO] [WebSocket] Client connected: client-1746357500564-ac44yp3
[2025-05-04T11:18:20.586Z] [INFO] [TaskDependencies] Unlocked task {"companyId":267,"taskId":738,"taskType":"company_kyb","progress":100,"status":"ready_for_submission"}
[2025-05-04T11:18:20.586Z] [DEBUG] Broadcasting task update with object format {"taskId":738,"status":"ready_for_submission"}
[WebSocket] Broadcast task_update to 1 clients (0 errors) { messageId: 'msg_1746357500586_5aw6jd85g' }
[2025-05-04T11:18:20.586Z] [INFO] Successfully broadcasted task_update message 
[Task Progress] Calculated progress for task 740 (open_banking): 0/44 = 0%
[2025-05-04T11:18:20.650Z] [INFO] [TaskDependencies] Calculated actual progress from database {"taskId":740,"taskType":"open_banking","storedProgress":0,"calculatedProgress":0}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-05-04T11:18:20.650Z'
}
[STATUS DETERMINATION] Task has 0% progress, setting to NOT_STARTED
[2025-05-04T11:18:20.650Z] [INFO] [TaskDependencies] Determining correct status for task {"taskId":740,"progress":0,"currentStatus":"not_started","newStatus":"not_started"}
[INFO] [WebSocket] Received message from client client-1746357500564-ac44yp3: {
  type: 'authenticate',
  data: { timestamp: '2025-05-04T11:18:20.544Z' }
}
[INFO] [WebSocket] Authentication from client client-1746357500564-ac44yp3: { userId: undefined, companyId: undefined, hasToken: true }
[2025-05-04T11:18:20.683Z] [INFO] [TaskDependencies] Unlocked task {"companyId":267,"taskId":740,"taskType":"open_banking","progress":0,"status":"not_started"}
[2025-05-04T11:18:20.683Z] [DEBUG] Broadcasting task update with object format {"taskId":740,"status":"not_started"}
[WebSocket] Broadcast task_update to 1 clients (0 errors) { messageId: 'msg_1746357500683_a7vccstpt' }
[2025-05-04T11:18:20.683Z] [INFO] Successfully broadcasted task_update message 
[2025-05-04T11:18:20.683Z] [INFO] [TaskDependencies] Successfully unlocked all tasks {"companyId":267,"count":2}
[Tasks] Successfully unlocked all tasks for company: 267
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 310',
    condition2: 'tasks.created_by = 310',
    condition3: "tasks.company_id = 267 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('12@e.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
11:18:20 AM [info] GET /api/tasks 200 in 400ms :: [{"id":737,"title":"New User Invitation: 12@e.com","description":"Complete us...
11:18:20 AM [info] GET /api/tasks 304 in 37ms :: [{"id":737,"title":"New User Invitation: 12@e.com","description":"Complete us...
[INFO] [WebSocket] Client connected: client-1746357501048-myj6hvd
[INFO] [WebSocket] Client connected: client-1746357501536-kpv1jnx
[INFO] [WebSocket] Received message from client client-1746357501536-kpv1jnx: {
  type: 'authenticate',
  userId: null,
  companyId: null,
  clientId: 'ws_1746357499990_bj97wty03',
  timestamp: '2025-05-04T11:18:21.518Z'
}
[INFO] [WebSocket] Authentication from client client-1746357501536-kpv1jnx: { userId: null, companyId: null, hasToken: true }
[Tasks Routes] Fetching task by ID: {
  taskId: 739,
  userCompanyId: 267,
  timestamp: '2025-05-04T11:18:23.135Z'
}
[Current Company] Fetching company for user: { userId: 310, companyId: 267 }
[Current Company] Found company: {
  id: 267,
  name: 'DevTest12',
  onboardingCompleted: false,
  riskScore: null,
  chosenScore: null,
  isDemo: true
}
[Tasks Routes] Task found by ID: {
  taskId: 739,
  title: '2. S&P KY3P Security Assessment: DevTest12',
  type: 'ky3p',
  formDataFields: 0,
  timestamp: '2025-05-04T11:18:23.169Z'
}
11:18:23 AM [info] GET /api/companies/current 304 in 68ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:18:23 AM [info] GET /api/tasks/739 200 in 70ms :: {"id":739,"title":"2. S&P KY3P Security Assessment: DevTest12","description":...
[Tasks Routes] Fetching task by ID: {
  taskId: 739,
  userCompanyId: 267,
  timestamp: '2025-05-04T11:18:23.364Z'
}
[Task Templates API] Fetching template for task type: ky3p, user: 310
[Tasks Routes] Task found by ID: {
  taskId: 739,
  title: '2. S&P KY3P Security Assessment: DevTest12',
  type: 'ky3p',
  formDataFields: 0,
  timestamp: '2025-05-04T11:18:23.396Z'
}
11:18:23 AM [info] GET /api/companies/current 304 in 35ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[Task Templates API] Found template: 48 (S&P KY3P Security Assessment) for task type: ky3p
11:18:23 AM [info] GET /api/tasks/739 304 in 63ms :: {"id":739,"title":"2. S&P KY3P Security Assessment: DevTest12","description":...
[Task Templates API] Retrieved 10 configuration items for template ID: 48
11:18:23 AM [info] GET /api/task-templates/by-type/ky3p 304 in 98ms :: {"id":48,"name":"S&P KY3P Security Assessment","description":"S&P KY3P Securi...
[2025-05-04T11:18:23.626Z] [INFO] Fetching all KY3P fields 
[2025-05-04T11:18:23.713Z] [INFO] Successfully retrieved 120 KY3P fields 
11:18:23 AM [info] GET /api/ky3p-fields 304 in 120ms :: [{"id":1,"order":1,"field_key":"externalSystems","display_name":"External Sys...
[2025-05-04T11:18:23.906Z] [INFO] Fetching KY3P progress for task 739 
[2025-05-04T11:18:23.971Z] [INFO] Retrieved 120 responses for task 739 
11:18:24 AM [info] GET /api/ky3p/progress/739 200 in 134ms :: {"success":true,"taskId":739,"status":"in_progress","responses":[{"id":110260...
[2025-05-04T11:18:24.182Z] [INFO] Fetching KY3P progress for task 739 
[2025-05-04T11:18:24.247Z] [INFO] Retrieved 120 responses for task 739 
11:18:24 AM [info] GET /api/ky3p/progress/739 304 in 130ms :: {"success":true,"taskId":739,"status":"in_progress","responses":[{"id":110260...
[Tasks Routes] Fetching task by ID: {
  taskId: 739,
  userCompanyId: 267,
  timestamp: '2025-05-04T11:18:24.422Z'
}
[Tasks Routes] Task found by ID: {
  taskId: 739,
  title: '2. S&P KY3P Security Assessment: DevTest12',
  type: 'ky3p',
  formDataFields: 0,
  timestamp: '2025-05-04T11:18:24.457Z'
}
11:18:24 AM [info] GET /api/tasks/739 304 in 74ms :: {"id":739,"title":"2. S&P KY3P Security Assessment: DevTest12","description":...
[Tasks Routes] Fetching task by ID: {
  taskId: 739,
  userCompanyId: 267,
  timestamp: '2025-05-04T11:18:24.649Z'
}
[2025-05-04T11:18:24.653Z] [INFO] Fetching KY3P responses for task 739 
[Tasks Routes] Task found by ID: {
  taskId: 739,
  title: '2. S&P KY3P Security Assessment: DevTest12',
  type: 'ky3p',
  formDataFields: 0,
  timestamp: '2025-05-04T11:18:24.681Z'
}
11:18:24 AM [info] GET /api/tasks/739 304 in 64ms :: {"id":739,"title":"2. S&P KY3P Security Assessment: DevTest12","description":...
[2025-05-04T11:18:24.743Z] [INFO] Retrieved 120 responses for task 739 
11:18:24 AM [info] GET /api/tasks/739/ky3p-responses 200 in 126ms :: {"success":true,"taskId":739,"status":"in_progress","responses":[{"id":110260...
[2025-05-04T11:18:24.902Z] [INFO] Fetching KY3P responses for task 739 
[2025-05-04T11:18:24.962Z] [INFO] Retrieved 120 responses for task 739 
11:18:24 AM [info] GET /api/tasks/739/ky3p-responses 304 in 92ms :: {"success":true,"taskId":739,"status":"in_progress","responses":[{"id":110260...
[2025-05-04T11:18:25.070Z] [INFO] Fetching KY3P progress for task 739 
[2025-05-04T11:18:25.130Z] [INFO] Retrieved 120 responses for task 739 
11:18:25 AM [info] GET /api/ky3p/progress/739 304 in 149ms :: {"success":true,"taskId":739,"status":"in_progress","responses":[{"id":110260...
[2025-05-04T11:18:25.370Z] [INFO] Fetching KY3P progress for task 739 
[2025-05-04T11:18:25.431Z] [INFO] Retrieved 120 responses for task 739 
11:18:25 AM [info] GET /api/ky3p/progress/739 304 in 124ms :: {"success":true,"taskId":739,"status":"in_progress","responses":[{"id":110260...
11:18:26 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:18:29 AM [info] GET /api/companies/current 304 in 30ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[KY3P API] Received batch update for task 739 with 1 fields
[KY3P] Task 739 progress updated: 0%
11:18:31 AM [info] POST /api/ky3p/batch-update/739 200 in 342ms :: {"success":true,"message":"Successfully processed 1 field updates","processed...
11:18:32 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[KY3P API] Received batch update for task 739 with 120 fields
[KY3P] Task 739 progress updated: 0%
11:18:33 AM [info] POST /api/ky3p/batch-update/739 200 in 447ms :: {"success":true,"message":"Successfully processed 120 field updates","process...
[KY3P API] Received batch update for task 739 with 1 fields
[KY3P API] Received batch update for task 739 with 120 fields
[KY3P] Task 739 progress updated: 0%
11:18:34 AM [info] POST /api/ky3p/batch-update/739 200 in 323ms :: {"success":true,"message":"Successfully processed 1 field updates","processed...
[KY3P] Task 739 progress updated: 0%
11:18:34 AM [info] POST /api/ky3p/batch-update/739 200 in 381ms :: {"success":true,"message":"Successfully processed 120 field updates","process...
11:18:35 AM [info] GET /api/companies/current 304 in 32ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[KY3P API] Received batch update for task 739 with 120 fields
[KY3P] Task 739 progress updated: 0%
11:18:36 AM [info] POST /api/ky3p/batch-update/739 200 in 402ms :: {"success":true,"message":"Successfully processed 120 field updates","process...
[KY3P API] Received batch update for task 739 with 120 fields
[KY3P] Task 739 progress updated: 0%
11:18:37 AM [info] POST /api/ky3p/batch-update/739 200 in 399ms :: {"success":true,"message":"Successfully processed 120 field updates","process...
11:18:38 AM [info] GET /api/companies/current 304 in 33ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[KY3P API] Received batch update for task 739 with 120 fields
11:18:38 AM [info] GET /api/tasks 304 in 33ms :: [{"id":737,"title":"New User Invitation: 12@e.com","description":"Complete us...
11:18:38 AM [info] GET /api/companies/current 304 in 33ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[KY3P] Task 739 progress updated: 0%
11:18:39 AM [info] POST /api/ky3p/batch-update/739 200 in 379ms :: {"success":true,"message":"Successfully processed 120 field updates","process...
11:18:39 AM [info] GET /api/tasks 304 in 32ms :: [{"id":737,"title":"New User Invitation: 12@e.com","description":"Complete us...
[KY3P API] Received batch update for task 739 with 120 fields
11:18:39 AM [info] GET /api/tasks 304 in 31ms :: [{"id":737,"title":"New User Invitation: 12@e.com","description":"Complete us...
[KY3P API] Received batch update for task 739 with 1 fields
[KY3P] Task 739 progress updated: 0%
11:18:39 AM [info] POST /api/ky3p/batch-update/739 200 in 368ms :: {"success":true,"message":"Successfully processed 120 field updates","process...
[KY3P] Task 739 progress updated: 0%
11:18:39 AM [info] POST /api/ky3p/batch-update/739 200 in 277ms :: {"success":true,"message":"Successfully processed 1 field updates","processed...
[INFO] [WebSocket] Received message from client client-1746357501048-myj6hvd: {
  type: 'ping',
  timestamp: '2025-05-04T11:18:41.031Z',
  connectionId: 'ws_1746357500033_4911s2qrv'
}
11:18:41 AM [info] GET /api/companies/current 304 in 34ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:18:44 AM [info] GET /api/companies/current 304 in 33ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:18:47 AM [info] GET /api/companies/current 304 in 32ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746357500564-ac44yp3: { type: 'ping' }
11:18:50 AM [info] GET /api/companies/current 304 in 37ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:18:53 AM [info] GET /api/companies/current 304 in 35ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 310, company_id: 267, email: '12@e.com' }
[2025-05-04T11:18:54.237Z] [INFO] Performing dynamic task unlocking check for company {"companyId":267,"userId":310}
[2025-05-04T11:18:54.268Z] [INFO] No completed KYB tasks found, skipping security task unlock check {"companyId":267}
[Tasks] Automatically unlocking all tasks for company { userId: 310, companyId: 267, requestedBy: 'automatic_task_unlock' }
[2025-05-04T11:18:54.269Z] [INFO] [TaskDependencies] Unlocking ALL tasks for company {"companyId":267}
[2025-05-04T11:18:54.303Z] [INFO] [TaskDependencies] Found tasks to unlock {"companyId":267,"count":2,"taskIds":[740,738],"taskTypes":["open_banking","company_kyb"]}
[Task Progress] Calculated progress for task 740 (open_banking): 0/44 = 0%
[2025-05-04T11:18:54.369Z] [INFO] [TaskDependencies] Calculated actual progress from database {"taskId":740,"taskType":"open_banking","storedProgress":0,"calculatedProgress":0}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-05-04T11:18:54.369Z'
}
[STATUS DETERMINATION] Task has 0% progress, setting to NOT_STARTED
[2025-05-04T11:18:54.369Z] [INFO] [TaskDependencies] Determining correct status for task {"taskId":740,"progress":0,"currentStatus":"not_started","newStatus":"not_started"}
[2025-05-04T11:18:54.409Z] [INFO] [TaskDependencies] Unlocked task {"companyId":267,"taskId":740,"taskType":"open_banking","progress":0,"status":"not_started"}
[2025-05-04T11:18:54.409Z] [DEBUG] Broadcasting task update with object format {"taskId":740,"status":"not_started"}
[WebSocket] Broadcast task_update to 3 clients (0 errors) { messageId: 'msg_1746357534409_05wyzswwc' }
[2025-05-04T11:18:54.409Z] [INFO] Successfully broadcasted task_update message 
[Task Progress] Calculated progress for task 738 (company_kyb): 30/30 = 100%
[2025-05-04T11:18:54.476Z] [INFO] [TaskDependencies] Calculated actual progress from database {"taskId":738,"taskType":"company_kyb","storedProgress":100,"calculatedProgress":100}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 100,
  currentStatus: 'ready_for_submission',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-05-04T11:18:54.476Z'
}
[STATUS DETERMINATION] Task has 100% progress but is not submitted, setting to READY_FOR_SUBMISSION
[2025-05-04T11:18:54.476Z] [INFO] [TaskDependencies] Determining correct status for task {"taskId":738,"progress":100,"currentStatus":"ready_for_submission","newStatus":"ready_for_submission"}
[2025-05-04T11:18:54.508Z] [INFO] [TaskDependencies] Unlocked task {"companyId":267,"taskId":738,"taskType":"company_kyb","progress":100,"status":"ready_for_submission"}
[2025-05-04T11:18:54.508Z] [DEBUG] Broadcasting task update with object format {"taskId":738,"status":"ready_for_submission"}
[WebSocket] Broadcast task_update to 3 clients (0 errors) { messageId: 'msg_1746357534508_za0mn072n' }
[2025-05-04T11:18:54.508Z] [INFO] Successfully broadcasted task_update message 
[2025-05-04T11:18:54.508Z] [INFO] [TaskDependencies] Successfully unlocked all tasks {"companyId":267,"count":2}
[Tasks] Successfully unlocked all tasks for company: 267
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 310',
    condition2: 'tasks.created_by = 310',
    condition3: "tasks.company_id = 267 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('12@e.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
11:18:54 AM [info] GET /api/tasks 200 in 369ms :: [{"id":737,"title":"New User Invitation: 12@e.com","description":"Complete us...
11:18:56 AM [info] GET /api/companies/current 304 in 34ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:18:59 AM [info] GET /api/companies/current 304 in 33ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746357501048-myj6hvd: {
  type: 'ping',
  timestamp: '2025-05-04T11:19:01.031Z',
  connectionId: 'ws_1746357500033_4911s2qrv'
}
11:19:02 AM [info] GET /api/companies/current 304 in 37ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[Tasks Routes] Fetching task by ID: {
  taskId: 739,
  userCompanyId: 267,
  timestamp: '2025-05-04T11:19:05.441Z'
}
[Tasks Routes] Task found by ID: {
  taskId: 739,
  title: '2. S&P KY3P Security Assessment: DevTest12',
  type: 'ky3p',
  formDataFields: 0,
  timestamp: '2025-05-04T11:19:05.472Z'
}
11:19:05 AM [info] GET /api/companies/current 304 in 32ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:19:05 AM [info] GET /api/tasks/739 200 in 63ms :: {"id":739,"title":"2. S&P KY3P Security Assessment: DevTest12","description":...
[Auth] Returning user session data
[Tasks Routes] Fetching task by ID: {
  taskId: 739,
  userCompanyId: 267,
  timestamp: '2025-05-04T11:19:05.661Z'
}
[Tasks Routes] Task found by ID: {
  taskId: 739,
  title: '2. S&P KY3P Security Assessment: DevTest12',
  type: 'ky3p',
  formDataFields: 0,
  timestamp: '2025-05-04T11:19:05.690Z'
}
[Task Templates API] Fetching template for task type: ky3p, user: 310
11:19:05 AM [info] GET /api/tasks/739 304 in 62ms :: {"id":739,"title":"2. S&P KY3P Security Assessment: DevTest12","description":...
[Task Templates API] Found template: 48 (S&P KY3P Security Assessment) for task type: ky3p
11:19:05 AM [info] GET /api/companies/current 304 in 63ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[Task Templates API] Retrieved 10 configuration items for template ID: 48
11:19:05 AM [info] GET /api/task-templates/by-type/ky3p 304 in 101ms :: {"id":48,"name":"S&P KY3P Security Assessment","description":"S&P KY3P Securi...
[2025-05-04T11:19:05.951Z] [INFO] Fetching KY3P progress for task 739 
[2025-05-04T11:19:06.043Z] [INFO] Retrieved 120 responses for task 739 
11:19:06 AM [info] GET /api/ky3p/progress/739 200 in 189ms :: {"success":true,"taskId":739,"status":"in_progress","responses":[{"id":111079...
[2025-05-04T11:19:06.269Z] [INFO] Fetching KY3P progress for task 739 
[2025-05-04T11:19:06.339Z] [INFO] Retrieved 120 responses for task 739 
11:19:06 AM [info] GET /api/ky3p/progress/739 304 in 152ms :: {"success":true,"taskId":739,"status":"in_progress","responses":[{"id":111079...
[Tasks Routes] Fetching task by ID: {
  taskId: 739,
  userCompanyId: 267,
  timestamp: '2025-05-04T11:19:06.529Z'
}
[Tasks Routes] Task found by ID: {
  taskId: 739,
  title: '2. S&P KY3P Security Assessment: DevTest12',
  type: 'ky3p',
  formDataFields: 0,
  timestamp: '2025-05-04T11:19:06.560Z'
}
11:19:06 AM [info] GET /api/tasks/739 304 in 70ms :: {"id":739,"title":"2. S&P KY3P Security Assessment: DevTest12","description":...
[2025-05-04T11:19:06.748Z] [INFO] Fetching KY3P responses for task 739 
[Tasks Routes] Fetching task by ID: {
  taskId: 739,
  userCompanyId: 267,
  timestamp: '2025-05-04T11:19:06.749Z'
}
[Tasks Routes] Task found by ID: {
  taskId: 739,
  title: '2. S&P KY3P Security Assessment: DevTest12',
  type: 'ky3p',
  formDataFields: 0,
  timestamp: '2025-05-04T11:19:06.782Z'
}
11:19:06 AM [info] GET /api/tasks/739 304 in 74ms :: {"id":739,"title":"2. S&P KY3P Security Assessment: DevTest12","description":...
[2025-05-04T11:19:06.842Z] [INFO] Retrieved 120 responses for task 739 
11:19:06 AM [info] GET /api/tasks/739/ky3p-responses 200 in 126ms :: {"success":true,"taskId":739,"status":"in_progress","responses":[{"id":111079...
[2025-05-04T11:19:06.998Z] [INFO] Fetching KY3P responses for task 739 
[2025-05-04T11:19:07.060Z] [INFO] Retrieved 120 responses for task 739 
11:19:07 AM [info] GET /api/tasks/739/ky3p-responses 304 in 93ms :: {"success":true,"taskId":739,"status":"in_progress","responses":[{"id":111079...
[2025-05-04T11:19:07.171Z] [INFO] Fetching KY3P progress for task 739 
[2025-05-04T11:19:07.233Z] [INFO] Retrieved 120 responses for task 739 
11:19:07 AM [info] GET /api/ky3p/progress/739 304 in 153ms :: {"success":true,"taskId":739,"status":"in_progress","responses":[{"id":111079...
[2025-05-04T11:19:07.475Z] [INFO] Fetching KY3P progress for task 739 
[2025-05-04T11:19:07.535Z] [INFO] Retrieved 120 responses for task 739 
11:19:07 AM [info] GET /api/ky3p/progress/739 304 in 123ms :: {"success":true,"taskId":739,"status":"in_progress","responses":[{"id":111079...
11:19:08 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:19:11 AM [info] GET /api/companies/current 304 in 30ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-04T11:19:14.695Z] [INFO] [UnifiedDemoServiceRoutes] Applying demo data to task 739 
11:19:14 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-04T11:19:14.729Z] [INFO] [Ky3pDemoData] Generated demo data with 60 fields 
[2025-05-04T11:19:14.820Z] [INFO] [UnifiedDemoService] Deleted 120 ky3p responses for task 739 (resetProgress=false) 
[2025-05-04T11:19:14.907Z] [ERROR] [UnifiedDemoService] Error applying demo data to task 739: insert or update on table "ky3p_responses" violates foreign key constraint "ky3p_responses_field_id_fkey" 
[2025-05-04T11:19:14.907Z] [ERROR] [UnifiedDemoServiceRoutes] Error applying demo data: insert or update on table "ky3p_responses" violates foreign key constraint "ky3p_responses_field_id_fkey" 
11:19:14 AM [error] POST /api/unified-demo/apply/739 500 in 247ms :: {"error":"insert or update on table \"ky3p_responses\" violates foreign key c...
11:19:17 AM [info] GET /api/companies/current 304 in 41ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746357500564-ac44yp3: { type: 'ping' }
11:19:20 AM [info] GET /api/companies/current 304 in 34ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746357501048-myj6hvd: {
  type: 'ping',
  timestamp: '2025-05-04T11:19:21.031Z',
  connectionId: 'ws_1746357500033_4911s2qrv'
}
[Current Company] Fetching company for user: { userId: 310, companyId: 267 }
[Current Company] Found company: {
  id: 267,
  name: 'DevTest12',
  onboardingCompleted: false,
  riskScore: null,
  chosenScore: null,
  isDemo: true
}
11:19:23 AM [info] GET /api/companies/current 304 in 64ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-04T11:19:24.734Z] [INFO] [UnifiedDemoServiceRoutes] Applying demo data to task 739 
[2025-05-04T11:19:24.765Z] [INFO] [Ky3pDemoData] Generated demo data with 60 fields 
[2025-05-04T11:19:24.857Z] [INFO] [UnifiedDemoService] Deleted 120 ky3p responses for task 739 (resetProgress=false) 
[2025-05-04T11:19:24.927Z] [ERROR] [UnifiedDemoService] Error applying demo data to task 739: insert or update on table "ky3p_responses" violates foreign key constraint "ky3p_responses_field_id_fkey" 
[2025-05-04T11:19:24.927Z] [ERROR] [UnifiedDemoServiceRoutes] Error applying demo data: insert or update on table "ky3p_responses" violates foreign key constraint "ky3p_responses_field_id_fkey" 
11:19:24 AM [error] POST /api/unified-demo/apply/739 500 in 228ms :: {"error":"insert or update on table \"ky3p_responses\" violates foreign key c...
11:19:26 AM [info] GET /api/companies/current 304 in 33ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:19:29 AM [info] GET /api/companies/current 304 in 40ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:19:32 AM [info] GET /api/companies/current 304 in 32ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:19:35 AM [info] GET /api/companies/current 304 in 35ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[Current Company] Using cached company data: 267
11:19:38 AM [info] GET /api/companies/current 304 in 32ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746357501048-myj6hvd: {
  type: 'ping',
  timestamp: '2025-05-04T11:19:41.031Z',
  connectionId: 'ws_1746357500033_4911s2qrv'
}
11:19:41 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:19:44 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:19:50 AM [info] GET /api/companies/current 304 in 36ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746357500564-ac44yp3: { type: 'ping' }
11:19:50 AM [info] GET /api/companies/current 304 in 33ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:19:53 AM [info] GET /api/companies/current 304 in 32ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:19:56 AM [info] GET /api/companies/current 304 in 37ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:19:59 AM [info] GET /api/companies/current 304 in 32ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746357501048-myj6hvd: {
  type: 'ping',
  timestamp: '2025-05-04T11:20:01.031Z',
  connectionId: 'ws_1746357500033_4911s2qrv'
}
11:20:02 AM [info] GET /api/companies/current 304 in 36ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:20:05 AM [info] GET /api/companies/current 304 in 33ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:20:08 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:20:11 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:20:14 AM [info] GET /api/companies/current 304 in 31ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
11:20:17 AM [info] GET /api/companies/current 304 in 33ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746357500564-ac44yp3: { type: 'ping' }
11:20:20 AM [info] GET /api/companies/current 304 in 36ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746357501048-myj6hvd: {
  type: 'ping',
  timestamp: '2025-05-04T11:20:21.031Z',
  connectionId: 'ws_1746357500033_4911s2qrv'
}
[INFO] [WebSocket] Received message from client client-1746357501536-kpv1jnx: { type: 'ping' }
11:20:23 AM [info] GET /api/companies/current 304 in 42ms :: {"id":267,"name":"DevTest12","category":"FinTech","is_demo":true,"revenue_tie...
[Current Company] Fetching company for user: { userId: 310, companyId: 267 }
[Current Company] Found company: {
  id: 267,
  name: 'DevTest12',
  onboardingCompleted: false,
  riskScore: null,
  chosenScore: null,
  isDemo: true
}