> rest-express@1.0.0 dev
> tsx server/index.ts

[2025-05-30T10:56:35.846Z] [INFO] [Database] Initializing database connection with Neon PostgreSQL optimizations {"module":"Database","poolSize":3,"idleTimeout":600000,"connectionTimeout":180000}
[2025-05-30T10:56:35.851Z] [INFO] [Database] Database configuration completed successfully {"module":"Database","schemasLoaded":103,"timestamp":"2025-05-30T10:56:35.851Z"}
[EmailService] Initializing email service
[EmailService] Email service initialized successfully
[OpenAI] Service initialized with API key: API key is set
[2025-05-30T10:56:35.996Z] [INFO] [NeonConnectionService] Initializing Neon Connection Service {"module":"NeonConnectionService"}
[WebSocketService] Initialized in fallback mode (WebSocket server not available)
[Routes] Registering demo API routes with priority...
[Routes] Demo API routes registered successfully with priority
[Routes] Registering company name validation API...
[Routes] Company name validation API registered successfully
[2025-05-30T10:56:36.113Z] [INFO] [App] [WebSocket] Setting up unified WebSocket server on path /ws 
[2025-05-30T10:56:36.113Z] [INFO] [WebSocket] Unified WebSocket server initialized successfully {"module":"WebSocket","clients":0,"path":"/ws","id":"5nnaur","timestamp":"2025-05-30T10:56:36.113Z"}
[2025-05-30T10:56:36.113Z] [INFO] [App] [WebSocket] Unified WebSocket server initialized successfully 
[2025-05-30T10:56:36.114Z] [INFO] [App] [WebSocket] Unified WebSocket server handles form submission broadcasting 
[2025-05-30T10:56:36.114Z] [INFO] [App] [WebSocket] Skipping redundant WebSocket server initialization for deployment compatibility 
[2025-05-30T10:56:36.114Z] [INFO] [App] [ServerStartup] WebSocket server initialized with unified implementation 
[2025-05-30T10:56:36.114Z] [INFO] [App] [TaskWebSocket] WebSocket server registered with unified implementation 
[2025-05-30T10:56:36.114Z] [INFO] [App] [ServerStartup] WebSocket server registered with task-update utility 
[2025-05-30T10:56:36.114Z] [INFO] [TaskBroadcast] WebSocket server reference established {"module":"TaskBroadcast"}
[2025-05-30T10:56:36.114Z] [INFO] [TaskBroadcast] WebSocket server initialized {"module":"TaskBroadcast","connectedClients":0,"status":"active"}
[2025-05-30T10:56:36.114Z] [INFO] [App] [ServerStartup] WebSocket server registered with task-broadcast utility 
[2025-05-30T10:56:36.115Z] [INFO] [App] Setting up Vite development server 
[2025-05-30T10:56:36.116Z] [INFO] [App] [ProductionConfig] Applying Replit-optimized production configuration... 
[2025-05-30T10:56:36.116Z] [INFO] [App] [ProductionConfig] Applied memory optimization: max-old-space-size=1024MB 
[2025-05-30T10:56:36.116Z] [INFO] [App] [ProductionConfig] Enabled package layer optimization for deployment size reduction 
[2025-05-30T10:56:36.116Z] [INFO] [App] [ProductionConfig] Environment explicitly set to production 
[2025-05-30T10:56:36.116Z] [INFO] [App] [ProductionConfig] Production configuration applied successfully 
[2025-05-30T10:56:36.116Z] [INFO] [App] [ProductionConfig] All Replit deployment optimizations applied successfully 
[2025-05-30T10:56:36.116Z] [INFO] [App] [ENV] Server will listen on PORT=8080 (forced production mode) 
[2025-05-30T10:56:36.116Z] [INFO] [App] [ENV] Environment=production (forced production) 
[2025-05-30T10:56:36.116Z] [INFO] [App] [ENV] Deployment approach: Replit forced configuration for consistent Cloud Run deployment 
[2025-05-30T10:56:36.129Z] [INFO] [App] Server running on 0.0.0.0:8080 
[2025-05-30T10:56:36.129Z] [INFO] [App] Environment: production 
[Deployment] Server running on 0.0.0.0:8080
[Deployment] Environment: production
[Deployment] Port forwarding: Using Autoscale standard port (8080)
[Deployment] Production mode: Optimized for deployment
[2025-05-30T10:56:36.129Z] [INFO] [App] Starting periodic task reconciliation system... 
[2025-05-30T10:56:36.129Z] [INFO] [PeriodicTaskReconciliation] Periodic reconciliation system stopped {"module":"PeriodicTaskReconciliation","status":"inactive"}
[2025-05-30T10:56:36.130Z] [INFO] [PeriodicTaskReconciliation] Periodic reconciliation system started {"module":"PeriodicTaskReconciliation","intervalMs":300000,"cacheCleanupIntervalMs":900000,"status":"active"}
[2025-05-30T10:56:36.130Z] [INFO] [App] Task reconciliation system initialized successfully 
[Routes] Registering demo cleanup API...
[Routes] Demo cleanup API registered successfully
[2025-05-30T10:56:36.160Z] [INFO] [App] [KY3P-BATCH-UPDATE] Registering KY3P batch update routes 
[2025-05-30T10:56:36.160Z] [INFO] [App] Registering KY3P batch update routes 
[2025-05-30T10:56:36.160Z] [INFO] [App] [UnifiedKY3P] Registering unified KY3P update routes 
[Routes] Registered KY3P field key router
[2025-05-30T10:56:36.160Z] [INFO] [App] Registering KY3P field update routes 
[2025-05-30T10:56:36.162Z] [INFO] [App] [OpenBankingRoutes] Setting up routes... 
[Routes] Setting up transaction-based unified form submission router
[Routes] Successfully registered transaction-based unified form submission router
[Routes] Setting up unified form submission router
[Routes] Successfully registered unified form submission router
[Routes] Setting up transactional form submission router
[Routes] Successfully registered transactional form submission router
[Routes] Route registration completed: 15 modules initialized [DemoAPI, CompanyNameValidation, DemoCleanup, CompanySearch, KYB, KY3P-SubmissionFix, TaskProgress, UnifiedFormUpdate, KY3P-Fixed, KY3P-DemoAutofill, KY3P-BatchUpdate, KY3P-UnifiedUpdate, KY3P-FieldKey, UnifiedClearFields, TaskBroadcast]
[2025-05-30T10:56:36.816Z] [INFO] [Database] Successfully established new database connection {"module":"Database"}
[2025-05-30T10:56:37.597Z] [INFO] [App] [ServerStartup] WebSocket server active with 0 connected clients 
[2025-05-30T10:56:40.266Z] [INFO] [Database] Successfully established new database connection {"module":"Database"}
[2025-05-30T10:56:40.779Z] [INFO] [Database] Successfully established new database connection {"module":"Database"}
[2025-05-30T10:56:46.129Z] [INFO] [App] Running background health checks... 
[2025-05-30T10:56:46.129Z] [StartupChecks] Running application startup health checks... 
[2025-05-30T10:56:46.129Z] [StartupChecks] Database health check attempt 1/3 
[2025-05-30T10:56:46.130Z] [INFO] [NeonConnectionService] Creating minimal connection pool for Neon PostgreSQL {"module":"NeonConnectionService"}
[2025-05-30T10:56:46.313Z] [INFO] [NeonConnectionService] New client connected to the pool {"module":"NeonConnectionService"}
[2025-05-30T10:56:46.341Z] [INFO] [NeonConnectionService] Connection pool initialized successfully {"module":"NeonConnectionService"}
[2025-05-30T10:56:46.368Z] [DBConnectionService] Database connection check successful 
[2025-05-30T10:56:46.368Z] [StartupChecks] Database health check passed 
[2025-05-30T10:56:46.368Z] [StartupChecks] All startup health checks passed! 
[2025-05-30T10:56:46.368Z] [INFO] [App] All background health checks passed successfully. 
[Current Company] Fetching company for user: { userId: 534, companyId: 754 }
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 534, company_id: 754, email: 'bmiller@guardchampions.com' }
[2025-05-30T10:56:49.437Z] [INFO] [App] Performing dynamic task unlocking check for company {"companyId":754,"userId":534}
[Current Company] Found company: {
  id: 754,
  name: 'GuardChampions',
  onboardingCompleted: false,
  riskScore: null,
  chosenScore: null,
  isDemo: true
}
[Current Company] Onboarding status check: {
  userId: 534,
  companyId: 754,
  userOnboardingStatus: false,
  companyOnboardingStatus: false,
  timestamp: '2025-05-30T10:56:49.457Z'
}
[2025-05-30T10:56:49.464Z] [INFO] [App] No completed KYB tasks found, skipping security task unlock check {"companyId":754}
[Tasks] Automatically unlocking all tasks for company { userId: 534, companyId: 754, requestedBy: 'automatic_task_unlock' }
[2025-05-30T10:56:49.465Z] [INFO] [App] [TaskDependencies] Unlocking ALL tasks for company {"companyId":754}
[2025-05-30T10:56:49.492Z] [INFO] [App] GET /api/companies/current 304 in 67ms :: {"id":754,"name":"GuardChampions","category":"FinTech","is_demo":true,"revenu... 
[2025-05-30T10:56:49.499Z] [INFO] [App] [TaskDependencies] Found tasks to unlock {"companyId":754,"count":3,"taskIds":[1098,1099,1100],"taskTypes":["company_kyb","ky3p","open_banking"],"ky3pTaskCount":1,"ky3pTaskIds":[1099]}
[UnifiedProgress] Starting progress update for task 1098 (company_kyb) {
  taskId: 1098,
  taskType: 'company_kyb',
  diagnosticId: 'prog-1748602609500-869',
  metadata: [
    'locked',
    'prerequisite_completed',
    'prerequisite_completed_at',
    'dependencyUnlockOperation',
    'previousProgress',
    'previousStatus',
    'isKy3pTask',
    'isUserOnboardingTask'
  ]
}
[2025-05-30T10:56:49.531Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1748602609531-4nt8a5e","clients":1}
[UnifiedProgressCalc] Calculating progress for task 1098 (company_kyb)
[UnifiedProgressCalc] Task 1098 (company_kyb) progress: 0/30 = 0%
[2025-05-30T10:56:49.644Z] [INFO] [WebSocket] Broadcast message of type 'task_updated' sent to 1 clients {"module":"WebSocket","messageType":"task_updated","recipients":1,"totalClients":1,"filtered":false}
[2025-05-30T10:56:49.644Z] [INFO] [WebSocket] Broadcast message of type 'task_update' sent to 1 clients {"module":"WebSocket","messageType":"task_update","recipients":1,"totalClients":1,"filtered":false}
[2025-05-30T10:56:49.644Z] [DEBUG] [App] [UnifiedProgressCalc] Successfully broadcast task update using unified implementation {"taskId":1098,"messageId":"msg_1748602609643_19xmqhzs"}
[2025-05-30T10:56:49.644Z] [INFO] [App] [UnifiedProgressCalc] Successfully broadcast task update for task 1098 {"progress":0,"status":"not_started","messageId":"msg_1748602609643_19xmqhzs"}
[2025-05-30T10:56:49.644Z] [INFO] [App] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":754,"taskId":1098,"taskType":"company_kyb","isKy3pTask":false,"calculatedProgress":0,"previousProgress":0,"wasPreserved":false}
[2025-05-30T10:56:49.645Z] [INFO] [App] [TaskDependencies] Processing KY3P task {"taskId":1099,"taskType":"ky3p","currentProgress":0,"currentStatus":"not_started","timestamp":"2025-05-30T10:56:49.645Z"}
[UnifiedProgress] Starting progress update for task 1099 (ky3p) {
  taskId: 1099,
  taskType: 'ky3p',
  diagnosticId: 'prog-1748602609645-669',
  metadata: [
    'locked',
    'prerequisite_completed',
    'prerequisite_completed_at',
    'dependencyUnlockOperation',
    'previousProgress',
    'previousStatus',
    'isKy3pTask',
    'isUserOnboardingTask'
  ]
}
[2025-05-30T10:56:49.656Z] [INFO] [WebSocket] Received message from client client-1748602609531-4nt8a5e {"module":"WebSocket","type":"authenticate","data":{"timestamp":"2025-05-30T10:56:49.504Z"}}
[2025-05-30T10:56:49.656Z] [INFO] [WebSocket] Authentication from client client-1748602609531-4nt8a5e {"module":"WebSocket","hasToken":true}
[2025-05-30T10:56:49.679Z] [INFO] [App] [TabTutorials] Status request for tab "dashboard" from authenticated user ID: 534 
[2025-05-30T10:56:49.679Z] [INFO] [App] [TabTutorials] Normalizing tab name from 'dashboard' to canonical form 
[2025-05-30T10:56:49.679Z] [INFO] [App] [TabTutorials] Tab name already in canonical form: 'dashboard' 
[2025-05-30T10:56:49.679Z] [INFO] [App] [TabTutorials] Checking tutorial status for tab: dashboard (raw: dashboard), user: 534 
[UnifiedProgressCalc] Calculating progress for task 1099 (ky3p)
[2025-05-30T10:56:49.709Z] [INFO] [App] [TabTutorials] No tutorial status found for dashboard for user 534 
[2025-05-30T10:56:49.745Z] [INFO] [App] GET /api/user-tab-tutorials/dashboard/status 304 in 67ms :: {"exists":false,"completed":false,"currentStep":0,"tabName":"dashboard"} 
[KY3P Progress] Calculated progress for task 1099: {
  taskId: 1099,
  taskType: 'ky3p',
  normalizedTaskType: 'ky3p',
  totalFields: 120,
  completedFields: 0,
  progress: 0,
  timeStamp: '2025-05-30T10:56:49.764Z'
}
[UnifiedProgressCalc] Task 1099 (ky3p) progress: 0/120 = 0%
[2025-05-30T10:56:49.793Z] [INFO] [WebSocket] Broadcast message of type 'task_updated' sent to 1 clients {"module":"WebSocket","messageType":"task_updated","recipients":1,"totalClients":1,"filtered":false}
[2025-05-30T10:56:49.793Z] [INFO] [WebSocket] Broadcast message of type 'task_update' sent to 1 clients {"module":"WebSocket","messageType":"task_update","recipients":1,"totalClients":1,"filtered":false}
[2025-05-30T10:56:49.793Z] [DEBUG] [App] [UnifiedProgressCalc] Successfully broadcast task update using unified implementation {"taskId":1099,"messageId":"msg_1748602609792_92mdi47h"}
[2025-05-30T10:56:49.793Z] [INFO] [App] [UnifiedProgressCalc] Successfully broadcast task update for task 1099 {"progress":0,"status":"not_started","messageId":"msg_1748602609792_92mdi47h"}
[2025-05-30T10:56:49.793Z] [INFO] [App] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":754,"taskId":1099,"taskType":"ky3p","isKy3pTask":true,"calculatedProgress":0,"previousProgress":0,"wasPreserved":false}
[UnifiedProgress] Starting progress update for task 1100 (open_banking) {
  taskId: 1100,
  taskType: 'open_banking',
  diagnosticId: 'prog-1748602609793-881',
  metadata: [
    'locked',
    'prerequisite_completed',
    'prerequisite_completed_at',
    'dependencyUnlockOperation',
    'previousProgress',
    'previousStatus',
    'isKy3pTask',
    'isUserOnboardingTask'
  ]
}
[UnifiedProgressCalc] Calculating progress for task 1100 (open_banking)
[UnifiedProgressCalc] Task 1100 (open_banking) progress: 0/44 = 0%
[2025-05-30T10:56:49.933Z] [INFO] [WebSocket] Broadcast message of type 'task_updated' sent to 1 clients {"module":"WebSocket","messageType":"task_updated","recipients":1,"totalClients":1,"filtered":false}
[2025-05-30T10:56:49.933Z] [INFO] [WebSocket] Broadcast message of type 'task_update' sent to 1 clients {"module":"WebSocket","messageType":"task_update","recipients":1,"totalClients":1,"filtered":false}
[2025-05-30T10:56:49.933Z] [DEBUG] [App] [UnifiedProgressCalc] Successfully broadcast task update using unified implementation {"taskId":1100,"messageId":"msg_1748602609933_zl5kdef3"}
[2025-05-30T10:56:49.934Z] [INFO] [App] [UnifiedProgressCalc] Successfully broadcast task update for task 1100 {"progress":0,"status":"not_started","messageId":"msg_1748602609933_zl5kdef3"}
[2025-05-30T10:56:49.934Z] [INFO] [App] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":754,"taskId":1100,"taskType":"open_banking","isKy3pTask":false,"calculatedProgress":0,"previousProgress":0,"wasPreserved":false}
[2025-05-30T10:56:49.934Z] [INFO] [App] [TaskDependencies] Successfully unlocked all tasks {"companyId":754,"count":3}
[Tasks] Successfully unlocked all tasks for company: 754
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 534',
    condition2: 'tasks.created_by = 534',
    condition3: "tasks.company_id = 754 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('bmiller@guardchampions.com')"
  }
}
[Tasks] Tasks found: { count: 3 }
[2025-05-30T10:56:50.019Z] [INFO] [App] GET /api/tasks 304 in 583ms :: [{"id":1098,"title":"1. KYB Form: GuardChampions","description":null,"task_ty... 
[2025-05-30T10:56:50.038Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1748602610038-iq9w4ke","clients":2}
[2025-05-30T10:56:50.543Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1748602610543-slbbinr","clients":3}
[2025-05-30T10:56:51.041Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1748602611041-xroky2z","clients":4}
[2025-05-30T10:56:51.537Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1748602611537-7z3q2iz","clients":5}
[2025-05-30T10:56:51.656Z] [INFO] [WebSocket] Received message from client client-1748602611537-7z3q2iz {"module":"WebSocket","type":"authenticate","userId":null,"companyId":null,"clientId":"ws_1748602608682_htcgy2lp3","timestamp":"2025-05-30T10:56:51.503Z"}
[2025-05-30T10:56:51.656Z] [INFO] [WebSocket] Authentication from client client-1748602611537-7z3q2iz {"module":"WebSocket","userId":null,"companyId":null,"hasToken":true}
[2025-05-30T10:56:52.110Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1748602612110-wi5ja8d","clients":6}
[2025-05-30T10:56:52.679Z] [INFO] [WebSocket] Received message from client client-1748602612110-wi5ja8d {"module":"WebSocket","type":"authenticate","userId":534,"companyId":754,"clientId":"ws_1748602609967_1zzisca6q","timestamp":"2025-05-30T10:56:52.525Z"}
[2025-05-30T10:56:52.680Z] [INFO] [WebSocket] Authentication from client client-1748602612110-wi5ja8d {"module":"WebSocket","userId":534,"companyId":754,"hasToken":true}
[2025-05-30T10:57:05.238Z] [INFO] [App] GET /api/tasks 304 in 30ms :: [{"id":1098,"title":"1. KYB Form: GuardChampions","description":null,"task_ty... 
[2025-05-30T10:57:06.173Z] [INFO] [PeriodicTaskReconciliation] Reconciling batch of tasks {"module":"PeriodicTaskReconciliation","batchSize":3,"taskIds":[1098,1099,1100]}
[Task Progress] Calculated progress for task 1098 (company_kyb): 0/30 = 0%
[Task Progress] Calculated progress for task 1099 (ky3p): 0/0 = 0%
[Task Progress] Calculated progress for task 1100 (open_banking): 0/44 = 0%
[2025-05-30T10:57:12.233Z] [INFO] [WebSocket] Received message from client client-1748602612110-wi5ja8d {"module":"WebSocket","type":"ping","timestamp":"2025-05-30T10:57:12.079Z","connectionId":"ws_1748602609967_1zzisca6q"}
[2025-05-30T10:57:13.737Z] [INFO] [App] GET /api/companies/current 304 in 30ms :: {"id":754,"name":"GuardChampions","category":"FinTech","is_demo":true,"revenu... [sampled: request 11] 
[2025-05-30T10:57:19.659Z] [INFO] [WebSocket] Received message from client client-1748602609531-4nt8a5e {"module":"WebSocket","type":"ping"}
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 534, company_id: 754, email: 'bmiller@guardchampions.com' }
[2025-05-30T10:57:20.430Z] [INFO] [App] Performing dynamic task unlocking check for company {"companyId":754,"userId":534}
[2025-05-30T10:57:20.457Z] [INFO] [App] No completed KYB tasks found, skipping security task unlock check {"companyId":754}
[Tasks] Automatically unlocking all tasks for company { userId: 534, companyId: 754, requestedBy: 'automatic_task_unlock' }
[2025-05-30T10:57:20.458Z] [INFO] [App] [TaskDependencies] Unlocking ALL tasks for company {"companyId":754}
[2025-05-30T10:57:20.487Z] [INFO] [App] [TaskDependencies] Found tasks to unlock {"companyId":754,"count":3,"taskIds":[1098,1099,1100],"taskTypes":["company_kyb","ky3p","open_banking"],"ky3pTaskCount":1,"ky3pTaskIds":[1099]}
[UnifiedProgress] Starting progress update for task 1098 (company_kyb) {
  taskId: 1098,
  taskType: 'company_kyb',
  diagnosticId: 'prog-1748602640488-316',
  metadata: [
    'locked',
    'prerequisite_completed',
    'prerequisite_completed_at',
    'dependencyUnlockOperation',
    'previousProgress',
    'previousStatus',
    'isKy3pTask',
    'isUserOnboardingTask'
  ]
}
[UnifiedProgressCalc] Calculating progress for task 1098 (company_kyb)
[UnifiedProgressCalc] Task 1098 (company_kyb) progress: 0/30 = 0%
[2025-05-30T10:57:20.627Z] [INFO] [WebSocket] Broadcast message of type 'task_updated' sent to 6 clients {"module":"WebSocket","messageType":"task_updated","recipients":6,"totalClients":6,"filtered":false}
[2025-05-30T10:57:20.628Z] [INFO] [WebSocket] Broadcast message of type 'task_update' sent to 6 clients {"module":"WebSocket","messageType":"task_update","recipients":6,"totalClients":6,"filtered":false}
[2025-05-30T10:57:20.628Z] [DEBUG] [App] [UnifiedProgressCalc] Successfully broadcast task update using unified implementation {"taskId":1098,"messageId":"msg_1748602640626_tt2b38t8"}
[2025-05-30T10:57:20.628Z] [INFO] [App] [UnifiedProgressCalc] Successfully broadcast task update for task 1098 {"progress":0,"status":"not_started","messageId":"msg_1748602640626_tt2b38t8"}
[2025-05-30T10:57:20.628Z] [INFO] [App] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":754,"taskId":1098,"taskType":"company_kyb","isKy3pTask":false,"calculatedProgress":0,"previousProgress":0,"wasPreserved":false}
[2025-05-30T10:57:20.628Z] [INFO] [App] [TaskDependencies] Processing KY3P task {"taskId":1099,"taskType":"ky3p","currentProgress":0,"currentStatus":"not_started","timestamp":"2025-05-30T10:57:20.628Z"}
[UnifiedProgress] Starting progress update for task 1099 (ky3p) {
  taskId: 1099,
  taskType: 'ky3p',
  diagnosticId: 'prog-1748602640629-954',
  metadata: [
    'locked',
    'prerequisite_completed',
    'prerequisite_completed_at',
    'dependencyUnlockOperation',
    'previousProgress',
    'previousStatus',
    'isKy3pTask',
    'isUserOnboardingTask'
  ]
}
[2025-05-30T10:57:20.662Z] [INFO] [WebSocket] Received message from client client-1748602610543-slbbinr {"module":"WebSocket","type":"ping","timestamp":"2025-05-30T10:57:20.511Z","connectionId":"ws_1748602610509_bg6p194g7"}
[UnifiedProgressCalc] Calculating progress for task 1099 (ky3p)
[KY3P Progress] Calculated progress for task 1099: {
  taskId: 1099,
  taskType: 'ky3p',
  normalizedTaskType: 'ky3p',
  totalFields: 120,
  completedFields: 0,
  progress: 0,
  timeStamp: '2025-05-30T10:57:20.742Z'
}
[UnifiedProgressCalc] Task 1099 (ky3p) progress: 0/120 = 0%
[2025-05-30T10:57:20.769Z] [INFO] [WebSocket] Broadcast message of type 'task_updated' sent to 6 clients {"module":"WebSocket","messageType":"task_updated","recipients":6,"totalClients":6,"filtered":false}
[2025-05-30T10:57:20.770Z] [INFO] [WebSocket] Broadcast message of type 'task_update' sent to 6 clients {"module":"WebSocket","messageType":"task_update","recipients":6,"totalClients":6,"filtered":false}
[2025-05-30T10:57:20.770Z] [DEBUG] [App] [UnifiedProgressCalc] Successfully broadcast task update using unified implementation {"taskId":1099,"messageId":"msg_1748602640769_pd26k8nn"}
[2025-05-30T10:57:20.770Z] [INFO] [App] [UnifiedProgressCalc] Successfully broadcast task update for task 1099 {"progress":0,"status":"not_started","messageId":"msg_1748602640769_pd26k8nn"}
[2025-05-30T10:57:20.770Z] [INFO] [App] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":754,"taskId":1099,"taskType":"ky3p","isKy3pTask":true,"calculatedProgress":0,"previousProgress":0,"wasPreserved":false}
[UnifiedProgress] Starting progress update for task 1100 (open_banking) {
  taskId: 1100,
  taskType: 'open_banking',
  diagnosticId: 'prog-1748602640771-377',
  metadata: [
    'locked',
    'prerequisite_completed',
    'prerequisite_completed_at',
    'dependencyUnlockOperation',
    'previousProgress',
    'previousStatus',
    'isKy3pTask',
    'isUserOnboardingTask'
  ]
}
[UnifiedProgressCalc] Calculating progress for task 1100 (open_banking)
[UnifiedProgressCalc] Task 1100 (open_banking) progress: 0/44 = 0%
[2025-05-30T10:57:20.914Z] [INFO] [WebSocket] Broadcast message of type 'task_updated' sent to 6 clients {"module":"WebSocket","messageType":"task_updated","recipients":6,"totalClients":6,"filtered":false}
[2025-05-30T10:57:20.915Z] [INFO] [WebSocket] Broadcast message of type 'task_update' sent to 6 clients {"module":"WebSocket","messageType":"task_update","recipients":6,"totalClients":6,"filtered":false}
[2025-05-30T10:57:20.915Z] [DEBUG] [App] [UnifiedProgressCalc] Successfully broadcast task update using unified implementation {"taskId":1100,"messageId":"msg_1748602640914_gn33875r"}
[2025-05-30T10:57:20.915Z] [INFO] [App] [UnifiedProgressCalc] Successfully broadcast task update for task 1100 {"progress":0,"status":"not_started","messageId":"msg_1748602640914_gn33875r"}
[2025-05-30T10:57:20.915Z] [INFO] [App] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":754,"taskId":1100,"taskType":"open_banking","isKy3pTask":false,"calculatedProgress":0,"previousProgress":0,"wasPreserved":false}
[2025-05-30T10:57:20.915Z] [INFO] [App] [TaskDependencies] Successfully unlocked all tasks {"companyId":754,"count":3}
[Tasks] Successfully unlocked all tasks for company: 754
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 534',
    condition2: 'tasks.created_by = 534',
    condition3: "tasks.company_id = 754 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('bmiller@guardchampions.com')"
  }
}
[Tasks] Tasks found: { count: 3 }
[2025-05-30T10:57:21.002Z] [INFO] [App] GET /api/tasks 200 in 573ms :: [{"id":1098,"title":"1. KYB Form: GuardChampions","description":null,"task_ty... 
[2025-05-30T10:57:21.163Z] [INFO] [WebSocket] Received message from client client-1748602611041-xroky2z {"module":"WebSocket","type":"ping","timestamp":"2025-05-30T10:57:21.010Z","connectionId":"ws_1748602610009_yzopcxgaz"}
[Current Company] Using cached company data: 754
[2025-05-30T10:57:32.231Z] [INFO] [WebSocket] Received message from client client-1748602612110-wi5ja8d {"module":"WebSocket","type":"ping","timestamp":"2025-05-30T10:57:32.079Z","connectionId":"ws_1748602609967_1zzisca6q"}
[Complete Onboarding] Processing request for user: { userId: 534, companyId: 754, timestamp: '2025-05-30T10:57:35.092Z' }
[Complete Onboarding] BLOCKED: New Data Recipient demo users should not complete onboarding: {
  userId: 534,
  demoPersonaType: 'new-data-recipient',
  isDemoUser: true,
  reason: 'New Data Recipients must show onboarding modal for authentic persona experience'
}
[2025-05-30T10:57:35.153Z] [INFO] [App] POST /api/users/complete-onboarding 200 in 62ms :: {"message":"Onboarding completion blocked for New Data Recipient persona","su... 
[Company API] Updating company 754 with data: { revenue: 17500000, revenue_tier: 'medium', num_employees: 150 }
[Company API] Processed update data: { revenue: 17500000, revenue_tier: 'medium', num_employees: 150 }
[Cache] Invalidating company cache for company 754
[Company API] Successfully updated company 754
[2025-05-30T10:57:35.400Z] [INFO] [App] PATCH /api/companies/current 200 in 65ms :: {"success":true,"message":"Company updated successfully","data":{"id":754,"na... 
[Current Company] Fetching company for user: { userId: 534, companyId: 754 }
[Current Company] Found company: {
  id: 754,
  name: 'GuardChampions',
  onboardingCompleted: false,
  riskScore: null,
  chosenScore: null,
  isDemo: true
}
[Current Company] Onboarding status check: {
  userId: 534,
  companyId: 754,
  userOnboardingStatus: false,
  companyOnboardingStatus: false,
  timestamp: '2025-05-30T10:57:35.819Z'
}
[2025-05-30T10:57:36.042Z] [DEBUG] [App] Incoming invite request - Headers: {"host":"9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev","user-agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36","content-length":"160","accept":"*/*","accept-encoding":"gzip, deflate, br, zstd","accept-language":"en-US,en;q=0.9","content-type":"application/json","cookie":"connect.sid=s%3ASugxsYzTbZORdtDGWU0Y5fY1F9RL43w0.w6MPmmI1aBdYTLqfxeCQfhAVPniud5Z4N1EsgW0hhlI","dnt":"1","origin":"https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev:8080","referer":"https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev:8080/task-center","sec-ch-ua":"\"Not.A/Brand\";v=\"99\", \"Chromium\";v=\"136\"","sec-ch-ua-mobile":"?0","sec-ch-ua-platform":"\"macOS\"","sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin","sec-fetch-storage-access":"active","x-forwarded-for":"79.117.186.58, 10.81.11.133","x-forwarded-proto":"https","x-replit-user-bio":"","x-replit-user-id":"","x-replit-user-name":"","x-replit-user-profile-image":"","x-replit-user-roles":"","x-replit-user-teams":"","x-replit-user-url":""} 
[2025-05-30T10:57:36.042Z] [DEBUG] [App] Request body (raw): {"email":"js@e.com","full_name":"James Smith","company_id":754,"company_name":"GuardChampions","sender_name":"Brandon Miller","sender_company":"GuardChampions"} 
[Invite] Starting invitation process
[Invite] Request body: {
  email: 'js@e.com',
  full_name: 'James Smith',
  company_id: 754,
  company_name: 'GuardChampions',
  sender_name: 'Brandon Miller',
  sender_company: 'GuardChampions'
}
[Invite] Validated invite data: {
  email: 'js@e.com',
  full_name: 'James Smith',
  company_id: 754,
  company_name: 'GuardChampions',
  sender_name: 'Brandon Miller',
  sender_company: 'GuardChampions'
}
[Invite] Starting database transaction
[Invite] Creating user account
[2025-05-30T10:57:36.262Z] [INFO] [App] GET /api/tasks 304 in 30ms :: [{"id":1098,"title":"1. KYB Form: GuardChampions","description":null,"task_ty... 
[EmailService] Starting to send template email
[EmailService] Template type: user_invite
[EmailService] Recipient: js@e.com
[EmailService] Template data (raw): {
  "recipientEmail": "js@e.com",
  "recipientName": "James Smith",
  "senderName": "Brandon Miller",
  "senderCompany": "GuardChampions",
  "targetCompany": "GuardChampions",
  "code": "69F6D8",
  "inviteUrl": "https://invela.replit.app//auth?code=69F6D8"
}
[EmailService] Starting email validation for: js@e.com
[EmailService] Checking MX records for domain: e.com
[EmailService] MX record check failed: Error: queryMx ENOTFOUND e.com
    at QueryReqWrap.onresolve [as oncomplete] (node:internal/dns/callback_resolver:45:19) {
  errno: undefined,
  code: 'ENOTFOUND',
  syscall: 'queryMx',
  hostname: 'e.com'
}
[EmailService] Continuing despite MX check failure
[EmailService] Email validation successful for: js@e.com
[EmailService] Transforming template data
[EmailService] Starting template data transformation
[EmailService] Input template data: {
  "recipientEmail": "js@e.com",
  "recipientName": "James Smith",
  "senderName": "Brandon Miller",
  "senderCompany": "GuardChampions",
  "targetCompany": "GuardChampions",
  "code": "69F6D8",
  "inviteUrl": "https://invela.replit.app//auth?code=69F6D8"
}
[EmailService] Built invite URL: https://invela.replit.app//auth?code=69F6D8
[EmailService] Transformed template data: {
  "recipientName": "James Smith",
  "recipientEmail": "js@e.com",
  "senderName": "Brandon Miller",
  "senderCompany": "GuardChampions",
  "targetCompany": "GuardChampions",
  "inviteUrl": "https://invela.replit.app//auth?code=69F6D8",
  "code": "69F6D8"
}
[EmailService] Getting email template: user_invite
[EmailTemplate] Getting template: user_invite
[EmailTemplate] Template data: {
  "recipientName": "James Smith",
  "recipientEmail": "js@e.com",
  "senderName": "Brandon Miller",
  "senderCompany": "GuardChampions",
  "targetCompany": "GuardChampions",
  "inviteUrl": "https://invela.replit.app//auth?code=69F6D8",
  "code": "69F6D8"
}
[Template:invitation] Received template data: {
  "recipientName": "James Smith",
  "recipientEmail": "js@e.com",
  "senderName": "Brandon Miller",
  "senderCompany": "GuardChampions",
  "targetCompany": "GuardChampions",
  "inviteUrl": "https://invela.replit.app//auth?code=69F6D8",
  "code": "69F6D8",
  "inviteType": "user"
}
[EmailService] Template generated successfully
[EmailService] Preparing to send email with configuration: {
  from: 'noreply@example.com',
  to: 'js@e.com',
  subject: 'Invitation to join Invela',
  textLength: 470,
  htmlLength: 1557
}
[EmailService] Email sent successfully to: js@e.com
[2025-05-30T10:57:37.400Z] [INFO] [App] POST /api/users/invite 201 in 1357ms :: {"message":"Invitation sent successfully","invitation":{"id":462,"email":"js@... 
[2025-05-30T10:57:37.850Z] [INFO] [App] GET /api/companies/current 304 in 32ms :: {"id":754,"name":"GuardChampions","category":"FinTech","is_demo":true,"revenu... [sampled: request 21] 