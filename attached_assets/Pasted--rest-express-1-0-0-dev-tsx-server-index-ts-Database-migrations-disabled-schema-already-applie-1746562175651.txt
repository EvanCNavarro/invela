> rest-express@1.0.0 dev
> tsx server/index.ts

Database migrations disabled - schema already applied
[EmailService] Initializing email service
[EmailService] Email service initialized successfully
[OpenAI] Service initialized with API key: API key is set
Database module not found, creating a mock implementation
Database module not found, creating a mock implementation
[Auth] Setting up authentication...
[Auth] Setting up PostgreSQL session store
[Auth] PostgreSQL session store initialized successfully
[Auth] Authentication setup completed
[2025-05-06T19:58:13.813Z] [INFO] [KY3P-BATCH-UPDATE] Registering KY3P batch update routes
[2025-05-06T19:58:13.813Z] [INFO] Registering KY3P batch update routes
[2025-05-06T19:58:13.813Z] [INFO] [UnifiedKY3P] Registering unified KY3P update routes
[Routes] Registered KY3P field key router
[Routes] Registered KY3P field key router
[2025-05-06T19:58:13.814Z] [INFO] Registering KY3P field update routes
[2025-05-06T19:58:13.815Z] [INFO] [OpenBankingRoutes] Setting up routes...
[Routes] Setting up transaction-based unified form submission router
[Routes] Successfully registered transaction-based unified form submission router
[Routes] Setting up unified form submission router
[Routes] Successfully registered unified form submission router
[Routes] Setting up transactional form submission router
[Routes] Successfully registered transactional form submission router
[Routes] Routes setup completed
[2025-05-06T19:58:13.816Z] [INFO] [WebSocket] Setting up WebSocket server on path /ws
[INFO] Unified WebSocket server initialized successfully with details: {
  clients: 0,
  path: '/ws',
  id: '0e9spv',
  timestamp: '2025-05-06T19:58:13.816Z'
}
[2025-05-06T19:58:13.818Z] [INFO] [WebSocket] WebSocket server initialized successfully
[2025-05-06T19:58:13.818Z] [INFO] [ServerStartup] WebSocket server initialized with unified implementation
[2025-05-06T19:58:13.819Z] [INFO] [TaskWebSocket] WebSocket server registered with unified implementation
[2025-05-06T19:58:13.819Z] [INFO] [ServerStartup] WebSocket server registered with task-update utility
[TaskBroadcast] WebSocket server reference set up
[TaskBroadcast] WebSocket server active with 0 connected clients
[2025-05-06T19:58:13.819Z] [INFO] [ServerStartup] WebSocket server registered with task-broadcast utility
[2025-05-06T19:58:13.819Z] [INFO] Setting up Vite development server
[ENV] Using PORT=5000 from environment (override: yes)
[ENV] Environment=development (production: no)
[2025-05-06T19:58:13.830Z] [INFO] Server running on 0.0.0.0:5000
[2025-05-06T19:58:13.830Z] [INFO] Environment: development
[Deployment] Server running on 0.0.0.0:5000
[Deployment] Environment: development
[Deployment] Port forwarding: Custom port: 5000
[Deployment] Development mode: Hot reloading enabled
[2025-05-06T19:58:13.831Z] [INFO] Starting periodic task reconciliation system...
[PeriodicTaskReconciliation] Stopped periodic reconciliation system
[PeriodicTaskReconciliation] Starting periodic reconciliation system (interval: 300000ms)
[2025-05-06T19:58:13.831Z] [INFO] Task reconciliation system initialized successfully
[2025-05-06T19:58:15.121Z] [INFO] [ServerStartup] WebSocket server active with 0 connected clients
[INFO] [WebSocket] Client connected: client-1746561499754-5p9285d
[Auth] Unauthenticated user session
[INFO] [WebSocket] Received message from client client-1746561499754-5p9285d: {
  type: 'authenticate',
  data: { timestamp: '2025-05-06T19:58:19.860Z' }
}
[INFO] [WebSocket] Authentication from client client-1746561499754-5p9285d: { userId: undefined, companyId: undefined, hasToken: false }
[INFO] [WebSocket] Client disconnected: client-1746561499754-5p9285d { code: 1001, reason: 'No reason provided', connectionDuration: '1s' }
[2025-05-06T19:58:43.940Z] New client connected to the pool (1/3)
[PeriodicTaskReconciliation] Reconciling batch of 10 tasks: [
  685, 679, 699, 697,
  751, 691, 760, 707,
  759, 714
]
[Task Progress] Calculated progress for task 685 (company_kyb): 30/30 = 100%
[Task Progress] Calculated progress for task 679 (open_banking): 44/44 = 100%
[Task Progress] Calculated progress for task 699 (open_banking): 0/44 = 0%
[Task Progress] Calculated progress for task 697 (company_kyb): 30/30 = 100%
[Task Progress] Calculated progress for task 751 (ky3p): 0/120 = 0%
[Task Progress] Calculated progress for task 691 (open_banking): 0/44 = 0%
[Task Progress] Calculated progress for task 760 (open_banking): 0/44 = 0%
[Task Progress] Calculated progress for task 707 (open_banking): 0/44 = 0%
[Task Progress] Calculated progress for task 759 (ky3p): 0/0 = 0%
[Task Progress] Calculated progress for task 714 (ky3p): 0/0 = 0%
[2025-05-06T19:59:03.264Z] New client connected to the pool (2/3)
[2025-05-06T19:59:04.638Z] New client connected to the pool (3/3)
[Auth] Returning user session data
[Current Company] Fetching company for user: { userId: 315, companyId: 272 }
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 315, company_id: 272, email: '17@e.com' }
[2025-05-06T19:59:24.346Z] [INFO] Performing dynamic task unlocking check for company {"companyId":272,"userId":315}
[2025-05-06T19:59:24.387Z] [INFO] No completed KYB tasks found, skipping security task unlock check {"companyId":272}
[Tasks] Automatically unlocking all tasks for company { userId: 315, companyId: 272, requestedBy: 'automatic_task_unlock' }
[2025-05-06T19:59:24.388Z] [INFO] [TaskDependencies] Unlocking ALL tasks for company {"companyId":272}
[Current Company] Found company: {
  id: 272,
  name: 'DevTest17',
  onboardingCompleted: false,
  riskScore: null,
  chosenScore: null,
  isDemo: true
}
[2025-05-06T19:59:24.418Z] [INFO] [TaskDependencies] Found user onboarding task that needs completion {"taskId":757,"userEmail":"17@e.com","currentStatus":"completed","currentProgress":100}
[TaskDependencies] Skipping task 758 with submission indicators {
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasFileId: false,
  status: 'ready_for_submission',
  progress: 100,
  isReadyForSubmission: true
}
[2025-05-06T19:59:24.418Z] [INFO] [TaskDependencies] Found tasks to unlock {"companyId":272,"count":3,"taskIds":[757,759,760],"taskTypes":["user_onboarding","ky3p","open_banking"],"ky3pTaskCount":1,"ky3pTaskIds":[759]}
[2025-05-06T19:59:24.418Z] [INFO] [TaskDependencies] Setting User Onboarding task as completed {"taskId":757,"userEmail":"17@e.com","timestamp":"2025-05-06T19:59:24.418Z"}
[2025-05-06T19:59:24.427Z] [INFO] GET /api/companies/current 200 in 88ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Client connected: client-1746561564445-1axxiw3
[2025-05-06T19:59:24.454Z] [INFO] Successfully retrieved unified WebSocket server for broadcast
[WebSocket] Broadcast task_update to 1 clients (0 errors) { messageId: 'msg_1746561564454_ih5yx2gwi' }
[2025-05-06T19:59:24.455Z] [INFO] Successfully broadcasted task_update message
[2025-05-06T19:59:24.455Z] [INFO] [TaskDependencies] Processing KY3P task {"taskId":759,"taskType":"ky3p","currentProgress":0,"currentStatus":"not_started","timestamp":"2025-05-06T19:59:24.455Z"}
[UnifiedProgress] Starting progress update for task 759 (ky3p) {
  taskId: 759,
  taskType: 'ky3p',
  diagnosticId: 'prog-1746561564455-646',
  metadata: [
    'locked',
    'prerequisite_completed',
    'prerequisite_completed_at',
    'dependencyUnlockOperation',
    'previousProgress',
    'previousStatus',
    'isKy3pTask',
    'isUserOnboardingTask'
  ]
}
[UnifiedProgressCalc] Calculating progress for task 759 (ky3p)
[INFO] [WebSocket] Received message from client client-1746561564445-1axxiw3: {
  type: 'authenticate',
  data: { timestamp: '2025-05-06T19:59:24.464Z' }
}
[INFO] [WebSocket] Authentication from client client-1746561564445-1axxiw3: { userId: undefined, companyId: undefined, hasToken: true }
[KY3P Progress] Calculated progress for task 759: {
  taskId: 759,
  taskType: 'ky3p',
  normalizedTaskType: 'ky3p',
  totalFields: 120,
  completedFields: 0,
  progress: 0,
  timeStamp: '2025-05-06T19:59:24.576Z'
}
[UnifiedProgressCalc] Task 759 (ky3p) progress: 0/120 = 0%
[INFO] [WebSocket] Broadcast task_updated to 1 clients
[2025-05-06T19:59:24.605Z] [INFO] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":272,"taskId":759,"taskType":"ky3p","isKy3pTask":true,"calculatedProgress":{"success":true,"taskId":759,"message":"Progress unchanged","progress":0,"status":"not_started"},"previousProgress":0,"wasPreserved":false}
[UnifiedProgress] Starting progress update for task 760 (open_banking) {
  taskId: 760,
  taskType: 'open_banking',
  diagnosticId: 'prog-1746561564605-70',
  metadata: [
    'locked',
    'prerequisite_completed',
    'prerequisite_completed_at',
    'dependencyUnlockOperation',
    'previousProgress',
    'previousStatus',
    'isKy3pTask',
    'isUserOnboardingTask'
  ]
}
[2025-05-06T19:59:24.635Z] [INFO] GET /api/companies/current 304 in 30ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[UnifiedProgressCalc] Calculating progress for task 760 (open_banking)
[UnifiedProgressCalc] Task 760 (open_banking) progress: 0/44 = 0%
[INFO] [WebSocket] Broadcast task_updated to 1 clients
[2025-05-06T19:59:24.766Z] [INFO] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":272,"taskId":760,"taskType":"open_banking","isKy3pTask":false,"calculatedProgress":{"success":true,"taskId":760,"message":"Progress unchanged","progress":0,"status":"not_started"},"previousProgress":0,"wasPreserved":false}
[2025-05-06T19:59:24.767Z] [INFO] [TaskDependencies] Successfully unlocked all tasks {"companyId":272,"count":3}
[Tasks] Successfully unlocked all tasks for company: 272
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 315',
    condition2: 'tasks.created_by = 315',
    condition3: "tasks.company_id = 272 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('17@e.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
[2025-05-06T19:59:24.888Z] [INFO] GET /api/tasks 200 in 543ms :: [{"id":757,"title":"New User Invitation: 17@e.com","description":"Complete us...
[INFO] [WebSocket] Client connected: client-1746561564951-upy7pjg
[INFO] [WebSocket] Received message from client client-1746561564951-upy7pjg: {
  type: 'authenticate',
  userId: null,
  companyId: null,
  clientId: 'ws_1746561563940_5ldtit38q',
  timestamp: '2025-05-06T19:59:24.961Z'
}
[INFO] [WebSocket] Authentication from client client-1746561564951-upy7pjg: { userId: null, companyId: null, hasToken: true }
[2025-05-06T19:59:25.071Z] [INFO] GET /api/tasks 304 in 30ms :: [{"id":757,"title":"New User Invitation: 17@e.com","description":"Complete us...
[INFO] [WebSocket] Client connected: client-1746561565790-xnq2byf
[Auth] Returning user session data
[2025-05-06T19:59:26.190Z] [INFO] GET /api/companies/current 304 in 33ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746561565790-xnq2byf: {
  type: 'authenticate',
  userId: 315,
  companyId: 272,
  clientId: 'ws_1746561565268_xxxkuq1ye',
  timestamp: '2025-05-06T19:59:26.209Z'
}
[INFO] [WebSocket] Authentication from client client-1746561565790-xnq2byf: { userId: 315, companyId: 272, hasToken: true }
[2025-05-06T19:59:28.451Z] [INFO] GET /api/companies/current 304 in 37ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T19:59:31.472Z] [INFO] GET /api/companies/current 304 in 36ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T19:59:34.439Z] [INFO] GET /api/companies/current 304 in 31ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T19:59:37.529Z] [INFO] GET /api/companies/current 304 in 116ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T19:59:40.556Z] [INFO] GET /api/companies/current 304 in 32ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T19:59:43.462Z] [INFO] GET /api/companies/current 304 in 37ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746561565790-xnq2byf: {
  type: 'ping',
  timestamp: '2025-05-06T19:59:46.264Z',
  connectionId: 'ws_1746561565268_xxxkuq1ye'
}
[2025-05-06T19:59:46.440Z] [INFO] GET /api/companies/current 304 in 31ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T19:59:49.447Z] [INFO] GET /api/companies/current 304 in 37ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[Current Company] Using cached company data: 272
[2025-05-06T19:59:52.468Z] [INFO] GET /api/companies/current 304 in 39ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746561564445-1axxiw3: { type: 'ping' }
[2025-05-06T19:59:55.484Z] [INFO] GET /api/companies/current 304 in 31ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T19:59:58.440Z] [INFO] GET /api/companies/current 304 in 32ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:00:01.445Z] [INFO] GET /api/companies/current 304 in 31ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:00:04.436Z] [INFO] GET /api/companies/current 304 in 31ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746561565790-xnq2byf: {
  type: 'ping',
  timestamp: '2025-05-06T20:00:06.262Z',
  connectionId: 'ws_1746561565268_xxxkuq1ye'
}
[INFO] [WebSocket] Received message from client client-1746561564445-1axxiw3: { type: 'ping' }
[INFO] [WebSocket] Received message from client client-1746561565790-xnq2byf: {
  type: 'ping',
  timestamp: '2025-05-06T20:00:26.263Z',
  connectionId: 'ws_1746561565268_xxxkuq1ye'
}
[INFO] [WebSocket] Received message from client client-1746561565790-xnq2byf: {
  type: 'ping',
  timestamp: '2025-05-06T20:00:46.263Z',
  connectionId: 'ws_1746561565268_xxxkuq1ye'
}
[INFO] [WebSocket] Received message from client client-1746561564445-1axxiw3: { type: 'ping' }
[Current Company] Fetching company for user: { userId: 315, companyId: 272 }
[Current Company] Found company: {
  id: 272,
  name: 'DevTest17',
  onboardingCompleted: false,
  riskScore: null,
  chosenScore: null,
  isDemo: true
}
[2025-05-06T20:01:03.542Z] [INFO] GET /api/companies/current 304 in 81ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746561564445-1axxiw3: { type: 'ping' }
[INFO] [WebSocket] Received message from client client-1746561564951-upy7pjg: { type: 'ping' }
[INFO] [WebSocket] Received message from client client-1746561564445-1axxiw3: { type: 'ping' }
[INFO] [WebSocket] Received message from client client-1746561565790-xnq2byf: {
  type: 'ping',
  timestamp: '2025-05-06T20:02:03.269Z',
  connectionId: 'ws_1746561565268_xxxkuq1ye'
}
[2025-05-06T20:02:03.480Z] [INFO] GET /api/companies/current 304 in 33ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746561564445-1axxiw3: { type: 'ping' }
[INFO] [WebSocket] Received message from client client-1746561565790-xnq2byf: {
  type: 'ping',
  timestamp: '2025-05-06T20:02:53.635Z',
  connectionId: 'ws_1746561565268_xxxkuq1ye'
}
[Current Company] Fetching company for user: { userId: 315, companyId: 272 }
[Current Company] Found company: {
  id: 272,
  name: 'DevTest17',
  onboardingCompleted: false,
  riskScore: null,
  chosenScore: null,
  isDemo: true
}
[2025-05-06T20:02:53.969Z] [INFO] GET /api/companies/current 304 in 77ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
Suppressing further connection logs. Pool size: 3
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 315, company_id: 272, email: '17@e.com' }
[2025-05-06T20:02:54.089Z] [INFO] Performing dynamic task unlocking check for company {"companyId":272,"userId":315}
[2025-05-06T20:02:54.129Z] [INFO] No completed KYB tasks found, skipping security task unlock check {"companyId":272}
[Tasks] Automatically unlocking all tasks for company { userId: 315, companyId: 272, requestedBy: 'automatic_task_unlock' }
[2025-05-06T20:02:54.129Z] [INFO] [TaskDependencies] Unlocking ALL tasks for company {"companyId":272}
[2025-05-06T20:02:54.163Z] [INFO] GET /api/companies/current 304 in 38ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:02:54.167Z] [INFO] [TaskDependencies] Found user onboarding task that needs completion {"taskId":757,"userEmail":"17@e.com","currentStatus":"completed","currentProgress":100}
[TaskDependencies] Skipping task 758 with submission indicators {
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasFileId: false,
  status: 'ready_for_submission',
  progress: 100,
  isReadyForSubmission: true
}
[2025-05-06T20:02:54.167Z] [INFO] [TaskDependencies] Found tasks to unlock {"companyId":272,"count":3,"taskIds":[757,759,760],"taskTypes":["user_onboarding","ky3p","open_banking"],"ky3pTaskCount":1,"ky3pTaskIds":[759]}
[2025-05-06T20:02:54.167Z] [INFO] [TaskDependencies] Setting User Onboarding task as completed {"taskId":757,"userEmail":"17@e.com","timestamp":"2025-05-06T20:02:54.167Z"}
[WebSocket] Broadcast task_update to 3 clients (0 errors) { messageId: 'msg_1746561774206_wgwl7hwxm' }
[2025-05-06T20:02:54.207Z] [INFO] Successfully broadcasted task_update message
[2025-05-06T20:02:54.207Z] [INFO] [TaskDependencies] Processing KY3P task {"taskId":759,"taskType":"ky3p","currentProgress":0,"currentStatus":"not_started","timestamp":"2025-05-06T20:02:54.207Z"}
[UnifiedProgress] Starting progress update for task 759 (ky3p) {
  taskId: 759,
  taskType: 'ky3p',
  diagnosticId: 'prog-1746561774207-414',
  metadata: [
    'locked',
    'prerequisite_completed',
    'prerequisite_completed_at',
    'dependencyUnlockOperation',
    'previousProgress',
    'previousStatus',
    'isKy3pTask',
    'isUserOnboardingTask'
  ]
}
[UnifiedProgressCalc] Calculating progress for task 759 (ky3p)
[KY3P Progress] Calculated progress for task 759: {
  taskId: 759,
  taskType: 'ky3p',
  normalizedTaskType: 'ky3p',
  totalFields: 120,
  completedFields: 0,
  progress: 0,
  timeStamp: '2025-05-06T20:02:54.379Z'
}
[UnifiedProgressCalc] Task 759 (ky3p) progress: 0/120 = 0%
[INFO] [WebSocket] Broadcast task_updated to 3 clients
[2025-05-06T20:02:54.427Z] [INFO] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":272,"taskId":759,"taskType":"ky3p","isKy3pTask":true,"calculatedProgress":{"success":true,"taskId":759,"message":"Progress unchanged","progress":0,"status":"not_started"},"previousProgress":0,"wasPreserved":false}
[UnifiedProgress] Starting progress update for task 760 (open_banking) {
  taskId: 760,
  taskType: 'open_banking',
  diagnosticId: 'prog-1746561774427-249',
  metadata: [
    'locked',
    'prerequisite_completed',
    'prerequisite_completed_at',
    'dependencyUnlockOperation',
    'previousProgress',
    'previousStatus',
    'isKy3pTask',
    'isUserOnboardingTask'
  ]
}
[UnifiedProgressCalc] Calculating progress for task 760 (open_banking)
[UnifiedProgressCalc] Task 760 (open_banking) progress: 0/44 = 0%
[INFO] [WebSocket] Broadcast task_updated to 3 clients
[2025-05-06T20:02:54.701Z] [INFO] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":272,"taskId":760,"taskType":"open_banking","isKy3pTask":false,"calculatedProgress":{"success":true,"taskId":760,"message":"Progress unchanged","progress":0,"status":"not_started"},"previousProgress":0,"wasPreserved":false}
[2025-05-06T20:02:54.701Z] [INFO] [TaskDependencies] Successfully unlocked all tasks {"companyId":272,"count":3}
[Tasks] Successfully unlocked all tasks for company: 272
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 315',
    condition2: 'tasks.created_by = 315',
    condition3: "tasks.company_id = 272 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('17@e.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
[2025-05-06T20:02:54.850Z] [INFO] GET /api/tasks 200 in 761ms :: [{"id":757,"title":"New User Invitation: 17@e.com","description":"Complete us...
[2025-05-06T20:02:54.876Z] [INFO] GET /api/companies/current 304 in 41ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:02:57.651Z] [INFO] GET /api/companies/current 304 in 36ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:03:00.643Z] [INFO] GET /api/companies/current 304 in 33ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:03:03.644Z] [INFO] GET /api/companies/current 304 in 35ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:03:05.831Z] [INFO] GET /api/tasks 304 in 30ms :: [{"id":757,"title":"New User Invitation: 17@e.com","description":"Complete us...
[2025-05-06T20:03:05.832Z] [INFO] GET /api/companies/current 304 in 33ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746561565790-xnq2byf: {
  type: 'ping',
  timestamp: '2025-05-06T20:03:05.804Z',
  connectionId: 'ws_1746561565268_xxxkuq1ye'
}
[2025-05-06T20:03:05.932Z] [INFO] GET /api/tasks/758 200 in 63ms :: {"id":758,"title":"1. KYB Form: DevTest17","description":"Complete KYB verifi...
[Auth] Returning user session data
[2025-05-06T20:03:06.136Z] [INFO] GET /api/companies/current 304 in 34ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[Task Templates API] Fetching template for task type: company_kyb, user: 315
[2025-05-06T20:03:06.171Z] [INFO] GET /api/tasks/758 304 in 67ms :: {"id":758,"title":"1. KYB Form: DevTest17","description":"Complete KYB verifi...
[Task Templates API] Found template: 1 (KYB Form) for task type: company_kyb
[Task Templates API] Retrieved 9 configuration items for template ID: 1
[2025-05-06T20:03:06.295Z] [INFO] GET /api/task-templates/by-type/company_kyb 304 in 127ms :: {"id":1,"name":"KYB Form","description":"Know Your Business form for company ...
[2025-05-06T20:03:06.454Z] [INFO] Fetching KYB fields
[2025-05-06T20:03:06.486Z] [INFO] KYB fields retrieved successfully {"fieldCount":30,"groups":["companyProfile","financialProfile","governanceLeadership","operationsCompliance"]}
[2025-05-06T20:03:06.517Z] [INFO] GET /api/kyb/fields 304 in 63ms :: [{"id":1,"field_key":"legalEntityName","display_name":"Legal Entity Name","fi...
[KYB API Debug] Loading progress for task: 758
[Task Reconciliation] Found 30 responses for task 758 (type: company_kyb)
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 100,
  currentStatus: 'ready_for_submission',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: true,
  effectiveHasResponses: true,
  timestamp: '2025-05-06T20:03:06.774Z'
}
[STATUS DETERMINATION] Task has 100% progress but is not submitted, setting to READY_FOR_SUBMISSION
[Task Reconciliation] Progress calculation: {
  taskId: 758,
  currentProgress: 100,
  calculatedProgress: 100,
  currentStatus: 'ready_for_submission',
  calculatedStatus: 'ready_for_submission',
  responseCount: 30,
  completeCount: 30
}
[Task Reconciliation] No updates needed for task 758
[KYB API Debug] Retrieved task: {
  taskId: 758,
  status: 'ready_for_submission',
  progress: 100,
  metadata: [
    'company_id',
    'created_at',
    'statusFlow',
    'created_via',
    'lastUpdated',
    'status_flow',
    'company_name',
    'created_by_id',
    'progressHistory',
    'prerequisite_for',
    'lastProgressUpdate',
    'lastProgressReconciliation'
  ],
  timestamp: '2025-05-06T20:03:06.807Z'
}
[KYB API Debug] Retrieved responses: {
  responseCount: 30,
  fields: [
    {
      field: 'lifetimeCustomerValue',
      status: 'COMPLETE',
      hasValue: true
    },
    {
      field: 'annualRecurringRevenue',
      status: 'COMPLETE',
      hasValue: true
    },
    {
      field: 'monthlyRecurringRevenue',
      status: 'COMPLETE',
      hasValue: true
    },
    {
      field: 'investigationsIncidents',
      status: 'COMPLETE',
      hasValue: true
    },
    {
      field: 'financialStatements',
      status: 'COMPLETE',
      hasValue: true
    },
    {
      field: 'operationalPolicies',
      status: 'COMPLETE',
      hasValue: true
    },
    { field: 'dataVolume', status: 'COMPLETE', hasValue: true },
    { field: 'dataTypes', status: 'COMPLETE', hasValue: true },
    { field: 'sanctionsCheck', status: 'COMPLETE', hasValue: true },
    { field: 'dueDiligence', status: 'COMPLETE', hasValue: true },
    { field: 'regulatoryActions', status: 'COMPLETE', hasValue: true },
    { field: 'legalEntityName', status: 'COMPLETE', hasValue: true },
    { field: 'registrationNumber', status: 'COMPLETE', hasValue: true },
    { field: 'incorporationDate', status: 'COMPLETE', hasValue: true },
    { field: 'businessType', status: 'COMPLETE', hasValue: true },
    { field: 'jurisdiction', status: 'COMPLETE', hasValue: true },
    { field: 'registeredAddress', status: 'COMPLETE', hasValue: true },
    { field: 'companyPhone', status: 'COMPLETE', hasValue: true },
    { field: 'priorNames', status: 'COMPLETE', hasValue: true },
    { field: 'licenses', status: 'COMPLETE', hasValue: true },
    { field: 'goodStanding', status: 'COMPLETE', hasValue: true },
    {
      field: 'corporateRegistration',
      status: 'COMPLETE',
      hasValue: true
    },
    { field: 'externalAudit', status: 'COMPLETE', hasValue: true },
    { field: 'controlEnvironment', status: 'COMPLETE', hasValue: true },
    { field: 'authorizedSigners', status: 'COMPLETE', hasValue: true },
    {
      field: 'governmentOwnership',
      status: 'COMPLETE',
      hasValue: true
    },
    {
      field: 'ultimateBeneficialOwners',
      status: 'COMPLETE',
      hasValue: true
    },
    {
      field: 'directorsAndOfficers',
      status: 'COMPLETE',
      hasValue: true
    },
    { field: 'contactEmail', status: 'COMPLETE', hasValue: true },
    {
      field: 'marketCapitalization',
      status: 'COMPLETE',
      hasValue: true
    }
  ],
  timestamp: '2025-05-06T20:03:06.837Z'
}
[SERVER DEBUG] No savedFormData found in task table
[SERVER DEBUG] No KYB form file ID found in task metadata
[KYB API Debug] Retrieved task data: {
  id: 758,
  responseCount: 30,
  progress: 100,
  status: 'ready_for_submission',
  formDataKeys: [
    'lifetimeCustomerValue',
    'annualRecurringRevenue',
    'monthlyRecurringRevenue',
    'investigationsIncidents',
    'financialStatements',
    'operationalPolicies',
    'dataVolume',
    'dataTypes',
    'sanctionsCheck',
    'dueDiligence',
    'regulatoryActions',
    'legalEntityName',
    'registrationNumber',
    'incorporationDate',
    'businessType',
    'jurisdiction',
    'registeredAddress',
    'companyPhone',
    'priorNames',
    'licenses',
    'goodStanding',
    'corporateRegistration',
    'externalAudit',
    'controlEnvironment',
    'authorizedSigners',
    'governmentOwnership',
    'ultimateBeneficialOwners',
    'directorsAndOfficers',
    'contactEmail',
    'marketCapitalization'
  ]
}
===============================================
[SERVER DEBUG] PREPARING GET RESPONSE at 2025-05-06T20:03:06.838Z
[SERVER DEBUG] Task ID: 758, Found 30 fields in database
===============================================
[SERVER DEBUG] Checking field corporateRegistration in retrieved data: "Delaware State Filing Number 1234567, registered as FinTech Innovations LLC on 05/12/2010"
[SERVER DEBUG] Checking field goodStanding in retrieved data: "Yes"
[SERVER DEBUG] Checking field regulatoryActions in retrieved data: "Yes"
[SERVER DEBUG] Checking field investigationsIncidents in retrieved data: "No significant incidents in the past 3 years"
[SERVER DEBUG] No fields with value "asdf" found in GET response data
[SERVER DEBUG] Sending GET response with 30 fields, status: ready_for_submission, progress: 100%
===============================================
[2025-05-06T20:03:06.869Z] [INFO] GET /api/kyb/progress/758 304 in 189ms :: {"formData":{"lifetimeCustomerValue":"$1,250","annualRecurringRevenue":"5,000...
[KYB API Debug] Loading progress for task: 758
[TimestampHandler] Retrieved 30 timestamps for task 758
[TimestampAPI] Returning 30 timestamps for task 758
[Task Reconciliation] Found 30 responses for task 758 (type: company_kyb)
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 100,
  currentStatus: 'ready_for_submission',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: true,
  effectiveHasResponses: true,
  timestamp: '2025-05-06T20:03:07.141Z'
}
[STATUS DETERMINATION] Task has 100% progress but is not submitted, setting to READY_FOR_SUBMISSION
[Task Reconciliation] Progress calculation: {
  taskId: 758,
  currentProgress: 100,
  calculatedProgress: 100,
  currentStatus: 'ready_for_submission',
  calculatedStatus: 'ready_for_submission',
  responseCount: 30,
  completeCount: 30
}
[Task Reconciliation] No updates needed for task 758
[2025-05-06T20:03:07.143Z] [INFO] GET /api/kyb/timestamps/758 200 in 114ms :: {"legalEntityName":1746559174408,"registrationNumber":1746559174408,"incorpor...
[KYB API Debug] Retrieved task: {
  taskId: 758,
  status: 'ready_for_submission',
  progress: 100,
  metadata: [
    'company_id',
    'created_at',
    'statusFlow',
    'created_via',
    'lastUpdated',
    'status_flow',
    'company_name',
    'created_by_id',
    'progressHistory',
    'prerequisite_for',
    'lastProgressUpdate',
    'lastProgressReconciliation'
  ],
  timestamp: '2025-05-06T20:03:07.206Z'
}
[KYB API Debug] Retrieved responses: {
  responseCount: 30,
  fields: [
    {
      field: 'lifetimeCustomerValue',
      status: 'COMPLETE',
      hasValue: true
    },
    {
      field: 'annualRecurringRevenue',
      status: 'COMPLETE',
      hasValue: true
    },
    {
      field: 'monthlyRecurringRevenue',
      status: 'COMPLETE',
      hasValue: true
    },
    {
      field: 'investigationsIncidents',
      status: 'COMPLETE',
      hasValue: true
    },
    {
      field: 'financialStatements',
      status: 'COMPLETE',
      hasValue: true
    },
    {
      field: 'operationalPolicies',
      status: 'COMPLETE',
      hasValue: true
    },
    { field: 'dataVolume', status: 'COMPLETE', hasValue: true },
    { field: 'dataTypes', status: 'COMPLETE', hasValue: true },
    { field: 'sanctionsCheck', status: 'COMPLETE', hasValue: true },
    { field: 'dueDiligence', status: 'COMPLETE', hasValue: true },
    { field: 'regulatoryActions', status: 'COMPLETE', hasValue: true },
    { field: 'legalEntityName', status: 'COMPLETE', hasValue: true },
    { field: 'registrationNumber', status: 'COMPLETE', hasValue: true },
    { field: 'incorporationDate', status: 'COMPLETE', hasValue: true },
    { field: 'businessType', status: 'COMPLETE', hasValue: true },
    { field: 'jurisdiction', status: 'COMPLETE', hasValue: true },
    { field: 'registeredAddress', status: 'COMPLETE', hasValue: true },
    { field: 'companyPhone', status: 'COMPLETE', hasValue: true },
    { field: 'priorNames', status: 'COMPLETE', hasValue: true },
    { field: 'licenses', status: 'COMPLETE', hasValue: true },
    { field: 'goodStanding', status: 'COMPLETE', hasValue: true },
    {
      field: 'corporateRegistration',
      status: 'COMPLETE',
      hasValue: true
    },
    { field: 'externalAudit', status: 'COMPLETE', hasValue: true },
    { field: 'controlEnvironment', status: 'COMPLETE', hasValue: true },
    { field: 'authorizedSigners', status: 'COMPLETE', hasValue: true },
    {
      field: 'governmentOwnership',
      status: 'COMPLETE',
      hasValue: true
    },
    {
      field: 'ultimateBeneficialOwners',
      status: 'COMPLETE',
      hasValue: true
    },
    {
      field: 'directorsAndOfficers',
      status: 'COMPLETE',
      hasValue: true
    },
    { field: 'contactEmail', status: 'COMPLETE', hasValue: true },
    {
      field: 'marketCapitalization',
      status: 'COMPLETE',
      hasValue: true
    }
  ],
  timestamp: '2025-05-06T20:03:07.245Z'
}
[SERVER DEBUG] No savedFormData found in task table
[SERVER DEBUG] No KYB form file ID found in task metadata
[KYB API Debug] Retrieved task data: {
  id: 758,
  responseCount: 30,
  progress: 100,
  status: 'ready_for_submission',
  formDataKeys: [
    'lifetimeCustomerValue',
    'annualRecurringRevenue',
    'monthlyRecurringRevenue',
    'investigationsIncidents',
    'financialStatements',
    'operationalPolicies',
    'dataVolume',
    'dataTypes',
    'sanctionsCheck',
    'dueDiligence',
    'regulatoryActions',
    'legalEntityName',
    'registrationNumber',
    'incorporationDate',
    'businessType',
    'jurisdiction',
    'registeredAddress',
    'companyPhone',
    'priorNames',
    'licenses',
    'goodStanding',
    'corporateRegistration',
    'externalAudit',
    'controlEnvironment',
    'authorizedSigners',
    'governmentOwnership',
    'ultimateBeneficialOwners',
    'directorsAndOfficers',
    'contactEmail',
    'marketCapitalization'
  ]
}
===============================================
[SERVER DEBUG] PREPARING GET RESPONSE at 2025-05-06T20:03:07.246Z
[SERVER DEBUG] Task ID: 758, Found 30 fields in database
===============================================
[SERVER DEBUG] Checking field corporateRegistration in retrieved data: "Delaware State Filing Number 1234567, registered as FinTech Innovations LLC on 05/12/2010"
[SERVER DEBUG] Checking field goodStanding in retrieved data: "Yes"
[SERVER DEBUG] Checking field regulatoryActions in retrieved data: "Yes"
[SERVER DEBUG] Checking field investigationsIncidents in retrieved data: "No significant incidents in the past 3 years"
[SERVER DEBUG] No fields with value "asdf" found in GET response data
[SERVER DEBUG] Sending GET response with 30 fields, status: ready_for_submission, progress: 100%
===============================================
[2025-05-06T20:03:07.293Z] [INFO] GET /api/kyb/progress/758 304 in 266ms :: {"formData":{"lifetimeCustomerValue":"$1,250","annualRecurringRevenue":"5,000...
[TimestampHandler] Retrieved 30 timestamps for task 758
[TimestampAPI] Returning 30 timestamps for task 758
[2025-05-06T20:03:07.510Z] [INFO] GET /api/kyb/timestamps/758 304 in 61ms :: {"legalEntityName":1746559174408,"registrationNumber":1746559174408,"incorpor...
[2025-05-06T20:03:09.130Z] [INFO] GET /api/companies/current 304 in 31ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:03:12.278Z] [INFO] GET /api/companies/current 304 in 34ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[PeriodicTaskReconciliation] Reconciling batch of 10 tasks: [
  679, 685, 699, 697,
  751, 691, 759, 714,
  760, 707
]
[Task Progress] Calculated progress for task 679 (open_banking): 44/44 = 100%
[Task Progress] Calculated progress for task 685 (company_kyb): 30/30 = 100%
[Task Progress] Calculated progress for task 699 (open_banking): 0/44 = 0%
[Task Progress] Calculated progress for task 697 (company_kyb): 30/30 = 100%
[Task Progress] Calculated progress for task 751 (ky3p): 0/120 = 0%
[Task Progress] Calculated progress for task 691 (open_banking): 0/44 = 0%
[Task Progress] Calculated progress for task 759 (ky3p): 0/0 = 0%
[Task Progress] Calculated progress for task 714 (ky3p): 0/0 = 0%
[Task Progress] Calculated progress for task 760 (open_banking): 0/44 = 0%
[Task Progress] Calculated progress for task 707 (open_banking): 0/44 = 0%
[2025-05-06T20:03:15.151Z] [INFO] GET /api/companies/current 304 in 41ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[Current Company] Using cached company data: 272
[2025-05-06T20:03:18.157Z] [INFO] GET /api/companies/current 304 in 44ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:03:21.139Z] [INFO] GET /api/companies/current 304 in 36ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:03:24.163Z] [INFO] GET /api/companies/current 304 in 33ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746561564445-1axxiw3: { type: 'ping' }
[INFO] [WebSocket] Received message from client client-1746561564951-upy7pjg: { type: 'ping' }
[INFO] [WebSocket] Received message from client client-1746561565790-xnq2byf: {
  type: 'ping',
  timestamp: '2025-05-06T20:03:25.805Z',
  connectionId: 'ws_1746561565268_xxxkuq1ye'
}
[2025-05-06T20:03:27.127Z] [INFO] GET /api/companies/current 304 in 32ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 315, company_id: 272, email: '17@e.com' }
[2025-05-06T20:03:29.151Z] [INFO] Performing dynamic task unlocking check for company {"companyId":272,"userId":315}
[2025-05-06T20:03:29.186Z] [INFO] No completed KYB tasks found, skipping security task unlock check {"companyId":272}
[Tasks] Automatically unlocking all tasks for company { userId: 315, companyId: 272, requestedBy: 'automatic_task_unlock' }
[2025-05-06T20:03:29.187Z] [INFO] [TaskDependencies] Unlocking ALL tasks for company {"companyId":272}
[2025-05-06T20:03:29.196Z] [INFO] GET /api/companies/current 304 in 42ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:03:29.229Z] [INFO] [TaskDependencies] Found user onboarding task that needs completion {"taskId":757,"userEmail":"17@e.com","currentStatus":"completed","currentProgress":100}
[TaskDependencies] Skipping task 758 with submission indicators {
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasFileId: false,
  status: 'ready_for_submission',
  progress: 100,
  isReadyForSubmission: true
}
[2025-05-06T20:03:29.229Z] [INFO] [TaskDependencies] Found tasks to unlock {"companyId":272,"count":3,"taskIds":[757,760,759],"taskTypes":["user_onboarding","open_banking","ky3p"],"ky3pTaskCount":1,"ky3pTaskIds":[759]}
[2025-05-06T20:03:29.229Z] [INFO] [TaskDependencies] Setting User Onboarding task as completed {"taskId":757,"userEmail":"17@e.com","timestamp":"2025-05-06T20:03:29.229Z"}
[WebSocket] Broadcast task_update to 3 clients (0 errors) { messageId: 'msg_1746561809280_54e8sfzsg' }
[2025-05-06T20:03:29.281Z] [INFO] Successfully broadcasted task_update message
[UnifiedProgress] Starting progress update for task 760 (open_banking) {
  taskId: 760,
  taskType: 'open_banking',
  diagnosticId: 'prog-1746561809281-298',
  metadata: [
    'locked',
    'prerequisite_completed',
    'prerequisite_completed_at',
    'dependencyUnlockOperation',
    'previousProgress',
    'previousStatus',
    'isKy3pTask',
    'isUserOnboardingTask'
  ]
}
[UnifiedProgressCalc] Calculating progress for task 760 (open_banking)
[UnifiedProgressCalc] Task 760 (open_banking) progress: 0/44 = 0%
[INFO] [WebSocket] Broadcast task_updated to 3 clients
[2025-05-06T20:03:29.709Z] [INFO] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":272,"taskId":760,"taskType":"open_banking","isKy3pTask":false,"calculatedProgress":{"success":true,"taskId":760,"message":"Progress unchanged","progress":0,"status":"not_started"},"previousProgress":0,"wasPreserved":false}
[2025-05-06T20:03:29.709Z] [INFO] [TaskDependencies] Processing KY3P task {"taskId":759,"taskType":"ky3p","currentProgress":0,"currentStatus":"not_started","timestamp":"2025-05-06T20:03:29.709Z"}
[UnifiedProgress] Starting progress update for task 759 (ky3p) {
  taskId: 759,
  taskType: 'ky3p',
  diagnosticId: 'prog-1746561809709-767',
  metadata: [
    'locked',
    'prerequisite_completed',
    'prerequisite_completed_at',
    'dependencyUnlockOperation',
    'previousProgress',
    'previousStatus',
    'isKy3pTask',
    'isUserOnboardingTask'
  ]
}
[UnifiedProgressCalc] Calculating progress for task 759 (ky3p)
[KY3P Progress] Calculated progress for task 759: {
  taskId: 759,
  taskType: 'ky3p',
  normalizedTaskType: 'ky3p',
  totalFields: 120,
  completedFields: 0,
  progress: 0,
  timeStamp: '2025-05-06T20:03:29.954Z'
}
[UnifiedProgressCalc] Task 759 (ky3p) progress: 0/120 = 0%
[INFO] [WebSocket] Broadcast task_updated to 3 clients
[2025-05-06T20:03:30.003Z] [INFO] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":272,"taskId":759,"taskType":"ky3p","isKy3pTask":true,"calculatedProgress":{"success":true,"taskId":759,"message":"Progress unchanged","progress":0,"status":"not_started"},"previousProgress":0,"wasPreserved":false}
[2025-05-06T20:03:30.003Z] [INFO] [TaskDependencies] Successfully unlocked all tasks {"companyId":272,"count":3}
[Tasks] Successfully unlocked all tasks for company: 272
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 315',
    condition2: 'tasks.created_by = 315',
    condition3: "tasks.company_id = 272 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('17@e.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
[2025-05-06T20:03:30.132Z] [INFO] GET /api/tasks 200 in 982ms :: [{"id":757,"title":"New User Invitation: 17@e.com","description":"Complete us...
[2025-05-06T20:03:30.365Z] [INFO] GET /api/tasks 304 in 61ms :: [{"id":757,"title":"New User Invitation: 17@e.com","description":"Complete us...
[2025-05-06T20:03:30.604Z] [INFO] GET /api/tasks 304 in 54ms :: [{"id":757,"title":"New User Invitation: 17@e.com","description":"Complete us...
[2025-05-06T20:03:32.209Z] [INFO] GET /api/companies/current 304 in 65ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:03:35.167Z] [INFO] GET /api/companies/current 304 in 33ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:03:38.184Z] [INFO] GET /api/companies/current 304 in 35ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:03:41.171Z] [INFO] GET /api/companies/current 304 in 31ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:03:44.168Z] [INFO] GET /api/companies/current 304 in 33ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[Tasks] Using cached task data for user: 315
[2025-05-06T20:03:45.639Z] [INFO] GET /api/tasks 304 in 49ms :: [{"id":757,"title":"New User Invitation: 17@e.com","description":"Complete us...
[INFO] [WebSocket] Received message from client client-1746561565790-xnq2byf: {
  type: 'ping',
  timestamp: '2025-05-06T20:03:45.804Z',
  connectionId: 'ws_1746561565268_xxxkuq1ye'
}
[2025-05-06T20:03:47.191Z] [INFO] GET /api/companies/current 304 in 36ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:03:50.166Z] [INFO] GET /api/companies/current 304 in 32ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:03:53.171Z] [INFO] GET /api/companies/current 304 in 35ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746561564445-1axxiw3: { type: 'ping' }
[Current Company] Fetching company for user: { userId: 315, companyId: 272 }
[Current Company] Found company: {
  id: 272,
  name: 'DevTest17',
  onboardingCompleted: false,
  riskScore: null,
  chosenScore: null,
  isDemo: true
}
[2025-05-06T20:03:56.199Z] [INFO] GET /api/companies/current 304 in 62ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:03:59.161Z] [INFO] GET /api/companies/current 304 in 32ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:04:02.463Z] [INFO] GET /api/companies/current 304 in 43ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:04:05.480Z] [INFO] GET /api/companies/current 304 in 34ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746561565790-xnq2byf: {
  type: 'ping',
  timestamp: '2025-05-06T20:04:06.263Z',
  connectionId: 'ws_1746561565268_xxxkuq1ye'
}
[2025-05-06T20:04:06.865Z] [INFO] GET /api/companies/current 304 in 30ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:04:08.169Z] [INFO] GET /api/companies/current 304 in 40ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:04:11.158Z] [INFO] GET /api/companies/current 304 in 31ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:04:14.165Z] [INFO] GET /api/companies/current 304 in 38ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 315, company_id: 272, email: '17@e.com' }
[2025-05-06T20:04:15.813Z] [INFO] Performing dynamic task unlocking check for company {"companyId":272,"userId":315}
[2025-05-06T20:04:15.848Z] [INFO] No completed KYB tasks found, skipping security task unlock check {"companyId":272}
[Tasks] Automatically unlocking all tasks for company { userId: 315, companyId: 272, requestedBy: 'automatic_task_unlock' }
[2025-05-06T20:04:15.849Z] [INFO] [TaskDependencies] Unlocking ALL tasks for company {"companyId":272}
[2025-05-06T20:04:15.887Z] [INFO] [TaskDependencies] Found user onboarding task that needs completion {"taskId":757,"userEmail":"17@e.com","currentStatus":"completed","currentProgress":100}
[TaskDependencies] Skipping task 758 with submission indicators {
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasFileId: false,
  status: 'ready_for_submission',
  progress: 100,
  isReadyForSubmission: true
}
[2025-05-06T20:04:15.888Z] [INFO] [TaskDependencies] Found tasks to unlock {"companyId":272,"count":3,"taskIds":[757,760,759],"taskTypes":["user_onboarding","open_banking","ky3p"],"ky3pTaskCount":1,"ky3pTaskIds":[759]}
[2025-05-06T20:04:15.888Z] [INFO] [TaskDependencies] Setting User Onboarding task as completed {"taskId":757,"userEmail":"17@e.com","timestamp":"2025-05-06T20:04:15.888Z"}
[WebSocket] Broadcast task_update to 3 clients (0 errors) { messageId: 'msg_1746561855920_yd3jpn7y7' }
[2025-05-06T20:04:15.920Z] [INFO] Successfully broadcasted task_update message
[UnifiedProgress] Starting progress update for task 760 (open_banking) {
  taskId: 760,
  taskType: 'open_banking',
  diagnosticId: 'prog-1746561855920-387',
  metadata: [
    'locked',
    'prerequisite_completed',
    'prerequisite_completed_at',
    'dependencyUnlockOperation',
    'previousProgress',
    'previousStatus',
    'isKy3pTask',
    'isUserOnboardingTask'
  ]
}
[UnifiedProgressCalc] Calculating progress for task 760 (open_banking)
[UnifiedProgressCalc] Task 760 (open_banking) progress: 0/44 = 0%
[INFO] [WebSocket] Broadcast task_updated to 3 clients
[2025-05-06T20:04:16.072Z] [INFO] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":272,"taskId":760,"taskType":"open_banking","isKy3pTask":false,"calculatedProgress":{"success":true,"taskId":760,"message":"Progress unchanged","progress":0,"status":"not_started"},"previousProgress":0,"wasPreserved":false}
[2025-05-06T20:04:16.072Z] [INFO] [TaskDependencies] Processing KY3P task {"taskId":759,"taskType":"ky3p","currentProgress":0,"currentStatus":"not_started","timestamp":"2025-05-06T20:04:16.072Z"}
[UnifiedProgress] Starting progress update for task 759 (ky3p) {
  taskId: 759,
  taskType: 'ky3p',
  diagnosticId: 'prog-1746561856073-511',
  metadata: [
    'locked',
    'prerequisite_completed',
    'prerequisite_completed_at',
    'dependencyUnlockOperation',
    'previousProgress',
    'previousStatus',
    'isKy3pTask',
    'isUserOnboardingTask'
  ]
}
[UnifiedProgressCalc] Calculating progress for task 759 (ky3p)
[KY3P Progress] Calculated progress for task 759: {
  taskId: 759,
  taskType: 'ky3p',
  normalizedTaskType: 'ky3p',
  totalFields: 120,
  completedFields: 0,
  progress: 0,
  timeStamp: '2025-05-06T20:04:16.223Z'
}
[UnifiedProgressCalc] Task 759 (ky3p) progress: 0/120 = 0%
[INFO] [WebSocket] Broadcast task_updated to 3 clients
[2025-05-06T20:04:16.255Z] [INFO] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":272,"taskId":759,"taskType":"ky3p","isKy3pTask":true,"calculatedProgress":{"success":true,"taskId":759,"message":"Progress unchanged","progress":0,"status":"not_started"},"previousProgress":0,"wasPreserved":false}
[2025-05-06T20:04:16.255Z] [INFO] [TaskDependencies] Successfully unlocked all tasks {"companyId":272,"count":3}
[Tasks] Successfully unlocked all tasks for company: 272
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 315',
    condition2: 'tasks.created_by = 315',
    condition3: "tasks.company_id = 272 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('17@e.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
[2025-05-06T20:04:16.353Z] [INFO] GET /api/tasks 200 in 541ms :: [{"id":757,"title":"New User Invitation: 17@e.com","description":"Complete us...
[2025-05-06T20:04:17.186Z] [INFO] GET /api/companies/current 304 in 37ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:04:20.157Z] [INFO] GET /api/companies/current 304 in 31ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:04:23.159Z] [INFO] GET /api/companies/current 304 in 31ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746561564445-1axxiw3: { type: 'ping' }
[INFO] [WebSocket] Received message from client client-1746561565790-xnq2byf: {
  type: 'ping',
  timestamp: '2025-05-06T20:04:25.805Z',
  connectionId: 'ws_1746561565268_xxxkuq1ye'
}
[2025-05-06T20:04:26.171Z] [INFO] GET /api/companies/current 304 in 30ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:04:29.186Z] [INFO] GET /api/companies/current 304 in 41ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:04:31.556Z] [INFO] GET /api/tasks 304 in 33ms :: [{"id":757,"title":"New User Invitation: 17@e.com","description":"Complete us...
[2025-05-06T20:04:32.196Z] [INFO] GET /api/companies/current 304 in 42ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:04:35.164Z] [INFO] GET /api/companies/current 304 in 34ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:04:38.464Z] [INFO] GET /api/companies/current 304 in 39ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:04:39.575Z] [INFO] GET /api/companies/current 304 in 35ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:04:41.445Z] [INFO] GET /api/companies/current 304 in 32ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:04:44.437Z] [INFO] GET /api/companies/current 304 in 32ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746561565790-xnq2byf: {
  type: 'ping',
  timestamp: '2025-05-06T20:04:46.263Z',
  connectionId: 'ws_1746561565268_xxxkuq1ye'
}
[2025-05-06T20:04:47.447Z] [INFO] GET /api/companies/current 304 in 35ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:04:50.459Z] [INFO] GET /api/companies/current 304 in 32ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:04:53.448Z] [INFO] GET /api/companies/current 304 in 31ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746561564445-1axxiw3: { type: 'ping' }
[Current Company] Fetching company for user: { userId: 315, companyId: 272 }
[Current Company] Found company: {
  id: 272,
  name: 'DevTest17',
  onboardingCompleted: false,
  riskScore: null,
  chosenScore: null,
  isDemo: true
}
[2025-05-06T20:04:56.475Z] [INFO] GET /api/companies/current 304 in 59ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:04:59.440Z] [INFO] GET /api/companies/current 304 in 33ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:05:02.484Z] [INFO] GET /api/companies/current 304 in 39ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:05:05.440Z] [INFO] GET /api/companies/current 304 in 32ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746561565790-xnq2byf: {
  type: 'ping',
  timestamp: '2025-05-06T20:05:06.263Z',
  connectionId: 'ws_1746561565268_xxxkuq1ye'
}
[2025-05-06T20:05:08.445Z] [INFO] GET /api/companies/current 304 in 31ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:05:11.472Z] [INFO] GET /api/companies/current 304 in 38ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:05:14.461Z] [INFO] GET /api/companies/current 304 in 35ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:05:17.449Z] [INFO] GET /api/companies/current 304 in 31ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:05:20.444Z] [INFO] GET /api/companies/current 304 in 33ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:05:23.580Z] [INFO] GET /api/companies/current 304 in 48ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746561564445-1axxiw3: { type: 'ping' }
[INFO] [WebSocket] Received message from client client-1746561564951-upy7pjg: { type: 'ping' }
[INFO] [WebSocket] Received message from client client-1746561565790-xnq2byf: {
  type: 'ping',
  timestamp: '2025-05-06T20:05:26.263Z',
  connectionId: 'ws_1746561565268_xxxkuq1ye'
}
[2025-05-06T20:05:26.446Z] [INFO] GET /api/companies/current 304 in 31ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:05:29.456Z] [INFO] GET /api/companies/current 304 in 32ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:05:32.472Z] [INFO] GET /api/companies/current 304 in 30ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:05:35.453Z] [INFO] GET /api/companies/current 304 in 39ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:05:38.479Z] [INFO] GET /api/companies/current 304 in 34ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:05:40.844Z] [INFO] GET /api/companies/current 304 in 30ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:05:41.177Z] [INFO] GET /api/companies/current 304 in 34ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:05:44.455Z] [INFO] GET /api/companies/current 304 in 36ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746561565790-xnq2byf: {
  type: 'ping',
  timestamp: '2025-05-06T20:05:46.263Z',
  connectionId: 'ws_1746561565268_xxxkuq1ye'
}
[2025-05-06T20:05:47.447Z] [INFO] GET /api/companies/current 304 in 33ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:05:47.824Z] [INFO] GET /api/companies/current 304 in 30ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:05:50.171Z] [INFO] GET /api/companies/current 304 in 34ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:05:53.185Z] [INFO] GET /api/companies/current 304 in 42ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746561564445-1axxiw3: { type: 'ping' }
[2025-05-06T20:05:56.158Z] [INFO] GET /api/companies/current 304 in 31ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[Current Company] Fetching company for user: { userId: 315, companyId: 272 }
[Current Company] Found company: {
  id: 272,
  name: 'DevTest17',
  onboardingCompleted: false,
  riskScore: null,
  chosenScore: null,
  isDemo: true
}
[2025-05-06T20:05:59.190Z] [INFO] GET /api/companies/current 304 in 61ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 315, company_id: 272, email: '17@e.com' }
[2025-05-06T20:06:01.728Z] [INFO] Performing dynamic task unlocking check for company {"companyId":272,"userId":315}
[2025-05-06T20:06:01.764Z] [INFO] No completed KYB tasks found, skipping security task unlock check {"companyId":272}
[Tasks] Automatically unlocking all tasks for company { userId: 315, companyId: 272, requestedBy: 'automatic_task_unlock' }
[2025-05-06T20:06:01.766Z] [INFO] [TaskDependencies] Unlocking ALL tasks for company {"companyId":272}
[2025-05-06T20:06:01.825Z] [INFO] [TaskDependencies] Found user onboarding task that needs completion {"taskId":757,"userEmail":"17@e.com","currentStatus":"completed","currentProgress":100}
[TaskDependencies] Skipping task 758 with submission indicators {
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasFileId: false,
  status: 'ready_for_submission',
  progress: 100,
  isReadyForSubmission: true
}
[2025-05-06T20:06:01.826Z] [INFO] [TaskDependencies] Found tasks to unlock {"companyId":272,"count":3,"taskIds":[757,760,759],"taskTypes":["user_onboarding","open_banking","ky3p"],"ky3pTaskCount":1,"ky3pTaskIds":[759]}
[2025-05-06T20:06:01.826Z] [INFO] [TaskDependencies] Setting User Onboarding task as completed {"taskId":757,"userEmail":"17@e.com","timestamp":"2025-05-06T20:06:01.826Z"}
[WebSocket] Broadcast task_update to 3 clients (0 errors) { messageId: 'msg_1746561961868_2ab19toua' }
[2025-05-06T20:06:01.868Z] [INFO] Successfully broadcasted task_update message
[UnifiedProgress] Starting progress update for task 760 (open_banking) {
  taskId: 760,
  taskType: 'open_banking',
  diagnosticId: 'prog-1746561961868-256',
  metadata: [
    'locked',
    'prerequisite_completed',
    'prerequisite_completed_at',
    'dependencyUnlockOperation',
    'previousProgress',
    'previousStatus',
    'isKy3pTask',
    'isUserOnboardingTask'
  ]
}
[UnifiedProgressCalc] Calculating progress for task 760 (open_banking)
[UnifiedProgressCalc] Task 760 (open_banking) progress: 0/44 = 0%
[INFO] [WebSocket] Broadcast task_updated to 3 clients
[2025-05-06T20:06:02.240Z] [INFO] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":272,"taskId":760,"taskType":"open_banking","isKy3pTask":false,"calculatedProgress":{"success":true,"taskId":760,"message":"Progress unchanged","progress":0,"status":"not_started"},"previousProgress":0,"wasPreserved":false}
[2025-05-06T20:06:02.240Z] [INFO] [TaskDependencies] Processing KY3P task {"taskId":759,"taskType":"ky3p","currentProgress":0,"currentStatus":"not_started","timestamp":"2025-05-06T20:06:02.240Z"}
[UnifiedProgress] Starting progress update for task 759 (ky3p) {
  taskId: 759,
  taskType: 'ky3p',
  diagnosticId: 'prog-1746561962240-602',
  metadata: [
    'locked',
    'prerequisite_completed',
    'prerequisite_completed_at',
    'dependencyUnlockOperation',
    'previousProgress',
    'previousStatus',
    'isKy3pTask',
    'isUserOnboardingTask'
  ]
}
[2025-05-06T20:06:02.255Z] [INFO] GET /api/companies/current 304 in 30ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[UnifiedProgressCalc] Calculating progress for task 759 (ky3p)
[KY3P Progress] Calculated progress for task 759: {
  taskId: 759,
  taskType: 'ky3p',
  normalizedTaskType: 'ky3p',
  totalFields: 120,
  completedFields: 0,
  progress: 0,
  timeStamp: '2025-05-06T20:06:02.360Z'
}
[UnifiedProgressCalc] Task 759 (ky3p) progress: 0/120 = 0%
[INFO] [WebSocket] Broadcast task_updated to 3 clients
[2025-05-06T20:06:02.389Z] [INFO] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":272,"taskId":759,"taskType":"ky3p","isKy3pTask":true,"calculatedProgress":{"success":true,"taskId":759,"message":"Progress unchanged","progress":0,"status":"not_started"},"previousProgress":0,"wasPreserved":false}
[2025-05-06T20:06:02.389Z] [INFO] [TaskDependencies] Successfully unlocked all tasks {"companyId":272,"count":3}
[Tasks] Successfully unlocked all tasks for company: 272
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 315',
    condition2: 'tasks.created_by = 315',
    condition3: "tasks.company_id = 272 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('17@e.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
[2025-05-06T20:06:02.490Z] [INFO] GET /api/tasks 200 in 763ms :: [{"id":757,"title":"New User Invitation: 17@e.com","description":"Complete us...
[2025-05-06T20:06:05.161Z] [INFO] GET /api/companies/current 304 in 31ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746561565790-xnq2byf: {
  type: 'ping',
  timestamp: '2025-05-06T20:06:05.805Z',
  connectionId: 'ws_1746561565268_xxxkuq1ye'
}
[2025-05-06T20:06:08.179Z] [INFO] GET /api/companies/current 304 in 38ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:06:11.159Z] [INFO] GET /api/companies/current 304 in 34ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:06:14.199Z] [INFO] GET /api/companies/current 304 in 45ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:06:17.167Z] [INFO] GET /api/companies/current 304 in 36ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:06:17.930Z] [INFO] GET /api/tasks 304 in 31ms :: [{"id":757,"title":"New User Invitation: 17@e.com","description":"Complete us...
[2025-05-06T20:06:20.158Z] [INFO] GET /api/companies/current 304 in 30ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:06:23.297Z] [INFO] GET /api/companies/current 304 in 166ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746561564445-1axxiw3: { type: 'ping' }
[INFO] [WebSocket] Received message from client client-1746561565790-xnq2byf: {
  type: 'ping',
  timestamp: '2025-05-06T20:06:25.805Z',
  connectionId: 'ws_1746561565268_xxxkuq1ye'
}
[2025-05-06T20:06:26.166Z] [INFO] GET /api/companies/current 304 in 30ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:06:29.163Z] [INFO] GET /api/companies/current 304 in 37ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:06:32.191Z] [INFO] GET /api/companies/current 304 in 52ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 315, company_id: 272, email: '17@e.com' }
[2025-05-06T20:06:33.089Z] [INFO] Performing dynamic task unlocking check for company {"companyId":272,"userId":315}
[2025-05-06T20:06:33.120Z] [INFO] No completed KYB tasks found, skipping security task unlock check {"companyId":272}
[Tasks] Automatically unlocking all tasks for company { userId: 315, companyId: 272, requestedBy: 'automatic_task_unlock' }
[2025-05-06T20:06:33.120Z] [INFO] [TaskDependencies] Unlocking ALL tasks for company {"companyId":272}
[2025-05-06T20:06:33.158Z] [INFO] [TaskDependencies] Found user onboarding task that needs completion {"taskId":757,"userEmail":"17@e.com","currentStatus":"completed","currentProgress":100}
[TaskDependencies] Skipping task 758 with submission indicators {
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasFileId: false,
  status: 'ready_for_submission',
  progress: 100,
  isReadyForSubmission: true
}
[2025-05-06T20:06:33.158Z] [INFO] [TaskDependencies] Found tasks to unlock {"companyId":272,"count":3,"taskIds":[757,759,760],"taskTypes":["user_onboarding","ky3p","open_banking"],"ky3pTaskCount":1,"ky3pTaskIds":[759]}
[2025-05-06T20:06:33.158Z] [INFO] [TaskDependencies] Setting User Onboarding task as completed {"taskId":757,"userEmail":"17@e.com","timestamp":"2025-05-06T20:06:33.158Z"}
[WebSocket] Broadcast task_update to 3 clients (0 errors) { messageId: 'msg_1746561993190_0huabqz72' }
[2025-05-06T20:06:33.190Z] [INFO] Successfully broadcasted task_update message
[2025-05-06T20:06:33.190Z] [INFO] [TaskDependencies] Processing KY3P task {"taskId":759,"taskType":"ky3p","currentProgress":0,"currentStatus":"not_started","timestamp":"2025-05-06T20:06:33.190Z"}
[UnifiedProgress] Starting progress update for task 759 (ky3p) {
  taskId: 759,
  taskType: 'ky3p',
  diagnosticId: 'prog-1746561993190-430',
  metadata: [
    'locked',
    'prerequisite_completed',
    'prerequisite_completed_at',
    'dependencyUnlockOperation',
    'previousProgress',
    'previousStatus',
    'isKy3pTask',
    'isUserOnboardingTask'
  ]
}
[UnifiedProgressCalc] Calculating progress for task 759 (ky3p)
[KY3P Progress] Calculated progress for task 759: {
  taskId: 759,
  taskType: 'ky3p',
  normalizedTaskType: 'ky3p',
  totalFields: 120,
  completedFields: 0,
  progress: 0,
  timeStamp: '2025-05-06T20:06:33.309Z'
}
[UnifiedProgressCalc] Task 759 (ky3p) progress: 0/120 = 0%
[INFO] [WebSocket] Broadcast task_updated to 3 clients
[2025-05-06T20:06:33.338Z] [INFO] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":272,"taskId":759,"taskType":"ky3p","isKy3pTask":true,"calculatedProgress":{"success":true,"taskId":759,"message":"Progress unchanged","progress":0,"status":"not_started"},"previousProgress":0,"wasPreserved":false}
[UnifiedProgress] Starting progress update for task 760 (open_banking) {
  taskId: 760,
  taskType: 'open_banking',
  diagnosticId: 'prog-1746561993338-399',
  metadata: [
    'locked',
    'prerequisite_completed',
    'prerequisite_completed_at',
    'dependencyUnlockOperation',
    'previousProgress',
    'previousStatus',
    'isKy3pTask',
    'isUserOnboardingTask'
  ]
}
[UnifiedProgressCalc] Calculating progress for task 760 (open_banking)
[UnifiedProgressCalc] Task 760 (open_banking) progress: 0/44 = 0%
[INFO] [WebSocket] Broadcast task_updated to 3 clients
[2025-05-06T20:06:33.485Z] [INFO] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":272,"taskId":760,"taskType":"open_banking","isKy3pTask":false,"calculatedProgress":{"success":true,"taskId":760,"message":"Progress unchanged","progress":0,"status":"not_started"},"previousProgress":0,"wasPreserved":false}
[2025-05-06T20:06:33.485Z] [INFO] [TaskDependencies] Successfully unlocked all tasks {"companyId":272,"count":3}
[Tasks] Successfully unlocked all tasks for company: 272
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 315',
    condition2: 'tasks.created_by = 315',
    condition3: "tasks.company_id = 272 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('17@e.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
[2025-05-06T20:06:33.588Z] [INFO] GET /api/tasks 200 in 499ms :: [{"id":757,"title":"New User Invitation: 17@e.com","description":"Complete us...
[2025-05-06T20:06:35.172Z] [INFO] GET /api/companies/current 304 in 32ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:06:38.187Z] [INFO] GET /api/companies/current 304 in 43ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:06:41.163Z] [INFO] GET /api/companies/current 304 in 31ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:06:44.163Z] [INFO] GET /api/companies/current 304 in 32ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746561565790-xnq2byf: {
  type: 'ping',
  timestamp: '2025-05-06T20:06:45.805Z',
  connectionId: 'ws_1746561565268_xxxkuq1ye'
}
[2025-05-06T20:06:47.200Z] [INFO] GET /api/companies/current 304 in 62ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:06:48.793Z] [INFO] GET /api/tasks 304 in 34ms :: [{"id":757,"title":"New User Invitation: 17@e.com","description":"Complete us...
[2025-05-06T20:06:50.190Z] [INFO] GET /api/companies/current 304 in 50ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:06:53.161Z] [INFO] GET /api/companies/current 304 in 33ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746561564445-1axxiw3: { type: 'ping' }
[2025-05-06T20:06:56.308Z] [INFO] GET /api/companies/current 304 in 39ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[Current Company] Fetching company for user: { userId: 315, companyId: 272 }
[Current Company] Found company: {
  id: 272,
  name: 'DevTest17',
  onboardingCompleted: false,
  riskScore: null,
  chosenScore: null,
  isDemo: true
}
[2025-05-06T20:06:59.231Z] [INFO] GET /api/companies/current 304 in 72ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:07:02.192Z] [INFO] GET /api/companies/current 304 in 55ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 315, company_id: 272, email: '17@e.com' }
[2025-05-06T20:07:03.955Z] [INFO] Performing dynamic task unlocking check for company {"companyId":272,"userId":315}
[2025-05-06T20:07:03.987Z] [INFO] No completed KYB tasks found, skipping security task unlock check {"companyId":272}
[Tasks] Automatically unlocking all tasks for company { userId: 315, companyId: 272, requestedBy: 'automatic_task_unlock' }
[2025-05-06T20:07:03.988Z] [INFO] [TaskDependencies] Unlocking ALL tasks for company {"companyId":272}
[2025-05-06T20:07:04.020Z] [INFO] [TaskDependencies] Found user onboarding task that needs completion {"taskId":757,"userEmail":"17@e.com","currentStatus":"completed","currentProgress":100}
[TaskDependencies] Skipping task 758 with submission indicators {
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasFileId: false,
  status: 'ready_for_submission',
  progress: 100,
  isReadyForSubmission: true
}
[2025-05-06T20:07:04.020Z] [INFO] [TaskDependencies] Found tasks to unlock {"companyId":272,"count":3,"taskIds":[757,759,760],"taskTypes":["user_onboarding","ky3p","open_banking"],"ky3pTaskCount":1,"ky3pTaskIds":[759]}
[2025-05-06T20:07:04.020Z] [INFO] [TaskDependencies] Setting User Onboarding task as completed {"taskId":757,"userEmail":"17@e.com","timestamp":"2025-05-06T20:07:04.020Z"}
[WebSocket] Broadcast task_update to 3 clients (0 errors) { messageId: 'msg_1746562024051_kt9tqueg5' }
[2025-05-06T20:07:04.052Z] [INFO] Successfully broadcasted task_update message
[2025-05-06T20:07:04.052Z] [INFO] [TaskDependencies] Processing KY3P task {"taskId":759,"taskType":"ky3p","currentProgress":0,"currentStatus":"not_started","timestamp":"2025-05-06T20:07:04.052Z"}
[UnifiedProgress] Starting progress update for task 759 (ky3p) {
  taskId: 759,
  taskType: 'ky3p',
  diagnosticId: 'prog-1746562024052-721',
  metadata: [
    'locked',
    'prerequisite_completed',
    'prerequisite_completed_at',
    'dependencyUnlockOperation',
    'previousProgress',
    'previousStatus',
    'isKy3pTask',
    'isUserOnboardingTask'
  ]
}
[UnifiedProgressCalc] Calculating progress for task 759 (ky3p)
[KY3P Progress] Calculated progress for task 759: {
  taskId: 759,
  taskType: 'ky3p',
  normalizedTaskType: 'ky3p',
  totalFields: 120,
  completedFields: 0,
  progress: 0,
  timeStamp: '2025-05-06T20:07:04.183Z'
}
[UnifiedProgressCalc] Task 759 (ky3p) progress: 0/120 = 0%
[INFO] [WebSocket] Broadcast task_updated to 3 clients
[2025-05-06T20:07:04.225Z] [INFO] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":272,"taskId":759,"taskType":"ky3p","isKy3pTask":true,"calculatedProgress":{"success":true,"taskId":759,"message":"Progress unchanged","progress":0,"status":"not_started"},"previousProgress":0,"wasPreserved":false}
[UnifiedProgress] Starting progress update for task 760 (open_banking) {
  taskId: 760,
  taskType: 'open_banking',
  diagnosticId: 'prog-1746562024225-968',
  metadata: [
    'locked',
    'prerequisite_completed',
    'prerequisite_completed_at',
    'dependencyUnlockOperation',
    'previousProgress',
    'previousStatus',
    'isKy3pTask',
    'isUserOnboardingTask'
  ]
}
[UnifiedProgressCalc] Calculating progress for task 760 (open_banking)
[UnifiedProgressCalc] Task 760 (open_banking) progress: 0/44 = 0%
[INFO] [WebSocket] Broadcast task_updated to 3 clients
[2025-05-06T20:07:04.394Z] [INFO] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":272,"taskId":760,"taskType":"open_banking","isKy3pTask":false,"calculatedProgress":{"success":true,"taskId":760,"message":"Progress unchanged","progress":0,"status":"not_started"},"previousProgress":0,"wasPreserved":false}
[2025-05-06T20:07:04.395Z] [INFO] [TaskDependencies] Successfully unlocked all tasks {"companyId":272,"count":3}
[Tasks] Successfully unlocked all tasks for company: 272
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 315',
    condition2: 'tasks.created_by = 315',
    condition3: "tasks.company_id = 272 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('17@e.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
[2025-05-06T20:07:04.503Z] [INFO] GET /api/tasks 200 in 549ms :: [{"id":757,"title":"New User Invitation: 17@e.com","description":"Complete us...
[2025-05-06T20:07:05.171Z] [INFO] GET /api/companies/current 304 in 34ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746561565790-xnq2byf: {
  type: 'ping',
  timestamp: '2025-05-06T20:07:05.805Z',
  connectionId: 'ws_1746561565268_xxxkuq1ye'
}
[Current Company] Using cached company data: 272
[2025-05-06T20:07:08.162Z] [INFO] GET /api/companies/current 304 in 30ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:07:11.169Z] [INFO] GET /api/companies/current 304 in 31ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:07:14.222Z] [INFO] GET /api/companies/current 304 in 96ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:07:17.179Z] [INFO] GET /api/companies/current 304 in 32ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:07:19.736Z] [INFO] GET /api/tasks 304 in 30ms :: [{"id":757,"title":"New User Invitation: 17@e.com","description":"Complete us...
[2025-05-06T20:07:20.162Z] [INFO] GET /api/companies/current 304 in 33ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:07:23.177Z] [INFO] GET /api/companies/current 304 in 37ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746561564445-1axxiw3: { type: 'ping' }
[INFO] [WebSocket] Received message from client client-1746561564951-upy7pjg: { type: 'ping' }
[INFO] [WebSocket] Received message from client client-1746561565790-xnq2byf: {
  type: 'ping',
  timestamp: '2025-05-06T20:07:25.805Z',
  connectionId: 'ws_1746561565268_xxxkuq1ye'
}
[2025-05-06T20:07:26.156Z] [INFO] GET /api/companies/current 304 in 31ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:07:29.174Z] [INFO] GET /api/companies/current 304 in 33ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:07:32.184Z] [INFO] GET /api/companies/current 304 in 39ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 315, company_id: 272, email: '17@e.com' }
[2025-05-06T20:07:34.924Z] [INFO] Performing dynamic task unlocking check for company {"companyId":272,"userId":315}
[2025-05-06T20:07:34.955Z] [INFO] No completed KYB tasks found, skipping security task unlock check {"companyId":272}
[Tasks] Automatically unlocking all tasks for company { userId: 315, companyId: 272, requestedBy: 'automatic_task_unlock' }
[2025-05-06T20:07:34.955Z] [INFO] [TaskDependencies] Unlocking ALL tasks for company {"companyId":272}
[2025-05-06T20:07:34.985Z] [INFO] [TaskDependencies] Found user onboarding task that needs completion {"taskId":757,"userEmail":"17@e.com","currentStatus":"completed","currentProgress":100}
[TaskDependencies] Skipping task 758 with submission indicators {
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasFileId: false,
  status: 'ready_for_submission',
  progress: 100,
  isReadyForSubmission: true
}
[2025-05-06T20:07:34.985Z] [INFO] [TaskDependencies] Found tasks to unlock {"companyId":272,"count":3,"taskIds":[757,759,760],"taskTypes":["user_onboarding","ky3p","open_banking"],"ky3pTaskCount":1,"ky3pTaskIds":[759]}
[2025-05-06T20:07:34.985Z] [INFO] [TaskDependencies] Setting User Onboarding task as completed {"taskId":757,"userEmail":"17@e.com","timestamp":"2025-05-06T20:07:34.985Z"}
[WebSocket] Broadcast task_update to 3 clients (0 errors) { messageId: 'msg_1746562055016_5d2ucwve8' }
[2025-05-06T20:07:35.017Z] [INFO] Successfully broadcasted task_update message
[2025-05-06T20:07:35.017Z] [INFO] [TaskDependencies] Processing KY3P task {"taskId":759,"taskType":"ky3p","currentProgress":0,"currentStatus":"not_started","timestamp":"2025-05-06T20:07:35.017Z"}
[UnifiedProgress] Starting progress update for task 759 (ky3p) {
  taskId: 759,
  taskType: 'ky3p',
  diagnosticId: 'prog-1746562055017-64',
  metadata: [
    'locked',
    'prerequisite_completed',
    'prerequisite_completed_at',
    'dependencyUnlockOperation',
    'previousProgress',
    'previousStatus',
    'isKy3pTask',
    'isUserOnboardingTask'
  ]
}
[UnifiedProgressCalc] Calculating progress for task 759 (ky3p)
[KY3P Progress] Calculated progress for task 759: {
  taskId: 759,
  taskType: 'ky3p',
  normalizedTaskType: 'ky3p',
  totalFields: 120,
  completedFields: 0,
  progress: 0,
  timeStamp: '2025-05-06T20:07:35.131Z'
}
[UnifiedProgressCalc] Task 759 (ky3p) progress: 0/120 = 0%
[INFO] [WebSocket] Broadcast task_updated to 3 clients
[2025-05-06T20:07:35.160Z] [INFO] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":272,"taskId":759,"taskType":"ky3p","isKy3pTask":true,"calculatedProgress":{"success":true,"taskId":759,"message":"Progress unchanged","progress":0,"status":"not_started"},"previousProgress":0,"wasPreserved":false}
[UnifiedProgress] Starting progress update for task 760 (open_banking) {
  taskId: 760,
  taskType: 'open_banking',
  diagnosticId: 'prog-1746562055160-70',
  metadata: [
    'locked',
    'prerequisite_completed',
    'prerequisite_completed_at',
    'dependencyUnlockOperation',
    'previousProgress',
    'previousStatus',
    'isKy3pTask',
    'isUserOnboardingTask'
  ]
}
[UnifiedProgressCalc] Calculating progress for task 760 (open_banking)
[2025-05-06T20:07:35.253Z] [INFO] GET /api/companies/current 304 in 30ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[UnifiedProgressCalc] Task 760 (open_banking) progress: 0/44 = 0%
[INFO] [WebSocket] Broadcast task_updated to 3 clients
[2025-05-06T20:07:35.300Z] [INFO] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":272,"taskId":760,"taskType":"open_banking","isKy3pTask":false,"calculatedProgress":{"success":true,"taskId":760,"message":"Progress unchanged","progress":0,"status":"not_started"},"previousProgress":0,"wasPreserved":false}
[2025-05-06T20:07:35.300Z] [INFO] [TaskDependencies] Successfully unlocked all tasks {"companyId":272,"count":3}
[Tasks] Successfully unlocked all tasks for company: 272
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 315',
    condition2: 'tasks.created_by = 315',
    condition3: "tasks.company_id = 272 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('17@e.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
[2025-05-06T20:07:35.391Z] [INFO] GET /api/tasks 200 in 467ms :: [{"id":757,"title":"New User Invitation: 17@e.com","description":"Complete us...
[2025-05-06T20:07:38.172Z] [INFO] GET /api/companies/current 304 in 38ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:07:41.164Z] [INFO] GET /api/companies/current 304 in 31ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:07:44.160Z] [INFO] GET /api/companies/current 304 in 33ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746561565790-xnq2byf: {
  type: 'ping',
  timestamp: '2025-05-06T20:07:45.805Z',
  connectionId: 'ws_1746561565268_xxxkuq1ye'
}
[2025-05-06T20:07:47.178Z] [INFO] GET /api/companies/current 304 in 32ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:07:50.166Z] [INFO] GET /api/companies/current 304 in 32ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:07:50.590Z] [INFO] GET /api/tasks 304 in 32ms :: [{"id":757,"title":"New User Invitation: 17@e.com","description":"Complete us...
[Current Company] Using cached company data: 272
[2025-05-06T20:07:53.172Z] [INFO] GET /api/companies/current 304 in 35ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746561564445-1axxiw3: { type: 'ping' }
[2025-05-06T20:07:56.227Z] [INFO] GET /api/companies/current 304 in 33ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:07:59.167Z] [INFO] GET /api/companies/current 304 in 31ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[Current Company] Fetching company for user: { userId: 315, companyId: 272 }
[Current Company] Found company: {
  id: 272,
  name: 'DevTest17',
  onboardingCompleted: false,
  riskScore: null,
  chosenScore: null,
  isDemo: true
}
[2025-05-06T20:08:02.199Z] [INFO] GET /api/companies/current 304 in 63ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:08:05.187Z] [INFO] GET /api/companies/current 304 in 37ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 315, company_id: 272, email: '17@e.com' }
[2025-05-06T20:08:05.777Z] [INFO] Performing dynamic task unlocking check for company {"companyId":272,"userId":315}
[2025-05-06T20:08:05.822Z] [INFO] No completed KYB tasks found, skipping security task unlock check {"companyId":272}
[Tasks] Automatically unlocking all tasks for company { userId: 315, companyId: 272, requestedBy: 'automatic_task_unlock' }
[2025-05-06T20:08:05.823Z] [INFO] [TaskDependencies] Unlocking ALL tasks for company {"companyId":272}
[2025-05-06T20:08:05.868Z] [INFO] [TaskDependencies] Found user onboarding task that needs completion {"taskId":757,"userEmail":"17@e.com","currentStatus":"completed","currentProgress":100}
[TaskDependencies] Skipping task 758 with submission indicators {
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasFileId: false,
  status: 'ready_for_submission',
  progress: 100,
  isReadyForSubmission: true
}
[2025-05-06T20:08:05.868Z] [INFO] [TaskDependencies] Found tasks to unlock {"companyId":272,"count":3,"taskIds":[757,759,760],"taskTypes":["user_onboarding","ky3p","open_banking"],"ky3pTaskCount":1,"ky3pTaskIds":[759]}
[2025-05-06T20:08:05.868Z] [INFO] [TaskDependencies] Setting User Onboarding task as completed {"taskId":757,"userEmail":"17@e.com","timestamp":"2025-05-06T20:08:05.868Z"}
[INFO] [WebSocket] Received message from client client-1746561565790-xnq2byf: {
  type: 'ping',
  timestamp: '2025-05-06T20:08:05.805Z',
  connectionId: 'ws_1746561565268_xxxkuq1ye'
}
[WebSocket] Broadcast task_update to 3 clients (0 errors) { messageId: 'msg_1746562085918_e4yaqszky' }
[2025-05-06T20:08:05.918Z] [INFO] Successfully broadcasted task_update message
[2025-05-06T20:08:05.918Z] [INFO] [TaskDependencies] Processing KY3P task {"taskId":759,"taskType":"ky3p","currentProgress":0,"currentStatus":"not_started","timestamp":"2025-05-06T20:08:05.918Z"}
[UnifiedProgress] Starting progress update for task 759 (ky3p) {
  taskId: 759,
  taskType: 'ky3p',
  diagnosticId: 'prog-1746562085918-277',
  metadata: [
    'locked',
    'prerequisite_completed',
    'prerequisite_completed_at',
    'dependencyUnlockOperation',
    'previousProgress',
    'previousStatus',
    'isKy3pTask',
    'isUserOnboardingTask'
  ]
}
[UnifiedProgressCalc] Calculating progress for task 759 (ky3p)
[KY3P Progress] Calculated progress for task 759: {
  taskId: 759,
  taskType: 'ky3p',
  normalizedTaskType: 'ky3p',
  totalFields: 120,
  completedFields: 0,
  progress: 0,
  timeStamp: '2025-05-06T20:08:06.049Z'
}
[UnifiedProgressCalc] Task 759 (ky3p) progress: 0/120 = 0%
[INFO] [WebSocket] Broadcast task_updated to 3 clients
[2025-05-06T20:08:06.080Z] [INFO] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":272,"taskId":759,"taskType":"ky3p","isKy3pTask":true,"calculatedProgress":{"success":true,"taskId":759,"message":"Progress unchanged","progress":0,"status":"not_started"},"previousProgress":0,"wasPreserved":false}
[UnifiedProgress] Starting progress update for task 760 (open_banking) {
  taskId: 760,
  taskType: 'open_banking',
  diagnosticId: 'prog-1746562086080-466',
  metadata: [
    'locked',
    'prerequisite_completed',
    'prerequisite_completed_at',
    'dependencyUnlockOperation',
    'previousProgress',
    'previousStatus',
    'isKy3pTask',
    'isUserOnboardingTask'
  ]
}
[UnifiedProgressCalc] Calculating progress for task 760 (open_banking)
[UnifiedProgressCalc] Task 760 (open_banking) progress: 0/44 = 0%
[INFO] [WebSocket] Broadcast task_updated to 3 clients
[2025-05-06T20:08:06.241Z] [INFO] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":272,"taskId":760,"taskType":"open_banking","isKy3pTask":false,"calculatedProgress":{"success":true,"taskId":760,"message":"Progress unchanged","progress":0,"status":"not_started"},"previousProgress":0,"wasPreserved":false}
[2025-05-06T20:08:06.241Z] [INFO] [TaskDependencies] Successfully unlocked all tasks {"companyId":272,"count":3}
[Tasks] Successfully unlocked all tasks for company: 272
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 315',
    condition2: 'tasks.created_by = 315',
    condition3: "tasks.company_id = 272 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('17@e.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
[2025-05-06T20:08:06.340Z] [INFO] GET /api/tasks 200 in 563ms :: [{"id":757,"title":"New User Invitation: 17@e.com","description":"Complete us...
[2025-05-06T20:08:08.171Z] [INFO] GET /api/companies/current 304 in 34ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:08:11.171Z] [INFO] GET /api/companies/current 304 in 31ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[PeriodicTaskReconciliation] Reconciling batch of 10 tasks: [
  679, 685, 699, 697,
  751, 691, 707, 759,
  714, 698
]
[2025-05-06T20:08:13.871Z] [INFO] GET /api/tasks 304 in 31ms :: [{"id":757,"title":"New User Invitation: 17@e.com","description":"Complete us...
[2025-05-06T20:08:13.942Z] [INFO] GET /api/companies/current 304 in 31ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[Task Progress] Calculated progress for task 679 (open_banking): 44/44 = 100%
[Task Progress] Calculated progress for task 685 (company_kyb): 30/30 = 100%
[2025-05-06T20:08:14.081Z] [INFO] GET /api/tasks/758 304 in 60ms :: {"id":758,"title":"1. KYB Form: DevTest17","description":"Complete KYB verifi...
[Task Progress] Calculated progress for task 699 (open_banking): 0/44 = 0%
[Auth] Returning user session data
[Task Progress] Calculated progress for task 697 (company_kyb): 30/30 = 100%
[Task Templates API] Fetching template for task type: company_kyb, user: 315
[2025-05-06T20:08:14.321Z] [INFO] GET /api/tasks/758 304 in 69ms :: {"id":758,"title":"1. KYB Form: DevTest17","description":"Complete KYB verifi...
[Task Templates API] Found template: 1 (KYB Form) for task type: company_kyb
[Task Progress] Calculated progress for task 751 (ky3p): 0/120 = 0%
[Task Templates API] Retrieved 9 configuration items for template ID: 1
[2025-05-06T20:08:14.510Z] [INFO] GET /api/task-templates/by-type/company_kyb 304 in 192ms :: {"id":1,"name":"KYB Form","description":"Know Your Business form for company ...
[Task Progress] Calculated progress for task 691 (open_banking): 0/44 = 0%
[2025-05-06T20:08:14.566Z] [INFO] GET /api/companies/current 304 in 72ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[Task Progress] Calculated progress for task 707 (open_banking): 0/44 = 0%
[KYB API Debug] Loading progress for task: 758
[Task Reconciliation] Found 30 responses for task 758 (type: company_kyb)
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 100,
  currentStatus: 'ready_for_submission',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: true,
  effectiveHasResponses: true,
  timestamp: '2025-05-06T20:08:14.730Z'
}
[STATUS DETERMINATION] Task has 100% progress but is not submitted, setting to READY_FOR_SUBMISSION
[Task Reconciliation] Progress calculation: {
  taskId: 758,
  currentProgress: 100,
  calculatedProgress: 100,
  currentStatus: 'ready_for_submission',
  calculatedStatus: 'ready_for_submission',
  responseCount: 30,
  completeCount: 30
}
[Task Reconciliation] No updates needed for task 758
[Task Progress] Calculated progress for task 759 (ky3p): 0/0 = 0%
[KYB API Debug] Retrieved task: {
  taskId: 758,
  status: 'ready_for_submission',
  progress: 100,
  metadata: [
    'company_id',
    'created_at',
    'statusFlow',
    'created_via',
    'lastUpdated',
    'status_flow',
    'company_name',
    'created_by_id',
    'progressHistory',
    'prerequisite_for',
    'lastProgressUpdate',
    'lastProgressReconciliation'
  ],
  timestamp: '2025-05-06T20:08:14.759Z'
}
[KYB API Debug] Retrieved responses: {
  responseCount: 30,
  fields: [
    {
      field: 'lifetimeCustomerValue',
      status: 'COMPLETE',
      hasValue: true
    },
    {
      field: 'annualRecurringRevenue',
      status: 'COMPLETE',
      hasValue: true
    },
    {
      field: 'monthlyRecurringRevenue',
      status: 'COMPLETE',
      hasValue: true
    },
    {
      field: 'investigationsIncidents',
      status: 'COMPLETE',
      hasValue: true
    },
    {
      field: 'financialStatements',
      status: 'COMPLETE',
      hasValue: true
    },
    {
      field: 'operationalPolicies',
      status: 'COMPLETE',
      hasValue: true
    },
    { field: 'dataVolume', status: 'COMPLETE', hasValue: true },
    { field: 'dataTypes', status: 'COMPLETE', hasValue: true },
    { field: 'sanctionsCheck', status: 'COMPLETE', hasValue: true },
    { field: 'dueDiligence', status: 'COMPLETE', hasValue: true },
    { field: 'regulatoryActions', status: 'COMPLETE', hasValue: true },
    { field: 'legalEntityName', status: 'COMPLETE', hasValue: true },
    { field: 'registrationNumber', status: 'COMPLETE', hasValue: true },
    { field: 'incorporationDate', status: 'COMPLETE', hasValue: true },
    { field: 'businessType', status: 'COMPLETE', hasValue: true },
    { field: 'jurisdiction', status: 'COMPLETE', hasValue: true },
    { field: 'registeredAddress', status: 'COMPLETE', hasValue: true },
    { field: 'companyPhone', status: 'COMPLETE', hasValue: true },
    { field: 'priorNames', status: 'COMPLETE', hasValue: true },
    { field: 'licenses', status: 'COMPLETE', hasValue: true },
    { field: 'goodStanding', status: 'COMPLETE', hasValue: true },
    {
      field: 'corporateRegistration',
      status: 'COMPLETE',
      hasValue: true
    },
    { field: 'externalAudit', status: 'COMPLETE', hasValue: true },
    { field: 'controlEnvironment', status: 'COMPLETE', hasValue: true },
    { field: 'authorizedSigners', status: 'COMPLETE', hasValue: true },
    {
      field: 'governmentOwnership',
      status: 'COMPLETE',
      hasValue: true
    },
    {
      field: 'ultimateBeneficialOwners',
      status: 'COMPLETE',
      hasValue: true
    },
    {
      field: 'directorsAndOfficers',
      status: 'COMPLETE',
      hasValue: true
    },
    { field: 'contactEmail', status: 'COMPLETE', hasValue: true },
    {
      field: 'marketCapitalization',
      status: 'COMPLETE',
      hasValue: true
    }
  ],
  timestamp: '2025-05-06T20:08:14.790Z'
}
[SERVER DEBUG] No savedFormData found in task table
[SERVER DEBUG] No KYB form file ID found in task metadata
[KYB API Debug] Retrieved task data: {
  id: 758,
  responseCount: 30,
  progress: 100,
  status: 'ready_for_submission',
  formDataKeys: [
    'lifetimeCustomerValue',
    'annualRecurringRevenue',
    'monthlyRecurringRevenue',
    'investigationsIncidents',
    'financialStatements',
    'operationalPolicies',
    'dataVolume',
    'dataTypes',
    'sanctionsCheck',
    'dueDiligence',
    'regulatoryActions',
    'legalEntityName',
    'registrationNumber',
    'incorporationDate',
    'businessType',
    'jurisdiction',
    'registeredAddress',
    'companyPhone',
    'priorNames',
    'licenses',
    'goodStanding',
    'corporateRegistration',
    'externalAudit',
    'controlEnvironment',
    'authorizedSigners',
    'governmentOwnership',
    'ultimateBeneficialOwners',
    'directorsAndOfficers',
    'contactEmail',
    'marketCapitalization'
  ]
}
===============================================
[SERVER DEBUG] PREPARING GET RESPONSE at 2025-05-06T20:08:14.790Z
[SERVER DEBUG] Task ID: 758, Found 30 fields in database
===============================================
[SERVER DEBUG] Checking field corporateRegistration in retrieved data: "Delaware State Filing Number 1234567, registered as FinTech Innovations LLC on 05/12/2010"
[SERVER DEBUG] Checking field goodStanding in retrieved data: "Yes"
[SERVER DEBUG] Checking field regulatoryActions in retrieved data: "Yes"
[SERVER DEBUG] Checking field investigationsIncidents in retrieved data: "No significant incidents in the past 3 years"
[SERVER DEBUG] No fields with value "asdf" found in GET response data
[SERVER DEBUG] Sending GET response with 30 fields, status: ready_for_submission, progress: 100%
===============================================
[2025-05-06T20:08:14.824Z] [INFO] GET /api/kyb/progress/758 304 in 152ms :: {"formData":{"lifetimeCustomerValue":"$1,250","annualRecurringRevenue":"5,000...
[Task Progress] Calculated progress for task 714 (ky3p): 0/0 = 0%
[Task Progress] Calculated progress for task 698 (ky3p): 0/0 = 0%
[KYB API Debug] Loading progress for task: 758
[TimestampHandler] Retrieved 30 timestamps for task 758
[TimestampAPI] Returning 30 timestamps for task 758
[2025-05-06T20:08:15.075Z] [INFO] GET /api/kyb/timestamps/758 304 in 60ms :: {"legalEntityName":1746559174408,"registrationNumber":1746559174408,"incorpor...
[Task Reconciliation] Found 30 responses for task 758 (type: company_kyb)
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 100,
  currentStatus: 'ready_for_submission',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: true,
  effectiveHasResponses: true,
  timestamp: '2025-05-06T20:08:15.076Z'
}
[STATUS DETERMINATION] Task has 100% progress but is not submitted, setting to READY_FOR_SUBMISSION
[Task Reconciliation] Progress calculation: {
  taskId: 758,
  currentProgress: 100,
  calculatedProgress: 100,
  currentStatus: 'ready_for_submission',
  calculatedStatus: 'ready_for_submission',
  responseCount: 30,
  completeCount: 30
}
[Task Reconciliation] No updates needed for task 758
[KYB API Debug] Retrieved task: {
  taskId: 758,
  status: 'ready_for_submission',
  progress: 100,
  metadata: [
    'company_id',
    'created_at',
    'statusFlow',
    'created_via',
    'lastUpdated',
    'status_flow',
    'company_name',
    'created_by_id',
    'progressHistory',
    'prerequisite_for',
    'lastProgressUpdate',
    'lastProgressReconciliation'
  ],
  timestamp: '2025-05-06T20:08:15.106Z'
}
[KYB API Debug] Retrieved responses: {
  responseCount: 30,
  fields: [
    {
      field: 'lifetimeCustomerValue',
      status: 'COMPLETE',
      hasValue: true
    },
    {
      field: 'annualRecurringRevenue',
      status: 'COMPLETE',
      hasValue: true
    },
    {
      field: 'monthlyRecurringRevenue',
      status: 'COMPLETE',
      hasValue: true
    },
    {
      field: 'investigationsIncidents',
      status: 'COMPLETE',
      hasValue: true
    },
    {
      field: 'financialStatements',
      status: 'COMPLETE',
      hasValue: true
    },
    {
      field: 'operationalPolicies',
      status: 'COMPLETE',
      hasValue: true
    },
    { field: 'dataVolume', status: 'COMPLETE', hasValue: true },
    { field: 'dataTypes', status: 'COMPLETE', hasValue: true },
    { field: 'sanctionsCheck', status: 'COMPLETE', hasValue: true },
    { field: 'dueDiligence', status: 'COMPLETE', hasValue: true },
    { field: 'regulatoryActions', status: 'COMPLETE', hasValue: true },
    { field: 'legalEntityName', status: 'COMPLETE', hasValue: true },
    { field: 'registrationNumber', status: 'COMPLETE', hasValue: true },
    { field: 'incorporationDate', status: 'COMPLETE', hasValue: true },
    { field: 'businessType', status: 'COMPLETE', hasValue: true },
    { field: 'jurisdiction', status: 'COMPLETE', hasValue: true },
    { field: 'registeredAddress', status: 'COMPLETE', hasValue: true },
    { field: 'companyPhone', status: 'COMPLETE', hasValue: true },
    { field: 'priorNames', status: 'COMPLETE', hasValue: true },
    { field: 'licenses', status: 'COMPLETE', hasValue: true },
    { field: 'goodStanding', status: 'COMPLETE', hasValue: true },
    {
      field: 'corporateRegistration',
      status: 'COMPLETE',
      hasValue: true
    },
    { field: 'externalAudit', status: 'COMPLETE', hasValue: true },
    { field: 'controlEnvironment', status: 'COMPLETE', hasValue: true },
    { field: 'authorizedSigners', status: 'COMPLETE', hasValue: true },
    {
      field: 'governmentOwnership',
      status: 'COMPLETE',
      hasValue: true
    },
    {
      field: 'ultimateBeneficialOwners',
      status: 'COMPLETE',
      hasValue: true
    },
    {
      field: 'directorsAndOfficers',
      status: 'COMPLETE',
      hasValue: true
    },
    { field: 'contactEmail', status: 'COMPLETE', hasValue: true },
    {
      field: 'marketCapitalization',
      status: 'COMPLETE',
      hasValue: true
    }
  ],
  timestamp: '2025-05-06T20:08:15.135Z'
}
[SERVER DEBUG] No savedFormData found in task table
[SERVER DEBUG] No KYB form file ID found in task metadata
[KYB API Debug] Retrieved task data: {
  id: 758,
  responseCount: 30,
  progress: 100,
  status: 'ready_for_submission',
  formDataKeys: [
    'lifetimeCustomerValue',
    'annualRecurringRevenue',
    'monthlyRecurringRevenue',
    'investigationsIncidents',
    'financialStatements',
    'operationalPolicies',
    'dataVolume',
    'dataTypes',
    'sanctionsCheck',
    'dueDiligence',
    'regulatoryActions',
    'legalEntityName',
    'registrationNumber',
    'incorporationDate',
    'businessType',
    'jurisdiction',
    'registeredAddress',
    'companyPhone',
    'priorNames',
    'licenses',
    'goodStanding',
    'corporateRegistration',
    'externalAudit',
    'controlEnvironment',
    'authorizedSigners',
    'governmentOwnership',
    'ultimateBeneficialOwners',
    'directorsAndOfficers',
    'contactEmail',
    'marketCapitalization'
  ]
}
===============================================
[SERVER DEBUG] PREPARING GET RESPONSE at 2025-05-06T20:08:15.136Z
[SERVER DEBUG] Task ID: 758, Found 30 fields in database
===============================================
[SERVER DEBUG] Checking field corporateRegistration in retrieved data: "Delaware State Filing Number 1234567, registered as FinTech Innovations LLC on 05/12/2010"
[SERVER DEBUG] Checking field goodStanding in retrieved data: "Yes"
[SERVER DEBUG] Checking field regulatoryActions in retrieved data: "Yes"
[SERVER DEBUG] Checking field investigationsIncidents in retrieved data: "No significant incidents in the past 3 years"
[SERVER DEBUG] No fields with value "asdf" found in GET response data
[SERVER DEBUG] Sending GET response with 30 fields, status: ready_for_submission, progress: 100%
===============================================
[2025-05-06T20:08:15.170Z] [INFO] GET /api/kyb/progress/758 304 in 154ms :: {"formData":{"lifetimeCustomerValue":"$1,250","annualRecurringRevenue":"5,000...
[TimestampHandler] Retrieved 30 timestamps for task 758
[TimestampAPI] Returning 30 timestamps for task 758
[2025-05-06T20:08:15.406Z] [INFO] GET /api/kyb/timestamps/758 304 in 63ms :: {"legalEntityName":1746559174408,"registrationNumber":1746559174408,"incorpor...
[2025-05-06T20:08:17.281Z] [INFO] GET /api/companies/current 304 in 31ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:08:20.283Z] [INFO] GET /api/companies/current 304 in 31ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[Current Company] Using cached company data: 272
[2025-05-06T20:08:23.287Z] [INFO] GET /api/companies/current 304 in 33ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746561564445-1axxiw3: { type: 'ping' }
[INFO] [WebSocket] Received message from client client-1746561565790-xnq2byf: {
  type: 'ping',
  timestamp: '2025-05-06T20:08:25.805Z',
  connectionId: 'ws_1746561565268_xxxkuq1ye'
}
[2025-05-06T20:08:26.272Z] [INFO] GET /api/companies/current 304 in 31ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:08:29.291Z] [INFO] GET /api/companies/current 304 in 31ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:08:31.179Z] [INFO] Received form submission request {"taskId":758,"formType":"kyb","userId":315,"companyId":272,"dataKeysCount":4}
[WebSocket] Broadcast form_submission to 3 clients (0 errors) { messageId: 'msg_1746562111179_v6y0k1yh8' }
[2025-05-06T20:08:31.179Z] [INFO] Successfully broadcasted form_submission message
[2025-05-06T20:08:31.179Z] [INFO] Starting transactional form submission {"taskId":758,"userId":315,"companyId":272,"formType":"kyb","fieldsCount":4}
[2025-05-06T20:08:31.179Z] [INFO] Starting form submission transaction {"taskId":758,"userId":315,"companyId":272,"formType":"kyb","transactionId":"tx-1746562111179-pdcq5","logContext":{"service":"TransactionalFormHandler"}}
[TransactionalFormHandler] Starting file creation for task 758 {
  taskId: 758,
  formType: 'kyb',
  companyId: 272,
  userId: 315,
  formDataKeys: 4,
  timestamp: '2025-05-06T20:08:31.180Z'
}
[2025-05-06T20:08:31.180Z] [INFO] Creating file for kyb task 758 {"taskId":758,"normalizedFormType":"kyb"}
[FileCreation] Retrieved 30 KYB responses for task 758 ordered by UI form order
[2025-05-06T20:08:31.211Z] [INFO] Building CSV from 30 complete responses {"taskId":758}
[2025-05-06T20:08:31.211Z] [INFO] Created 30 data rows from database responses {"taskId":758}
[2025-05-06T20:08:31.211Z] [INFO] Created CSV with 30 rows (form fields only, no metadata rows) {"taskId":758}
[FileCreation] Created standard CSV file with 30 data rows for task 758
[FileCreation] CSV file created with 30 fields: {
  rowCount: 31,
  headerRow: [ 'id', 'question', 'response', 'field_key', 'timestamp' ],
  contentLength: 4089
}
[FileCreation] Created CSV file for task 758
[FileCreation] Creating file with metadata for task 758: {
  taskId: 758,
  formType: 'kyb',
  fileName: 'kyb_758_272_v1.0_20250506200831.csv',
  metadataFields: [
    'taskId',
    'taskType',
    'submissionDate',
    'formType',
    'formSubmission',
    'fieldCount',
    'fileName',
    'version',
    'jsonBackup'
  ]
}
[2025-05-06T20:08:31.212Z] [INFO] Creating file: kyb_758_272_v1.0_20250506200831.csv {"companyId":272,"userId":315,"fileType":"text/csv","fileSize":4089}
[FileCreation] Creating file for company 272 by user 315 {
  fileName: 'kyb_758_272_v1.0_20250506200831.csv',
  fileType: 'text/csv',
  fileSize: 4089,
  timestamp: '2025-05-06T20:08:31.212Z'
}
[2025-05-06T20:08:31.290Z] [INFO] File created successfully {"fileId":853,"fileName":"kyb_758_272_v1.0_20250506200831.csv","companyId":272}
[TransactionalFormHandler] File creation result for task 758: {
  success: true,
  fileId: 853,
  fileName: 'kyb_758_272_v1.0_20250506200831.csv',
  error: undefined,
  timestamp: '2025-05-06T20:08:31.290Z'
}
[FileCreation] ✅ File 853 created for task 758 and linked to file vault
[TransactionalFormHandler] Updating task 758 status to 'submitted' with 100% progress
[TransactionalFormHandler] ✅ Successfully updated task 758 status to 'submitted'
[2025-05-06T20:08:31.290Z] [INFO] [TabAccess] Unlocking tabs for form submission {"companyId":272,"formType":"kyb"}
[2025-05-06T20:08:31.290Z] [INFO] [TabAccess] Adding tabs to company {"companyId":272,"tabs":["file-vault"],"source":"form_submission"}
[TransactionalFormHandler] Broadcasting form submission for task 758: {
  formType: 'kyb',
  taskId: 758,
  companyId: 272,
  hasFileId: true,
  hasUnlockedTabs: true,
  timestamp: '2025-05-06T20:08:31.327Z'
}
[2025-05-06T20:08:31.327Z] [INFO] Broadcasting form submission event {"hasFileId":false,"hasFileName":false,"hasUnlockedTabs":false,"tabCount":0,"hasCompletedActions":false}
[WebSocket] Broadcast form_submission to 3 clients (0 errors) { messageId: 'msg_1746562111327_8s7yhpu26' }
[2025-05-06T20:08:31.328Z] [INFO] Successfully broadcasted form_submission message
[WebSocket] Broadcast task_update to 3 clients (0 errors) { messageId: 'msg_1746562111328_z90ssfkpv' }
[2025-05-06T20:08:31.328Z] [INFO] Successfully broadcasted task_update message
[2025-05-06T20:08:31.331Z] [WARN] Cannot cache form event without taskId and formType {"event":{"0":"k","1":"y","2":"b","timestamp":"2025-05-06T20:08:31.327Z","messageId":"msg_1746562111327_upotyie9y"}}
[WebSocket] Broadcast form_submission to 3 clients (0 errors) { messageId: 'msg_1746562111331_c4hexoc99' }
[2025-05-06T20:08:31.331Z] [INFO] Successfully broadcasted form_submission message
[WebSocket] Broadcast form_submitted to 3 clients (0 errors) { messageId: 'msg_1746562111331_j9cqx9a1y' }
[2025-05-06T20:08:31.331Z] [INFO] Successfully broadcasted form_submitted message
[WebSocket] Broadcast form_submission to 3 clients (0 errors) { messageId: 'msg_1746562111331_x3v9tvys8' }
[2025-05-06T20:08:31.332Z] [INFO] Successfully broadcasted form_submission message
[WebSocket] Broadcast form_submitted to 3 clients (0 errors) { messageId: 'msg_1746562111332_g3w0gc94e' }
[2025-05-06T20:08:31.332Z] [INFO] Successfully broadcasted form_submitted message
[WebSocket] Broadcast submission_status to 3 clients (0 errors) { messageId: 'msg_1746562111332_gnd4w8xzr' }
[2025-05-06T20:08:31.332Z] [INFO] Successfully broadcasted submission_status message
[2025-05-06T20:08:31.332Z] [INFO] Successfully broadcasted form submission events {"timestamp":"2025-05-06T20:08:31.327Z","messageId":"msg_1746562111327_upotyie9y"}
[2025-05-06T20:08:31.359Z] [INFO] POST /api/forms-tx/submit/kyb/758 200 in 181ms :: {"success":true,"message":"Form submitted successfully","fileId":853}
[2025-05-06T20:08:32.276Z] [INFO] GET /api/companies/current 304 in 31ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:08:35.283Z] [INFO] GET /api/companies/current 304 in 31ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:08:38.293Z] [INFO] GET /api/companies/current 304 in 40ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:08:41.295Z] [INFO] GET /api/companies/current 304 in 43ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:08:44.287Z] [INFO] GET /api/companies/current 304 in 31ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746561565790-xnq2byf: {
  type: 'ping',
  timestamp: '2025-05-06T20:08:45.805Z',
  connectionId: 'ws_1746561565268_xxxkuq1ye'
}
[2025-05-06T20:08:47.318Z] [INFO] GET /api/companies/current 304 in 46ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:08:50.283Z] [INFO] GET /api/companies/current 304 in 35ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:08:53.285Z] [INFO] GET /api/companies/current 304 in 37ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746561564445-1axxiw3: { type: 'ping' }
[2025-05-06T20:08:56.274Z] [INFO] GET /api/companies/current 304 in 30ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[Current Company] Using cached company data: 272
[2025-05-06T20:08:59.290Z] [INFO] GET /api/companies/current 304 in 30ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[Current Company] Fetching company for user: { userId: 315, companyId: 272 }
[Current Company] Found company: {
  id: 272,
  name: 'DevTest17',
  onboardingCompleted: false,
  riskScore: null,
  chosenScore: null,
  isDemo: true
}
[2025-05-06T20:09:02.329Z] [INFO] GET /api/companies/current 304 in 68ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:09:05.284Z] [INFO] GET /api/companies/current 304 in 32ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746561565790-xnq2byf: {
  type: 'ping',
  timestamp: '2025-05-06T20:09:05.805Z',
  connectionId: 'ws_1746561565268_xxxkuq1ye'
}
[2025-05-06T20:09:08.284Z] [INFO] GET /api/companies/current 304 in 31ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:09:11.285Z] [INFO] GET /api/companies/current 304 in 31ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:09:14.277Z] [INFO] GET /api/companies/current 304 in 34ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:09:17.282Z] [INFO] GET /api/companies/current 304 in 31ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:09:20.278Z] [INFO] GET /api/companies/current 304 in 32ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-06T20:09:23.295Z] [INFO] GET /api/companies/current 304 in 33ms :: {"id":272,"name":"DevTest17","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746561564445-1axxiw3: { type: 'ping' }
[INFO] [WebSocket] Received message from client client-1746561564951-upy7pjg: { type: 'ping' }
[INFO] [WebSocket] Received message from client client-1746561565790-xnq2byf: {
  type: 'ping',
  timestamp: '2025-05-06T20:09:25.810Z',
  connectionId: 'ws_1746561565268_xxxkuq1ye'
}