> rest-express@1.0.0 dev
> tsx server/index.ts

Database migrations disabled - schema already applied
[EmailService] Initializing email service
[EmailService] Email service initialized successfully
[OpenAI] Service initialized with API key: API key is set
Database module not found, creating a mock implementation
[Auth] Setting up authentication...
[Auth] Setting up PostgreSQL session store
[Auth] PostgreSQL session store initialized successfully
[Auth] Authentication setup completed
[2025-05-07T17:30:50.098Z] [INFO] [App] [KY3P-BATCH-UPDATE] Registering KY3P batch update routes 
[2025-05-07T17:30:50.098Z] [INFO] [App] Registering KY3P batch update routes 
[2025-05-07T17:30:50.099Z] [INFO] [App] [UnifiedKY3P] Registering unified KY3P update routes 
[Routes] Registered KY3P field key router
[Routes] Registered KY3P field key router
[2025-05-07T17:30:50.099Z] [INFO] [App] Registering KY3P field update routes 
[2025-05-07T17:30:50.101Z] [INFO] [App] [OpenBankingRoutes] Setting up routes... 
[Routes] Setting up transaction-based unified form submission router
[Routes] Successfully registered transaction-based unified form submission router
[Routes] Setting up unified form submission router
[Routes] Successfully registered unified form submission router
[Routes] Setting up transactional form submission router
[Routes] Successfully registered transactional form submission router
[Routes] Routes setup completed
[2025-05-07T17:30:50.103Z] [INFO] [App] [WebSocket] Setting up unified WebSocket server on path /ws 
[2025-05-07T17:30:50.104Z] [INFO] [WebSocket] Unified WebSocket server initialized successfully {"module":"WebSocket","clients":0,"path":"/ws","id":"uf9g9r","timestamp":"2025-05-07T17:30:50.104Z"}
[2025-05-07T17:30:50.104Z] [INFO] [App] [WebSocket] Unified WebSocket server initialized successfully 
[2025-05-07T17:30:50.104Z] [INFO] [App] [ServerStartup] WebSocket server initialized with unified implementation 
[2025-05-07T17:30:50.104Z] [INFO] [App] [TaskWebSocket] WebSocket server registered with unified implementation 
[2025-05-07T17:30:50.104Z] [INFO] [App] [ServerStartup] WebSocket server registered with task-update utility 
[TaskBroadcast] WebSocket server reference set up
[TaskBroadcast] WebSocket server reference set, but clients property is missing
[2025-05-07T17:30:50.104Z] [INFO] [App] [ServerStartup] WebSocket server registered with task-broadcast utility 
[2025-05-07T17:30:50.105Z] [INFO] [App] Setting up Vite development server 
[ENV] Using PORT=5000 from environment (override: yes)
[ENV] Environment=development (production: no)
[2025-05-07T17:30:50.121Z] [INFO] [App] Server running on 0.0.0.0:5000 
[2025-05-07T17:30:50.121Z] [INFO] [App] Environment: development 
[Deployment] Server running on 0.0.0.0:5000
[Deployment] Environment: development
[Deployment] Port forwarding: Custom port: 5000
[Deployment] Development mode: Hot reloading enabled
[2025-05-07T17:30:50.122Z] [INFO] [App] Starting periodic task reconciliation system... 
[PeriodicTaskReconciliation] Stopped periodic reconciliation system
[PeriodicTaskReconciliation] Starting periodic reconciliation system (interval: 300000ms)
[2025-05-07T17:30:50.122Z] [INFO] [App] Task reconciliation system initialized successfully 
[2025-05-07T17:30:51.106Z] [WARN] [App] [ServerStartup] Warning: WebSocket server not properly initialized 
[2025-05-07T17:30:51.219Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1746639051219-5i4g7yo","clients":1}
[2025-05-07T17:30:52.539Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1746639052539-2gx0twd","clients":2}
[2025-05-07T17:30:54.764Z] [INFO] [WebSocket] Received message from client client-1746639052539-2gx0twd {"module":"WebSocket","type":"authenticate","userId":null,"companyId":null,"clientId":"ws_1746638930958_imxkieovb","timestamp":"2025-05-07T17:30:52.574Z"}
[2025-05-07T17:30:54.765Z] [INFO] [WebSocket] Authentication from client client-1746639052539-2gx0twd {"module":"WebSocket","userId":null,"companyId":null,"hasToken":true}
[2025-05-07T17:30:54.825Z] New client connected to the pool (1/3)
[2025-05-07T17:30:55.003Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1746639055003-rvfx8a8","clients":3}
[2025-05-07T17:30:55.358Z] [INFO] [WebSocket] Received message from client client-1746639055003-rvfx8a8 {"module":"WebSocket","type":"authenticate","data":{"timestamp":"2025-05-07T17:30:55.035Z"}}
[2025-05-07T17:30:55.358Z] [INFO] [WebSocket] Authentication from client client-1746639055003-rvfx8a8 {"module":"WebSocket","hasToken":true}
[Auth] Returning user session data
[2025-05-07T17:30:56.229Z] New client connected to the pool (2/3)
[Current Company] Fetching company for user: { userId: 316, companyId: 273 }
[Current Company] Found company: {
  id: 273,
  name: 'DevTest18',
  onboardingCompleted: false,
  riskScore: null,
  chosenScore: null,
  isDemo: true
}
[2025-05-07T17:30:56.653Z] [INFO] [App] GET /api/companies/current 200 in 216ms :: {"id":273,"name":"DevTest18","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-07T17:30:56.837Z] [INFO] [App] GET /api/companies/current 304 in 33ms :: {"id":273,"name":"DevTest18","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-07T17:30:57.015Z] [INFO] [App] GET /api/companies/current 304 in 31ms :: {"id":273,"name":"DevTest18","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-07T17:30:57.132Z] [INFO] [WebSocket] Received message from client client-1746639051219-5i4g7yo {"module":"WebSocket","type":"authenticate","userId":316,"companyId":273,"clientId":"ws_1746639050746_k5tzcnyup","timestamp":"2025-05-07T17:30:57.047Z"}
[2025-05-07T17:30:57.132Z] [INFO] [WebSocket] Authentication from client client-1746639051219-5i4g7yo {"module":"WebSocket","userId":316,"companyId":273,"hasToken":true}
[2025-05-07T17:30:57.283Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1746639057283-j1l4qhz","clients":4}
[Auth] Unauthenticated user session
[2025-05-07T17:30:57.390Z] [INFO] [WebSocket] Received message from client client-1746639057283-j1l4qhz {"module":"WebSocket","type":"authenticate","data":{"timestamp":"2025-05-07T17:30:57.389Z"}}
[2025-05-07T17:30:57.391Z] [INFO] [WebSocket] Authentication from client client-1746639057283-j1l4qhz {"module":"WebSocket","hasToken":true}
[2025-05-07T17:30:57.607Z] [INFO] [App] GET /api/companies/current 304 in 54ms :: {"id":273,"name":"DevTest18","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-07T17:30:58.356Z] [INFO] [WebSocket] Client disconnected {"module":"WebSocket","clientId":"client-1746639057283-j1l4qhz","code":1001,"reason":"","remainingClients":3}
[2025-05-07T17:31:00.571Z] [INFO] [App] GET /api/companies/current 304 in 31ms :: {"id":273,"name":"DevTest18","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-07T17:31:03.551Z] [INFO] [App] GET /api/companies/current 304 in 34ms :: {"id":273,"name":"DevTest18","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-07T17:31:06.548Z] [INFO] [App] GET /api/companies/current 304 in 31ms :: {"id":273,"name":"DevTest18","category":"FinTech","is_demo":true,"revenue_tie... 
5:31:08 PM [vite] hmr update /src/components/forms/UniversalFormNew.tsx, /src/index.css?v=Cpkp6KaN1kC7gkOiJx_tX
[2025-05-07T17:31:09.554Z] [INFO] [App] GET /api/companies/current 304 in 32ms :: {"id":273,"name":"DevTest18","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-07T17:31:11.338Z] [INFO] [WebSocket] Received message from client client-1746639051219-5i4g7yo {"module":"WebSocket","type":"ping","timestamp":"2025-05-07T17:31:11.251Z","connectionId":"ws_1746639050746_k5tzcnyup"}
[2025-05-07T17:31:12.557Z] [INFO] [App] GET /api/companies/current 304 in 31ms :: {"id":273,"name":"DevTest18","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-07T17:31:15.547Z] [INFO] [App] GET /api/companies/current 304 in 31ms :: {"id":273,"name":"DevTest18","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-07T17:31:18.573Z] [INFO] [App] GET /api/companies/current 304 in 34ms :: {"id":273,"name":"DevTest18","category":"FinTech","is_demo":true,"revenue_tie... 
[PeriodicTaskReconciliation] Reconciling batch of 10 tasks: [
  685, 679, 691, 707,
  759, 763, 687, 689,
  698, 766
]
[Task Progress] Calculated progress for task 685 (company_kyb): 30/30 = 100%
[Task Progress] Calculated progress for task 679 (open_banking): 44/44 = 100%
[Task Progress] Calculated progress for task 691 (open_banking): 0/44 = 0%
[Task Progress] Calculated progress for task 707 (open_banking): 0/44 = 0%
[Task Progress] Calculated progress for task 759 (ky3p): 0/0 = 0%
[Task Progress] Calculated progress for task 763 (ky3p): 120/120 = 100%
[Task Progress] Calculated progress for task 687 (open_banking): 44/44 = 100%
[Task Progress] Calculated progress for task 689 (company_kyb): 30/30 = 100%
[Task Progress] Calculated progress for task 698 (ky3p): 0/0 = 0%
[Task Progress] Calculated progress for task 766 (company_kyb): 0/30 = 0%
[2025-05-07T17:31:21.556Z] [INFO] [App] GET /api/companies/current 304 in 31ms :: {"id":273,"name":"DevTest18","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-07T17:31:24.562Z] [INFO] [App] GET /api/companies/current 304 in 32ms :: {"id":273,"name":"DevTest18","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-07T17:31:25.121Z] [INFO] [WebSocket] Received message from client client-1746639055003-rvfx8a8 {"module":"WebSocket","type":"ping"}
[2025-05-07T17:31:27.547Z] [INFO] [App] GET /api/companies/current 304 in 30ms :: {"id":273,"name":"DevTest18","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-07T17:31:30.545Z] [INFO] [App] GET /api/companies/current 304 in 31ms :: {"id":273,"name":"DevTest18","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-07T17:31:31.339Z] [INFO] [WebSocket] Received message from client client-1746639051219-5i4g7yo {"module":"WebSocket","type":"ping","timestamp":"2025-05-07T17:31:31.251Z","connectionId":"ws_1746639050746_k5tzcnyup"}
[2025-05-07T17:31:33.545Z] [INFO] [App] GET /api/companies/current 304 in 30ms :: {"id":273,"name":"DevTest18","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-07T17:31:36.561Z] [INFO] [App] GET /api/companies/current 304 in 34ms :: {"id":273,"name":"DevTest18","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-07T17:31:39.548Z] [INFO] [App] GET /api/companies/current 304 in 30ms :: {"id":273,"name":"DevTest18","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-07T17:31:42.550Z] [INFO] [App] GET /api/companies/current 304 in 31ms :: {"id":273,"name":"DevTest18","category":"FinTech","is_demo":true,"revenue_tie... 
5:31:43 PM [vite] hmr update /src/components/forms/UniversalFormNew.tsx, /src/index.css?v=Cpkp6KaN1kC7gkOiJx_tX (x2)
[2025-05-07T17:31:45.549Z] [INFO] [App] GET /api/companies/current 304 in 31ms :: {"id":273,"name":"DevTest18","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-07T17:31:48.618Z] [INFO] [App] GET /api/companies/current 304 in 32ms :: {"id":273,"name":"DevTest18","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-07T17:31:51.341Z] [INFO] [WebSocket] Received message from client client-1746639051219-5i4g7yo {"module":"WebSocket","type":"ping","timestamp":"2025-05-07T17:31:51.252Z","connectionId":"ws_1746639050746_k5tzcnyup"}
[2025-05-07T17:31:51.544Z] [INFO] [App] GET /api/companies/current 304 in 29ms :: {"id":273,"name":"DevTest18","category":"FinTech","is_demo":true,"revenue_tie... 
5:31:54 PM [vite] hmr update /src/components/forms/UniversalFormNew.tsx, /src/index.css?v=Cpkp6KaN1kC7gkOiJx_tX (x3)
[2025-05-07T17:31:54.553Z] [INFO] [App] GET /api/companies/current 304 in 33ms :: {"id":273,"name":"DevTest18","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-07T17:31:55.123Z] [INFO] [WebSocket] Received message from client client-1746639055003-rvfx8a8 {"module":"WebSocket","type":"ping"}
[Current Company] Fetching company for user: { userId: 316, companyId: 273 }
[Current Company] Found company: {
  id: 273,
  name: 'DevTest18',
  onboardingCompleted: false,
  riskScore: null,
  chosenScore: null,
  isDemo: true
}
[2025-05-07T17:31:57.578Z] [INFO] [App] GET /api/companies/current 304 in 62ms :: {"id":273,"name":"DevTest18","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-07T17:32:00.554Z] [INFO] [App] GET /api/companies/current 304 in 29ms :: {"id":273,"name":"DevTest18","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-07T17:32:03.547Z] [INFO] [App] GET /api/companies/current 304 in 33ms :: {"id":273,"name":"DevTest18","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-07T17:32:06.547Z] [INFO] [App] GET /api/companies/current 304 in 31ms :: {"id":273,"name":"DevTest18","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-07T17:32:09.606Z] [INFO] [App] GET /api/companies/current 304 in 31ms :: {"id":273,"name":"DevTest18","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-07T17:32:11.336Z] [INFO] [WebSocket] Received message from client client-1746639051219-5i4g7yo {"module":"WebSocket","type":"ping","timestamp":"2025-05-07T17:32:11.252Z","connectionId":"ws_1746639050746_k5tzcnyup"}
[Current Company] Using cached company data: 273
[2025-05-07T17:32:12.556Z] [INFO] [App] GET /api/companies/current 304 in 30ms :: {"id":273,"name":"DevTest18","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-07T17:32:15.552Z] [INFO] [App] GET /api/companies/current 304 in 37ms :: {"id":273,"name":"DevTest18","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-07T17:32:18.550Z] [INFO] [App] GET /api/companies/current 304 in 32ms :: {"id":273,"name":"DevTest18","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-07T17:32:21.545Z] [INFO] [App] GET /api/companies/current 304 in 31ms :: {"id":273,"name":"DevTest18","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-07T17:32:24.554Z] [INFO] [App] GET /api/companies/current 304 in 30ms :: {"id":273,"name":"DevTest18","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-07T17:32:25.121Z] [INFO] [WebSocket] Received message from client client-1746639055003-rvfx8a8 {"module":"WebSocket","type":"ping"}
[2025-05-07T17:32:27.556Z] [INFO] [App] GET /api/companies/current 304 in 31ms :: {"id":273,"name":"DevTest18","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-07T17:32:30.547Z] [INFO] [App] GET /api/companies/current 304 in 31ms :: {"id":273,"name":"DevTest18","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-07T17:32:31.337Z] [INFO] [WebSocket] Received message from client client-1746639051219-5i4g7yo {"module":"WebSocket","type":"ping","timestamp":"2025-05-07T17:32:31.252Z","connectionId":"ws_1746639050746_k5tzcnyup"}
[2025-05-07T17:32:33.548Z] [INFO] [App] GET /api/companies/current 304 in 30ms :: {"id":273,"name":"DevTest18","category":"FinTech","is_demo":true,"revenue_tie... 
[2025-05-07T17:32:34.279Z] [INFO] [WebSocket] Client disconnected {"module":"WebSocket","clientId":"client-1746639055003-rvfx8a8","code":1001,"reason":"","remainingClients":2}
[2025-05-07T17:32:34.279Z] [INFO] [WebSocket] Client disconnected {"module":"WebSocket","clientId":"client-1746639051219-5i4g7yo","code":1001,"reason":"","remainingClients":1}
[2025-05-07T17:32:34.280Z] [INFO] [WebSocket] Client disconnected {"module":"WebSocket","clientId":"client-1746639052539-2gx0twd","code":1001,"reason":"","remainingClients":0}
[2025-05-07T17:32:35.083Z] New client connected to the pool (3/3)
Suppressing further connection logs. Pool size: 3
5:32:36 PM [vite] ✨ new dependencies optimized: @radix-ui/react-alert-dialog
5:32:36 PM [vite] ✨ optimized dependencies changed. reloading
[2025-05-07T17:32:37.060Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1746639157060-impqztt","clients":1}
[2025-05-07T17:32:37.195Z] [INFO] [WebSocket] Received message from client client-1746639157060-impqztt {"module":"WebSocket","type":"authenticate","data":{"timestamp":"2025-05-07T17:32:37.127Z"}}
[2025-05-07T17:32:37.195Z] [INFO] [WebSocket] Authentication from client client-1746639157060-impqztt {"module":"WebSocket","hasToken":true}
[Auth] Unauthenticated user session
[2025-05-07T17:32:38.129Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1746639158129-yrrs1hj","clients":2}
[Auth] Unauthenticated user session
[2025-05-07T17:32:38.215Z] [INFO] [WebSocket] Received message from client client-1746639158129-yrrs1hj {"module":"WebSocket","type":"authenticate","userId":null,"companyId":null,"clientId":"ws_1746639158094_aeljaoo0f","timestamp":"2025-05-07T17:32:38.207Z"}
[2025-05-07T17:32:38.215Z] [INFO] [WebSocket] Authentication from client client-1746639158129-yrrs1hj {"module":"WebSocket","userId":null,"companyId":null,"hasToken":true}
[2025-05-07T17:32:38.368Z] [INFO] [WebSocket] Client disconnected {"module":"WebSocket","clientId":"client-1746639158129-yrrs1hj","code":1001,"reason":"","remainingClients":1}
[2025-05-07T17:32:38.369Z] [INFO] [WebSocket] Client disconnected {"module":"WebSocket","clientId":"client-1746639157060-impqztt","code":1001,"reason":"","remainingClients":0}
[2025-05-07T17:32:48.685Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1746639168685-j99ld3s","clients":1}
[2025-05-07T17:32:48.809Z] [INFO] [WebSocket] Received message from client client-1746639168685-j99ld3s {"module":"WebSocket","type":"authenticate","data":{"timestamp":"2025-05-07T17:32:48.716Z"}}
[2025-05-07T17:32:48.809Z] [INFO] [WebSocket] Authentication from client client-1746639168685-j99ld3s {"module":"WebSocket","hasToken":true}
[2025-05-07T17:33:18.801Z] [INFO] [WebSocket] Received message from client client-1746639168685-j99ld3s {"module":"WebSocket","type":"ping"}
[2025-05-07T17:33:48.802Z] [INFO] [WebSocket] Received message from client client-1746639168685-j99ld3s {"module":"WebSocket","type":"ping"}
[2025-05-07T17:34:14.713Z] [INFO] [WebSocket] Client disconnected {"module":"WebSocket","clientId":"client-1746639168685-j99ld3s","code":1006,"reason":"","remainingClients":0}
[2025-05-07T17:34:16.168Z] [INFO] [WebSocket] Client connected {"module":"WebSocket","clientId":"client-1746639256168-xoubrbd","clients":1}
[2025-05-07T17:34:16.296Z] [INFO] [WebSocket] Received message from client client-1746639256168-xoubrbd {"module":"WebSocket","type":"authenticate","data":{"timestamp":"2025-05-07T17:34:16.154Z"}}
[2025-05-07T17:34:16.297Z] [INFO] [WebSocket] Authentication from client client-1746639256168-xoubrbd {"module":"WebSocket","hasToken":true}