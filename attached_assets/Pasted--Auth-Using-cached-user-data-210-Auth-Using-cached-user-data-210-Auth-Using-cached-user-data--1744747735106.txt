[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Returning user session data
8:07:06 PM [info] GET /api/tasks 304 in 28ms :: [{"id":347,"title":"New User Invitation: e.vancnavarr.o@gmail.com","descripti...
8:07:06 PM [info] GET /api/companies/current 304 in 67ms :: {"id":169,"name":"DevelopmentTesting","description":"FinTech partner company ...
8:07:06 PM [info] GET /api/tasks 304 in 29ms :: [{"id":347,"title":"New User Invitation: e.vancnavarr.o@gmail.com","descripti...
New WebSocket client connected
New WebSocket client connected
8:07:11 PM [info] GET /api/tasks 304 in 32ms :: [{"id":347,"title":"New User Invitation: e.vancnavarr.o@gmail.com","descripti...
WebSocket client disconnected with code 1001 and reason: 
WebSocket client disconnected with code 1001 and reason: 
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Using cached user data: 210
[Auth] Returning user session data
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 210, company_id: 169, email: 'e.vancnavarr.o@gmail.com' }
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 210',
    condition2: 'tasks.created_by = 210',
    condition3: "tasks.company_id = 169 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('e.vancnavarr.o@gmail.com')"
  }
}
8:07:22 PM [info] GET /api/companies/current 304 in 29ms :: {"id":169,"name":"DevelopmentTesting","description":"FinTech partner company ...
[Tasks] Tasks found: { count: 4 }
8:07:22 PM [info] GET /api/tasks 200 in 94ms :: [{"id":347,"title":"New User Invitation: e.vancnavarr.o@gmail.com","descripti...
8:07:23 PM [info] GET /api/tasks 304 in 30ms :: [{"id":347,"title":"New User Invitation: e.vancnavarr.o@gmail.com","descripti...
New WebSocket client connected
New WebSocket client connected
[Tasks Routes] Fetching task by ID (special .json endpoint): { taskId: 348, timestamp: '2025-04-15T20:07:23.971Z' }
[Tasks Routes] Task found by ID (special .json endpoint): {
  taskId: 348,
  title: '1. KYB Form: DevelopmentTesting',
  type: 'company_kyb',
  timestamp: '2025-04-15T20:07:24.000Z'
}
8:07:24 PM [info] GET /api/tasks.json/348 200 in 60ms :: {"id":348,"title":"1. KYB Form: DevelopmentTesting","description":"Complete K...
[Task Templates API] Fetching template for task type: company_kyb, user: 210
[Task Templates API] Found template: 1 (KYB Form) for task type: company_kyb
[Task Templates API] Retrieved 9 configuration items for template ID: 1
8:07:24 PM [info] GET /api/task-templates/by-type/company_kyb 304 in 90ms :: {"id":1,"name":"KYB Form","description":"Know Your Business form for company ...
[KYB API DIAGNOSTIC] Schema check passed: kyb_fields table exists
[KYB API DIAGNOSTIC] Field count: 30
[KYB API DIAGNOSTIC] Fields fetched successfully: {
  count: 30,
  fieldKeys: [
    'legalEntityName',
    'registrationNumber',
    'incorporationDate',
    'businessType',
    'jurisdiction',
    'registeredAddress',
    'companyPhone',
    'contactEmail',
    'directorsAndOfficers',
    'ultimateBeneficialOwners',
    'authorizedSigners',
    'governmentOwnership',
    'priorNames',
    'externalAudit',
    'controlEnvironment',
    'corporateRegistration',
    'goodStanding',
    'licenses',
    'annualRecurringRevenue',
    'monthlyRecurringRevenue',
    'marketCapitalization',
    'lifetimeCustomerValue',
    'financialStatements',
    'operationalPolicies',
    'dataVolume',
    'dataTypes',
    'sanctionsCheck',
    'dueDiligence',
    'investigationsIncidents',
    'regulatoryActions'
  ],
  groups: [
    'companyProfile',
    'governanceLeadership',
    'financialProfile',
    'operationsCompliance'
  ],
  sampleField: {
    id: 1,
    field_key: 'legalEntityName',
    display_name: 'Legal Entity Name',
    field_type: 'TEXT',
    question: 'What is the registered business name?',
    group: 'companyProfile',
    required: true,
    order: 1,
    step_index: 0,
    validation_rules: null,
    help_text: 'The official name under which your business is registered with government authorities.',
    created_at: 2025-03-05T07:32:29.195Z,
    updated_at: 2025-03-05T07:32:29.195Z
  }
}
8:07:24 PM [info] GET /api/kyb/fields 304 in 91ms :: {"fields":[{"id":1,"field_key":"legalEntityName","display_name":"Legal Entity...
[KYB API Debug] Loading progress for task: 348
[KYB Debug] Retrieved task: {
  id: 348,
  status: 'ready_for_submission',
  progress: 100,
  metadata: [
    'company_id',
    'created_at',
    'statusFlow',
    'created_via',
    'formVersion',
    'kybFormFile',
    'lastUpdated',
    'status_flow',
    'company_name',
    'created_by_id',
    'submissionDate',
    'prerequisite_for'
  ],
  timestamp: '2025-04-15T20:07:24.713Z'
}
[KYB Debug] Retrieved responses: {
  responseCount: 30,
  fields: [
    { field: 'externalAudit', status: 'complete', hasValue: true },
    { field: 'authorizedSigners', status: 'complete', hasValue: true },
    {
      field: 'governmentOwnership',
      status: 'complete',
      hasValue: true
    },
    { field: 'priorNames', status: 'complete', hasValue: true },
    { field: 'controlEnvironment', status: 'complete', hasValue: true }
  ],
  timestamp: '2025-04-15T20:07:24.770Z'
}
[KYB API Debug] Retrieved task data: {
  id: 348,
  responseCount: 30,
  progress: 100,
  status: 'ready_for_submission',
  formDataKeys: [
    'externalAudit',
    'authorizedSigners',
    'governmentOwnership',
    'priorNames',
    'controlEnvironment',
    'corporateRegistration',
    'goodStanding',
    'licenses',
    'annualRecurringRevenue',
    'monthlyRecurringRevenue',
    'marketCapitalization',
    'lifetimeCustomerValue',
    'legalEntityName',
    'registrationNumber',
    'incorporationDate',
    'businessType',
    'jurisdiction',
    'registeredAddress',
    'companyPhone',
    'contactEmail',
    'directorsAndOfficers',
    'ultimateBeneficialOwners',
    'financialStatements',
    'operationalPolicies',
    'dataVolume',
    'dataTypes',
    'sanctionsCheck',
    'dueDiligence',
    'investigationsIncidents',
    'regulatoryActions'
  ],
  formData: {
    externalAudit: 'asdf',
    authorizedSigners: 'asdf',
    governmentOwnership: 'asdf',
    priorNames: 'r',
    controlEnvironment: 'asdf',
    corporateRegistration: 'asdf',
    goodStanding: 'asdf',
    licenses: 'asdf',
    annualRecurringRevenue: 'asdf',
    monthlyRecurringRevenue: 'asdf',
    marketCapitalization: 'asdf',
    lifetimeCustomerValue: 'asdf',
    legalEntityName: 'asdfasdf',
    registrationNumber: 'bcdefghijk',
    incorporationDate: 'ab',
    businessType: 'ff',
    jurisdiction: 'asd',
    registeredAddress: 'dd',
    companyPhone: 'ff',
    contactEmail: 'AASFD',
    directorsAndOfficers: 'asdf',
    ultimateBeneficialOwners: 'asdf',
    financialStatements: 'asdf',
    operationalPolicies: 'asdf',
    dataVolume: 'asdf',
    dataTypes: 'asdf',
    sanctionsCheck: 'asdf',
    dueDiligence: 'asdf',
    investigationsIncidents: 'asdf',
    regulatoryActions: 'asdf'
  }
}
8:07:24 PM [info] GET /api/kyb/progress/348 304 in 117ms :: {"formData":{"externalAudit":"asdf","authorizedSigners":"asdf","governmentOwn...
[KYB API Debug] Loading progress for task: 348
[KYB Debug] Retrieved task: {
  id: 348,
  status: 'ready_for_submission',
  progress: 100,
  metadata: [
    'company_id',
    'created_at',
    'statusFlow',
    'created_via',
    'formVersion',
    'kybFormFile',
    'lastUpdated',
    'status_flow',
    'company_name',
    'created_by_id',
    'submissionDate',
    'prerequisite_for'
  ],
  timestamp: '2025-04-15T20:07:24.979Z'
}
[KYB Debug] Retrieved responses: {
  responseCount: 30,
  fields: [
    { field: 'externalAudit', status: 'complete', hasValue: true },
    { field: 'authorizedSigners', status: 'complete', hasValue: true },
    {
      field: 'governmentOwnership',
      status: 'complete',
      hasValue: true
    },
    { field: 'priorNames', status: 'complete', hasValue: true },
    { field: 'controlEnvironment', status: 'complete', hasValue: true }
  ],
  timestamp: '2025-04-15T20:07:25.010Z'
}
[KYB API Debug] Retrieved task data: {
  id: 348,
  responseCount: 30,
  progress: 100,
  status: 'ready_for_submission',
  formDataKeys: [
    'externalAudit',
    'authorizedSigners',
    'governmentOwnership',
    'priorNames',
    'controlEnvironment',
    'corporateRegistration',
    'goodStanding',
    'licenses',
    'annualRecurringRevenue',
    'monthlyRecurringRevenue',
    'marketCapitalization',
    'lifetimeCustomerValue',
    'legalEntityName',
    'registrationNumber',
    'incorporationDate',
    'businessType',
    'jurisdiction',
    'registeredAddress',
    'companyPhone',
    'contactEmail',
    'directorsAndOfficers',
    'ultimateBeneficialOwners',
    'financialStatements',
    'operationalPolicies',
    'dataVolume',
    'dataTypes',
    'sanctionsCheck',
    'dueDiligence',
    'investigationsIncidents',
    'regulatoryActions'
  ],
  formData: {
    externalAudit: 'asdf',
    authorizedSigners: 'asdf',
    governmentOwnership: 'asdf',
    priorNames: 'r',
    controlEnvironment: 'asdf',
    corporateRegistration: 'asdf',
    goodStanding: 'asdf',
    licenses: 'asdf',
    annualRecurringRevenue: 'asdf',
    monthlyRecurringRevenue: 'asdf',
    marketCapitalization: 'asdf',
    lifetimeCustomerValue: 'asdf',
    legalEntityName: 'asdfasdf',
    registrationNumber: 'bcdefghijk',
    incorporationDate: 'ab',
    businessType: 'ff',
    jurisdiction: 'asd',
    registeredAddress: 'dd',
    companyPhone: 'ff',
    contactEmail: 'AASFD',
    directorsAndOfficers: 'asdf',
    ultimateBeneficialOwners: 'asdf',
    financialStatements: 'asdf',
    operationalPolicies: 'asdf',
    dataVolume: 'asdf',
    dataTypes: 'asdf',
    sanctionsCheck: 'asdf',
    dueDiligence: 'asdf',
    investigationsIncidents: 'asdf',
    regulatoryActions: 'asdf'
  }
}
8:07:25 PM [info] GET /api/kyb/progress/348 304 in 93ms :: {"formData":{"externalAudit":"asdf","authorizedSigners":"asdf","governmentOwn...
[2025-04-15T20:07:27.654Z] [INFO] [KYB] Converting KYB fields to CSV {"fieldCount":30,"formDataKeys":31,"sampleKeys":["legalEntityName","registrationNumber","incorporationDate","businessType","jurisdiction"]}
[2025-04-15T20:07:27.654Z] [INFO] [KYB] Saved CSV file to ./uploads/kyb_348_1744747647654.csv
[2025-04-15T20:07:27.684Z] [INFO] [KYB] Starting transaction for KYB submission {"taskId":348,"userId":210}
[2025-04-15T20:07:27.684Z] [INFO] [KYB] Inserting file record with data {"fileName":"kyb_form_348_2025-04-15T200727.csv","taskId":348}
[2025-04-15T20:07:27.743Z] [INFO] [KYB] File record created in transaction {"fileId":682,"taskId":348}
[2025-04-15T20:07:27.773Z] [INFO] [KYB] Company data retrieved in transaction {"companyId":169,"availableTabs":["task-center","file-vault"]}
[2025-04-15T20:07:27.803Z] [INFO] [KYB] Task updated in transaction {"taskId":348,"status":"submitted"}
[2025-04-15T20:07:27.833Z] [INFO] [KYB] Found existing responses {"taskId":348,"count":30,"timestamp":"2025-04-15T20:07:27.833Z"}
[2025-04-15T20:07:27.863Z] [INFO] [KYB] Updated existing response for field: legalEntityName {"fieldId":1,"responseId":158}
[2025-04-15T20:07:27.892Z] [INFO] [KYB] Updated existing response for field: registrationNumber {"fieldId":2,"responseId":159}
[2025-04-15T20:07:27.922Z] [INFO] [KYB] Updated existing response for field: incorporationDate {"fieldId":3,"responseId":160}
[2025-04-15T20:07:27.950Z] [INFO] [KYB] Updated existing response for field: businessType {"fieldId":4,"responseId":161}
[2025-04-15T20:07:27.979Z] [INFO] [KYB] Updated existing response for field: jurisdiction {"fieldId":5,"responseId":162}
[2025-04-15T20:07:28.009Z] [INFO] [KYB] Updated existing response for field: registeredAddress {"fieldId":6,"responseId":163}
[2025-04-15T20:07:28.038Z] [INFO] [KYB] Updated existing response for field: companyPhone {"fieldId":7,"responseId":164}
[2025-04-15T20:07:28.067Z] [INFO] [KYB] Updated existing response for field: contactEmail {"fieldId":8,"responseId":166}
[2025-04-15T20:07:28.096Z] [INFO] [KYB] Updated existing response for field: directorsAndOfficers {"fieldId":9,"responseId":167}
[2025-04-15T20:07:28.125Z] [INFO] [KYB] Updated existing response for field: ultimateBeneficialOwners {"fieldId":10,"responseId":168}
[2025-04-15T20:07:28.154Z] [INFO] [KYB] Updated existing response for field: authorizedSigners {"fieldId":11,"responseId":169}
[2025-04-15T20:07:28.183Z] [INFO] [KYB] Updated existing response for field: governmentOwnership {"fieldId":12,"responseId":170}
[2025-04-15T20:07:28.212Z] [INFO] [KYB] Updated existing response for field: priorNames {"fieldId":13,"responseId":165}
[2025-04-15T20:07:28.241Z] [INFO] [KYB] Updated existing response for field: externalAudit {"fieldId":14,"responseId":171}
[2025-04-15T20:07:28.269Z] [INFO] [KYB] Updated existing response for field: controlEnvironment {"fieldId":15,"responseId":172}
[2025-04-15T20:07:28.298Z] [INFO] [KYB] Updated existing response for field: corporateRegistration {"fieldId":16,"responseId":173}
[2025-04-15T20:07:28.327Z] [INFO] [KYB] Updated existing response for field: goodStanding {"fieldId":17,"responseId":174}
[2025-04-15T20:07:28.356Z] [INFO] [KYB] Updated existing response for field: licenses {"fieldId":18,"responseId":175}
[2025-04-15T20:07:28.385Z] [INFO] [KYB] Updated existing response for field: annualRecurringRevenue {"fieldId":19,"responseId":176}
[2025-04-15T20:07:28.413Z] [INFO] [KYB] Updated existing response for field: monthlyRecurringRevenue {"fieldId":20,"responseId":177}
[2025-04-15T20:07:28.441Z] [INFO] [KYB] Updated existing response for field: marketCapitalization {"fieldId":21,"responseId":178}
[2025-04-15T20:07:28.472Z] [INFO] [KYB] Updated existing response for field: lifetimeCustomerValue {"fieldId":22,"responseId":179}
[2025-04-15T20:07:28.501Z] [INFO] [KYB] Updated existing response for field: financialStatements {"fieldId":23,"responseId":180}
[2025-04-15T20:07:28.530Z] [INFO] [KYB] Updated existing response for field: operationalPolicies {"fieldId":24,"responseId":181}
[2025-04-15T20:07:28.559Z] [INFO] [KYB] Updated existing response for field: dataVolume {"fieldId":25,"responseId":182}
[2025-04-15T20:07:28.588Z] [INFO] [KYB] Updated existing response for field: dataTypes {"fieldId":26,"responseId":183}
[2025-04-15T20:07:28.617Z] [INFO] [KYB] Updated existing response for field: sanctionsCheck {"fieldId":27,"responseId":184}
[2025-04-15T20:07:28.647Z] [INFO] [KYB] Updated existing response for field: dueDiligence {"fieldId":28,"responseId":185}
[2025-04-15T20:07:28.676Z] [INFO] [KYB] Updated existing response for field: investigationsIncidents {"fieldId":29,"responseId":186}
[2025-04-15T20:07:28.705Z] [INFO] [KYB] Updated existing response for field: regulatoryActions {"fieldId":30,"responseId":187}
[2025-04-15T20:07:28.705Z] [INFO] [KYB] All responses saved in transaction {"taskId":348,"responseCount":30}
[2025-04-15T20:07:28.735Z] [INFO] [KYB] KYB form complete and responses saved successfully {"taskId":348,"fileId":682,"responseCount":30,"warningCount":0}
8:07:28 PM [info] POST /api/kyb/save 200 in 1170ms :: {"success":true,"fileId":682}
[WebSocket] Received pong
[WebSocket] Received pong
[WebSocket] Received message: {
  type: 'pong',
  payload: { timestamp: '2025-04-15T20:07:39.219Z' },
  connectionId: 'ws-1'
}
[WebSocket] Received pong
[WebSocket] Received pong
[WebSocket] Received message: {
  type: 'pong',
  payload: { timestamp: '2025-04-15T20:08:08.660Z' },
  connectionId: 'ws-1'
}
[WebSocket] Received pong
[WebSocket] Received pong
[WebSocket] Received message: {
  type: 'pong',
  payload: { timestamp: '2025-04-15T20:08:24.222Z' },
  connectionId: 'ws-1'