> rest-express@1.0.0 dev
Database migrations disabled - schema already applied
[EmailService] Initializing email service
[EmailService] Email service initialized successfully
[Auth] Setting up authentication...
[Auth] Authentication setup completed
[Routes] Routes setup completed
[WebSocket] Server initialized on path: /ws
[WebSocket] WebSocketServer instance exported for test endpoints
3:25:52 PM [info] Setting up Vite development server
3:25:52 PM [express] Server running on port 5000
[Auth] Unauthenticated user session
New WebSocket client connected
WebSocket client disconnected with code 1001 and reason: 
[2025-04-20T15:26:51.022Z] New client connected to the pool (1/3)
[Auth] Deserializing user: 233
[2025-04-20T15:26:51.371Z] New client connected to the pool (2/3)
[2025-04-20T15:26:52.095Z] New client connected to the pool (3/3)
[Auth] Using cached user data: 233
[Auth] Using cached user data: 233
[Auth] Using cached user data: 233
[Auth] Using cached user data: 233
[Auth] Returning user session data
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 233, company_id: 192, email: 'email@l.com' }
[Current Company] Fetching company for user: { userId: 233, companyId: 192 }
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 233',
    condition2: 'tasks.created_by = 233',
    condition3: "tasks.company_id = 192 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('email@l.com')"
  }
}
[Current Company] Found company: {
  id: 192,
  name: 'DevelopmentTestingL',
  onboardingCompleted: false,
  riskScore: null,
  isDemo: true
}
[Tasks] Tasks found: { count: 4 }
3:26:58 PM [info] GET /api/companies/current 200 in 65ms :: {"id":192,"name":"DevelopmentTestingL","description":"FinTech partner company...
3:26:58 PM [info] GET /api/tasks 304 in 98ms :: [{"id":440,"title":"1. KYB Form: DevelopmentTestingL","description":"Complete...
New WebSocket client connected
3:26:58 PM [info] GET /api/tasks 304 in 31ms :: [{"id":440,"title":"1. KYB Form: DevelopmentTestingL","description":"Complete...
New WebSocket client connected
New WebSocket client connected
[WebSocket] Received message: {
  type: 'company_tabs_updated',
  data: {
    companyId: 192,
    availableTabs: [ 'task-center', 'file-vault' ],
    timestamp: '2025-04-20T15:27:09.668Z'
  }
}
WebSocket client disconnected with code 1005 and reason: 
3:27:13 PM [info] GET /api/tasks 304 in 31ms :: [{"id":440,"title":"1. KYB Form: DevelopmentTestingL","description":"Complete...
WebSocket client disconnected with code 1001 and reason: 
WebSocket client disconnected with code 1001 and reason: 
[Auth] Unauthenticated user session
New WebSocket client connected
[Auth] Using cached user data: 233
WebSocket client disconnected with code 1001 and reason: 
[Auth] Using cached user data: 233
[Auth] Using cached user data: 233
[Auth] Using cached user data: 233
[Auth] Using cached user data: 233
[Auth] Using cached user data: 233
[Auth] Using cached user data: 233
[Auth] Using cached user data: 233
[Auth] Using cached user data: 233
[Auth] Using cached user data: 233
[Auth] Using cached user data: 233
[Auth] Using cached user data: 233
[Auth] Using cached user data: 233
[Auth] Using cached user data: 233
[Auth] Returning user session data
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 233, company_id: 192, email: 'email@l.com' }
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 233',
    condition2: 'tasks.created_by = 233',
    condition3: "tasks.company_id = 192 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('email@l.com')"
  }
}
3:27:29 PM [info] GET /api/companies/current 304 in 31ms :: {"id":192,"name":"DevelopmentTestingL","description":"FinTech partner company...
[Tasks] Tasks found: { count: 4 }
3:27:29 PM [info] GET /api/tasks 304 in 88ms :: [{"id":440,"title":"1. KYB Form: DevelopmentTestingL","description":"Complete...
New WebSocket client connected
[Tasks] Using cached task data for user: 233
3:27:29 PM [info] GET /api/tasks 304 in 31ms :: [{"id":440,"title":"1. KYB Form: DevelopmentTestingL","description":"Complete...
New WebSocket client connected
3:27:44 PM [info] GET /api/tasks 304 in 29ms :: [{"id":440,"title":"1. KYB Form: DevelopmentTestingL","description":"Complete...
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 233, company_id: 192, email: 'email@l.com' }
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 233',
    condition2: 'tasks.created_by = 233',
    condition3: "tasks.company_id = 192 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('email@l.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
3:28:00 PM [info] GET /api/tasks 304 in 88ms :: [{"id":440,"title":"1. KYB Form: DevelopmentTestingL","description":"Complete...
[WebSocket] Received pong
3:28:15 PM [info] GET /api/tasks 304 in 30ms :: [{"id":440,"title":"1. KYB Form: DevelopmentTestingL","description":"Complete...
[WebSocket] Received pong
[Auth] Processing logout request
[Auth] Logout successful for user: 233
[Auth] Unauthenticated user session
[Auth] Processing login request
[Auth] Login request body: { email: 'admin@bofa.com', hasPassword: true, passwordLength: 8 }
[Auth] Login attempt for: admin@bofa.com
[Auth] Password received (first 4 chars): pass
[Auth] Looking up user by email: admin@bofa.com
[Auth] User lookup result: {
  found: true,
  userId: 183,
  hasPassword: true,
  passwordLength: 60,
  passwordStart: '$2b$'
}
[Auth] Found user, checking password
[Auth] Comparing passwords:
[Auth] - Stored hash length: 60
[Auth] - Stored hash format check: true
[Auth] - Supplied password length: 8
[Auth] - Stored hash: $2b$10$j8BCE/TB9HFFoazCrhVCGeiCjaA2/gIlpUyelb29FLJbcbgJMmxQq
[Auth] - Supplied password (first 4 chars): pass
[Auth] Starting to hash password
[Auth] Password hashed successfully: { hashLength: 60, startsWithBcrypt: true, rounds: 10 }
[Auth] - Test hash generated: $2b$10$02kPAr.BwiHbIVHOdOSEkelFhdxFJnD2hmp8lXPU0y5zsvByvMouO
[Auth] Password comparison result: true
[Auth] Password validation result: true
[Auth] Login successful for user: 183
[Auth] Serializing user: 183
[Auth] Login successful for user: 183
[Auth] Deserializing user: 183
[Current Company] Fetching company for user: { userId: 183, companyId: 5 }
[Current Company] Found company: {
  id: 5,
  name: 'Bank of America',
  onboardingCompleted: true,
  riskScore: 89,
  isDemo: null
}
Suppressing further connection logs. Pool size: 3
3:28:32 PM [info] GET /api/companies/current 200 in 58ms :: {"id":5,"name":"Bank of America","description":"Bank of America is a leading ...
[Network Visualization] Fetching network data for company: 5
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 183, company_id: 5, email: 'admin@bofa.com' }
[Tasks] KYB tasks found: { count: 0 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 183',
    condition2: 'tasks.created_by = 183',
    condition3: "tasks.company_id = 5 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('admin@bofa.com')"
  }
}
[Network Visualization] Found network relationships: { count: 35 }
[Network Visualization] Returning visualization data: { centerNode: 'Bank of America', nodeCount: 35 }
3:28:32 PM [info] GET /api/network/visualization 200 in 93ms :: {"center":{"id":5,"name":"Bank of America","riskScore":89,"riskBucket":"low",...
[Tasks] Tasks found: { count: 113 }
3:28:32 PM [info] GET /api/companies/current 304 in 30ms :: {"id":5,"name":"Bank of America","description":"Bank of America is a leading ...
3:28:32 PM [info] GET /api/tasks 200 in 148ms :: [{"id":439,"title":"New User Invitation: email@l.com","description":"Complete...
3:28:32 PM [info] GET /api/tasks 304 in 31ms :: [{"id":439,"title":"New User Invitation: email@l.com","description":"Complete...
3:28:50 PM [info] POST /api/fintech/check-company 200 in 95ms :: {"exists":false}
[WebSocket] Received pong
[WebSocket] Received pong
3:29:02 PM [info] POST /api/fintech/check-company 200 in 60ms :: {"exists":false}
[FinTech Invite] Starting invitation process with payload: {
  email: '***@***.***',
  full_name: 'John Doe',
  company_name: 'DevelopmentTestingM',
  sender_name: 'Bob Smith',
  sender_company: 'Invela'
}
[FinTech Invite] Found sender company: { name: 'Bank of America', duration: 29 }
[FinTech Invite] Created company: { id: 193, duration: 68 }
[FinTech Invite] Created user: { id: 234, duration: 157 }
[FinTech Invite] Creating user onboarding task
[FinTech Invite] Created onboarding task: { taskId: 443, status: 'email_sent', assignedTo: 234, duration: 192 }
[FinTech Invite] Created invitation: { id: 242, code: '40651E', duration: 223 }
[FinTech Invite] Creating company tasks with existing transaction
[Company Service] Creating new company: DevelopmentTestingM { hasExistingTransaction: true, timestamp: '2025-04-20T15:29:03.332Z' }
[Company Service] Using existing transaction for company creation
[Company Service] Using existing company record: { id: 193, name: 'DevelopmentTestingM' }
[Company Service] Creating tasks with creator ID: 183
[Company Service] Creating KYB task for company: 193
[Company Service] Created KYB task: { taskId: 444, companyId: 193, duration: 30 }
[Company Service] Creating Security Assessment task for company: 193
[Company Service] Created Security Assessment task: { taskId: 445, companyId: 193, duration: 60 }
[Company Service] Creating CARD task for company: 193
[Company Service] Created CARD task: { taskId: 446, companyId: 193, duration: 90 }
[Company Service] Creating relationship with Invela for company: 193
[Company Service] Creating relationship with creator company: 5
[Company Service] Created relationships: {
  invelaRelationshipId: 176,
  creatorRelationshipId: 177,
  newCompanyId: 193,
  duration: 153
}
[WebSocket] Broadcasting task update: {
  taskId: 444,
  status: 'not_started',
  progress: 0,
  metadata: {
    company_id: 193,
    created_at: '2025-04-20T15:29:03.332Z',
    created_via: 'fintech_invite',
    status_flow: [ 'not_started' ],
    company_name: 'DevelopmentTestingM',
    created_by_id: 183,
    prerequisite_for: [ 'security_assessment' ]
  }
}
[WebSocket] Broadcasting task update: {
  taskId: 445,
  status: 'not_started',
  progress: 0,
  metadata: {
    locked: true,
    company_id: 193,
    created_at: '2025-04-20T15:29:03.363Z',
    created_via: 'fintech_invite',
    status_flow: [ 'not_started' ],
    company_name: 'DevelopmentTestingM',
    last_updated: '2025-04-20T15:29:03.363Z',
    created_by_id: 183,
    progressHistory: [ [Object] ],
    prerequisite_for: [ 'company_card' ],
    prerequisite_task_id: 444,
    prerequisite_task_type: 'company_kyb'
  }
}
[WebSocket] Broadcasting task update: {
  taskId: 446,
  status: 'not_started',
  progress: 0,
  metadata: {
    locked: true,
    company_id: 193,
    created_at: '2025-04-20T15:29:03.392Z',
    statusFlow: [ 'not_started' ],
    created_via: 'fintech_invite',
    company_name: 'DevelopmentTestingM',
    last_updated: '2025-04-20T15:29:03.392Z',
    created_by_id: 183,
    progressHistory: [ [Object] ],
    prerequisite_task_id: 445,
    prerequisite_task_type: 'security_assessment'
  }
}
[FinTech Invite] Tasks created successfully: {
  companyId: 193,
  tasks: { kyb: 444, security: 445, card: 446, onboarding: 443 },
  duration: 377
}
[WebSocket] Broadcasting task update: {
  taskId: 443,
  status: 'email_sent',
  progress: 25,
  metadata: {
    user_id: 234,
    userEmail: 'email@m.com',
    company_id: 193,
    created_at: '2025-04-20T15:29:03.267Z',
    statusFlow: [ 'email_sent' ],
    companyName: 'DevelopmentTestingM',
    created_via: 'fintech_invite',
    created_by_id: 183,
    email_sent_at: '2025-04-20T15:29:03.267Z'
  }
}
[FinTech Invite] Sending invitation email
[EmailService] Starting to send template email
[EmailService] Template type: fintech_invite
[EmailService] Recipient: email@m.com
[EmailService] Template data (raw): {
  "recipientName": "John Doe",
  "recipientEmail": "email@m.com",
  "senderName": "Bob Smith",
  "senderCompany": "Bank of America",
  "targetCompany": "DevelopmentTestingM",
  "inviteUrl": "https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev/register?code=40651E&email=email%40m.com",
  "code": "40651E"
}
[EmailService] Starting email validation for: email@m.com
[EmailService] Checking MX records for domain: m.com
[EmailService] MX record check failed: Error: queryMx ENOTFOUND m.com
    at QueryReqWrap.onresolve [as oncomplete] (node:internal/dns/callback_resolver:45:19) {
  errno: undefined,
  code: 'ENOTFOUND',
  syscall: 'queryMx',
  hostname: 'm.com'
}
[EmailService] Continuing despite MX check failure
[EmailService] Email validation successful for: email@m.com
[EmailService] Transforming template data
[EmailService] Starting template data transformation
[EmailService] Input template data: {
  "recipientName": "John Doe",
  "recipientEmail": "email@m.com",
  "senderName": "Bob Smith",
  "senderCompany": "Bank of America",
  "targetCompany": "DevelopmentTestingM",
  "inviteUrl": "https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev/register?code=40651E&email=email%40m.com",
  "code": "40651E"
}
[EmailService] Built invite URL: https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev/register?code=40651E&email=email%40m.com
[EmailService] Transformed template data: {
  "recipientName": "John Doe",
  "recipientEmail": "email@m.com",
  "senderName": "Bob Smith",
  "senderCompany": "Bank of America",
  "targetCompany": "DevelopmentTestingM",
  "inviteUrl": "https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev/register?code=40651E&email=email%40m.com",
  "code": "40651E"
}
[EmailService] Getting email template: fintech_invite
[EmailTemplate] Getting template: fintech_invite
[EmailTemplate] Template data: {
  "recipientName": "John Doe",
  "recipientEmail": "email@m.com",
  "senderName": "Bob Smith",
  "senderCompany": "Bank of America",
  "targetCompany": "DevelopmentTestingM",
  "inviteUrl": "https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev/register?code=40651E&email=email%40m.com",
  "code": "40651E"
}
[Template:invitation] Received template data: {
  "recipientName": "John Doe",
  "recipientEmail": "email@m.com",
  "senderName": "Bob Smith",
  "senderCompany": "Bank of America",
  "targetCompany": "DevelopmentTestingM",
  "inviteUrl": "https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev/register?code=40651E&email=email%40m.com",
  "code": "40651E",
  "inviteType": "fintech"
}
[EmailService] Template generated successfully
[EmailService] Preparing to send email with configuration: {
  from: 'EvanCNavarro@gmail.com',
  to: 'email@m.com',
  subject: 'Invitation to join Invela',
  textLength: 620,
  htmlLength: 1692
}
[EmailService] Email sent successfully to: email@m.com
[FinTech Invite] Invitation email sent successfully
[FinTech Invite] Process completed: {
  companyId: 193,
  userId: 234,
  invitationId: 242,
  onboardingTaskId: 443,
  duration: 1306
}
3:29:04 PM [info] POST /api/fintech/invite 201 in 1336ms :: {"message":"FinTech company invited successfully","company":{"id":193,"name":...
3:29:07 PM [info] POST /api/fintech/check-company 200 in 61ms :: {"exists":false}
[FinTech Invite] Starting invitation process with payload: {
  email: '***@***.***',
  full_name: 'John Doe',
  company_name: 'DevelopmentTestingN',
  sender_name: 'Bob Smith',
  sender_company: 'Invela'
}
[FinTech Invite] Found sender company: { name: 'Bank of America', duration: 30 }
[FinTech Invite] Created company: { id: 194, duration: 60 }
[FinTech Invite] Created user: { id: 235, duration: 149 }
[FinTech Invite] Creating user onboarding task
[FinTech Invite] Created onboarding task: { taskId: 447, status: 'email_sent', assignedTo: 235, duration: 181 }
[FinTech Invite] Created invitation: { id: 243, code: 'AEDF3A', duration: 211 }
[FinTech Invite] Creating company tasks with existing transaction
[Company Service] Creating new company: DevelopmentTestingN { hasExistingTransaction: true, timestamp: '2025-04-20T15:29:11.769Z' }
[Company Service] Using existing transaction for company creation
[Company Service] Using existing company record: { id: 194, name: 'DevelopmentTestingN' }
[Company Service] Creating tasks with creator ID: 183
[Company Service] Creating KYB task for company: 194
[Company Service] Created KYB task: { taskId: 448, companyId: 194, duration: 32 }
[Company Service] Creating Security Assessment task for company: 194
[Company Service] Created Security Assessment task: { taskId: 449, companyId: 194, duration: 63 }
[Company Service] Creating CARD task for company: 194
[Company Service] Created CARD task: { taskId: 450, companyId: 194, duration: 93 }
[Company Service] Creating relationship with Invela for company: 194
[Company Service] Creating relationship with creator company: 5
[Company Service] Created relationships: {
  invelaRelationshipId: 178,
  creatorRelationshipId: 179,
  newCompanyId: 194,
  duration: 159
}
[WebSocket] Broadcasting task update: {
  taskId: 448,
  status: 'not_started',
  progress: 0,
  metadata: {
    company_id: 194,
    created_at: '2025-04-20T15:29:11.769Z',
    created_via: 'fintech_invite',
    status_flow: [ 'not_started' ],
    company_name: 'DevelopmentTestingN',
    created_by_id: 183,
    prerequisite_for: [ 'security_assessment' ]
  }
}
[WebSocket] Broadcasting task update: {
  taskId: 449,
  status: 'not_started',
  progress: 0,
  metadata: {
    locked: true,
    company_id: 194,
    created_at: '2025-04-20T15:29:11.801Z',
    created_via: 'fintech_invite',
    status_flow: [ 'not_started' ],
    company_name: 'DevelopmentTestingN',
    last_updated: '2025-04-20T15:29:11.801Z',
    created_by_id: 183,
    progressHistory: [ [Object] ],
    prerequisite_for: [ 'company_card' ],
    prerequisite_task_id: 448,
    prerequisite_task_type: 'company_kyb'
  }
}
[WebSocket] Broadcasting task update: {
  taskId: 450,
  status: 'not_started',
  progress: 0,
  metadata: {
    locked: true,
    company_id: 194,
    created_at: '2025-04-20T15:29:11.832Z',
    statusFlow: [ 'not_started' ],
    created_via: 'fintech_invite',
    company_name: 'DevelopmentTestingN',
    last_updated: '2025-04-20T15:29:11.832Z',
    created_by_id: 183,
    progressHistory: [ [Object] ],
    prerequisite_task_id: 449,
    prerequisite_task_type: 'security_assessment'
  }
}
[FinTech Invite] Tasks created successfully: {
  companyId: 194,
  tasks: { kyb: 448, security: 449, card: 450, onboarding: 447 },
  duration: 371
}
[WebSocket] Broadcasting task update: {
  taskId: 447,
  status: 'email_sent',
  progress: 25,
  metadata: {
    user_id: 235,
    userEmail: 'email@n.com',
    company_id: 194,
    created_at: '2025-04-20T15:29:11.707Z',
    statusFlow: [ 'email_sent' ],
    companyName: 'DevelopmentTestingN',
    created_via: 'fintech_invite',
    created_by_id: 183,
    email_sent_at: '2025-04-20T15:29:11.707Z'
  }
}
[FinTech Invite] Sending invitation email
[EmailService] Starting to send template email
[EmailService] Template type: fintech_invite
[EmailService] Recipient: email@n.com
[EmailService] Template data (raw): {
  "recipientName": "John Doe",
  "recipientEmail": "email@n.com",
  "senderName": "Bob Smith",
  "senderCompany": "Bank of America",
  "targetCompany": "DevelopmentTestingN",
  "inviteUrl": "https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev/register?code=AEDF3A&email=email%40n.com",
  "code": "AEDF3A"
}
[EmailService] Starting email validation for: email@n.com
[EmailService] Checking MX records for domain: n.com
[EmailService] MX record check failed: Error: queryMx ENOTFOUND n.com
    at QueryReqWrap.onresolve [as oncomplete] (node:internal/dns/callback_resolver:45:19) {
  errno: undefined,
  code: 'ENOTFOUND',
  syscall: 'queryMx',
  hostname: 'n.com'
}
[EmailService] Continuing despite MX check failure
[EmailService] Email validation successful for: email@n.com
[EmailService] Transforming template data
[EmailService] Starting template data transformation
[EmailService] Input template data: {
  "recipientName": "John Doe",
  "recipientEmail": "email@n.com",
  "senderName": "Bob Smith",
  "senderCompany": "Bank of America",
  "targetCompany": "DevelopmentTestingN",
  "inviteUrl": "https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev/register?code=AEDF3A&email=email%40n.com",
  "code": "AEDF3A"
}
[EmailService] Built invite URL: https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev/register?code=AEDF3A&email=email%40n.com
[EmailService] Transformed template data: {
  "recipientName": "John Doe",
  "recipientEmail": "email@n.com",
  "senderName": "Bob Smith",
  "senderCompany": "Bank of America",
  "targetCompany": "DevelopmentTestingN",
  "inviteUrl": "https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev/register?code=AEDF3A&email=email%40n.com",
  "code": "AEDF3A"
}
[EmailService] Getting email template: fintech_invite
[EmailTemplate] Getting template: fintech_invite
[EmailTemplate] Template data: {
  "recipientName": "John Doe",
  "recipientEmail": "email@n.com",
  "senderName": "Bob Smith",
  "senderCompany": "Bank of America",
  "targetCompany": "DevelopmentTestingN",
  "inviteUrl": "https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev/register?code=AEDF3A&email=email%40n.com",
  "code": "AEDF3A"
}
[Template:invitation] Received template data: {
  "recipientName": "John Doe",
  "recipientEmail": "email@n.com",
  "senderName": "Bob Smith",
  "senderCompany": "Bank of America",
  "targetCompany": "DevelopmentTestingN",
  "inviteUrl": "https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev/register?code=AEDF3A&email=email%40n.com",
  "code": "AEDF3A",
  "inviteType": "fintech"
}
[EmailService] Template generated successfully
[EmailService] Preparing to send email with configuration: {
  from: 'EvanCNavarro@gmail.com',
  to: 'email@n.com',
  subject: 'Invitation to join Invela',
  textLength: 620,
  htmlLength: 1692
}
[EmailService] Email sent successfully to: email@n.com
[FinTech Invite] Invitation email sent successfully
[FinTech Invite] Process completed: {
  companyId: 194,
  userId: 235,
  invitationId: 243,
  onboardingTaskId: 447,
  duration: 1309
}
3:29:12 PM [info] POST /api/fintech/invite 201 in 1340ms :: {"message":"FinTech company invited successfully","company":{"id":194,"name":...
3:29:16 PM [info] POST /api/fintech/check-company 200 in 63ms :: {"exists":false}
[FinTech Invite] Starting invitation process with payload: {
  email: '***@***.***',
  full_name: 'John Doe',
  company_name: 'DevelopmentTestingO',
  sender_name: 'Bob Smith',
  sender_company: 'Invela'
}
[FinTech Invite] Found sender company: { name: 'Bank of America', duration: 30 }
[FinTech Invite] Created company: { id: 195, duration: 60 }
[FinTech Invite] Created user: { id: 236, duration: 147 }
[FinTech Invite] Creating user onboarding task
[FinTech Invite] Created onboarding task: { taskId: 451, status: 'email_sent', assignedTo: 236, duration: 177 }
[FinTech Invite] Created invitation: { id: 244, code: '369655', duration: 207 }
[FinTech Invite] Creating company tasks with existing transaction
[Company Service] Creating new company: DevelopmentTestingO { hasExistingTransaction: true, timestamp: '2025-04-20T15:29:21.428Z' }
[Company Service] Using existing transaction for company creation
[Company Service] Using existing company record: { id: 195, name: 'DevelopmentTestingO' }
[Company Service] Creating tasks with creator ID: 183
[Company Service] Creating KYB task for company: 195
[Company Service] Created KYB task: { taskId: 452, companyId: 195, duration: 30 }
[Company Service] Creating Security Assessment task for company: 195
[Company Service] Created Security Assessment task: { taskId: 453, companyId: 195, duration: 61 }
[Company Service] Creating CARD task for company: 195
[Company Service] Created CARD task: { taskId: 454, companyId: 195, duration: 91 }
[Company Service] Creating relationship with Invela for company: 195
[Company Service] Creating relationship with creator company: 5
[Company Service] Created relationships: {
  invelaRelationshipId: 180,
  creatorRelationshipId: 181,
  newCompanyId: 195,
  duration: 150
}
[WebSocket] Broadcasting task update: {
  taskId: 452,
  status: 'not_started',
  progress: 0,
  metadata: {
    company_id: 195,
    created_at: '2025-04-20T15:29:21.428Z',
    created_via: 'fintech_invite',
    status_flow: [ 'not_started' ],
    company_name: 'DevelopmentTestingO',
    created_by_id: 183,
    prerequisite_for: [ 'security_assessment' ]
  }
}
[WebSocket] Broadcasting task update: {
  taskId: 453,
  status: 'not_started',
  progress: 0,
  metadata: {
    locked: true,
    company_id: 195,
    created_at: '2025-04-20T15:29:21.458Z',
    created_via: 'fintech_invite',
    status_flow: [ 'not_started' ],
    company_name: 'DevelopmentTestingO',
    last_updated: '2025-04-20T15:29:21.458Z',
    created_by_id: 183,
    progressHistory: [ [Object] ],
    prerequisite_for: [ 'company_card' ],
    prerequisite_task_id: 452,
    prerequisite_task_type: 'company_kyb'
  }
}
[WebSocket] Broadcasting task update: {
  taskId: 454,
  status: 'not_started',
  progress: 0,
  metadata: {
    locked: true,
    company_id: 195,
    created_at: '2025-04-20T15:29:21.489Z',
    statusFlow: [ 'not_started' ],
    created_via: 'fintech_invite',
    company_name: 'DevelopmentTestingO',
    last_updated: '2025-04-20T15:29:21.489Z',
    created_by_id: 183,
    progressHistory: [ [Object] ],
    prerequisite_task_id: 453,
    prerequisite_task_type: 'security_assessment'
  }
}
[FinTech Invite] Tasks created successfully: {
  companyId: 195,
  tasks: { kyb: 452, security: 453, card: 454, onboarding: 451 },
  duration: 358
}
[WebSocket] Broadcasting task update: {
  taskId: 451,
  status: 'email_sent',
  progress: 25,
  metadata: {
    user_id: 236,
    userEmail: 'email@o.com',
    company_id: 195,
    created_at: '2025-04-20T15:29:21.368Z',
    statusFlow: [ 'email_sent' ],
    companyName: 'DevelopmentTestingO',
    created_via: 'fintech_invite',
    created_by_id: 183,
    email_sent_at: '2025-04-20T15:29:21.368Z'
  }
}
[FinTech Invite] Sending invitation email
[EmailService] Starting to send template email
[EmailService] Template type: fintech_invite
[EmailService] Recipient: email@o.com
[EmailService] Template data (raw): {
  "recipientName": "John Doe",
  "recipientEmail": "email@o.com",
  "senderName": "Bob Smith",
  "senderCompany": "Bank of America",
  "targetCompany": "DevelopmentTestingO",
  "inviteUrl": "https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev/register?code=369655&email=email%40o.com",
  "code": "369655"
}
[EmailService] Starting email validation for: email@o.com
[EmailService] Checking MX records for domain: o.com
[EmailService] MX record check failed: Error: queryMx ENOTFOUND o.com
    at QueryReqWrap.onresolve [as oncomplete] (node:internal/dns/callback_resolver:45:19) {
  errno: undefined,
  code: 'ENOTFOUND',
  syscall: 'queryMx',
  hostname: 'o.com'
}
[EmailService] Continuing despite MX check failure
[EmailService] Email validation successful for: email@o.com
[EmailService] Transforming template data
[EmailService] Starting template data transformation
[EmailService] Input template data: {
  "recipientName": "John Doe",
  "recipientEmail": "email@o.com",
  "senderName": "Bob Smith",
  "senderCompany": "Bank of America",
  "targetCompany": "DevelopmentTestingO",
  "inviteUrl": "https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev/register?code=369655&email=email%40o.com",
  "code": "369655"
}
[EmailService] Built invite URL: https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev/register?code=369655&email=email%40o.com
[EmailService] Transformed template data: {
  "recipientName": "John Doe",
  "recipientEmail": "email@o.com",
  "senderName": "Bob Smith",
  "senderCompany": "Bank of America",
  "targetCompany": "DevelopmentTestingO",
  "inviteUrl": "https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev/register?code=369655&email=email%40o.com",
  "code": "369655"
}
[EmailService] Getting email template: fintech_invite
[EmailTemplate] Getting template: fintech_invite
[EmailTemplate] Template data: {
  "recipientName": "John Doe",
  "recipientEmail": "email@o.com",
  "senderName": "Bob Smith",
  "senderCompany": "Bank of America",
  "targetCompany": "DevelopmentTestingO",
  "inviteUrl": "https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev/register?code=369655&email=email%40o.com",
  "code": "369655"
}
[Template:invitation] Received template data: {
  "recipientName": "John Doe",
  "recipientEmail": "email@o.com",
  "senderName": "Bob Smith",
  "senderCompany": "Bank of America",
  "targetCompany": "DevelopmentTestingO",
  "inviteUrl": "https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev/register?code=369655&email=email%40o.com",
  "code": "369655",
  "inviteType": "fintech"
}
[EmailService] Template generated successfully
[EmailService] Preparing to send email with configuration: {
  from: 'EvanCNavarro@gmail.com',
  to: 'email@o.com',
  subject: 'Invitation to join Invela',
  textLength: 620,
  htmlLength: 1692
}
[EmailService] Email sent successfully to: email@o.com
[FinTech Invite] Invitation email sent successfully
[FinTech Invite] Process completed: {
  companyId: 195,
  userId: 236,
  invitationId: 244,
  onboardingTaskId: 451,
  duration: 1077
}
3:29:22 PM [info] POST /api/fintech/invite 201 in 1108ms :: {"message":"FinTech company invited successfully","company":{"id":195,"name":...
3:29:25 PM [info] POST /api/fintech/check-company 200 in 61ms :: {"exists":false}
[FinTech Invite] Starting invitation process with payload: {
  email: '***@***.***',
  full_name: 'John Doe',
  company_name: 'DevelopmentTestingP',
  sender_name: 'Bob Smith',
  sender_company: 'Invela'
}
[FinTech Invite] Found sender company: { name: 'Bank of America', duration: 31 }
[FinTech Invite] Created company: { id: 196, duration: 60 }
[FinTech Invite] Created user: { id: 237, duration: 148 }
[FinTech Invite] Creating user onboarding task
[FinTech Invite] Created onboarding task: { taskId: 455, status: 'email_sent', assignedTo: 237, duration: 178 }
[FinTech Invite] Created invitation: { id: 245, code: '24E702', duration: 208 }
[FinTech Invite] Creating company tasks with existing transaction
[Company Service] Creating new company: DevelopmentTestingP { hasExistingTransaction: true, timestamp: '2025-04-20T15:29:29.582Z' }
[Company Service] Using existing transaction for company creation
[Company Service] Using existing company record: { id: 196, name: 'DevelopmentTestingP' }
[Company Service] Creating tasks with creator ID: 183
[Company Service] Creating KYB task for company: 196
[Company Service] Created KYB task: { taskId: 456, companyId: 196, duration: 30 }
[Company Service] Creating Security Assessment task for company: 196
[Company Service] Created Security Assessment task: { taskId: 457, companyId: 196, duration: 60 }
[Company Service] Creating CARD task for company: 196
[Company Service] Created CARD task: { taskId: 458, companyId: 196, duration: 90 }
[Company Service] Creating relationship with Invela for company: 196
[Company Service] Creating relationship with creator company: 5
[Company Service] Created relationships: {
  invelaRelationshipId: 182,
  creatorRelationshipId: 183,
  newCompanyId: 196,
  duration: 150
}
[WebSocket] Broadcasting task update: {
  taskId: 456,
  status: 'not_started',
  progress: 0,
  metadata: {
    company_id: 196,
    created_at: '2025-04-20T15:29:29.582Z',
    created_via: 'fintech_invite',
    status_flow: [ 'not_started' ],
    company_name: 'DevelopmentTestingP',
    created_by_id: 183,
    prerequisite_for: [ 'security_assessment' ]
  }
}
[WebSocket] Broadcasting task update: {
  taskId: 457,
  status: 'not_started',
  progress: 0,
  metadata: {
    locked: true,
    company_id: 196,
    created_at: '2025-04-20T15:29:29.612Z',
    created_via: 'fintech_invite',
    status_flow: [ 'not_started' ],
    company_name: 'DevelopmentTestingP',
    last_updated: '2025-04-20T15:29:29.612Z',
    created_by_id: 183,
    progressHistory: [ [Object] ],
    prerequisite_for: [ 'company_card' ],
    prerequisite_task_id: 456,
    prerequisite_task_type: 'company_kyb'
  }
}
[WebSocket] Broadcasting task update: {
  taskId: 458,
  status: 'not_started',
  progress: 0,
  metadata: {
    locked: true,
    company_id: 196,
    created_at: '2025-04-20T15:29:29.642Z',
    statusFlow: [ 'not_started' ],
    created_via: 'fintech_invite',
    company_name: 'DevelopmentTestingP',
    last_updated: '2025-04-20T15:29:29.642Z',
    created_by_id: 183,
    progressHistory: [ [Object] ],
    prerequisite_task_id: 457,
    prerequisite_task_type: 'security_assessment'
  }
}
[FinTech Invite] Tasks created successfully: {
  companyId: 196,
  tasks: { kyb: 456, security: 457, card: 458, onboarding: 455 },
  duration: 359
}
[WebSocket] Broadcasting task update: {
  taskId: 455,
  status: 'email_sent',
  progress: 25,
  metadata: {
    user_id: 237,
    userEmail: 'email@p.com',
    company_id: 196,
    created_at: '2025-04-20T15:29:29.522Z',
    statusFlow: [ 'email_sent' ],
    companyName: 'DevelopmentTestingP',
    created_via: 'fintech_invite',
    created_by_id: 183,
    email_sent_at: '2025-04-20T15:29:29.522Z'
  }
}
[FinTech Invite] Sending invitation email
[EmailService] Starting to send template email
[EmailService] Template type: fintech_invite
[EmailService] Recipient: email@p.com
[EmailService] Template data (raw): {
  "recipientName": "John Doe",
  "recipientEmail": "email@p.com",
  "senderName": "Bob Smith",
  "senderCompany": "Bank of America",
  "targetCompany": "DevelopmentTestingP",
  "inviteUrl": "https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev/register?code=24E702&email=email%40p.com",
  "code": "24E702"
}
[EmailService] Starting email validation for: email@p.com
[EmailService] Checking MX records for domain: p.com
[EmailService] MX record check failed: Error: queryMx ENOTFOUND p.com
    at QueryReqWrap.onresolve [as oncomplete] (node:internal/dns/callback_resolver:45:19) {
  errno: undefined,
  code: 'ENOTFOUND',
  syscall: 'queryMx',
  hostname: 'p.com'
}
[EmailService] Continuing despite MX check failure
[EmailService] Email validation successful for: email@p.com
[EmailService] Transforming template data
[EmailService] Starting template data transformation
[EmailService] Input template data: {
  "recipientName": "John Doe",
  "recipientEmail": "email@p.com",
  "senderName": "Bob Smith",
  "senderCompany": "Bank of America",
  "targetCompany": "DevelopmentTestingP",
  "inviteUrl": "https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev/register?code=24E702&email=email%40p.com",
  "code": "24E702"
}
[EmailService] Built invite URL: https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev/register?code=24E702&email=email%40p.com
[EmailService] Transformed template data: {
  "recipientName": "John Doe",
  "recipientEmail": "email@p.com",
  "senderName": "Bob Smith",
  "senderCompany": "Bank of America",
  "targetCompany": "DevelopmentTestingP",
  "inviteUrl": "https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev/register?code=24E702&email=email%40p.com",
  "code": "24E702"
}
[EmailService] Getting email template: fintech_invite
[EmailTemplate] Getting template: fintech_invite
[EmailTemplate] Template data: {
  "recipientName": "John Doe",
  "recipientEmail": "email@p.com",
  "senderName": "Bob Smith",
  "senderCompany": "Bank of America",
  "targetCompany": "DevelopmentTestingP",
  "inviteUrl": "https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev/register?code=24E702&email=email%40p.com",
  "code": "24E702"
}
[Template:invitation] Received template data: {
  "recipientName": "John Doe",
  "recipientEmail": "email@p.com",
  "senderName": "Bob Smith",
  "senderCompany": "Bank of America",
  "targetCompany": "DevelopmentTestingP",
  "inviteUrl": "https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev/register?code=24E702&email=email%40p.com",
  "code": "24E702",
  "inviteType": "fintech"
}
[EmailService] Template generated successfully
[EmailService] Preparing to send email with configuration: {
  from: 'EvanCNavarro@gmail.com',
  to: 'email@p.com',
  subject: 'Invitation to join Invela',
  textLength: 620,
  htmlLength: 1692
}
[EmailService] Email sent successfully to: email@p.com
[FinTech Invite] Invitation email sent successfully
[FinTech Invite] Process completed: {
  companyId: 196,
  userId: 237,
  invitationId: 245,
  onboardingTaskId: 455,
  duration: 1266
}
3:29:30 PM [info] POST /api/fintech/invite 201 in 1296ms :: {"message":"FinTech company invited successfully","company":{"id":196,"name":...
3:29:32 PM [info] POST /api/fintech/check-company 200 in 66ms :: {"exists":false}
[FinTech Invite] Starting invitation process with payload: {
  email: '***@***.***',
  full_name: 'John Doe',
  company_name: 'DevelopmentTestingQ',
  sender_name: 'Bob Smith',
  sender_company: 'Invela'
}
[FinTech Invite] Found sender company: { name: 'Bank of America', duration: 29 }
[FinTech Invite] Created company: { id: 197, duration: 60 }
[FinTech Invite] Created user: { id: 238, duration: 147 }
[FinTech Invite] Creating user onboarding task
[FinTech Invite] Created onboarding task: { taskId: 459, status: 'email_sent', assignedTo: 238, duration: 178 }
[FinTech Invite] Created invitation: { id: 246, code: 'F21130', duration: 208 }
[FinTech Invite] Creating company tasks with existing transaction
[Company Service] Creating new company: DevelopmentTestingQ { hasExistingTransaction: true, timestamp: '2025-04-20T15:29:38.434Z' }
[Company Service] Using existing transaction for company creation
[Company Service] Using existing company record: { id: 197, name: 'DevelopmentTestingQ' }
[Company Service] Creating tasks with creator ID: 183
[Company Service] Creating KYB task for company: 197
[Company Service] Created KYB task: { taskId: 460, companyId: 197, duration: 30 }
[Company Service] Creating Security Assessment task for company: 197
[Company Service] Created Security Assessment task: { taskId: 461, companyId: 197, duration: 61 }
[Company Service] Creating CARD task for company: 197
[Company Service] Created CARD task: { taskId: 462, companyId: 197, duration: 92 }
[Company Service] Creating relationship with Invela for company: 197
[Company Service] Creating relationship with creator company: 5
[Company Service] Created relationships: {
  invelaRelationshipId: 184,
  creatorRelationshipId: 185,
  newCompanyId: 197,
  duration: 154
}
[WebSocket] Broadcasting task update: {
  taskId: 460,
  status: 'not_started',
  progress: 0,
  metadata: {
    company_id: 197,
    created_at: '2025-04-20T15:29:38.434Z',
    created_via: 'fintech_invite',
    status_flow: [ 'not_started' ],
    company_name: 'DevelopmentTestingQ',
    created_by_id: 183,
    prerequisite_for: [ 'security_assessment' ]
  }
}
[WebSocket] Broadcasting task update: {
  taskId: 461,
  status: 'not_started',
  progress: 0,
  metadata: {
    locked: true,
    company_id: 197,
    created_at: '2025-04-20T15:29:38.464Z',
    created_via: 'fintech_invite',
    status_flow: [ 'not_started' ],
    company_name: 'DevelopmentTestingQ',
    last_updated: '2025-04-20T15:29:38.464Z',
    created_by_id: 183,
    progressHistory: [ [Object] ],
    prerequisite_for: [ 'company_card' ],
    prerequisite_task_id: 460,
    prerequisite_task_type: 'company_kyb'
  }
}
[WebSocket] Broadcasting task update: {
  taskId: 462,
  status: 'not_started',
  progress: 0,
  metadata: {
    locked: true,
    company_id: 197,
    created_at: '2025-04-20T15:29:38.496Z',
    statusFlow: [ 'not_started' ],
    created_via: 'fintech_invite',
    company_name: 'DevelopmentTestingQ',
    last_updated: '2025-04-20T15:29:38.496Z',
    created_by_id: 183,
    progressHistory: [ [Object] ],
    prerequisite_task_id: 461,
    prerequisite_task_type: 'security_assessment'
  }
}
[FinTech Invite] Tasks created successfully: {
  companyId: 197,
  tasks: { kyb: 460, security: 461, card: 462, onboarding: 459 },
  duration: 363
}
[WebSocket] Broadcasting task update: {
  taskId: 459,
  status: 'email_sent',
  progress: 25,
  metadata: {
    user_id: 238,
    userEmail: 'email@q.com',
    company_id: 197,
    created_at: '2025-04-20T15:29:38.373Z',
    statusFlow: [ 'email_sent' ],
    companyName: 'DevelopmentTestingQ',
    created_via: 'fintech_invite',
    created_by_id: 183,
    email_sent_at: '2025-04-20T15:29:38.373Z'
  }
}
[FinTech Invite] Sending invitation email
[EmailService] Starting to send template email
[EmailService] Template type: fintech_invite
[EmailService] Recipient: email@q.com
[EmailService] Template data (raw): {
  "recipientName": "John Doe",
  "recipientEmail": "email@q.com",
  "senderName": "Bob Smith",
  "senderCompany": "Bank of America",
  "targetCompany": "DevelopmentTestingQ",
  "inviteUrl": "https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev/register?code=F21130&email=email%40q.com",
  "code": "F21130"
}
[EmailService] Starting email validation for: email@q.com
[EmailService] Checking MX records for domain: q.com
[EmailService] MX records found for domain: q.com
[EmailService] Email validation successful for: email@q.com
[EmailService] Transforming template data
[EmailService] Starting template data transformation
[EmailService] Input template data: {
  "recipientName": "John Doe",
  "recipientEmail": "email@q.com",
  "senderName": "Bob Smith",
  "senderCompany": "Bank of America",
  "targetCompany": "DevelopmentTestingQ",
  "inviteUrl": "https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev/register?code=F21130&email=email%40q.com",
  "code": "F21130"
}
[EmailService] Built invite URL: https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev/register?code=F21130&email=email%40q.com
[EmailService] Transformed template data: {
  "recipientName": "John Doe",
  "recipientEmail": "email@q.com",
  "senderName": "Bob Smith",
  "senderCompany": "Bank of America",
  "targetCompany": "DevelopmentTestingQ",
  "inviteUrl": "https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev/register?code=F21130&email=email%40q.com",
  "code": "F21130"
}
[EmailService] Getting email template: fintech_invite
[EmailTemplate] Getting template: fintech_invite
[EmailTemplate] Template data: {
  "recipientName": "John Doe",
  "recipientEmail": "email@q.com",
  "senderName": "Bob Smith",
  "senderCompany": "Bank of America",
  "targetCompany": "DevelopmentTestingQ",
  "inviteUrl": "https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev/register?code=F21130&email=email%40q.com",
  "code": "F21130"
}
[Template:invitation] Received template data: {
  "recipientName": "John Doe",
  "recipientEmail": "email@q.com",
  "senderName": "Bob Smith",
  "senderCompany": "Bank of America",
  "targetCompany": "DevelopmentTestingQ",
  "inviteUrl": "https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev/register?code=F21130&email=email%40q.com",
  "code": "F21130",
  "inviteType": "fintech"
}
[EmailService] Template generated successfully
[EmailService] Preparing to send email with configuration: {
  from: 'EvanCNavarro@gmail.com',
  to: 'email@q.com',
  subject: 'Invitation to join Invela',
  textLength: 620,
  htmlLength: 1692
}
[EmailService] Email sent successfully to: email@q.com
[FinTech Invite] Invitation email sent successfully
[FinTech Invite] Process completed: {
  companyId: 197,
  userId: 238,
  invitationId: 246,
  onboardingTaskId: 459,
  duration: 1071
}
3:29:39 PM [info] POST /api/fintech/invite 201 in 1103ms :: {"message":"FinTech company invited successfully","company":{"id":197,"name":...
3:29:41 PM [info] POST /api/fintech/check-company 200 in 61ms :: {"exists":false}
[WebSocket] Received pong
[FinTech Invite] Starting invitation process with payload: {
  email: '***@***.***',
  full_name: 'John Doe',
  company_name: 'DevelopmentTestingR',
  sender_name: 'Bob Smith',
  sender_company: 'Invela'
}
[FinTech Invite] Found sender company: { name: 'Bank of America', duration: 30 }
[WebSocket] Received pong
[FinTech Invite] Created company: { id: 198, duration: 60 }
[FinTech Invite] Created user: { id: 239, duration: 146 }
[FinTech Invite] Creating user onboarding task
[FinTech Invite] Created onboarding task: { taskId: 463, status: 'email_sent', assignedTo: 239, duration: 176 }
[FinTech Invite] Created invitation: { id: 247, code: '2F5007', duration: 207 }
[FinTech Invite] Creating company tasks with existing transaction
[Company Service] Creating new company: DevelopmentTestingR { hasExistingTransaction: true, timestamp: '2025-04-20T15:29:45.407Z' }
[Company Service] Using existing transaction for company creation
[Company Service] Using existing company record: { id: 198, name: 'DevelopmentTestingR' }
[Company Service] Creating tasks with creator ID: 183
[Company Service] Creating KYB task for company: 198
[Company Service] Created KYB task: { taskId: 464, companyId: 198, duration: 31 }
[Company Service] Creating Security Assessment task for company: 198
[Company Service] Created Security Assessment task: { taskId: 465, companyId: 198, duration: 61 }
[Company Service] Creating CARD task for company: 198
[Company Service] Created CARD task: { taskId: 466, companyId: 198, duration: 91 }
[Company Service] Creating relationship with Invela for company: 198
[Company Service] Creating relationship with creator company: 5
[Company Service] Created relationships: {
  invelaRelationshipId: 186,
  creatorRelationshipId: 187,
  newCompanyId: 198,
  duration: 153
}
[WebSocket] Broadcasting task update: {
  taskId: 464,
  status: 'not_started',
  progress: 0,
  metadata: {
    company_id: 198,
    created_at: '2025-04-20T15:29:45.407Z',
    created_via: 'fintech_invite',
    status_flow: [ 'not_started' ],
    company_name: 'DevelopmentTestingR',
    created_by_id: 183,
    prerequisite_for: [ 'security_assessment' ]
  }
}
[WebSocket] Broadcasting task update: {
  taskId: 465,
  status: 'not_started',
  progress: 0,
  metadata: {
    locked: true,
    company_id: 198,
    created_at: '2025-04-20T15:29:45.438Z',
    created_via: 'fintech_invite',
    status_flow: [ 'not_started' ],
    company_name: 'DevelopmentTestingR',
    last_updated: '2025-04-20T15:29:45.438Z',
    created_by_id: 183,
    progressHistory: [ [Object] ],
    prerequisite_for: [ 'company_card' ],
    prerequisite_task_id: 464,
    prerequisite_task_type: 'company_kyb'
  }
}
[WebSocket] Broadcasting task update: {
  taskId: 466,
  status: 'not_started',
  progress: 0,
  metadata: {
    locked: true,
    company_id: 198,
    created_at: '2025-04-20T15:29:45.468Z',
    statusFlow: [ 'not_started' ],
    created_via: 'fintech_invite',
    company_name: 'DevelopmentTestingR',
    last_updated: '2025-04-20T15:29:45.468Z',
    created_by_id: 183,
    progressHistory: [ [Object] ],
    prerequisite_task_id: 465,
    prerequisite_task_type: 'security_assessment'
  }
}
[FinTech Invite] Tasks created successfully: {
  companyId: 198,
  tasks: { kyb: 464, security: 465, card: 466, onboarding: 463 },
  duration: 361
}
[WebSocket] Broadcasting task update: {
  taskId: 463,
  status: 'email_sent',
  progress: 25,
  metadata: {
    user_id: 239,
    userEmail: 'email@r.com',
    company_id: 198,
    created_at: '2025-04-20T15:29:45.346Z',
    statusFlow: [ 'email_sent' ],
    companyName: 'DevelopmentTestingR',
    created_via: 'fintech_invite',
    created_by_id: 183,
    email_sent_at: '2025-04-20T15:29:45.346Z'
  }
}
[FinTech Invite] Sending invitation email
[EmailService] Starting to send template email
[EmailService] Template type: fintech_invite
[EmailService] Recipient: email@r.com
[EmailService] Template data (raw): {
  "recipientName": "John Doe",
  "recipientEmail": "email@r.com",
  "senderName": "Bob Smith",
  "senderCompany": "Bank of America",
  "targetCompany": "DevelopmentTestingR",
  "inviteUrl": "https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev/register?code=2F5007&email=email%40r.com",
  "code": "2F5007"
}
[EmailService] Starting email validation for: email@r.com
[EmailService] Checking MX records for domain: r.com
[EmailService] MX record check failed: Error: queryMx ENOTFOUND r.com
    at QueryReqWrap.onresolve [as oncomplete] (node:internal/dns/callback_resolver:45:19) {
  errno: undefined,
  code: 'ENOTFOUND',
  syscall: 'queryMx',
  hostname: 'r.com'
}
[EmailService] Continuing despite MX check failure
[EmailService] Email validation successful for: email@r.com
[EmailService] Transforming template data
[EmailService] Starting template data transformation
[EmailService] Input template data: {
  "recipientName": "John Doe",
  "recipientEmail": "email@r.com",
  "senderName": "Bob Smith",
  "senderCompany": "Bank of America",
  "targetCompany": "DevelopmentTestingR",
  "inviteUrl": "https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev/register?code=2F5007&email=email%40r.com",
  "code": "2F5007"
}
[EmailService] Built invite URL: https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev/register?code=2F5007&email=email%40r.com
[EmailService] Transformed template data: {
  "recipientName": "John Doe",
  "recipientEmail": "email@r.com",
  "senderName": "Bob Smith",
  "senderCompany": "Bank of America",
  "targetCompany": "DevelopmentTestingR",
  "inviteUrl": "https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev/register?code=2F5007&email=email%40r.com",
  "code": "2F5007"
}
[EmailService] Getting email template: fintech_invite
[EmailTemplate] Getting template: fintech_invite
[EmailTemplate] Template data: {
  "recipientName": "John Doe",
  "recipientEmail": "email@r.com",
  "senderName": "Bob Smith",
  "senderCompany": "Bank of America",
  "targetCompany": "DevelopmentTestingR",
  "inviteUrl": "https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev/register?code=2F5007&email=email%40r.com",
  "code": "2F5007"
}
[Template:invitation] Received template data: {
  "recipientName": "John Doe",
  "recipientEmail": "email@r.com",
  "senderName": "Bob Smith",
  "senderCompany": "Bank of America",
  "targetCompany": "DevelopmentTestingR",
  "inviteUrl": "https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev/register?code=2F5007&email=email%40r.com",
  "code": "2F5007",
  "inviteType": "fintech"
}
[EmailService] Template generated successfully
[EmailService] Preparing to send email with configuration: {
  from: 'EvanCNavarro@gmail.com',
  to: 'email@r.com',
  subject: 'Invitation to join Invela',
  textLength: 620,
  htmlLength: 1692
}
[EmailService] Email sent successfully to: email@r.com
[FinTech Invite] Invitation email sent successfully
[FinTech Invite] Process completed: {
  companyId: 198,
  userId: 239,
  invitationId: 247,
  onboardingTaskId: 463,
  duration: 1004
}
3:29:46 PM [info] POST /api/fintech/invite 201 in 1034ms :: {"message":"FinTech company invited successfully","company":{"id":198,"name":...
3:29:51 PM [info] POST /api/fintech/check-company 200 in 59ms :: {"exists":false}
[FinTech Invite] Starting invitation process with payload: {
  email: '***@***.***',
  full_name: 'John Doe',
  company_name: 'DevelopmentTestingS',
  sender_name: 'Bob Smith',
  sender_company: 'Invela'
}
[FinTech Invite] Found sender company: { name: 'Bank of America', duration: 30 }
[FinTech Invite] Created company: { id: 199, duration: 60 }
[FinTech Invite] Created user: { id: 240, duration: 145 }
[FinTech Invite] Creating user onboarding task
[FinTech Invite] Created onboarding task: { taskId: 467, status: 'email_sent', assignedTo: 240, duration: 176 }
[FinTech Invite] Created invitation: { id: 248, code: '034922', duration: 206 }
[FinTech Invite] Creating company tasks with existing transaction
[Company Service] Creating new company: DevelopmentTestingS { hasExistingTransaction: true, timestamp: '2025-04-20T15:29:55.731Z' }
[Company Service] Using existing transaction for company creation
[Company Service] Using existing company record: { id: 199, name: 'DevelopmentTestingS' }
[Company Service] Creating tasks with creator ID: 183
[Company Service] Creating KYB task for company: 199
[Company Service] Created KYB task: { taskId: 468, companyId: 199, duration: 30 }
[Company Service] Creating Security Assessment task for company: 199
[Company Service] Created Security Assessment task: { taskId: 469, companyId: 199, duration: 59 }
[Company Service] Creating CARD task for company: 199
[Company Service] Created CARD task: { taskId: 470, companyId: 199, duration: 90 }
[Company Service] Creating relationship with Invela for company: 199
[Company Service] Creating relationship with creator company: 5
[Company Service] Created relationships: {
  invelaRelationshipId: 188,
  creatorRelationshipId: 189,
  newCompanyId: 199,
  duration: 161
}
[WebSocket] Broadcasting task update: {
  taskId: 468,
  status: 'not_started',
  progress: 0,
  metadata: {
    company_id: 199,
    created_at: '2025-04-20T15:29:55.731Z',
    created_via: 'fintech_invite',
    status_flow: [ 'not_started' ],
    company_name: 'DevelopmentTestingS',
    created_by_id: 183,
    prerequisite_for: [ 'security_assessment' ]
  }
}
[WebSocket] Broadcasting task update: {
  taskId: 469,
  status: 'not_started',
  progress: 0,
  metadata: {
    locked: true,
    company_id: 199,
    created_at: '2025-04-20T15:29:55.761Z',
    created_via: 'fintech_invite',
    status_flow: [ 'not_started' ],
    company_name: 'DevelopmentTestingS',
    last_updated: '2025-04-20T15:29:55.761Z',
    created_by_id: 183,
    progressHistory: [ [Object] ],
    prerequisite_for: [ 'company_card' ],
    prerequisite_task_id: 468,
    prerequisite_task_type: 'company_kyb'
  }
}
[WebSocket] Broadcasting task update: {
  taskId: 470,
  status: 'not_started',
  progress: 0,
  metadata: {
    locked: true,
    company_id: 199,
    created_at: '2025-04-20T15:29:55.791Z',
    statusFlow: [ 'not_started' ],
    created_via: 'fintech_invite',
    company_name: 'DevelopmentTestingS',
    last_updated: '2025-04-20T15:29:55.791Z',
    created_by_id: 183,
    progressHistory: [ [Object] ],
    prerequisite_task_id: 469,
    prerequisite_task_type: 'security_assessment'
  }
}
[FinTech Invite] Tasks created successfully: {
  companyId: 199,
  tasks: { kyb: 468, security: 469, card: 470, onboarding: 467 },
  duration: 368
}
[WebSocket] Broadcasting task update: {
  taskId: 467,
  status: 'email_sent',
  progress: 25,
  metadata: {
    user_id: 240,
    userEmail: 'email@s.com',
    company_id: 199,
    created_at: '2025-04-20T15:29:55.671Z',
    statusFlow: [ 'email_sent' ],
    companyName: 'DevelopmentTestingS',
    created_via: 'fintech_invite',
    created_by_id: 183,
    email_sent_at: '2025-04-20T15:29:55.671Z'
  }
}
[FinTech Invite] Sending invitation email
[EmailService] Starting to send template email
[EmailService] Template type: fintech_invite
[EmailService] Recipient: email@s.com
[EmailService] Template data (raw): {
  "recipientName": "John Doe",
  "recipientEmail": "email@s.com",
  "senderName": "Bob Smith",
  "senderCompany": "Bank of America",
  "targetCompany": "DevelopmentTestingS",
  "inviteUrl": "https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev/register?code=034922&email=email%40s.com",
  "code": "034922"
}
[EmailService] Starting email validation for: email@s.com
[EmailService] Checking MX records for domain: s.com
[EmailService] MX record check failed: Error: queryMx ENOTFOUND s.com
    at QueryReqWrap.onresolve [as oncomplete] (node:internal/dns/callback_resolver:45:19) {
  errno: undefined,
  code: 'ENOTFOUND',
  syscall: 'queryMx',
  hostname: 's.com'
}
[EmailService] Continuing despite MX check failure
[EmailService] Email validation successful for: email@s.com
[EmailService] Transforming template data
[EmailService] Starting template data transformation
[EmailService] Input template data: {
  "recipientName": "John Doe",
  "recipientEmail": "email@s.com",
  "senderName": "Bob Smith",
  "senderCompany": "Bank of America",
  "targetCompany": "DevelopmentTestingS",
  "inviteUrl": "https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev/register?code=034922&email=email%40s.com",
  "code": "034922"
}
[EmailService] Built invite URL: https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev/register?code=034922&email=email%40s.com
[EmailService] Transformed template data: {
  "recipientName": "John Doe",
  "recipientEmail": "email@s.com",
  "senderName": "Bob Smith",
  "senderCompany": "Bank of America",
  "targetCompany": "DevelopmentTestingS",
  "inviteUrl": "https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev/register?code=034922&email=email%40s.com",
  "code": "034922"
}
[EmailService] Getting email template: fintech_invite
[EmailTemplate] Getting template: fintech_invite
[EmailTemplate] Template data: {
  "recipientName": "John Doe",
  "recipientEmail": "email@s.com",
  "senderName": "Bob Smith",
  "senderCompany": "Bank of America",
  "targetCompany": "DevelopmentTestingS",
  "inviteUrl": "https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev/register?code=034922&email=email%40s.com",
  "code": "034922"
}
[Template:invitation] Received template data: {
  "recipientName": "John Doe",
  "recipientEmail": "email@s.com",
  "senderName": "Bob Smith",
  "senderCompany": "Bank of America",
  "targetCompany": "DevelopmentTestingS",
  "inviteUrl": "https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev/register?code=034922&email=email%40s.com",
  "code": "034922",
  "inviteType": "fintech"
}
[EmailService] Template generated successfully
[EmailService] Preparing to send email with configuration: {
  from: 'EvanCNavarro@gmail.com',
  to: 'email@s.com',
  subject: 'Invitation to join Invela',
  textLength: 620,
  htmlLength: 1692
}
[EmailService] Email sent successfully to: email@s.com
[FinTech Invite] Invitation email sent successfully
[FinTech Invite] Process completed: {
  companyId: 199,
  userId: 240,
  invitationId: 248,
  onboardingTaskId: 467,
  duration: 1344
}
3:29:56 PM [info] POST /api/fintech/invite 201 in 1376ms :: {"message":"FinTech company invited successfully","company":{"id":199,"name":...
3:29:59 PM [info] POST /api/fintech/check-company 200 in 61ms :: {"exists":false}
[FinTech Invite] Starting invitation process with payload: {
  email: '***@***.***',
  full_name: 'John Doe',
  company_name: 'DevelopmentTestingT',
  sender_name: 'Bob Smith',
  sender_company: 'Invela'
}
[FinTech Invite] Found sender company: { name: 'Bank of America', duration: 30 }
[FinTech Invite] Created company: { id: 200, duration: 61 }
[FinTech Invite] Created user: { id: 241, duration: 149 }
[FinTech Invite] Creating user onboarding task
[FinTech Invite] Created onboarding task: { taskId: 471, status: 'email_sent', assignedTo: 241, duration: 180 }
[FinTech Invite] Created invitation: { id: 249, code: '5CAD1E', duration: 210 }
[FinTech Invite] Creating company tasks with existing transaction
[Company Service] Creating new company: DevelopmentTestingT { hasExistingTransaction: true, timestamp: '2025-04-20T15:30:05.849Z' }
[Company Service] Using existing transaction for company creation
[Company Service] Using existing company record: { id: 200, name: 'DevelopmentTestingT' }
[Company Service] Creating tasks with creator ID: 183
[Company Service] Creating KYB task for company: 200
[Company Service] Created KYB task: { taskId: 472, companyId: 200, duration: 31 }
[Company Service] Creating Security Assessment task for company: 200
[Company Service] Created Security Assessment task: { taskId: 473, companyId: 200, duration: 61 }
[Company Service] Creating CARD task for company: 200
[Company Service] Created CARD task: { taskId: 474, companyId: 200, duration: 92 }
[Company Service] Creating relationship with Invela for company: 200
[Company Service] Creating relationship with creator company: 5
[Company Service] Created relationships: {
  invelaRelationshipId: 190,
  creatorRelationshipId: 191,
  newCompanyId: 200,
  duration: 151
}
[WebSocket] Broadcasting task update: {
  taskId: 472,
  status: 'not_started',
  progress: 0,
  metadata: {
    company_id: 200,
    created_at: '2025-04-20T15:30:05.850Z',
    created_via: 'fintech_invite',
    status_flow: [ 'not_started' ],
    company_name: 'DevelopmentTestingT',
    created_by_id: 183,
    prerequisite_for: [ 'security_assessment' ]
  }
}
[WebSocket] Broadcasting task update: {
  taskId: 473,
  status: 'not_started',
  progress: 0,
  metadata: {
    locked: true,
    company_id: 200,
    created_at: '2025-04-20T15:30:05.880Z',
    created_via: 'fintech_invite',
    status_flow: [ 'not_started' ],
    company_name: 'DevelopmentTestingT',
    last_updated: '2025-04-20T15:30:05.880Z',
    created_by_id: 183,
    progressHistory: [ [Object] ],
    prerequisite_for: [ 'company_card' ],
    prerequisite_task_id: 472,
    prerequisite_task_type: 'company_kyb'
  }
}
[WebSocket] Broadcasting task update: {
  taskId: 474,
  status: 'not_started',
  progress: 0,
  metadata: {
    locked: true,
    company_id: 200,
    created_at: '2025-04-20T15:30:05.911Z',
    statusFlow: [ 'not_started' ],
    created_via: 'fintech_invite',
    company_name: 'DevelopmentTestingT',
    last_updated: '2025-04-20T15:30:05.911Z',
    created_by_id: 183,
    progressHistory: [ [Object] ],
    prerequisite_task_id: 473,
    prerequisite_task_type: 'security_assessment'
  }
}
[FinTech Invite] Tasks created successfully: {
  companyId: 200,
  tasks: { kyb: 472, security: 473, card: 474, onboarding: 471 },
  duration: 363
}
[WebSocket] Broadcasting task update: {
  taskId: 471,
  status: 'email_sent',
  progress: 25,
  metadata: {
    user_id: 241,
    userEmail: 'email@t.com',
    company_id: 200,
    created_at: '2025-04-20T15:30:05.789Z',
    statusFlow: [ 'email_sent' ],
    companyName: 'DevelopmentTestingT',
    created_via: 'fintech_invite',
    created_by_id: 183,
    email_sent_at: '2025-04-20T15:30:05.789Z'
  }
}
[FinTech Invite] Sending invitation email
[EmailService] Starting to send template email
[EmailService] Template type: fintech_invite
[EmailService] Recipient: email@t.com
[EmailService] Template data (raw): {
  "recipientName": "John Doe",
  "recipientEmail": "email@t.com",
  "senderName": "Bob Smith",
  "senderCompany": "Bank of America",
  "targetCompany": "DevelopmentTestingT",
  "inviteUrl": "https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev/register?code=5CAD1E&email=email%40t.com",
  "code": "5CAD1E"
}
[EmailService] Starting email validation for: email@t.com
[EmailService] Checking MX records for domain: t.com
[EmailService] MX record check failed: Error: queryMx ENOTFOUND t.com
    at QueryReqWrap.onresolve [as oncomplete] (node:internal/dns/callback_resolver:45:19) {
  errno: undefined,
  code: 'ENOTFOUND',
  syscall: 'queryMx',
  hostname: 't.com'
}
[EmailService] Continuing despite MX check failure
[EmailService] Email validation successful for: email@t.com
[EmailService] Transforming template data
[EmailService] Starting template data transformation
[EmailService] Input template data: {
  "recipientName": "John Doe",
  "recipientEmail": "email@t.com",
  "senderName": "Bob Smith",
  "senderCompany": "Bank of America",
  "targetCompany": "DevelopmentTestingT",
  "inviteUrl": "https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev/register?code=5CAD1E&email=email%40t.com",
  "code": "5CAD1E"
}
[EmailService] Built invite URL: https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev/register?code=5CAD1E&email=email%40t.com
[EmailService] Transformed template data: {
  "recipientName": "John Doe",
  "recipientEmail": "email@t.com",
  "senderName": "Bob Smith",
  "senderCompany": "Bank of America",
  "targetCompany": "DevelopmentTestingT",
  "inviteUrl": "https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev/register?code=5CAD1E&email=email%40t.com",
  "code": "5CAD1E"
}
[EmailService] Getting email template: fintech_invite
[EmailTemplate] Getting template: fintech_invite
[EmailTemplate] Template data: {
  "recipientName": "John Doe",
  "recipientEmail": "email@t.com",
  "senderName": "Bob Smith",
  "senderCompany": "Bank of America",
  "targetCompany": "DevelopmentTestingT",
  "inviteUrl": "https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev/register?code=5CAD1E&email=email%40t.com",
  "code": "5CAD1E"
}
[Template:invitation] Received template data: {
  "recipientName": "John Doe",
  "recipientEmail": "email@t.com",
  "senderName": "Bob Smith",
  "senderCompany": "Bank of America",
  "targetCompany": "DevelopmentTestingT",
  "inviteUrl": "https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev/register?code=5CAD1E&email=email%40t.com",
  "code": "5CAD1E",
  "inviteType": "fintech"
}
[EmailService] Template generated successfully
[EmailService] Preparing to send email with configuration: {
  from: 'EvanCNavarro@gmail.com',
  to: 'email@t.com',
  subject: 'Invitation to join Invela',
  textLength: 620,
  htmlLength: 1692
}
[EmailService] Email sent successfully to: email@t.com
[FinTech Invite] Invitation email sent successfully
[FinTech Invite] Process completed: {
  companyId: 200,
  userId: 241,
  invitationId: 249,
  onboardingTaskId: 471,
  duration: 1349
}
3:30:06 PM [info] POST /api/fintech/invite 201 in 1382ms :: {"message":"FinTech company invited successfully","company":{"id":200,"name":...
[WebSocket] Received pong
[WebSocket] Received pong
[Auth] Processing logout request
[Auth] Logout successful for user: 183
[Auth] Unauthenticated user session
[Invite Debug] Starting validation for code: 40651E
[Invite Debug] Found valid invitation: {
  id: 242,
  email: 'email@m.com',
  status: 'pending',
  expires_at: 2025-04-27T15:29:03.301Z
}
3:30:51 PM [info] GET /api/invitations/40651E/validate 200 in 61ms :: {"valid":true,"invitation":{"email":"email@m.com","invitee_name":"John Doe","...
[Account Setup] Processing setup request for: email@m.com
[Account Setup] Updated user: { id: 234, email: 'email@m.com', onboarding_completed: false }
[Account Setup] Updated task status: { taskId: 443, status: 'completed', progress: 100 }
[WebSocket] Broadcasting task update: {
  taskId: 443,
  status: 'completed',
  progress: 100,
  metadata: {
    user_id: 234,
    userEmail: 'email@m.com',
    company_id: 193,
    created_at: '2025-04-20T15:29:03.267Z',
    statusFlow: [ 'email_sent', 'completed' ],
    companyName: 'DevelopmentTestingM',
    created_via: 'fintech_invite',
    registeredAt: '2025-04-20T15:30:56.784Z',
    created_by_id: 183,
    email_sent_at: '2025-04-20T15:29:03.267Z'
  }
}
[Auth] Serializing user: 234
3:30:56 PM [info] POST /api/account/setup 200 in 336ms :: {"id":234,"email":"email@m.com","full_name":"John Doe","first_name":"John","l...
[Auth] Deserializing user: 234
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 234, company_id: 193, email: 'email@m.com' }
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 234',
    condition2: 'tasks.created_by = 234',
    condition3: "tasks.company_id = 193 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('email@m.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
[Current Company] Fetching company for user: { userId: 234, companyId: 193 }
3:30:57 PM [info] GET /api/tasks 200 in 102ms :: [{"id":444,"title":"1. KYB Form: DevelopmentTestingM","description":"Complete...
[Network Visualization] Fetching network data for company: 193
[Current Company] Found company: {
  id: 193,
  name: 'DevelopmentTestingM',
  onboardingCompleted: false,
  riskScore: null,
  isDemo: true
}
3:30:57 PM [info] GET /api/companies/current 200 in 62ms :: {"id":193,"name":"DevelopmentTestingM","description":"FinTech partner company...
[Network Visualization] Found network relationships: { count: 2 }
[Network Visualization] Returning visualization data: { centerNode: 'DevelopmentTestingM', nodeCount: 2 }
3:30:57 PM [info] GET /api/network/visualization 200 in 87ms :: {"center":{"id":193,"name":"DevelopmentTestingM","riskScore":0,"riskBucket":"...
3:30:57 PM [info] GET /api/tasks 304 in 29ms :: [{"id":444,"title":"1. KYB Form: DevelopmentTestingM","description":"Complete...
3:30:57 PM [info] GET /api/companies/current 304 in 32ms :: {"id":193,"name":"DevelopmentTestingM","description":"FinTech partner company...
[User Onboarding] Completing onboarding for user: 234
[User Onboarding] Updated user onboarding status: { id: 234, onboarding_completed: true }
3:31:00 PM [info] POST /api/user/complete-onboarding 200 in 60ms :: {"id":234,"email":"email@m.com","full_name":"John Doe","first_name":"John","l...
[Auth] Returning user session data
3:31:00 PM [info] GET /api/tasks 304 in 29ms :: [{"id":444,"title":"1. KYB Form: DevelopmentTestingM","description":"Complete...
3:31:01 PM [info] GET /api/tasks 304 in 29ms :: [{"id":444,"title":"1. KYB Form: DevelopmentTestingM","description":"Complete...
[Tasks Routes] Fetching task by ID: {
  taskId: 444,
  userCompanyId: 193,
  timestamp: '2025-04-20T15:31:03.042Z'
}
[Tasks Routes] Fetching latest KYB form data for task: 444
3:31:03 PM [info] GET /api/companies/current 304 in 29ms :: {"id":193,"name":"DevelopmentTestingM","description":"FinTech partner company...
[Tasks Routes] No KYB responses found for task 444
[Tasks Routes] Task found by ID: {
  taskId: 444,
  title: '1. KYB Form: DevelopmentTestingM',
  type: 'company_kyb',
  formDataFields: 0,
  timestamp: '2025-04-20T15:31:03.129Z'
}
3:31:03 PM [info] GET /api/tasks/444 200 in 116ms :: {"id":444,"title":"1. KYB Form: DevelopmentTestingM","description":"Complete ...
[Task Templates API] Fetching template for task type: company_kyb, user: 234
[Task Templates API] Found template: 1 (KYB Form) for task type: company_kyb
3:31:03 PM [warn] GET /api/companies/is-demo 400 in 31ms :: {"message":"Invalid company ID","code":"INVALID_ID"}
[Task Templates API] Retrieved 9 configuration items for template ID: 1
3:31:03 PM [info] GET /api/task-templates/by-type/company_kyb 304 in 87ms :: {"id":1,"name":"KYB Form","description":"Know Your Business form for company ...
[Tasks Routes] Fetching task by ID: {
  taskId: 444,
  userCompanyId: 193,
  timestamp: '2025-04-20T15:31:03.547Z'
}
3:31:03 PM [info] GET /api/companies/193 200 in 59ms :: {"id":193,"name":"DevelopmentTestingM","description":"FinTech partner company...
[Tasks Routes] Fetching latest KYB form data for task: 444
[Tasks Routes] No KYB responses found for task 444
[Tasks Routes] Task found by ID: {
  taskId: 444,
  title: '1. KYB Form: DevelopmentTestingM',
  type: 'company_kyb',
  formDataFields: 0,
  timestamp: '2025-04-20T15:31:03.640Z'
}
3:31:03 PM [info] GET /api/tasks/444 304 in 125ms :: {"id":444,"title":"1. KYB Form: DevelopmentTestingM","description":"Complete ...
[2025-04-20T15:31:03.822Z] [INFO] [KYBRoutes] Fetching KYB fields
[2025-04-20T15:31:03.852Z] [INFO] [KYBRoutes] KYB fields retrieved successfully {"fieldCount":30,"groups":["companyProfile","financialProfile","governanceLeadership","operationsCompliance"]}
3:31:03 PM [info] GET /api/kyb/fields 304 in 59ms :: [{"id":1,"field_key":"legalEntityName","display_name":"Legal Entity Name","fi...
[KYB API Debug] Loading progress for task: 444
[Task Reconciliation] Found 0 responses for task 444
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-04-20T15:31:04.102Z'
}
[STATUS DETERMINATION] Task has 0% progress, setting to NOT_STARTED
[Task Reconciliation] Progress calculation: {
  taskId: 444,
  currentProgress: 0,
  calculatedProgress: 0,
  currentStatus: 'not_started',
  calculatedStatus: 'not_started',
  responseCount: 0,
  completeCount: 0
}
[Task Reconciliation] No updates needed for task 444
[KYB API Debug] Retrieved task: {
  taskId: 444,
  status: 'not_started',
  progress: 0,
  metadata: [
    'company_id',
    'created_at',
    'created_via',
    'status_flow',
    'company_name',
    'created_by_id',
    'prerequisite_for'
  ],
  timestamp: '2025-04-20T15:31:04.131Z'
}
[KYB API Debug] Retrieved responses: { responseCount: 0, fields: [], timestamp: '2025-04-20T15:31:04.161Z' }
[SERVER DEBUG] No savedFormData found in task table
[SERVER DEBUG] No KYB form file ID found in task metadata
[KYB API Debug] Retrieved task data: {
  id: 444,
  responseCount: 0,
  progress: 0,
  status: 'not_started',
  formDataKeys: []
}
===============================================
[SERVER DEBUG] PREPARING GET RESPONSE at 2025-04-20T15:31:04.161Z
[SERVER DEBUG] Task ID: 444, Found 0 fields in database
===============================================
[SERVER DEBUG] Checking field corporateRegistration in retrieved data: NOT PRESENT
[SERVER DEBUG] Checking field goodStanding in retrieved data: NOT PRESENT
[SERVER DEBUG] Checking field regulatoryActions in retrieved data: NOT PRESENT
[SERVER DEBUG] Checking field investigationsIncidents in retrieved data: NOT PRESENT
[SERVER DEBUG] No fields with value "asdf" found in GET response data
[SERVER DEBUG] Sending GET response with 0 fields, status: not_started, progress: 0%
===============================================
3:31:04 PM [info] GET /api/kyb/progress/444 200 in 148ms :: {"formData":{},"progress":0,"status":"not_started"}
[KYB API Debug] Loading progress for task: 444
[Task Reconciliation] Found 0 responses for task 444
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-04-20T15:31:04.394Z'
}
[STATUS DETERMINATION] Task has 0% progress, setting to NOT_STARTED
[Task Reconciliation] Progress calculation: {
  taskId: 444,
  currentProgress: 0,
  calculatedProgress: 0,
  currentStatus: 'not_started',
  calculatedStatus: 'not_started',
  responseCount: 0,
  completeCount: 0
}
[Task Reconciliation] No updates needed for task 444
[KYB API Debug] Retrieved task: {
  taskId: 444,
  status: 'not_started',
  progress: 0,
  metadata: [
    'company_id',
    'created_at',
    'created_via',
    'status_flow',
    'company_name',
    'created_by_id',
    'prerequisite_for'
  ],
  timestamp: '2025-04-20T15:31:04.423Z'
}
[KYB API Debug] Retrieved responses: { responseCount: 0, fields: [], timestamp: '2025-04-20T15:31:04.452Z' }
[SERVER DEBUG] No savedFormData found in task table
[SERVER DEBUG] No KYB form file ID found in task metadata
[KYB API Debug] Retrieved task data: {
  id: 444,
  responseCount: 0,
  progress: 0,
  status: 'not_started',
  formDataKeys: []
}
===============================================
[SERVER DEBUG] PREPARING GET RESPONSE at 2025-04-20T15:31:04.452Z
[SERVER DEBUG] Task ID: 444, Found 0 fields in database
===============================================
[SERVER DEBUG] Checking field corporateRegistration in retrieved data: NOT PRESENT
[SERVER DEBUG] Checking field goodStanding in retrieved data: NOT PRESENT
[SERVER DEBUG] Checking field regulatoryActions in retrieved data: NOT PRESENT
[SERVER DEBUG] Checking field investigationsIncidents in retrieved data: NOT PRESENT
[SERVER DEBUG] No fields with value "asdf" found in GET response data
[SERVER DEBUG] Sending GET response with 0 fields, status: not_started, progress: 0%
===============================================
3:31:04 PM [info] GET /api/kyb/progress/444 304 in 146ms :: {"formData":{},"progress":0,"status":"not_started"}
[KYB API Debug] Loading progress for task: 444
[Task Reconciliation] Found 0 responses for task 444
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-04-20T15:31:04.688Z'
}
[STATUS DETERMINATION] Task has 0% progress, setting to NOT_STARTED
[Task Reconciliation] Progress calculation: {
  taskId: 444,
  currentProgress: 0,
  calculatedProgress: 0,
  currentStatus: 'not_started',
  calculatedStatus: 'not_started',
  responseCount: 0,
  completeCount: 0
}
[Task Reconciliation] No updates needed for task 444
[KYB API Debug] Retrieved task: {
  taskId: 444,
  status: 'not_started',
  progress: 0,
  metadata: [
    'company_id',
    'created_at',
    'created_via',
    'status_flow',
    'company_name',
    'created_by_id',
    'prerequisite_for'
  ],
  timestamp: '2025-04-20T15:31:04.717Z'
}
[KYB API Debug] Retrieved responses: { responseCount: 0, fields: [], timestamp: '2025-04-20T15:31:04.751Z' }
[SERVER DEBUG] No savedFormData found in task table
[SERVER DEBUG] No KYB form file ID found in task metadata
[KYB API Debug] Retrieved task data: {
  id: 444,
  responseCount: 0,
  progress: 0,
  status: 'not_started',
  formDataKeys: []
}
===============================================
[SERVER DEBUG] PREPARING GET RESPONSE at 2025-04-20T15:31:04.752Z
[SERVER DEBUG] Task ID: 444, Found 0 fields in database
===============================================
[SERVER DEBUG] Checking field corporateRegistration in retrieved data: NOT PRESENT
[SERVER DEBUG] Checking field goodStanding in retrieved data: NOT PRESENT
[SERVER DEBUG] Checking field regulatoryActions in retrieved data: NOT PRESENT
[SERVER DEBUG] Checking field investigationsIncidents in retrieved data: NOT PRESENT
[SERVER DEBUG] No fields with value "asdf" found in GET response data
[SERVER DEBUG] Sending GET response with 0 fields, status: not_started, progress: 0%
===============================================
3:31:04 PM [info] GET /api/kyb/progress/444 304 in 153ms :: {"formData":{},"progress":0,"status":"not_started"}
[Auth] Using cached user data: 234
[2025-04-20T15:31:06.804Z] [INFO] [KYBRoutes] Demo auto-fill requested for task {"taskId":"444","userId":234}
[2025-04-20T15:31:06.891Z] [INFO] [KYBRoutes] Fetched fields for demo auto-fill {"fieldCount":30,"taskId":"444"}
[KYB Demo Auto-Fill] First 5 fields from database:
[KYB Demo Auto-Fill] Raw field objects: [
  {
    id: 1,
    field_key: 'legalEntityName',
    display_name: 'Legal Entity Name',
    field_type: 'TEXT',
    question: 'What is the registered business name?',
    group: 'companyProfile',
    required: true,
    order: 1,
    step_index: 0,
    validation_rules: null,
    help_text: 'The official name under which your business is registered with government authorities.',
    demo_autofill: null,
    created_at: 2025-03-05T07:32:29.195Z,
    updated_at: 2025-03-05T07:32:29.195Z
  },
  {
    id: 2,
    field_key: 'registrationNumber',
    display_name: 'Registration Number',
    field_type: 'TEXT',
    question: "What is your company's entity registration number (e.g., EIN or State Entity ID)?",
    group: 'companyProfile',
    required: true,
    order: 2,
    step_index: 0,
    validation_rules: null,
    help_text: 'In the US, this is typically your EIN (Employer Identification Number) or state entity registration number.',
    demo_autofill: '12-3456789',
    created_at: 2025-03-05T07:32:29.195Z,
    updated_at: 2025-03-05T07:32:29.195Z
  },
  {
    id: 3,
    field_key: 'incorporationDate',
    display_name: 'Incorporation Date',
    field_type: 'DATE',
    question: 'When was the company incorporated?',
    group: 'companyProfile',
    required: true,
    order: 3,
    step_index: 0,
    validation_rules: null,
    help_text: 'The date when your company was legally established as per your registration documents.',
    demo_autofill: '5/12/2010',
    created_at: 2025-03-05T07:32:29.195Z,
    updated_at: 2025-03-05T07:32:29.195Z
  },
  {
    id: 4,
    field_key: 'businessType',
    display_name: 'Business Type',
    field_type: 'TEXT',
    question: 'What type of business entity is this?',
    group: 'companyProfile',
    required: true,
    order: 4,
    step_index: 0,
    validation_rules: null,
    help_text: 'Examples include LLC, Corporation, Partnership, Sole Proprietorship, etc.',
    demo_autofill: 'Limited Liability Company (LLC)',
    created_at: 2025-03-05T07:32:29.195Z,
    updated_at: 2025-03-05T07:32:29.195Z
  },
  {
    id: 5,
    field_key: 'jurisdiction',
    display_name: 'Jurisdiction',
    field_type: 'TEXT',
    question: 'In which jurisdiction is the company registered?',
    group: 'companyProfile',
    required: true,
    order: 5,
    step_index: 0,
    validation_rules: null,
    help_text: 'The country, state, or region where your company is officially registered.',
    demo_autofill: 'Delaware, United States',
    created_at: 2025-03-05T07:32:29.195Z,
    updated_at: 2025-03-05T07:32:29.195Z
  }
]
[KYB Demo Auto-Fill] Field legalEntityName has these properties: [
  'id',           'field_key',
  'display_name', 'field_type',
  'question',     'group',
  'required',     'order',
  'step_index',   'validation_rules',
  'help_text',    'demo_autofill',
  'created_at',   'updated_at'
]
[KYB Demo Auto-Fill] Field legalEntityName demo_autofill = "null"
[KYB Demo Auto-Fill] Field registrationNumber has these properties: [
  'id',           'field_key',
  'display_name', 'field_type',
  'question',     'group',
  'required',     'order',
  'step_index',   'validation_rules',
  'help_text',    'demo_autofill',
  'created_at',   'updated_at'
]
[KYB Demo Auto-Fill] Field registrationNumber demo_autofill = "12-3456789"
[KYB Demo Auto-Fill] Field incorporationDate has these properties: [
  'id',           'field_key',
  'display_name', 'field_type',
  'question',     'group',
  'required',     'order',
  'step_index',   'validation_rules',
  'help_text',    'demo_autofill',
  'created_at',   'updated_at'
]
[KYB Demo Auto-Fill] Field incorporationDate demo_autofill = "5/12/2010"
[KYB Demo Auto-Fill] Field businessType has these properties: [
  'id',           'field_key',
  'display_name', 'field_type',
  'question',     'group',
  'required',     'order',
  'step_index',   'validation_rules',
  'help_text',    'demo_autofill',
  'created_at',   'updated_at'
]
[KYB Demo Auto-Fill] Field businessType demo_autofill = "Limited Liability Company (LLC)"
[KYB Demo Auto-Fill] Field jurisdiction has these properties: [
  'id',           'field_key',
  'display_name', 'field_type',
  'question',     'group',
  'required',     'order',
  'step_index',   'validation_rules',
  'help_text',    'demo_autofill',
  'created_at',   'updated_at'
]
[KYB Demo Auto-Fill] Field jurisdiction demo_autofill = "Delaware, United States"
[KYB Demo Auto-Fill] Using company name for legalEntityName: DevelopmentTestingM
[KYB Demo Auto-Fill] Used database value for registrationNumber: 12-3456789
[KYB Demo Auto-Fill] Used database value for incorporationDate: 5/12/2010
[KYB Demo Auto-Fill] Used database value for businessType: Limited Liability Company (LLC)
[KYB Demo Auto-Fill] Used database value for jurisdiction: Delaware, United States
[KYB Demo Auto-Fill] Used database value for registeredAddress: 123 Market Street, Wilmington, DE 19801
[KYB Demo Auto-Fill] Used database value for companyPhone: (302) 555-1234
[KYB Demo Auto-Fill] Used database value for priorNames: None
[KYB Demo Auto-Fill] Used database value for marketCapitalization: $75 million (privately held)
[KYB Demo Auto-Fill] Used database value for lifetimeCustomerValue: $1,250
[KYB Demo Auto-Fill] Used database value for annualRecurringRevenue: 5,000,000
[KYB Demo Auto-Fill] Used database value for monthlyRecurringRevenue: 12,500,000
[KYB Demo Auto-Fill] Used database value for licenses: Money Transmitter License #MT-12345, Financial Data Provider License #FDP-98765
[KYB Demo Auto-Fill] Used database value for goodStanding: Yes
[KYB Demo Auto-Fill] Used database value for corporateRegistration: No
[KYB Demo Auto-Fill] Used database value for externalAudit: No
[KYB Demo Auto-Fill] Used database value for controlEnvironment: Yes
[KYB Demo Auto-Fill] Used database value for authorizedSigners: John Smith (CEO), Sarah Johnson (CFO), Michael Wong (COO)
[KYB Demo Auto-Fill] Used database value for governmentOwnership: No
[KYB Demo Auto-Fill] Used database value for ultimateBeneficialOwners: None
[KYB Demo Auto-Fill] Used database value for directorsAndOfficers: John Smith (Chairman), Jane Doe (Director), Mike Johnson (Director)
[KYB Demo Auto-Fill] Using current user email for contactEmail: email@m.com
[KYB Demo Auto-Fill] Used database value for investigationsIncidents: No significant incidents in the past 3 years
[KYB Demo Auto-Fill] Used database value for financialStatements: Yes
[KYB Demo Auto-Fill] Used database value for operationalPolicies: ISO 27001 certified, SOC 2 Type II compliant
[KYB Demo Auto-Fill] Used database value for dataVolume: Approximately 2 million records per month
[KYB Demo Auto-Fill] Used database value for dataTypes: Financial transaction data, Account balances, Customer KYC information
[KYB Demo Auto-Fill] Used database value for sanctionsCheck: Approximately 2 million records per month
[KYB Demo Auto-Fill] Used database value for dueDiligence: Yes
[KYB Demo Auto-Fill] Used database value for regulatoryActions: Yes
[2025-04-20T15:31:06.893Z] [INFO] [KYBRoutes] Generated demo data for auto-fill {"fieldCount":30,"taskId":"444"}
3:31:06 PM [info] GET /api/kyb/demo-autofill/444 200 in 119ms :: {"legalEntityName":"DevelopmentTestingM","registrationNumber":"12-3456789","i...
[TimestampHandler] Saving 30 timestamps for task 444
[TimestampHandler] Successfully saved timestamps for task 444
[TimestampAPI] Saved 30 timestamps for task 444
3:31:07 PM [info] POST /api/kyb/timestamps/444 200 in 76ms :: {"message":"Timestamps saved successfully","count":30}
===============================================
[SERVER DEBUG] KYB PROGRESS SAVE REQUEST RECEIVED at 2025-04-20T15:31:07.862Z
===============================================
Task ID: 444
Progress: 100
Status: ready_for_submission
Field count: 30
Sample form data values:
- legalEntityName: "DevelopmentTestingM" (string)
- registrationNumber: "12-3456789" (string)
- incorporationDate: "5/12/2010" (string)
- businessType: "Limited Liability Company (LLC)" (string)
- jurisdiction: "Delaware, United States" (string)
Request details:
- Method: POST
- Content-Type: application/json
- Content-Length: 2432
===============================================
===============================================
[SERVER DEBUG] PROCESSING FORM DATA FIELDS AT 2025-04-20T15:31:07.920Z
[SERVER DEBUG] Task ID: 444, Field count: 30
===============================================
[SERVER DEBUG] COMPLETE FORM DATA DUMP:
[SERVER DEBUG] legalEntityName: "DevelopmentTestingM" (string)
[SERVER DEBUG] registrationNumber: "12-3456789" (string)
[SERVER DEBUG] incorporationDate: "5/12/2010" (string)
[SERVER DEBUG] businessType: "Limited Liability Company (LLC)" (string)
[SERVER DEBUG] jurisdiction: "Delaware, United States" (string)
[SERVER DEBUG] registeredAddress: "123 Market Street, Wilmington, DE 19801" (string)
[SERVER DEBUG] companyPhone: "(302) 555-1234" (string)
[SERVER DEBUG] priorNames: "None" (string)
[SERVER DEBUG] licenses: "Money Transmitter License #MT-12345, Financial Data Provider License #FDP-98765" (string)
[SERVER DEBUG] goodStanding: "Yes" (string)
[SERVER DEBUG] corporateRegistration: "No" (string)
[SERVER DEBUG] externalAudit: "No" (string)
[SERVER DEBUG] controlEnvironment: "Yes" (string)
[SERVER DEBUG] authorizedSigners: "John Smith (CEO), Sarah Johnson (CFO), Michael Wong (COO)" (string)
[SERVER DEBUG] governmentOwnership: "No" (string)
[SERVER DEBUG] ultimateBeneficialOwners: "None" (string)
[SERVER DEBUG] directorsAndOfficers: "John Smith (Chairman), Jane Doe (Director), Mike Johnson (Director)" (string)
[SERVER DEBUG] contactEmail: "email@m.com" (string)
[SERVER DEBUG] marketCapitalization: "$75 million (privately held)" (string)
[SERVER DEBUG] lifetimeCustomerValue: "$1,250" (string)
[SERVER DEBUG] annualRecurringRevenue: "5,000,000" (string)
[SERVER DEBUG] monthlyRecurringRevenue: "12,500,000" (string)
[SERVER DEBUG] investigationsIncidents: "No significant incidents in the past 3 years" (string)
[SERVER DEBUG] financialStatements: "Yes" (string)
[SERVER DEBUG] operationalPolicies: "ISO 27001 certified, SOC 2 Type II compliant" (string)
[SERVER DEBUG] dataVolume: "Approximately 2 million records per month" (string)
[SERVER DEBUG] dataTypes: "Financial transaction data, Account balances, Customer KYC information" (string)
[SERVER DEBUG] sanctionsCheck: "Approximately 2 million records per month" (string)
[SERVER DEBUG] dueDiligence: "Yes" (string)
[SERVER DEBUG] regulatoryActions: "Yes" (string)
[SERVER DEBUG] END OF FORM DATA DUMP
[SERVER DEBUG] No fields with value "asdf" found in incoming data
[SERVER DEBUG] Processing field: "legalEntityName" (ID: 1)
[SERVER DEBUG] Original value: DevelopmentTestingM
[SERVER DEBUG] Normalized value: "DevelopmentTestingM" (string)
[SERVER DEBUG] Field status: COMPLETE
[SERVER DEBUG] Existing response found: NO
[SERVER DEBUG] INSERTING new response for field "legalEntityName"
[SERVER DEBUG] - Value: "DevelopmentTestingM" (string)
[SERVER DEBUG] - Status: COMPLETE
[SERVER DEBUG] ✅ INSERT VERIFICATION for field "legalEntityName":
[SERVER DEBUG] - Expected: "DevelopmentTestingM"
[SERVER DEBUG] - Actual: "DevelopmentTestingM"
[SERVER DEBUG] - Match: YES
[SERVER DEBUG] ✅ INSERT SUCCESSFUL for field "legalEntityName"
[SERVER DEBUG] Broadcasting legalEntityName insert via WebSocket: "DevelopmentTestingM"
[WebSocket] Broadcasting field update for task 444, field "legalEntityName": { value: 'DevelopmentTestingM', timestamp: '2025-04-20T15:31:08.012Z' }
[SERVER DEBUG] --- Finished processing field "legalEntityName" ---

[SERVER DEBUG] Processing field: "registrationNumber" (ID: 2)
[SERVER DEBUG] Original value: 12-3456789
[SERVER DEBUG] Normalized value: "12-3456789" (string)
[SERVER DEBUG] Field status: COMPLETE
[SERVER DEBUG] Existing response found: NO
[SERVER DEBUG] INSERTING new response for field "registrationNumber"
[SERVER DEBUG] - Value: "12-3456789" (string)
[SERVER DEBUG] - Status: COMPLETE
[SERVER DEBUG] ✅ INSERT VERIFICATION for field "registrationNumber":
[SERVER DEBUG] - Expected: "12-3456789"
[SERVER DEBUG] - Actual: "12-3456789"
[SERVER DEBUG] - Match: YES
[SERVER DEBUG] ✅ INSERT SUCCESSFUL for field "registrationNumber"
[SERVER DEBUG] --- Finished processing field "registrationNumber" ---

[SERVER DEBUG] Processing field: "incorporationDate" (ID: 3)
[SERVER DEBUG] Original value: 5/12/2010
[SERVER DEBUG] Normalized value: "5/12/2010" (string)
[SERVER DEBUG] Field status: COMPLETE
[SERVER DEBUG] Existing response found: NO
[SERVER DEBUG] INSERTING new response for field "incorporationDate"
[SERVER DEBUG] - Value: "5/12/2010" (string)
[SERVER DEBUG] - Status: COMPLETE
[SERVER DEBUG] ✅ INSERT VERIFICATION for field "incorporationDate":
[SERVER DEBUG] - Expected: "5/12/2010"
[SERVER DEBUG] - Actual: "5/12/2010"
[SERVER DEBUG] - Match: YES
[SERVER DEBUG] ✅ INSERT SUCCESSFUL for field "incorporationDate"
[SERVER DEBUG] --- Finished processing field "incorporationDate" ---

[SERVER DEBUG] Processing field: "businessType" (ID: 4)
[SERVER DEBUG] Original value: Limited Liability Company (LLC)
[SERVER DEBUG] Normalized value: "Limited Liability Company (LLC)" (string)
[SERVER DEBUG] Field status: COMPLETE
[SERVER DEBUG] Existing response found: NO
[SERVER DEBUG] INSERTING new response for field "businessType"
[SERVER DEBUG] - Value: "Limited Liability Company (LLC)" (string)
[SERVER DEBUG] - Status: COMPLETE
[SERVER DEBUG] ✅ INSERT VERIFICATION for field "businessType":
[SERVER DEBUG] - Expected: "Limited Liability Company (LLC)"
[SERVER DEBUG] - Actual: "Limited Liability Company (LLC)"
[SERVER DEBUG] - Match: YES
[SERVER DEBUG] ✅ INSERT SUCCESSFUL for field "businessType"
[SERVER DEBUG] --- Finished processing field "businessType" ---

[SERVER DEBUG] Processing field: "jurisdiction" (ID: 5)
[SERVER DEBUG] Original value: Delaware, United States
[SERVER DEBUG] Normalized value: "Delaware, United States" (string)
[SERVER DEBUG] Field status: COMPLETE
[SERVER DEBUG] Existing response found: NO
[SERVER DEBUG] INSERTING new response for field "jurisdiction"
[SERVER DEBUG] - Value: "Delaware, United States" (string)
[SERVER DEBUG] - Status: COMPLETE
[SERVER DEBUG] ✅ INSERT VERIFICATION for field "jurisdiction":
[SERVER DEBUG] - Expected: "Delaware, United States"
[SERVER DEBUG] - Actual: "Delaware, United States"
[SERVER DEBUG] - Match: YES
[SERVER DEBUG] ✅ INSERT SUCCESSFUL for field "jurisdiction"
[SERVER DEBUG] --- Finished processing field "jurisdiction" ---

[SERVER DEBUG] Processing field: "registeredAddress" (ID: 6)
[SERVER DEBUG] Original value: 123 Market Street, Wilmington, DE 19801
[SERVER DEBUG] Normalized value: "123 Market Street, Wilmington, DE 19801" (string)
[SERVER DEBUG] Field status: COMPLETE
[SERVER DEBUG] Existing response found: NO
[SERVER DEBUG] INSERTING new response for field "registeredAddress"
[SERVER DEBUG] - Value: "123 Market Street, Wilmington, DE 19801" (string)
[SERVER DEBUG] - Status: COMPLETE
[SERVER DEBUG] ✅ INSERT VERIFICATION for field "registeredAddress":
[SERVER DEBUG] - Expected: "123 Market Street, Wilmington, DE 19801"
[SERVER DEBUG] - Actual: "123 Market Street, Wilmington, DE 19801"
[SERVER DEBUG] - Match: YES
[SERVER DEBUG] ✅ INSERT SUCCESSFUL for field "registeredAddress"
[SERVER DEBUG] --- Finished processing field "registeredAddress" ---

[SERVER DEBUG] Processing field: "companyPhone" (ID: 7)
[SERVER DEBUG] Original value: (302) 555-1234
[SERVER DEBUG] Normalized value: "(302) 555-1234" (string)
[SERVER DEBUG] Field status: COMPLETE
[SERVER DEBUG] Existing response found: NO
[SERVER DEBUG] INSERTING new response for field "companyPhone"
[SERVER DEBUG] - Value: "(302) 555-1234" (string)
[SERVER DEBUG] - Status: COMPLETE
[SERVER DEBUG] ✅ INSERT VERIFICATION for field "companyPhone":
[SERVER DEBUG] - Expected: "(302) 555-1234"
[SERVER DEBUG] - Actual: "(302) 555-1234"
[SERVER DEBUG] - Match: YES
[SERVER DEBUG] ✅ INSERT SUCCESSFUL for field "companyPhone"
[SERVER DEBUG] --- Finished processing field "companyPhone" ---

[SERVER DEBUG] Processing field: "priorNames" (ID: 8)
[SERVER DEBUG] Original value: None
[SERVER DEBUG] Normalized value: "None" (string)
[SERVER DEBUG] Field status: COMPLETE
[SERVER DEBUG] Existing response found: NO
[SERVER DEBUG] INSERTING new response for field "priorNames"
[SERVER DEBUG] - Value: "None" (string)
[SERVER DEBUG] - Status: COMPLETE
[SERVER DEBUG] ✅ INSERT VERIFICATION for field "priorNames":
[SERVER DEBUG] - Expected: "None"
[SERVER DEBUG] - Actual: "None"
[SERVER DEBUG] - Match: YES
[SERVER DEBUG] ✅ INSERT SUCCESSFUL for field "priorNames"
[SERVER DEBUG] --- Finished processing field "priorNames" ---

[SERVER DEBUG] Processing field: "licenses" (ID: 9)
[SERVER DEBUG] Original value: Money Transmitter License #MT-12345, Financial Data Provider License #FDP-98765
[SERVER DEBUG] Normalized value: "Money Transmitter License #MT-12345, Financial Data Provider License #FDP-98765" (string)
[SERVER DEBUG] Field status: COMPLETE
[SERVER DEBUG] Existing response found: NO
[SERVER DEBUG] INSERTING new response for field "licenses"
[SERVER DEBUG] - Value: "Money Transmitter License #MT-12345, Financial Data Provider License #FDP-98765" (string)
[SERVER DEBUG] - Status: COMPLETE
[SERVER DEBUG] ✅ INSERT VERIFICATION for field "licenses":
[SERVER DEBUG] - Expected: "Money Transmitter License #MT-12345, Financial Data Provider License #FDP-98765"
[SERVER DEBUG] - Actual: "Money Transmitter License #MT-12345, Financial Data Provider License #FDP-98765"
[SERVER DEBUG] - Match: YES
[SERVER DEBUG] ✅ INSERT SUCCESSFUL for field "licenses"
[SERVER DEBUG] --- Finished processing field "licenses" ---

[SERVER DEBUG] Processing field: "goodStanding" (ID: 10)
[SERVER DEBUG] Original value: Yes
[SERVER DEBUG] Normalized value: "Yes" (string)
[SERVER DEBUG] Field status: COMPLETE
[SERVER DEBUG] Existing response found: NO
[SERVER DEBUG] INSERTING new response for field "goodStanding"
[SERVER DEBUG] - Value: "Yes" (string)
[SERVER DEBUG] - Status: COMPLETE
[SERVER DEBUG] ✅ INSERT VERIFICATION for field "goodStanding":
[SERVER DEBUG] - Expected: "Yes"
[SERVER DEBUG] - Actual: "Yes"
[SERVER DEBUG] - Match: YES
[SERVER DEBUG] ✅ INSERT SUCCESSFUL for field "goodStanding"
[SERVER DEBUG] --- Finished processing field "goodStanding" ---

[SERVER DEBUG] Processing field: "corporateRegistration" (ID: 11)
[SERVER DEBUG] Original value: No
[SERVER DEBUG] Normalized value: "No" (string)
[SERVER DEBUG] Field status: COMPLETE
[SERVER DEBUG] Existing response found: NO
[SERVER DEBUG] INSERTING new response for field "corporateRegistration"
[SERVER DEBUG] - Value: "No" (string)
[SERVER DEBUG] - Status: COMPLETE
[SERVER DEBUG] ✅ INSERT VERIFICATION for field "corporateRegistration":
[SERVER DEBUG] - Expected: "No"
[SERVER DEBUG] - Actual: "No"
[SERVER DEBUG] - Match: YES
[SERVER DEBUG] ✅ INSERT SUCCESSFUL for field "corporateRegistration"
[SERVER DEBUG] --- Finished processing field "corporateRegistration" ---

[SERVER DEBUG] Processing field: "externalAudit" (ID: 12)
[SERVER DEBUG] Original value: No
[SERVER DEBUG] Normalized value: "No" (string)
[SERVER DEBUG] Field status: COMPLETE
[SERVER DEBUG] Existing response found: NO
[SERVER DEBUG] INSERTING new response for field "externalAudit"
[SERVER DEBUG] - Value: "No" (string)
[SERVER DEBUG] - Status: COMPLETE
[SERVER DEBUG] ✅ INSERT VERIFICATION for field "externalAudit":
[SERVER DEBUG] - Expected: "No"
[SERVER DEBUG] - Actual: "No"
[SERVER DEBUG] - Match: YES
[SERVER DEBUG] ✅ INSERT SUCCESSFUL for field "externalAudit"
[SERVER DEBUG] --- Finished processing field "externalAudit" ---

[SERVER DEBUG] Processing field: "controlEnvironment" (ID: 13)
[SERVER DEBUG] Original value: Yes
[SERVER DEBUG] Normalized value: "Yes" (string)
[SERVER DEBUG] Field status: COMPLETE
[SERVER DEBUG] Existing response found: NO
[SERVER DEBUG] INSERTING new response for field "controlEnvironment"
[SERVER DEBUG] - Value: "Yes" (string)
[SERVER DEBUG] - Status: COMPLETE
[SERVER DEBUG] ✅ INSERT VERIFICATION for field "controlEnvironment":
[SERVER DEBUG] - Expected: "Yes"
[SERVER DEBUG] - Actual: "Yes"
[SERVER DEBUG] - Match: YES
[SERVER DEBUG] ✅ INSERT SUCCESSFUL for field "controlEnvironment"
[SERVER DEBUG] --- Finished processing field "controlEnvironment" ---

[SERVER DEBUG] Processing field: "authorizedSigners" (ID: 14)
[SERVER DEBUG] Original value: John Smith (CEO), Sarah Johnson (CFO), Michael Wong (COO)
[SERVER DEBUG] Normalized value: "John Smith (CEO), Sarah Johnson (CFO), Michael Wong (COO)" (string)
[SERVER DEBUG] Field status: COMPLETE
[SERVER DEBUG] Existing response found: NO
[SERVER DEBUG] INSERTING new response for field "authorizedSigners"
[SERVER DEBUG] - Value: "John Smith (CEO), Sarah Johnson (CFO), Michael Wong (COO)" (string)
[SERVER DEBUG] - Status: COMPLETE
[SERVER DEBUG] ✅ INSERT VERIFICATION for field "authorizedSigners":
[SERVER DEBUG] - Expected: "John Smith (CEO), Sarah Johnson (CFO), Michael Wong (COO)"
[SERVER DEBUG] - Actual: "John Smith (CEO), Sarah Johnson (CFO), Michael Wong (COO)"
[SERVER DEBUG] - Match: YES
[SERVER DEBUG] ✅ INSERT SUCCESSFUL for field "authorizedSigners"
[SERVER DEBUG] --- Finished processing field "authorizedSigners" ---

[SERVER DEBUG] Processing field: "governmentOwnership" (ID: 15)
[SERVER DEBUG] Original value: No
[SERVER DEBUG] Normalized value: "No" (string)
[SERVER DEBUG] Field status: COMPLETE
[SERVER DEBUG] Existing response found: NO
[SERVER DEBUG] INSERTING new response for field "governmentOwnership"
[SERVER DEBUG] - Value: "No" (string)
[SERVER DEBUG] - Status: COMPLETE
[SERVER DEBUG] ✅ INSERT VERIFICATION for field "governmentOwnership":
[SERVER DEBUG] - Expected: "No"
[SERVER DEBUG] - Actual: "No"
[SERVER DEBUG] - Match: YES
[SERVER DEBUG] ✅ INSERT SUCCESSFUL for field "governmentOwnership"
[SERVER DEBUG] --- Finished processing field "governmentOwnership" ---

[SERVER DEBUG] Processing field: "ultimateBeneficialOwners" (ID: 16)
[SERVER DEBUG] Original value: None
[SERVER DEBUG] Normalized value: "None" (string)
[SERVER DEBUG] Field status: COMPLETE
[SERVER DEBUG] Existing response found: NO
[SERVER DEBUG] INSERTING new response for field "ultimateBeneficialOwners"
[SERVER DEBUG] - Value: "None" (string)
[SERVER DEBUG] - Status: COMPLETE
[SERVER DEBUG] ✅ INSERT VERIFICATION for field "ultimateBeneficialOwners":
[SERVER DEBUG] - Expected: "None"
[SERVER DEBUG] - Actual: "None"
[SERVER DEBUG] - Match: YES
[SERVER DEBUG] ✅ INSERT SUCCESSFUL for field "ultimateBeneficialOwners"
[SERVER DEBUG] --- Finished processing field "ultimateBeneficialOwners" ---

[SERVER DEBUG] Processing field: "directorsAndOfficers" (ID: 17)
[SERVER DEBUG] Original value: John Smith (Chairman), Jane Doe (Director), Mike Johnson (Director)
[SERVER DEBUG] Normalized value: "John Smith (Chairman), Jane Doe (Director), Mike Johnson (Director)" (string)
[SERVER DEBUG] Field status: COMPLETE
[SERVER DEBUG] Existing response found: NO
[SERVER DEBUG] INSERTING new response for field "directorsAndOfficers"
[SERVER DEBUG] - Value: "John Smith (Chairman), Jane Doe (Director), Mike Johnson (Director)" (string)
[SERVER DEBUG] - Status: COMPLETE
[SERVER DEBUG] ✅ INSERT VERIFICATION for field "directorsAndOfficers":
[SERVER DEBUG] - Expected: "John Smith (Chairman), Jane Doe (Director), Mike Johnson (Director)"
[SERVER DEBUG] - Actual: "John Smith (Chairman), Jane Doe (Director), Mike Johnson (Director)"
[SERVER DEBUG] - Match: YES
[SERVER DEBUG] ✅ INSERT SUCCESSFUL for field "directorsAndOfficers"
[SERVER DEBUG] --- Finished processing field "directorsAndOfficers" ---

[SERVER DEBUG] Processing field: "contactEmail" (ID: 18)
[SERVER DEBUG] Original value: email@m.com
[SERVER DEBUG] Normalized value: "email@m.com" (string)
[SERVER DEBUG] Field status: COMPLETE
[SERVER DEBUG] Existing response found: NO
[SERVER DEBUG] INSERTING new response for field "contactEmail"
[SERVER DEBUG] - Value: "email@m.com" (string)
[SERVER DEBUG] - Status: COMPLETE
[SERVER DEBUG] ✅ INSERT VERIFICATION for field "contactEmail":
[SERVER DEBUG] - Expected: "email@m.com"
[SERVER DEBUG] - Actual: "email@m.com"
[SERVER DEBUG] - Match: YES
[SERVER DEBUG] ✅ INSERT SUCCESSFUL for field "contactEmail"
[SERVER DEBUG] --- Finished processing field "contactEmail" ---

[SERVER DEBUG] Processing field: "marketCapitalization" (ID: 19)
[SERVER DEBUG] Original value: $75 million (privately held)
[SERVER DEBUG] Normalized value: "$75 million (privately held)" (string)
[SERVER DEBUG] Field status: COMPLETE
[SERVER DEBUG] Existing response found: NO
[SERVER DEBUG] INSERTING new response for field "marketCapitalization"
[SERVER DEBUG] - Value: "$75 million (privately held)" (string)
[SERVER DEBUG] - Status: COMPLETE
[SERVER DEBUG] ✅ INSERT VERIFICATION for field "marketCapitalization":
[SERVER DEBUG] - Expected: "$75 million (privately held)"
[SERVER DEBUG] - Actual: "$75 million (privately held)"
[SERVER DEBUG] - Match: YES
[SERVER DEBUG] ✅ INSERT SUCCESSFUL for field "marketCapitalization"
[SERVER DEBUG] --- Finished processing field "marketCapitalization" ---

[SERVER DEBUG] Processing field: "lifetimeCustomerValue" (ID: 20)
[SERVER DEBUG] Original value: $1,250
[SERVER DEBUG] Normalized value: "$1,250" (string)
[SERVER DEBUG] Field status: COMPLETE
[SERVER DEBUG] Existing response found: NO
[SERVER DEBUG] INSERTING new response for field "lifetimeCustomerValue"
[SERVER DEBUG] - Value: "$1,250" (string)
[SERVER DEBUG] - Status: COMPLETE
[SERVER DEBUG] ✅ INSERT VERIFICATION for field "lifetimeCustomerValue":
[SERVER DEBUG] - Expected: "$1,250"
[SERVER DEBUG] - Actual: "$1,250"
[SERVER DEBUG] - Match: YES
[SERVER DEBUG] ✅ INSERT SUCCESSFUL for field "lifetimeCustomerValue"
[SERVER DEBUG] --- Finished processing field "lifetimeCustomerValue" ---

[SERVER DEBUG] Processing field: "annualRecurringRevenue" (ID: 21)
[SERVER DEBUG] Original value: 5,000,000
[SERVER DEBUG] Normalized value: "5,000,000" (string)
[SERVER DEBUG] Field status: COMPLETE
[SERVER DEBUG] Existing response found: NO
[SERVER DEBUG] INSERTING new response for field "annualRecurringRevenue"
[SERVER DEBUG] - Value: "5,000,000" (string)
[SERVER DEBUG] - Status: COMPLETE
[SERVER DEBUG] ✅ INSERT VERIFICATION for field "annualRecurringRevenue":
[SERVER DEBUG] - Expected: "5,000,000"
[SERVER DEBUG] - Actual: "5,000,000"
[SERVER DEBUG] - Match: YES
[SERVER DEBUG] ✅ INSERT SUCCESSFUL for field "annualRecurringRevenue"
[SERVER DEBUG] --- Finished processing field "annualRecurringRevenue" ---

[SERVER DEBUG] Processing field: "monthlyRecurringRevenue" (ID: 22)
[SERVER DEBUG] Original value: 12,500,000
[SERVER DEBUG] Normalized value: "12,500,000" (string)
[SERVER DEBUG] Field status: COMPLETE
[SERVER DEBUG] Existing response found: NO
[SERVER DEBUG] INSERTING new response for field "monthlyRecurringRevenue"
[SERVER DEBUG] - Value: "12,500,000" (string)
[SERVER DEBUG] - Status: COMPLETE
[SERVER DEBUG] ✅ INSERT VERIFICATION for field "monthlyRecurringRevenue":
[SERVER DEBUG] - Expected: "12,500,000"
[SERVER DEBUG] - Actual: "12,500,000"
[SERVER DEBUG] - Match: YES
[SERVER DEBUG] ✅ INSERT SUCCESSFUL for field "monthlyRecurringRevenue"
[SERVER DEBUG] --- Finished processing field "monthlyRecurringRevenue" ---

[SERVER DEBUG] Processing field: "investigationsIncidents" (ID: 23)
[SERVER DEBUG] Original value: No significant incidents in the past 3 years
[SERVER DEBUG] Normalized value: "No significant incidents in the past 3 years" (string)
[SERVER DEBUG] Field status: COMPLETE
[SERVER DEBUG] Existing response found: NO
[SERVER DEBUG] INSERTING new response for field "investigationsIncidents"
[SERVER DEBUG] - Value: "No significant incidents in the past 3 years" (string)
[SERVER DEBUG] - Status: COMPLETE
[SERVER DEBUG] ✅ INSERT VERIFICATION for field "investigationsIncidents":
[SERVER DEBUG] - Expected: "No significant incidents in the past 3 years"
[SERVER DEBUG] - Actual: "No significant incidents in the past 3 years"
[SERVER DEBUG] - Match: YES
[SERVER DEBUG] ✅ INSERT SUCCESSFUL for field "investigationsIncidents"
[SERVER DEBUG] --- Finished processing field "investigationsIncidents" ---

[SERVER DEBUG] Processing field: "financialStatements" (ID: 24)
[SERVER DEBUG] Original value: Yes
[SERVER DEBUG] Normalized value: "Yes" (string)
[SERVER DEBUG] Field status: COMPLETE
[SERVER DEBUG] Existing response found: NO
[SERVER DEBUG] INSERTING new response for field "financialStatements"
[SERVER DEBUG] - Value: "Yes" (string)
[SERVER DEBUG] - Status: COMPLETE
[SERVER DEBUG] ✅ INSERT VERIFICATION for field "financialStatements":
[SERVER DEBUG] - Expected: "Yes"
[SERVER DEBUG] - Actual: "Yes"
[SERVER DEBUG] - Match: YES
[SERVER DEBUG] ✅ INSERT SUCCESSFUL for field "financialStatements"
[SERVER DEBUG] --- Finished processing field "financialStatements" ---

[SERVER DEBUG] Processing field: "operationalPolicies" (ID: 25)
[SERVER DEBUG] Original value: ISO 27001 certified, SOC 2 Type II compliant
[SERVER DEBUG] Normalized value: "ISO 27001 certified, SOC 2 Type II compliant" (string)
[SERVER DEBUG] Field status: COMPLETE
[SERVER DEBUG] Existing response found: NO
[SERVER DEBUG] INSERTING new response for field "operationalPolicies"
[SERVER DEBUG] - Value: "ISO 27001 certified, SOC 2 Type II compliant" (string)
[SERVER DEBUG] - Status: COMPLETE
[SERVER DEBUG] ✅ INSERT VERIFICATION for field "operationalPolicies":
[SERVER DEBUG] - Expected: "ISO 27001 certified, SOC 2 Type II compliant"
[SERVER DEBUG] - Actual: "ISO 27001 certified, SOC 2 Type II compliant"
[SERVER DEBUG] - Match: YES
[SERVER DEBUG] ✅ INSERT SUCCESSFUL for field "operationalPolicies"
[SERVER DEBUG] --- Finished processing field "operationalPolicies" ---

[SERVER DEBUG] Processing field: "dataVolume" (ID: 26)
[SERVER DEBUG] Original value: Approximately 2 million records per month
[SERVER DEBUG] Normalized value: "Approximately 2 million records per month" (string)
[SERVER DEBUG] Field status: COMPLETE
[SERVER DEBUG] Existing response found: NO
[SERVER DEBUG] INSERTING new response for field "dataVolume"
[SERVER DEBUG] - Value: "Approximately 2 million records per month" (string)
[SERVER DEBUG] - Status: COMPLETE
[SERVER DEBUG] ✅ INSERT VERIFICATION for field "dataVolume":
[SERVER DEBUG] - Expected: "Approximately 2 million records per month"
[SERVER DEBUG] - Actual: "Approximately 2 million records per month"
[SERVER DEBUG] - Match: YES
[SERVER DEBUG] ✅ INSERT SUCCESSFUL for field "dataVolume"
[SERVER DEBUG] --- Finished processing field "dataVolume" ---

[SERVER DEBUG] Processing field: "dataTypes" (ID: 27)
[SERVER DEBUG] Original value: Financial transaction data, Account balances, Customer KYC information
[SERVER DEBUG] Normalized value: "Financial transaction data, Account balances, Customer KYC information" (string)
[SERVER DEBUG] Field status: COMPLETE
[SERVER DEBUG] Existing response found: NO
[SERVER DEBUG] INSERTING new response for field "dataTypes"
[SERVER DEBUG] - Value: "Financial transaction data, Account balances, Customer KYC information" (string)
[SERVER DEBUG] - Status: COMPLETE
[SERVER DEBUG] ✅ INSERT VERIFICATION for field "dataTypes":
[SERVER DEBUG] - Expected: "Financial transaction data, Account balances, Customer KYC information"
[SERVER DEBUG] - Actual: "Financial transaction data, Account balances, Customer KYC information"
[SERVER DEBUG] - Match: YES
[SERVER DEBUG] ✅ INSERT SUCCESSFUL for field "dataTypes"
[SERVER DEBUG] --- Finished processing field "dataTypes" ---

[SERVER DEBUG] Processing field: "sanctionsCheck" (ID: 28)
[SERVER DEBUG] Original value: Approximately 2 million records per month
[SERVER DEBUG] Normalized value: "Approximately 2 million records per month" (string)
[SERVER DEBUG] Field status: COMPLETE
[SERVER DEBUG] Existing response found: NO
[SERVER DEBUG] INSERTING new response for field "sanctionsCheck"
[SERVER DEBUG] - Value: "Approximately 2 million records per month" (string)
[SERVER DEBUG] - Status: COMPLETE
[SERVER DEBUG] ✅ INSERT VERIFICATION for field "sanctionsCheck":
[SERVER DEBUG] - Expected: "Approximately 2 million records per month"
[SERVER DEBUG] - Actual: "Approximately 2 million records per month"
[SERVER DEBUG] - Match: YES
[SERVER DEBUG] ✅ INSERT SUCCESSFUL for field "sanctionsCheck"
[SERVER DEBUG] --- Finished processing field "sanctionsCheck" ---

[SERVER DEBUG] Processing field: "dueDiligence" (ID: 29)
[SERVER DEBUG] Original value: Yes
[SERVER DEBUG] Normalized value: "Yes" (string)
[SERVER DEBUG] Field status: COMPLETE
[SERVER DEBUG] Existing response found: NO
[SERVER DEBUG] INSERTING new response for field "dueDiligence"
[SERVER DEBUG] - Value: "Yes" (string)
[SERVER DEBUG] - Status: COMPLETE
[SERVER DEBUG] ✅ INSERT VERIFICATION for field "dueDiligence":
[SERVER DEBUG] - Expected: "Yes"
[SERVER DEBUG] - Actual: "Yes"
[SERVER DEBUG] - Match: YES
[SERVER DEBUG] ✅ INSERT SUCCESSFUL for field "dueDiligence"
[SERVER DEBUG] --- Finished processing field "dueDiligence" ---

[SERVER DEBUG] Processing field: "regulatoryActions" (ID: 30)
[SERVER DEBUG] Original value: Yes
[SERVER DEBUG] Normalized value: "Yes" (string)
[SERVER DEBUG] Field status: COMPLETE
[SERVER DEBUG] Existing response found: NO
[SERVER DEBUG] INSERTING new response for field "regulatoryActions"
[SERVER DEBUG] - Value: "Yes" (string)
[SERVER DEBUG] - Status: COMPLETE
[SERVER DEBUG] ✅ INSERT VERIFICATION for field "regulatoryActions":
[SERVER DEBUG] - Expected: "Yes"
[SERVER DEBUG] - Actual: "Yes"
[SERVER DEBUG] - Match: YES
[SERVER DEBUG] ✅ INSERT SUCCESSFUL for field "regulatoryActions"
[SERVER DEBUG] --- Finished processing field "regulatoryActions" ---

[KYB API Debug] Using client-provided status: ready_for_submission
[WebSocket] Broadcasting task update for task 444: progress=100, status=ready_for_submission
[WebSocket] Broadcasting task update: {
  taskId: 444,
  status: 'ready_for_submission',
  progress: 100,
  metadata: { lastUpdated: '2025-04-20T15:31:07.920Z' }
}
===============================================
[SERVER DEBUG] PREPARING RESPONSE at 2025-04-20T15:31:10.673Z
[SERVER DEBUG] Found 30 fields in database after update
===============================================
[SERVER DEBUG] Checking field corporateRegistration in updated data: "No"
[SERVER DEBUG] Checking field goodStanding in updated data: "Yes"
[SERVER DEBUG] Checking field regulatoryActions in updated data: "Yes"
[SERVER DEBUG] Checking field investigationsIncidents in updated data: "No significant incidents in the past 3 years"
[SERVER DEBUG] No fields with value "asdf" found in response data
[SERVER DEBUG] Sending response with 30 fields, status: ready_for_submission, progress: 100%
[SERVER DEBUG] Updating task.savedFormData to ensure persistence across navigation
[SERVER DEBUG] ✅ Successfully updated task.savedFormData with latest form data
===============================================
3:31:10 PM [info] POST /api/kyb/progress 200 in 2873ms :: {"success":true,"savedData":{"progress":100,"status":"ready_for_submission","...
[Tasks Routes] Fetching task by ID: {
  taskId: 444,
  userCompanyId: 193,
  timestamp: '2025-04-20T15:31:10.802Z'
}
[Tasks Routes] Fetching latest KYB form data for task: 444
[Tasks Routes] Found 30 KYB responses for task 444
[Tasks Routes] Constructed form data with 30 fields
[Tasks Routes] Task found by ID: {
  taskId: 444,
  title: '1. KYB Form: DevelopmentTestingM',
  type: 'company_kyb',
  formDataFields: 30,
  timestamp: '2025-04-20T15:31:10.891Z'
}
3:31:10 PM [info] GET /api/tasks/444 200 in 118ms :: {"id":444,"title":"1. KYB Form: DevelopmentTestingM","description":"Complete ...
3:31:11 PM [warn] GET /api/companies/is-demo 400 in 30ms :: {"message":"Invalid company ID","code":"INVALID_ID"}
3:31:11 PM [info] GET /api/companies/193 304 in 60ms :: {"id":193,"name":"DevelopmentTestingM","description":"FinTech partner company...
[WebSocket] Received pong
[WebSocket] Received pong
[KYB API Debug] KYB save endpoint triggered: {
  endpoint: '/api/kyb/save',
  method: 'POST',
  url: '/api/kyb/save',
  headers: {
    contentType: 'application/json',
    accept: 'application/json',
    cookie: true
  },
  timestamp: '2025-04-20T15:31:18.228Z'
}
[KYB API Debug] User authenticated: {
  userId: 234,
  userEmail: 'email@m.com',
  companyId: 193,
  timestamp: '2025-04-20T15:31:18.228Z'
}
[2025-04-20T15:31:18.228Z] [DEBUG] [KYBRoutes] Save request received {"taskId":444,"formDataKeys":["legalEntityName","registrationNumber","incorporationDate","businessType","jurisdiction","registeredAddress","companyPhone","priorNames","licenses","goodStanding","corporateRegistration","externalAudit","controlEnvironment","authorizedSigners","governmentOwnership","ultimateBeneficialOwners","directorsAndOfficers","contactEmail","marketCapitalization","lifetimeCustomerValue","annualRecurringRevenue","monthlyRecurringRevenue","investigationsIncidents","financialStatements","operationalPolicies","dataVolume","dataTypes","sanctionsCheck","dueDiligence","regulatoryActions","completion_date"],"fileName":"kyb_form_444_2025-04-20T153118.csv","userId":234,"isSubmission":false}
[2025-04-20T15:31:18.287Z] [DEBUG] [FileCreationService] Starting file creation {"fileName":"kyb_form_444_2025-04-20T153118.csv","fileType":"text/csv","userId":183,"companyId":193}
[2025-04-20T15:31:18.287Z] [DEBUG] [FileCreationService] Storing KYB CSV content directly in database
[2025-04-20T15:31:18.323Z] [INFO] [FileCreationService] File created successfully {"fileId":730,"fileName":"kyb_form_444_2025-04-20T153118.csv","size":2161}
[SERVER DEBUG] Unlocking file vault access for company 193
[CompanyTabsService] Adding file-vault tab to company 193
[CompanyTabsService] Successfully unlocked file vault for company 193: {
  previousTabs: [ 'task-center' ],
  newTabs: [ 'task-center', 'file-vault' ]
}
[CompanyTabsService] Failed to broadcast WebSocket event: ReferenceError: require is not defined
    at Object.unlockFileVault (/home/runner/workspace/server/services/companyTabsService.ts:138:48)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async <anonymous> (/home/runner/workspace/server/routes/kyb.ts:1049:30)
[SERVER DEBUG] Successfully updated company tabs: {
  companyId: 193,
  availableTabs: [ 'task-center', 'file-vault' ],
  timestamp: '2025-04-20T15:31:18.395Z'
}
[2025-04-20T15:31:19.345Z] [INFO] [KYBRoutes] Save completed successfully {"taskId":444,"fileId":730,"responseCount":30,"warningCount":0}
3:31:19 PM [info] POST /api/kyb/save 200 in 1148ms :: {"success":true,"fileId":730}
[WebSocket] Received message: {
  type: 'submission_status',
  payload: {
    taskId: 444,
    status: 'submitted',
    timestamp: 1745163079377,
    source: 'client-emit'
  }
}
[WebSocket] Received message: {
  type: 'submission_status',
  payload: {
    taskId: 444,
    status: 'submitted',
    verified: false,
    message: 'Status verification failed, but form data was saved',
    source: 'client-emit',
    timestamp: 1745163079396
  }
}
[Tasks Routes] Fetching task by ID: {
  taskId: 444,
  userCompanyId: 193,
  timestamp: '2025-04-20T15:31:19.523Z'
}
[Tasks Routes] Fetching latest KYB form data for task: 444
3:31:19 PM [info] GET /api/tasks 304 in 29ms :: [{"id":444,"title":"1. KYB Form: DevelopmentTestingM","description":"Complete...
3:31:19 PM [info] GET /api/companies/current 304 in 31ms :: {"id":193,"name":"DevelopmentTestingM","description":"FinTech partner company...
[Tasks Routes] Found 60 KYB responses for task 444
[Tasks Routes] Constructed form data with 30 fields
[Tasks Routes] Task found by ID: {
  taskId: 444,
  title: '1. KYB Form: DevelopmentTestingM',
  type: 'company_kyb',
  formDataFields: 30,
  timestamp: '2025-04-20T15:31:19.612Z'
}
3:31:19 PM [info] GET /api/tasks/444 200 in 121ms :: {"id":444,"title":"1. KYB Form: DevelopmentTestingM","description":"Complete ...
3:31:19 PM [info] GET /api/tasks 304 in 32ms :: [{"id":444,"title":"1. KYB Form: DevelopmentTestingM","description":"Complete...
3:31:19 PM [info] GET /api/companies/current 304 in 30ms :: {"id":193,"name":"DevelopmentTestingM","description":"FinTech partner company...
[Tasks Routes] Fetching task by ID: {
  taskId: 444,
  userCompanyId: 193,
  timestamp: '2025-04-20T15:31:19.789Z'
}
[Tasks Routes] Fetching latest KYB form data for task: 444
[Tasks Routes] Found 60 KYB responses for task 444
[Tasks Routes] Constructed form data with 30 fields
[Tasks Routes] Task found by ID: {
  taskId: 444,
  title: '1. KYB Form: DevelopmentTestingM',
  type: 'company_kyb',
  formDataFields: 30,
  timestamp: '2025-04-20T15:31:19.880Z'
}
3:31:19 PM [info] GET /api/tasks/444 304 in 123ms :: {"id":444,"title":"1. KYB Form: DevelopmentTestingM","description":"Complete ...
3:31:19 PM [info] GET /api/tasks 304 in 34ms :: [{"id":444,"title":"1. KYB Form: DevelopmentTestingM","description":"Complete...
3:31:19 PM [info] GET /api/companies/current 304 in 29ms :: {"id":193,"name":"DevelopmentTestingM","description":"FinTech partner company...
[Tasks Routes] Fetching task by ID: {
  taskId: 444,
  userCompanyId: 193,
  timestamp: '2025-04-20T15:31:20.061Z'
}
[Tasks Routes] Fetching latest KYB form data for task: 444
3:31:20 PM [info] GET /api/tasks 304 in 31ms :: [{"id":444,"title":"1. KYB Form: DevelopmentTestingM","description":"Complete...
[Tasks Routes] Found 60 KYB responses for task 444
[Tasks Routes] Constructed form data with 30 fields
[Tasks Routes] Task found by ID: {
  taskId: 444,
  title: '1. KYB Form: DevelopmentTestingM',
  type: 'company_kyb',
  formDataFields: 30,
  timestamp: '2025-04-20T15:31:20.149Z'
}
3:31:20 PM [info] GET /api/tasks/444 304 in 118ms :: {"id":444,"title":"1. KYB Form: DevelopmentTestingM","description":"Complete ...
3:31:20 PM [info] GET /api/tasks 304 in 30ms :: [{"id":444,"title":"1. KYB Form: DevelopmentTestingM","description":"Complete...
3:31:20 PM [warn] GET /api/companies/is-demo 400 in 30ms :: {"message":"Invalid company ID","code":"INVALID_ID"}
3:31:20 PM [info] GET /api/tasks 304 in 29ms :: [{"id":444,"title":"1. KYB Form: DevelopmentTestingM","description":"Complete...
3:31:20 PM [info] GET /api/companies/193 200 in 62ms :: {"id":193,"name":"DevelopmentTestingM","description":"FinTech partner company...
3:31:20 PM [info] GET /api/tasks 304 in 30ms :: [{"id":444,"title":"1. KYB Form: DevelopmentTestingM","description":"Complete...
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 234, company_id: 193, email: 'email@m.com' }
[Tasks Routes] Fetching task by ID: {
  taskId: 444,
  userCompanyId: 193,
  timestamp: '2025-04-20T15:31:29.546Z'
}
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 234',
    condition2: 'tasks.created_by = 234',
    condition3: "tasks.company_id = 193 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('email@m.com')"
  }
}
[Tasks Routes] Fetching latest KYB form data for task: 444
[Tasks] Tasks found: { count: 4 }
3:31:29 PM [info] GET /api/tasks 200 in 88ms :: [{"id":445,"title":"2. Security Assessment: DevelopmentTestingM","description...
[Tasks Routes] Found 60 KYB responses for task 444
[Tasks Routes] Constructed form data with 30 fields
[Tasks Routes] Task found by ID: {
  taskId: 444,
  title: '1. KYB Form: DevelopmentTestingM',
  type: 'company_kyb',
  formDataFields: 30,
  timestamp: '2025-04-20T15:31:29.634Z'
}
3:31:29 PM [info] GET /api/tasks/444 304 in 118ms :: {"id":444,"title":"1. KYB Form: DevelopmentTestingM","description":"Complete ...
[Tasks Routes] Fetching task by ID: {
  taskId: 444,
  userCompanyId: 193,
  timestamp: '2025-04-20T15:31:29.809Z'
}
3:31:29 PM [info] GET /api/tasks 304 in 32ms :: [{"id":445,"title":"2. Security Assessment: DevelopmentTestingM","description...
[Tasks Routes] Fetching latest KYB form data for task: 444
[Tasks Routes] Found 60 KYB responses for task 444
[Tasks Routes] Constructed form data with 30 fields
[Tasks Routes] Task found by ID: {
  taskId: 444,
  title: '1. KYB Form: DevelopmentTestingM',
  type: 'company_kyb',
  formDataFields: 30,
  timestamp: '2025-04-20T15:31:29.895Z'
}
3:31:29 PM [info] GET /api/tasks/444 304 in 116ms :: {"id":444,"title":"1. KYB Form: DevelopmentTestingM","description":"Complete ...
3:31:29 PM [info] GET /api/tasks 304 in 30ms :: [{"id":445,"title":"2. Security Assessment: DevelopmentTestingM","description...
3:31:30 PM [info] GET /api/tasks 304 in 29ms :: [{"id":445,"title":"2. Security Assessment: DevelopmentTestingM","description...