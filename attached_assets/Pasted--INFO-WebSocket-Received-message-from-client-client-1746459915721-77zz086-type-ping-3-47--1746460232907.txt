[INFO] [WebSocket] Received message from client client-1746459915721-77zz086: { type: 'ping' }
3:47:45 PM [info] GET /api/companies/current 304 in 29ms :: {"id":268,"name":"DevTest13","category":"FinTech","is_demo":true,"revenue_tie...
3:47:48 PM [info] GET /api/companies/current 304 in 39ms :: {"id":268,"name":"DevTest13","category":"FinTech","is_demo":true,"revenue_tie...
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 311, company_id: 268, email: '13@e.com' }
[2025-05-05T15:47:50.214Z] [INFO] Performing dynamic task unlocking check for company {"companyId":268,"userId":311}
[2025-05-05T15:47:50.243Z] [INFO] No completed KYB tasks found, skipping security task unlock check {"companyId":268}
[Tasks] Automatically unlocking all tasks for company { userId: 311, companyId: 268, requestedBy: 'automatic_task_unlock' }
[2025-05-05T15:47:50.243Z] [INFO] [TaskDependencies] Unlocking ALL tasks for company {"companyId":268}
[2025-05-05T15:47:50.274Z] [INFO] [TaskDependencies] Found tasks to unlock {"companyId":268,"count":3,"taskIds":[742,744,743],"taskTypes":["company_kyb","open_banking","ky3p"],"ky3pTaskCount":1,"ky3pTaskIds":[743]}
[2025-05-05T15:47:50.306Z] [INFO] [UnifiedProgressCalc] Preserving existing progress for task 742 (company_kyb): 100% {"taskId":742,"taskType":"company_kyb","existingProgress":100,"operation":"preserve-existing"}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 100,
  currentStatus: 'ready_for_submission',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-05-05T15:47:50.336Z'
}
[STATUS DETERMINATION] Task has 100% progress but is not submitted, setting to READY_FOR_SUBMISSION
[2025-05-05T15:47:50.367Z] [INFO] [ProgressUpdate] Updated task 742 progress to 100% and status to ready_for_submission {"taskId":742,"taskType":"company_kyb","progress":100,"status":"ready_for_submission","previousStatus":"ready_for_submission"}
[2025-05-05T15:47:50.368Z] [DEBUG] Broadcasting task update with object format {"taskId":742,"status":"ready_for_submission"}
[WebSocket] Broadcast task_update to 3 clients (0 errors) { messageId: 'msg_1746460070368_ulk3vlded' }
[2025-05-05T15:47:50.369Z] [INFO] Successfully broadcasted task_update message 
[2025-05-05T15:47:50.369Z] [INFO] [ProgressUpdate] Broadcasted progress update for task 742 {"taskId":742,"progress":100,"status":"ready_for_submission"}
[2025-05-05T15:47:50.369Z] [INFO] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":268,"taskId":742,"taskType":"company_kyb","isKy3pTask":false,"calculatedProgress":100,"previousProgress":100,"wasPreserved":true}
[2025-05-05T15:47:50.398Z] [INFO] [UnifiedProgressCalc] Preserving existing progress for task 744 (open_banking): 14% {"taskId":744,"taskType":"open_banking","existingProgress":14,"operation":"preserve-existing"}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 14,
  currentStatus: 'in_progress',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-05-05T15:47:50.428Z'
}
[STATUS DETERMINATION] Task has partial progress, setting to IN_PROGRESS
[2025-05-05T15:47:50.459Z] [INFO] [ProgressUpdate] Updated task 744 progress to 14% and status to in_progress {"taskId":744,"taskType":"open_banking","progress":14,"status":"in_progress","previousStatus":"in_progress"}
[2025-05-05T15:47:50.460Z] [DEBUG] Broadcasting task update with object format {"taskId":744,"status":"in_progress"}
[WebSocket] Broadcast task_update to 3 clients (0 errors) { messageId: 'msg_1746460070460_w49q7fc11' }
[2025-05-05T15:47:50.461Z] [INFO] Successfully broadcasted task_update message 
[2025-05-05T15:47:50.461Z] [INFO] [ProgressUpdate] Broadcasted progress update for task 744 {"taskId":744,"progress":14,"status":"in_progress"}
[2025-05-05T15:47:50.461Z] [INFO] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":268,"taskId":744,"taskType":"open_banking","isKy3pTask":false,"calculatedProgress":14,"previousProgress":14,"wasPreserved":true}
[2025-05-05T15:47:50.461Z] [INFO] [TaskDependencies] Processing KY3P task {"taskId":743,"taskType":"ky3p","currentProgress":0,"currentStatus":"not_started","timestamp":"2025-05-05T15:47:50.461Z"}
[2025-05-05T15:47:50.551Z] [DEBUG] [UnifiedProgressCalc] KY3P progress calculation details: {"taskId":743,"totalFields":120,"completedFields":"0","fieldsWithResponses":120,"calculationMethod":"fields-with-responses"}
[2025-05-05T15:47:50.551Z] [INFO] [UnifiedProgressCalc] Calculated progress for task 743 (ky3p): 0/120 = 0% {"taskId":743,"taskType":"ky3p","totalFields":120,"completedFields":"0","progress":0}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-05-05T15:47:50.581Z'
}
[STATUS DETERMINATION] Task has 0% progress, setting to NOT_STARTED
[2025-05-05T15:47:50.611Z] [INFO] [ProgressUpdate] Updated task 743 progress to 0% and status to not_started {"taskId":743,"taskType":"ky3p","progress":0,"status":"not_started","previousStatus":"not_started"}
[2025-05-05T15:47:50.612Z] [DEBUG] Broadcasting task update with object format {"taskId":743,"status":"not_started"}
[WebSocket] Broadcast task_update to 3 clients (0 errors) { messageId: 'msg_1746460070612_b303bn0xq' }
[2025-05-05T15:47:50.612Z] [INFO] Successfully broadcasted task_update message 
[2025-05-05T15:47:50.612Z] [INFO] [ProgressUpdate] Broadcasted progress update for task 743 {"taskId":743,"progress":0,"status":"not_started"}
[2025-05-05T15:47:50.613Z] [INFO] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":268,"taskId":743,"taskType":"ky3p","isKy3pTask":true,"calculatedProgress":0,"previousProgress":0,"wasPreserved":false}
[2025-05-05T15:47:50.613Z] [INFO] [TaskDependencies] Successfully unlocked all tasks {"companyId":268,"count":3}
[Tasks] Successfully unlocked all tasks for company: 268
[Tasks] KYB tasks found: { count: 1 }