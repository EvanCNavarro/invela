> rest-express@1.0.0 dev
Database migrations disabled - schema already applied
[EmailService] Initializing email service
[EmailService] Email service initialized successfully
[OpenAI] Service initialized with API key: API key is set
[Auth] Setting up authentication...
[Auth] Authentication setup completed
[2025-04-25T19:33:51.566Z] [INFO] [OpenBankingRoutes] [OpenBankingRoutes] Setting up routes...
[Routes] Routes setup completed
[WebSocket] Server initialized on path: /ws
7:33:51 PM [info] Setting up Vite development server
7:33:51 PM [express] Server running on port 5000
New WebSocket client connected
New WebSocket client connected
New WebSocket client connected
New WebSocket client connected
New WebSocket client connected
New WebSocket client connected
[2025-04-25T19:33:56.367Z] New client connected to the pool (1/3)
[Auth] Deserializing user: 288
[Current Company] Fetching company for user: { userId: 288, companyId: 246 }
[Current Company] Found company: {
  id: 246,
  name: 'DevTest35',
  onboardingCompleted: false,
  riskScore: null,
  chosenScore: null,
  isDemo: true
}
7:33:56 PM [info] GET /api/companies/current 304 in 72ms :: {"id":246,"name":"DevTest35","category":"FinTech","is_demo":true,"revenue_tie...
WebSocket client disconnected with code 1001 and reason: 
WebSocket client disconnected with code 1001 and reason: 
WebSocket client disconnected with code 1001 and reason: 
WebSocket client disconnected with code 1001 and reason: 
WebSocket client disconnected with code 1001 and reason: 
WebSocket client disconnected with code 1001 and reason: 
7:34:02 PM [vite] warning: Duplicate member "clearCache" in class body
491|     * This is especially important for demo auto-fill functionality
492|     */
493|    public clearCache(): void {
   |           ^
494|      logger.info('[KY3P Form Service] Clearing form data cache');
495|      this._formData = null;

  Plugin: vite:esbuild
  File: /home/runner/workspace/client/src/services/ky3p-form-service.ts
[2025-04-25T19:34:03.272Z] New client connected to the pool (2/3)
[2025-04-25T19:34:03.356Z] New client connected to the pool (3/3)
[Auth] Unauthenticated user session
New WebSocket client connected
[Auth] Using cached user data: 288
WebSocket client disconnected with code 1001 and reason: 
[Auth] Using cached user data: 288
[Auth] Using cached user data: 288
[Auth] Using cached user data: 288
[Auth] Using cached user data: 288
[Auth] Using cached user data: 288
[Auth] Using cached user data: 288
[Auth] Using cached user data: 288
[Auth] Using cached user data: 288
[Auth] Using cached user data: 288
[Auth] Using cached user data: 288
[Auth] Using cached user data: 288
[Auth] Using cached user data: 288
[Auth] Returning user session data
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 288, company_id: 246, email: '35@e.com' }
[2025-04-25T19:34:10.887Z] [INFO] [KYBRoutes] Performing dynamic task unlocking check for company {"companyId":246,"userId":288}
[Current Company] Using cached company data: 246
[Tasks Routes] Fetching task by ID (special .json endpoint): {
  taskId: 654,
  userCompanyId: 246,
  timestamp: '2025-04-25T19:34:10.920Z'
}
[2025-04-25T19:34:10.923Z] [INFO] [KYBRoutes] No completed KYB tasks found, skipping security task unlock check {"companyId":246}
[Tasks] Automatically unlocking all tasks for company { userId: 288, companyId: 246, requestedBy: 'automatic_task_unlock' }
[2025-04-25T19:34:10.924Z] [INFO] [TaskDependencies] [TaskDependencies] Unlocking ALL tasks for company {"companyId":246}
7:34:10 PM [info] GET /api/companies/current 304 in 63ms :: {"id":246,"name":"DevTest35","category":"FinTech","is_demo":true,"revenue_tie...
[Tasks Routes] Task found by ID (special .json endpoint): {
  taskId: 654,
  title: '2. S&P KY3P Security Assessment: DevTest35',
  type: 'ky3p',
  formDataFields: 0,
  timestamp: '2025-04-25T19:34:10.954Z'
}
[2025-04-25T19:34:10.955Z] [INFO] [TaskDependencies] [TaskDependencies] Found tasks to unlock {"companyId":246,"count":3,"taskIds":[653,654,655],"taskTypes":["company_kyb","ky3p","open_banking"]}
7:34:10 PM [info] GET /api/tasks.json/654 304 in 65ms :: {"id":654,"title":"2. S&P KY3P Security Assessment: DevTest35","description":...
[2025-04-25T19:34:10.987Z] [INFO] [TaskDependencies] [TaskDependencies] Unlocked task {"companyId":246,"taskId":653,"taskType":"company_kyb"}
[WebSocket] Broadcast "task_updated" sent to 0 clients {
  type: 'task_updated',
  dataKeys: [ 'id', 'status', 'metadata', 'timestamp' ],
  timestamp: '2025-04-25T19:34:10.988Z',
  clientCount: 0
}
New WebSocket client connected
[2025-04-25T19:34:11.020Z] [INFO] [TaskDependencies] [TaskDependencies] Unlocked task {"companyId":246,"taskId":654,"taskType":"ky3p"}
[WebSocket] Broadcast "task_updated" sent to 1 clients {
  type: 'task_updated',
  dataKeys: [ 'id', 'status', 'metadata', 'timestamp' ],
  timestamp: '2025-04-25T19:34:11.020Z',
  clientCount: 1
}
[2025-04-25T19:34:11.053Z] [INFO] [TaskDependencies] [TaskDependencies] Unlocked task {"companyId":246,"taskId":655,"taskType":"open_banking"}
[WebSocket] Broadcast "task_updated" sent to 1 clients {
  type: 'task_updated',
  dataKeys: [ 'id', 'status', 'metadata', 'timestamp' ],
  timestamp: '2025-04-25T19:34:11.053Z',
  clientCount: 1
}
[2025-04-25T19:34:11.053Z] [INFO] [TaskDependencies] [TaskDependencies] Successfully unlocked all tasks {"companyId":246,"count":3}
[Tasks] Successfully unlocked all tasks for company: 246
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 288',
    condition2: 'tasks.created_by = 288',
    condition3: "tasks.company_id = 246 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('35@e.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
7:34:11 PM [info] GET /api/tasks 200 in 275ms :: [{"id":652,"title":"New User Invitation: 35@e.com","description":"Complete us...
7:34:11 PM [info] GET /api/tasks 304 in 33ms :: [{"id":652,"title":"New User Invitation: 35@e.com","description":"Complete us...
New WebSocket client connected
New WebSocket client connected
7:34:21 PM [info] GET /api/companies/current 304 in 32ms :: {"id":246,"name":"DevTest35","category":"FinTech","is_demo":true,"revenue_tie...
7:34:31 PM [info] GET /api/companies/current 304 in 31ms :: {"id":246,"name":"DevTest35","category":"FinTech","is_demo":true,"revenue_tie...
[WebSocket] Received ping
7:34:41 PM [info] GET /api/companies/current 304 in 38ms :: {"id":246,"name":"DevTest35","category":"FinTech","is_demo":true,"revenue_tie...
7:34:51 PM [info] GET /api/companies/current 304 in 32ms :: {"id":246,"name":"DevTest35","category":"FinTech","is_demo":true,"revenue_tie...
[Current Company] Fetching company for user: { userId: 288, companyId: 246 }
[Current Company] Found company: {
  id: 246,
  name: 'DevTest35',
  onboardingCompleted: false,
  riskScore: null,
  chosenScore: null,
  isDemo: true
}
7:35:02 PM [info] GET /api/companies/current 304 in 72ms :: {"id":246,"name":"DevTest35","category":"FinTech","is_demo":true,"revenue_tie...
[WebSocket] Received ping
7:35:12 PM [info] GET /api/companies/current 304 in 31ms :: {"id":246,"name":"DevTest35","category":"FinTech","is_demo":true,"revenue_tie...
7:35:22 PM [info] GET /api/companies/current 304 in 33ms :: {"id":246,"name":"DevTest35","category":"FinTech","is_demo":true,"revenue_tie...
[Auth] Using cached user data: 288
7:35:32 PM [info] GET /api/companies/current 304 in 34ms :: {"id":246,"name":"DevTest35","category":"FinTech","is_demo":true,"revenue_tie...
[WebSocket] Received ping
7:35:42 PM [info] GET /api/companies/current 304 in 31ms :: {"id":246,"name":"DevTest35","category":"FinTech","is_demo":true,"revenue_tie...
7:35:53 PM [info] GET /api/companies/current 304 in 34ms :: {"id":246,"name":"DevTest35","category":"FinTech","is_demo":true,"revenue_tie...
[Current Company] Fetching company for user: { userId: 288, companyId: 246 }
[Current Company] Found company: {
  id: 246,
  name: 'DevTest35',
  onboardingCompleted: false,
  riskScore: null,
  chosenScore: null,
  isDemo: true
}
7:36:03 PM [info] GET /api/companies/current 304 in 62ms :: {"id":246,"name":"DevTest35","category":"FinTech","is_demo":true,"revenue_tie...
[WebSocket] Received ping
[WebSocket] Received ping
7:36:13 PM [info] GET /api/companies/current 304 in 37ms :: {"id":246,"name":"DevTest35","category":"FinTech","is_demo":true,"revenue_tie...
WebSocket client disconnected with code 1005 and reason: 
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 288, company_id: 246, email: '35@e.com' }
[2025-04-25T19:36:23.145Z] [INFO] [KYBRoutes] Performing dynamic task unlocking check for company {"companyId":246,"userId":288}
[2025-04-25T19:36:23.180Z] [INFO] [KYBRoutes] No completed KYB tasks found, skipping security task unlock check {"companyId":246}
[Tasks] Automatically unlocking all tasks for company { userId: 288, companyId: 246, requestedBy: 'automatic_task_unlock' }
[2025-04-25T19:36:23.182Z] [INFO] [TaskDependencies] [TaskDependencies] Unlocking ALL tasks for company {"companyId":246}
Suppressing further connection logs. Pool size: 3
[2025-04-25T19:36:23.213Z] [INFO] [TaskDependencies] [TaskDependencies] Found tasks to unlock {"companyId":246,"count":3,"taskIds":[654,653,655],"taskTypes":["ky3p","company_kyb","open_banking"]}
[2025-04-25T19:36:23.246Z] [INFO] [TaskDependencies] [TaskDependencies] Unlocked task {"companyId":246,"taskId":654,"taskType":"ky3p"}
[WebSocket] Broadcast "task_updated" sent to 2 clients {
  type: 'task_updated',
  dataKeys: [ 'id', 'status', 'metadata', 'timestamp' ],
  timestamp: '2025-04-25T19:36:23.246Z',
  clientCount: 2
}
[2025-04-25T19:36:23.278Z] [INFO] [TaskDependencies] [TaskDependencies] Unlocked task {"companyId":246,"taskId":653,"taskType":"company_kyb"}
[WebSocket] Broadcast "task_updated" sent to 2 clients {
  type: 'task_updated',
  dataKeys: [ 'id', 'status', 'metadata', 'timestamp' ],
  timestamp: '2025-04-25T19:36:23.278Z',
  clientCount: 2
}
7:36:23 PM [info] GET /api/companies/current 304 in 31ms :: {"id":246,"name":"DevTest35","category":"FinTech","is_demo":true,"revenue_tie...
[2025-04-25T19:36:23.308Z] [INFO] [TaskDependencies] [TaskDependencies] Unlocked task {"companyId":246,"taskId":655,"taskType":"open_banking"}
[WebSocket] Broadcast "task_updated" sent to 2 clients {
  type: 'task_updated',
  dataKeys: [ 'id', 'status', 'metadata', 'timestamp' ],
  timestamp: '2025-04-25T19:36:23.308Z',
  clientCount: 2
}
[2025-04-25T19:36:23.309Z] [INFO] [TaskDependencies] [TaskDependencies] Successfully unlocked all tasks {"companyId":246,"count":3}
[Tasks] Successfully unlocked all tasks for company: 246
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 288',
    condition2: 'tasks.created_by = 288',
    condition3: "tasks.company_id = 246 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('35@e.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
7:36:23 PM [info] GET /api/tasks 200 in 255ms :: [{"id":652,"title":"New User Invitation: 35@e.com","description":"Complete us...
7:36:23 PM [info] GET /api/tasks 304 in 32ms :: [{"id":652,"title":"New User Invitation: 35@e.com","description":"Complete us...
7:36:24 PM [info] GET /api/companies/current 304 in 33ms :: {"id":246,"name":"DevTest35","category":"FinTech","is_demo":true,"revenue_tie...
New WebSocket client connected
New WebSocket client connected
[Auth] Returning user session data
[Tasks Routes] Updating task progress: { taskId: 654, timestamp: '2025-04-25T19:36:29.299Z' }
[Task Reconciliation] Found 0 responses for task 654 (type: ky3p)
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-04-25T19:36:29.361Z'
}
[STATUS DETERMINATION] Task has 0% progress, setting to NOT_STARTED
[Task Reconciliation] Progress calculation: {
  taskId: 654,
  currentProgress: 0,
  calculatedProgress: 0,
  currentStatus: 'not_started',
  calculatedStatus: 'not_started',
  responseCount: 0,
  completeCount: 0
}
[Task Reconciliation] Correcting task 654: {
  progressFrom: 0,
  progressTo: 0,
  statusFrom: 'not_started',
  statusTo: 'not_started',
  forceUpdate: true
}
[Task Templates API] Fetching template for task type: ky3p, user: 288
[Progress Utils] Broadcasting task progress update: {
  taskId: 654,
  progress: 0,
  requestedStatus: 'not_started',
  finalStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  timestamp: '2025-04-25T19:36:29.397Z'
}
[WebSocket] Broadcast "task_updated" sent to 4 clients {
  type: 'task_updated',
  dataKeys: [ 'id', 'status', 'progress', 'metadata', 'timestamp' ],
  timestamp: '2025-04-25T19:36:29.398Z',
  clientCount: 4
}
[Task Templates API] Found template: 48 (S&P KY3P Security Assessment) for task type: ky3p
[Tasks Routes] Task progress reconciled: {
  taskId: 654,
  progress: 0,
  status: 'not_started',
  timestamp: '2025-04-25T19:36:29.429Z'
}
[Task Templates API] Retrieved 10 configuration items for template ID: 48
7:36:29 PM [info] POST /api/tasks/654/update-progress 200 in 160ms :: {"success":true,"progress":0,"status":"not_started","taskId":654}
7:36:29 PM [info] GET /api/task-templates/by-type/ky3p 304 in 99ms :: {"id":48,"name":"S&P KY3P Security Assessment","description":"S&P KY3P Securi...
[Tasks Routes] Fetching task by ID (special .json endpoint): {
  taskId: 654,
  userCompanyId: 246,
  timestamp: '2025-04-25T19:36:29.548Z'
}
[Tasks Routes] Task found by ID (special .json endpoint): {
  taskId: 654,
  title: '2. S&P KY3P Security Assessment: DevTest35',
  type: 'ky3p',
  formDataFields: 0,
  timestamp: '2025-04-25T19:36:29.584Z'
}
7:36:29 PM [info] GET /api/tasks.json/654 200 in 75ms :: {"id":654,"title":"2. S&P KY3P Security Assessment: DevTest35","description":...
[Tasks Routes] Updating task progress: { taskId: 654, timestamp: '2025-04-25T19:36:29.650Z' }
[2025-04-25T19:36:29.652Z] [INFO] [KY3PRoutes] [KY3P API] Fetching KY3P fields. User authenticated: true
[Task Reconciliation] Found 0 responses for task 654 (type: ky3p)
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-04-25T19:36:29.715Z'
}
[STATUS DETERMINATION] Task has 0% progress, setting to NOT_STARTED
[Task Reconciliation] Progress calculation: {
  taskId: 654,
  currentProgress: 0,
  calculatedProgress: 0,
  currentStatus: 'not_started',
  calculatedStatus: 'not_started',
  responseCount: 0,
  completeCount: 0
}
[Task Reconciliation] Correcting task 654: {
  progressFrom: 0,
  progressTo: 0,
  statusFrom: 'not_started',
  statusTo: 'not_started',
  forceUpdate: true
}
[2025-04-25T19:36:29.744Z] [INFO] [KY3PRoutes] [KY3P API] Successfully retrieved 120 KY3P fields
[2025-04-25T19:36:29.744Z] [INFO] [KY3PRoutes] [KY3P API] Fields grouped by step: ["Step 0: 120 fields"]
[Progress Utils] Broadcasting task progress update: {
  taskId: 654,
  progress: 0,
  requestedStatus: 'not_started',
  finalStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  timestamp: '2025-04-25T19:36:29.752Z'
}
[WebSocket] Broadcast "task_updated" sent to 4 clients {
  type: 'task_updated',
  dataKeys: [ 'id', 'status', 'progress', 'metadata', 'timestamp' ],
  timestamp: '2025-04-25T19:36:29.752Z',
  clientCount: 4
}
[Tasks Routes] Fetching task by ID (special .json endpoint): {
  taskId: 654,
  userCompanyId: 246,
  timestamp: '2025-04-25T19:36:29.778Z'
}
7:36:29 PM [info] GET /api/ky3p-fields 304 in 128ms :: [{"id":1,"order":1,"field_key":"externalSystems","display_name":"External Sys...
[Tasks Routes] Task progress reconciled: {
  taskId: 654,
  progress: 0,
  status: 'not_started',
  timestamp: '2025-04-25T19:36:29.783Z'
}
[Tasks Routes] Task found by ID (special .json endpoint): {
  taskId: 654,
  title: '2. S&P KY3P Security Assessment: DevTest35',
  type: 'ky3p',
  formDataFields: 0,
  timestamp: '2025-04-25T19:36:29.813Z'
}
7:36:29 PM [info] POST /api/tasks/654/update-progress 200 in 164ms :: {"success":true,"progress":0,"status":"not_started","taskId":654}
7:36:29 PM [info] GET /api/tasks.json/654 200 in 67ms :: {"id":654,"title":"2. S&P KY3P Security Assessment: DevTest35","description":...
[KYB API Debug] Loading progress for task: 654
[Tasks Routes] Updating task progress: { taskId: 654, timestamp: '2025-04-25T19:36:29.932Z' }
[Task Reconciliation] Found 0 responses for task 654 (type: ky3p)
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-04-25T19:36:29.992Z'
}
[STATUS DETERMINATION] Task has 0% progress, setting to NOT_STARTED
[Task Reconciliation] Progress calculation: {
  taskId: 654,
  currentProgress: 0,
  calculatedProgress: 0,
  currentStatus: 'not_started',
  calculatedStatus: 'not_started',
  responseCount: 0,
  completeCount: 0
}
[Task Reconciliation] No updates needed for task 654
[Task Reconciliation] Found 0 responses for task 654 (type: ky3p)
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-04-25T19:36:29.992Z'
}
[STATUS DETERMINATION] Task has 0% progress, setting to NOT_STARTED
[Task Reconciliation] Progress calculation: {
  taskId: 654,
  currentProgress: 0,
  calculatedProgress: 0,
  currentStatus: 'not_started',
  calculatedStatus: 'not_started',
  responseCount: 0,
  completeCount: 0
}
[Task Reconciliation] Correcting task 654: {
  progressFrom: 0,
  progressTo: 0,
  statusFrom: 'not_started',
  statusTo: 'not_started',
  forceUpdate: true
}
[Tasks Routes] Fetching task by ID (special .json endpoint): {
  taskId: 654,
  userCompanyId: 246,
  timestamp: '2025-04-25T19:36:29.999Z'
}
[KYB API Debug] Retrieved task: {
  taskId: 654,
  status: 'not_started',
  progress: 0,
  metadata: [
    'locked',
    'company_id',
    'created_at',
    'created_via',
    'status_flow',
    'company_name',
    'last_updated',
    'created_by_id',
    'progressHistory',
    'prerequisite_for',
    'prerequisite_task_id',
    'prerequisite_completed',
    'prerequisite_task_type',
    'prerequisite_completed_at',
    'lastProgressReconciliation'
  ],
  timestamp: '2025-04-25T19:36:30.022Z'
}
[Progress Utils] Broadcasting task progress update: {
  taskId: 654,
  progress: 0,
  requestedStatus: 'not_started',
  finalStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  timestamp: '2025-04-25T19:36:30.025Z'
}
[WebSocket] Broadcast "task_updated" sent to 4 clients {
  type: 'task_updated',
  dataKeys: [ 'id', 'status', 'progress', 'metadata', 'timestamp' ],
  timestamp: '2025-04-25T19:36:30.025Z',
  clientCount: 4
}
[Tasks Routes] Task found by ID (special .json endpoint): {
  taskId: 654,
  title: '2. S&P KY3P Security Assessment: DevTest35',
  type: 'ky3p',
  formDataFields: 0,
  timestamp: '2025-04-25T19:36:30.030Z'
}
[KYB API Debug] Retrieved responses: { responseCount: 0, fields: [], timestamp: '2025-04-25T19:36:30.051Z' }
[SERVER DEBUG] No savedFormData found in task table
[SERVER DEBUG] No KYB form file ID found in task metadata
[KYB API Debug] Retrieved task data: {
  id: 654,
  responseCount: 0,
  progress: 0,
  status: 'not_started',
  formDataKeys: []
}
===============================================
[SERVER DEBUG] PREPARING GET RESPONSE at 2025-04-25T19:36:30.052Z
[SERVER DEBUG] Task ID: 654, Found 0 fields in database
===============================================
[SERVER DEBUG] Checking field corporateRegistration in retrieved data: NOT PRESENT
[SERVER DEBUG] Checking field goodStanding in retrieved data: NOT PRESENT
[SERVER DEBUG] Checking field regulatoryActions in retrieved data: NOT PRESENT
[SERVER DEBUG] Checking field investigationsIncidents in retrieved data: NOT PRESENT
[SERVER DEBUG] No fields with value "asdf" found in GET response data
[SERVER DEBUG] Sending GET response with 0 fields, status: not_started, progress: 0%
===============================================
[Tasks Routes] Task progress reconciled: {
  taskId: 654,
  progress: 0,
  status: 'not_started',
  timestamp: '2025-04-25T19:36:30.056Z'
}
7:36:30 PM [info] GET /api/tasks.json/654 200 in 65ms :: {"id":654,"title":"2. S&P KY3P Security Assessment: DevTest35","description":...
7:36:30 PM [info] GET /api/kyb/progress/654 304 in 154ms :: {"formData":{},"progress":0,"status":"not_started"}
7:36:30 PM [info] POST /api/tasks/654/update-progress 200 in 155ms :: {"success":true,"progress":0,"status":"not_started","taskId":654}
[Auth] Using cached user data: 288
[Tasks Routes] Fetching task by ID (special .json endpoint): {
  taskId: 654,
  userCompanyId: 246,
  timestamp: '2025-04-25T19:36:30.209Z'
}
[KYB API Debug] Loading progress for task: 654
[Tasks Routes] Task found by ID (special .json endpoint): {
  taskId: 654,
  title: '2. S&P KY3P Security Assessment: DevTest35',
  type: 'ky3p',
  formDataFields: 0,
  timestamp: '2025-04-25T19:36:30.238Z'
}
7:36:30 PM [info] GET /api/tasks.json/654 304 in 60ms :: {"id":654,"title":"2. S&P KY3P Security Assessment: DevTest35","description":...
[Task Reconciliation] Found 0 responses for task 654 (type: ky3p)
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-04-25T19:36:30.293Z'
}
[STATUS DETERMINATION] Task has 0% progress, setting to NOT_STARTED
[Task Reconciliation] Progress calculation: {
  taskId: 654,
  currentProgress: 0,
  calculatedProgress: 0,
  currentStatus: 'not_started',
  calculatedStatus: 'not_started',
  responseCount: 0,
  completeCount: 0
}
[Task Reconciliation] No updates needed for task 654
[KYB API Debug] Retrieved task: {
  taskId: 654,
  status: 'not_started',
  progress: 0,
  metadata: [
    'locked',
    'company_id',
    'created_at',
    'created_via',
    'status_flow',
    'company_name',
    'last_updated',
    'created_by_id',
    'progressHistory',
    'prerequisite_for',
    'prerequisite_task_id',
    'prerequisite_completed',
    'prerequisite_task_type',
    'prerequisite_completed_at',
    'lastProgressReconciliation'
  ],
  timestamp: '2025-04-25T19:36:30.327Z'
}
[KYB API Debug] Retrieved responses: { responseCount: 0, fields: [], timestamp: '2025-04-25T19:36:30.356Z' }
[SERVER DEBUG] No savedFormData found in task table
[SERVER DEBUG] No KYB form file ID found in task metadata
[KYB API Debug] Retrieved task data: {
  id: 654,
  responseCount: 0,
  progress: 0,
  status: 'not_started',
  formDataKeys: []
}
===============================================
[SERVER DEBUG] PREPARING GET RESPONSE at 2025-04-25T19:36:30.357Z
[SERVER DEBUG] Task ID: 654, Found 0 fields in database
===============================================
[SERVER DEBUG] Checking field corporateRegistration in retrieved data: NOT PRESENT
[SERVER DEBUG] Checking field goodStanding in retrieved data: NOT PRESENT
[SERVER DEBUG] Checking field regulatoryActions in retrieved data: NOT PRESENT
[SERVER DEBUG] Checking field investigationsIncidents in retrieved data: NOT PRESENT
[SERVER DEBUG] No fields with value "asdf" found in GET response data
[SERVER DEBUG] Sending GET response with 0 fields, status: not_started, progress: 0%
===============================================
7:36:30 PM [info] GET /api/kyb/progress/654 304 in 155ms :: {"formData":{},"progress":0,"status":"not_started"}
[Tasks Routes] Fetching task by ID (special .json endpoint): {
  taskId: 654,
  userCompanyId: 246,
  timestamp: '2025-04-25T19:36:30.416Z'
}
[Tasks Routes] Task found by ID (special .json endpoint): {
  taskId: 654,
  title: '2. S&P KY3P Security Assessment: DevTest35',
  type: 'ky3p',
  formDataFields: 0,
  timestamp: '2025-04-25T19:36:30.445Z'
}
7:36:30 PM [info] GET /api/tasks.json/654 304 in 65ms :: {"id":654,"title":"2. S&P KY3P Security Assessment: DevTest35","description":...
[Tasks Routes] Updating task progress: { taskId: 654, timestamp: '2025-04-25T19:36:30.563Z' }
[Task Reconciliation] Found 0 responses for task 654 (type: ky3p)
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-04-25T19:36:30.624Z'
}
[STATUS DETERMINATION] Task has 0% progress, setting to NOT_STARTED
[Task Reconciliation] Progress calculation: {
  taskId: 654,
  currentProgress: 0,
  calculatedProgress: 0,
  currentStatus: 'not_started',
  calculatedStatus: 'not_started',
  responseCount: 0,
  completeCount: 0
}
[Task Reconciliation] Correcting task 654: {
  progressFrom: 0,
  progressTo: 0,
  statusFrom: 'not_started',
  statusTo: 'not_started',
  forceUpdate: true
}
[Auth] Using cached user data: 288
[Tasks Routes] Fetching task by ID (special .json endpoint): {
  taskId: 654,
  userCompanyId: 246,
  timestamp: '2025-04-25T19:36:30.626Z'
}
[Tasks Routes] Task found by ID (special .json endpoint): {
  taskId: 654,
  title: '2. S&P KY3P Security Assessment: DevTest35',
  type: 'ky3p',
  formDataFields: 0,
  timestamp: '2025-04-25T19:36:30.656Z'
}
[Progress Utils] Broadcasting task progress update: {
  taskId: 654,
  progress: 0,
  requestedStatus: 'not_started',
  finalStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  timestamp: '2025-04-25T19:36:30.657Z'
}
[WebSocket] Broadcast "task_updated" sent to 4 clients {
  type: 'task_updated',
  dataKeys: [ 'id', 'status', 'progress', 'metadata', 'timestamp' ],
  timestamp: '2025-04-25T19:36:30.657Z',
  clientCount: 4
}
7:36:30 PM [info] GET /api/tasks.json/654 304 in 62ms :: {"id":654,"title":"2. S&P KY3P Security Assessment: DevTest35","description":...
[Tasks Routes] Task progress reconciled: {
  taskId: 654,
  progress: 0,
  status: 'not_started',
  timestamp: '2025-04-25T19:36:30.690Z'
}
7:36:30 PM [info] POST /api/tasks/654/update-progress 200 in 162ms :: {"success":true,"progress":0,"status":"not_started","taskId":654}
[Tasks Routes] Fetching task by ID (special .json endpoint): {
  taskId: 654,
  userCompanyId: 246,
  timestamp: '2025-04-25T19:36:30.836Z'
}
[Tasks Routes] Task found by ID (special .json endpoint): {
  taskId: 654,
  title: '2. S&P KY3P Security Assessment: DevTest35',
  type: 'ky3p',
  formDataFields: 0,
  timestamp: '2025-04-25T19:36:30.866Z'
}
7:36:30 PM [info] GET /api/tasks.json/654 200 in 61ms :: {"id":654,"title":"2. S&P KY3P Security Assessment: DevTest35","description":...
[Tasks Routes] Fetching task by ID (special .json endpoint): {
  taskId: 654,
  userCompanyId: 246,
  timestamp: '2025-04-25T19:36:31.049Z'
}
[Tasks Routes] Task found by ID (special .json endpoint): {
  taskId: 654,
  title: '2. S&P KY3P Security Assessment: DevTest35',
  type: 'ky3p',
  formDataFields: 0,
  timestamp: '2025-04-25T19:36:31.082Z'
}
7:36:31 PM [info] GET /api/tasks.json/654 304 in 66ms :: {"id":654,"title":"2. S&P KY3P Security Assessment: DevTest35","description":...
[2025-04-25T19:36:31.610Z] [INFO] [KY3PDemoAutofill] Demo auto-fill requested for KY3P task {"taskId":654,"userId":288}
[2025-04-25T19:36:31.731Z] [INFO] [KY3PDemoAutofill] Found 120 KY3P fields with demo values for task 654
[2025-04-25T19:36:31.763Z] [INFO] [KY3PDemoAutofill] Cleared existing responses for task 654
[2025-04-25T19:36:33.025Z] [INFO] [KY3PDemoAutofill] Successfully inserted 120 KY3P responses for task 654
[2025-04-25T19:36:33.055Z] [INFO] [KY3PDemoAutofill] Updated task progress after demo auto-fill {"taskId":654,"progress":100,"status":"ready_for_submission"}
[WebSocket] Broadcast "task_updated" sent to 4 clients {
  type: 'task_updated',
  dataKeys: [ 'id', 'taskId', 'status', 'progress', 'source', 'timestamp' ],
  timestamp: '2025-04-25T19:36:33.055Z',
  clientCount: 4
}
7:36:33 PM [info] POST /api/ky3p/demo-autofill/654 200 in 1476ms :: {"success":true,"message":"KY3P form auto-filled with demo data","responsesIn...
[Tasks Routes] Fetching task by ID (special .json endpoint): {
  taskId: 654,
  userCompanyId: 246,
  timestamp: '2025-04-25T19:36:33.255Z'
}
[Tasks Routes] Updating task progress: { taskId: 654, timestamp: '2025-04-25T19:36:33.260Z' }
[Tasks Routes] Task found by ID (special .json endpoint): {
  taskId: 654,
  title: '2. S&P KY3P Security Assessment: DevTest35',
  type: 'ky3p',
  formDataFields: 0,
  timestamp: '2025-04-25T19:36:33.283Z'
}
[Tasks Routes] Updating task progress: { taskId: 654, timestamp: '2025-04-25T19:36:33.291Z' }
7:36:33 PM [info] GET /api/tasks.json/654 200 in 59ms :: {"id":654,"title":"2. S&P KY3P Security Assessment: DevTest35","description":...
[Task Reconciliation] Found 0 responses for task 654 (type: ky3p)
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'ready_for_submission',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-04-25T19:36:33.318Z'
}
[STATUS DETERMINATION] Task has 0% progress, setting to NOT_STARTED
[Task Reconciliation] Progress calculation: {
  taskId: 654,
  currentProgress: 100,
  calculatedProgress: 0,
  currentStatus: 'ready_for_submission',
  calculatedStatus: 'not_started',
  responseCount: 0,
  completeCount: 0
}
[Task Reconciliation] Correcting task 654: {
  progressFrom: 100,
  progressTo: 0,
  statusFrom: 'ready_for_submission',
  statusTo: 'not_started',
  forceUpdate: true
}
[Task Reconciliation] Found 0 responses for task 654 (type: ky3p)
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'ready_for_submission',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  timestamp: '2025-04-25T19:36:33.348Z'
}
[STATUS DETERMINATION] Task has 0% progress, setting to NOT_STARTED
[Task Reconciliation] Progress calculation: {
  taskId: 654,
  currentProgress: 100,
  calculatedProgress: 0,
  currentStatus: 'ready_for_submission',
  calculatedStatus: 'not_started',
  responseCount: 0,
  completeCount: 0
}
[Task Reconciliation] Correcting task 654: {
  progressFrom: 100,
  progressTo: 0,
  statusFrom: 'ready_for_submission',
  statusTo: 'not_started',
  forceUpdate: true
}
[Progress Utils] Broadcasting task progress update: {
  taskId: 654,
  progress: 0,
  requestedStatus: 'not_started',
  finalStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  timestamp: '2025-04-25T19:36:33.349Z'
}
[WebSocket] Broadcast "task_updated" sent to 4 clients {
  type: 'task_updated',
  dataKeys: [ 'id', 'status', 'progress', 'metadata', 'timestamp' ],
  timestamp: '2025-04-25T19:36:33.349Z',
  clientCount: 4
}
[Tasks Routes] Task progress reconciled: {
  taskId: 654,
  progress: 0,
  status: 'not_started',
  timestamp: '2025-04-25T19:36:33.379Z'
}
[Progress Utils] Broadcasting task progress update: {
  taskId: 654,
  progress: 0,
  requestedStatus: 'not_started',
  finalStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  timestamp: '2025-04-25T19:36:33.380Z'
}
[WebSocket] Broadcast "task_updated" sent to 4 clients {
  type: 'task_updated',
  dataKeys: [ 'id', 'status', 'progress', 'metadata', 'timestamp' ],
  timestamp: '2025-04-25T19:36:33.380Z',
  clientCount: 4
}
[Tasks Routes] Task progress reconciled: {
  taskId: 654,
  progress: 0,
  status: 'not_started',
  timestamp: '2025-04-25T19:36:33.409Z'
}
7:36:33 PM [info] POST /api/tasks/654/update-progress 200 in 149ms :: {"success":true,"progress":0,"status":"not_started","taskId":654}
7:36:33 PM [info] POST /api/tasks/654/update-progress 200 in 147ms :: {"success":true,"progress":0,"status":"not_started","taskId":654}
[Tasks Routes] Fetching task by ID (special .json endpoint): {
  taskId: 654,
  userCompanyId: 246,
  timestamp: '2025-04-25T19:36:33.461Z'
}
[Tasks Routes] Task found by ID (special .json endpoint): {
  taskId: 654,
  title: '2. S&P KY3P Security Assessment: DevTest35',
  type: 'ky3p',
  formDataFields: 0,
  timestamp: '2025-04-25T19:36:33.490Z'
}
7:36:33 PM [info] GET /api/tasks.json/654 200 in 60ms :: {"id":654,"title":"2. S&P KY3P Security Assessment: DevTest35","description":...
[Tasks Routes] Fetching task by ID (special .json endpoint): {
  taskId: 654,
  userCompanyId: 246,
  timestamp: '2025-04-25T19:36:33.678Z'
}
[Tasks Routes] Task found by ID (special .json endpoint): {
  taskId: 654,
  title: '2. S&P KY3P Security Assessment: DevTest35',
  type: 'ky3p',
  formDataFields: 0,
  timestamp: '2025-04-25T19:36:33.707Z'
}
7:36:33 PM [info] GET /api/tasks.json/654 304 in 59ms :: {"id":654,"title":"2. S&P KY3P Security Assessment: DevTest35","description":...
[Tasks Routes] Fetching task by ID (special .json endpoint): {
  taskId: 654,
  userCompanyId: 246,
  timestamp: '2025-04-25T19:36:33.884Z'
}
[Tasks Routes] Task found by ID (special .json endpoint): {
  taskId: 654,
  title: '2. S&P KY3P Security Assessment: DevTest35',
  type: 'ky3p',
  formDataFields: 0,
  timestamp: '2025-04-25T19:36:33.914Z'
}
7:36:33 PM [info] GET /api/tasks.json/654 304 in 60ms :: {"id":654,"title":"2. S&P KY3P Security Assessment: DevTest35","description":...
[Tasks Routes] Fetching task by ID (special .json endpoint): {
  taskId: 654,
  userCompanyId: 246,
  timestamp: '2025-04-25T19:36:34.092Z'
}
[Tasks Routes] Task found by ID (special .json endpoint): {
  taskId: 654,
  title: '2. S&P KY3P Security Assessment: DevTest35',
  type: 'ky3p',
  formDataFields: 0,
  timestamp: '2025-04-25T19:36:34.122Z'
}
7:36:34 PM [info] GET /api/tasks.json/654 304 in 61ms :: {"id":654,"title":"2. S&P KY3P Security Assessment: DevTest35","description":...
[Tasks Routes] Fetching task by ID (special .json endpoint): {
  taskId: 654,
  userCompanyId: 246,
  timestamp: '2025-04-25T19:36:34.298Z'
}
[Tasks Routes] Task found by ID (special .json endpoint): {
  taskId: 654,
  title: '2. S&P KY3P Security Assessment: DevTest35',
  type: 'ky3p',
  formDataFields: 0,
  timestamp: '2025-04-25T19:36:34.332Z'
}
7:36:34 PM [info] GET /api/tasks.json/654 304 in 64ms :: {"id":654,"title":"2. S&P KY3P Security Assessment: DevTest35","description":...
7:36:34 PM [info] GET /api/companies/current 304 in 31ms :: {"id":246,"name":"DevTest35","category":"FinTech","is_demo":true,"revenue_tie...
[WebSocket] Received ping
7:36:44 PM [info] GET /api/companies/current 304 in 32ms :: {"id":246,"name":"DevTest35","category":"FinTech","is_demo":true,"revenue_tie...
7:36:54 PM [info] GET /api/companies/current 304 in 31ms :: {"id":246,"name":"DevTest35","category":"FinTech","is_demo":true,"revenue_tie...
[Current Company] Fetching company for user: { userId: 288, companyId: 246 }
[Current Company] Found company: {
  id: 246,
  name: 'DevTest35',
  onboardingCompleted: false,
  riskScore: null,
  chosenScore: null,
  isDemo: true
}
7:37:05 PM [info] GET /api/companies/current 304 in 62ms :: {"id":246,"name":"DevTest35","category":"FinTech","is_demo":true,"revenue_tie...
