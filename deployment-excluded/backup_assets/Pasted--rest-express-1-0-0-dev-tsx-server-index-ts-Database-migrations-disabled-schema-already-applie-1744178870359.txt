> rest-express@1.0.0 dev
> tsx server/index.ts

Database migrations disabled - schema already applied
[EmailService] Initializing email service
[EmailService] Email service initialized successfully
[Auth] Setting up authentication...
[Auth] Authentication setup completed
[Routes] Routes setup completed
[WebSocket] Server initialized on path: /ws
6:05:53 AM [info] Setting up Vite development server
6:05:54 AM [express] Server running on port 5000
[2025-04-09T06:05:54.515Z] New client connected to the pool (1/3)
[Auth] Deserializing user: 199
[2025-04-09T06:05:55.190Z] New client connected to the pool (2/3)
[2025-04-09T06:05:58.043Z] New client connected to the pool (3/3)
[Auth] Using cached user data: 199
[Auth] Using cached user data: 199
[Auth] Using cached user data: 199
[Auth] Using cached user data: 199
[Auth] Using cached user data: 199
[Auth] Using cached user data: 199
[Auth] Using cached user data: 199
[Auth] Using cached user data: 199
[Auth] Using cached user data: 199
[Auth] Using cached user data: 199
[Auth] Using cached user data: 199
[Auth] Using cached user data: 199
[Auth] Returning user session data
New WebSocket client connected
[Auth] Returning user session data
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 199, company_id: 160, email: 'eva.n.cnava.r.r.o@gmail.com' }
[Network Visualization] Fetching network data for company: 160
[Current Company] Fetching company for user: { userId: 199, companyId: 160 }
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 199',
    condition2: 'tasks.created_by = 199',
    condition3: "tasks.company_id = 160 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('eva.n.cnava.r.r.o@gmail.com')"
  }
}
[Current Company] Found company: { id: 160, name: 'Ramp', onboardingCompleted: false, riskScore: null }
[Tasks] Tasks found: { count: 4 }
[Network Visualization] Found network relationships: { count: 2 }
[Network Visualization] Returning visualization data: { centerNode: 'Ramp', nodeCount: 2 }
6:06:06 AM [info] GET /api/companies/current 304 in 87ms :: {"id":160,"name":"Ramp","description":"FinTech partner company Ramp","categor...
6:06:06 AM [info] GET /api/tasks 304 in 130ms :: [{"id":310,"title":"1. KYB Form: Ramp","description":"Complete KYB verificati...
6:06:06 AM [info] GET /api/network/visualization 304 in 123ms :: {"center":{"id":160,"name":"Ramp","riskScore":0,"riskBucket":"low","accredita...
New WebSocket client connected
6:06:06 AM [info] GET /api/companies/current 304 in 30ms :: {"id":160,"name":"Ramp","description":"FinTech partner company Ramp","categor...
6:06:06 AM [info] GET /api/tasks 304 in 30ms :: [{"id":310,"title":"1. KYB Form: Ramp","description":"Complete KYB verificati...
6:06:06 AM [info] GET /api/network/visualization 304 in 30ms :: {"center":{"id":160,"name":"Ramp","riskScore":0,"riskBucket":"low","accredita...
6:06:06 AM [info] GET /api/tasks 304 in 31ms :: [{"id":310,"title":"1. KYB Form: Ramp","description":"Complete KYB verificati...
[Auth] Using cached user data: 199
New WebSocket client connected
6:06:06 AM [info] GET /api/tasks 304 in 30ms :: [{"id":310,"title":"1. KYB Form: Ramp","description":"Complete KYB verificati...
New WebSocket client connected
6:06:11 AM [info] GET /api/companies/current 304 in 31ms :: {"id":160,"name":"Ramp","description":"FinTech partner company Ramp","categor...
6:06:11 AM [info] GET /api/tasks 304 in 30ms :: [{"id":310,"title":"1. KYB Form: Ramp","description":"Complete KYB verificati...
6:06:11 AM [info] GET /api/companies/current 304 in 31ms :: {"id":160,"name":"Ramp","description":"FinTech partner company Ramp","categor...
6:06:11 AM [info] GET /api/tasks 304 in 30ms :: [{"id":310,"title":"1. KYB Form: Ramp","description":"Complete KYB verificati...
6:06:16 AM [info] GET /api/companies/current 304 in 30ms :: {"id":160,"name":"Ramp","description":"FinTech partner company Ramp","categor...
6:06:16 AM [info] GET /api/tasks 304 in 30ms :: [{"id":310,"title":"1. KYB Form: Ramp","description":"Complete KYB verificati...
6:06:16 AM [info] GET /api/companies/current 304 in 31ms :: {"id":160,"name":"Ramp","description":"FinTech partner company Ramp","categor...
6:06:16 AM [info] GET /api/tasks 304 in 32ms :: [{"id":310,"title":"1. KYB Form: Ramp","description":"Complete KYB verificati...
WebSocket client disconnected with code 1001 and reason: 
WebSocket client disconnected with code 1001 and reason: 
New WebSocket client connected
[Auth] Unauthenticated user session
WebSocket client disconnected with code 1001 and reason: 
[Auth] Using cached user data: 199
[Auth] Using cached user data: 199
[Auth] Using cached user data: 199
[Auth] Using cached user data: 199
[Auth] Using cached user data: 199
[Auth] Using cached user data: 199
6:06:22 AM [info] GET /api/companies/current 304 in 31ms :: {"id":160,"name":"Ramp","description":"FinTech partner company Ramp","categor...
6:06:22 AM [info] GET /api/tasks 304 in 30ms :: [{"id":310,"title":"1. KYB Form: Ramp","description":"Complete KYB verificati...
[Auth] Using cached user data: 199
[Auth] Using cached user data: 199
[Auth] Using cached user data: 199
[Auth] Returning user session data
New WebSocket client connected
6:06:23 AM [info] GET /api/tasks 304 in 32ms :: [{"id":310,"title":"1. KYB Form: Ramp","description":"Complete KYB verificati...
6:06:23 AM [info] GET /api/network/visualization 304 in 33ms :: {"center":{"id":160,"name":"Ramp","riskScore":0,"riskBucket":"low","accredita...
6:06:23 AM [info] GET /api/companies/current 304 in 55ms :: {"id":160,"name":"Ramp","description":"FinTech partner company Ramp","categor...
[Auth] Using cached user data: 199
6:06:23 AM [info] GET /api/tasks 304 in 31ms :: [{"id":310,"title":"1. KYB Form: Ramp","description":"Complete KYB verificati...
New WebSocket client connected
6:06:27 AM [info] GET /api/companies/current 304 in 31ms :: {"id":160,"name":"Ramp","description":"FinTech partner company Ramp","categor...
6:06:27 AM [info] GET /api/tasks 304 in 31ms :: [{"id":310,"title":"1. KYB Form: Ramp","description":"Complete KYB verificati...
6:06:28 AM [info] GET /api/companies/current 304 in 30ms :: {"id":160,"name":"Ramp","description":"FinTech partner company Ramp","categor...
6:06:28 AM [info] GET /api/tasks 304 in 31ms :: [{"id":310,"title":"1. KYB Form: Ramp","description":"Complete KYB verificati...
6:06:32 AM [info] GET /api/companies/current 304 in 31ms :: {"id":160,"name":"Ramp","description":"FinTech partner company Ramp","categor...
6:06:32 AM [info] GET /api/tasks 304 in 31ms :: [{"id":310,"title":"1. KYB Form: Ramp","description":"Complete KYB verificati...
6:06:33 AM [info] GET /api/companies/current 304 in 31ms :: {"id":160,"name":"Ramp","description":"FinTech partner company Ramp","categor...
6:06:33 AM [info] GET /api/tasks 304 in 30ms :: [{"id":310,"title":"1. KYB Form: Ramp","description":"Complete KYB verificati...
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 199, company_id: 160, email: 'eva.n.cnava.r.r.o@gmail.com' }
6:06:37 AM [info] GET /api/companies/current 304 in 31ms :: {"id":160,"name":"Ramp","description":"FinTech partner company Ramp","categor...
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 199',
    condition2: 'tasks.created_by = 199',
    condition3: "tasks.company_id = 160 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('eva.n.cnava.r.r.o@gmail.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
6:06:37 AM [info] GET /api/tasks 304 in 92ms :: [{"id":310,"title":"1. KYB Form: Ramp","description":"Complete KYB verificati...
[Current Company] Using cached company data: 160
6:06:38 AM [info] GET /api/companies/current 304 in 31ms :: {"id":160,"name":"Ramp","description":"FinTech partner company Ramp","categor...
6:06:38 AM [info] GET /api/tasks 304 in 31ms :: [{"id":310,"title":"1. KYB Form: Ramp","description":"Complete KYB verificati...
6:06:43 AM [info] GET /api/companies/current 304 in 31ms :: {"id":160,"name":"Ramp","description":"FinTech partner company Ramp","categor...
6:06:43 AM [info] GET /api/tasks 304 in 31ms :: [{"id":310,"title":"1. KYB Form: Ramp","description":"Complete KYB verificati...
6:06:43 AM [info] GET /api/tasks 304 in 30ms :: [{"id":310,"title":"1. KYB Form: Ramp","description":"Complete KYB verificati...
6:06:43 AM [info] GET /api/companies/current 304 in 30ms :: {"id":160,"name":"Ramp","description":"FinTech partner company Ramp","categor...
6:06:48 AM [info] GET /api/companies/current 304 in 30ms :: {"id":160,"name":"Ramp","description":"FinTech partner company Ramp","categor...
6:06:48 AM [info] GET /api/tasks 304 in 31ms :: [{"id":310,"title":"1. KYB Form: Ramp","description":"Complete KYB verificati...
6:06:49 AM [info] GET /api/companies/current 304 in 31ms :: {"id":160,"name":"Ramp","description":"FinTech partner company Ramp","categor...
6:06:49 AM [info] GET /api/tasks 304 in 33ms :: [{"id":310,"title":"1. KYB Form: Ramp","description":"Complete KYB verificati...
[WebSocket] Received pong
[WebSocket] Received pong
[WebSocket] Received message: {
  type: 'pong',
  payload: { timestamp: '2025-04-09T06:06:51.489Z' },
  connectionId: 'ws-1'
}
6:06:53 AM [info] GET /api/companies/current 304 in 31ms :: {"id":160,"name":"Ramp","description":"FinTech partner company Ramp","categor...
6:06:53 AM [info] GET /api/tasks 304 in 31ms :: [{"id":310,"title":"1. KYB Form: Ramp","description":"Complete KYB verificati...
6:06:54 AM [info] GET /api/companies/current 304 in 33ms :: {"id":160,"name":"Ramp","description":"FinTech partner company Ramp","categor...
6:06:54 AM [info] GET /api/tasks 304 in 63ms :: [{"id":310,"title":"1. KYB Form: Ramp","description":"Complete KYB verificati...
6:06:58 AM [info] GET /api/companies/current 304 in 31ms :: {"id":160,"name":"Ramp","description":"FinTech partner company Ramp","categor...
6:06:58 AM [info] GET /api/tasks 304 in 32ms :: [{"id":310,"title":"1. KYB Form: Ramp","description":"Complete KYB verificati...
[Current Company] Using cached company data: 160
6:06:59 AM [info] GET /api/companies/current 304 in 31ms :: {"id":160,"name":"Ramp","description":"FinTech partner company Ramp","categor...
6:06:59 AM [info] GET /api/tasks 304 in 31ms :: [{"id":310,"title":"1. KYB Form: Ramp","description":"Complete KYB verificati...
6:07:03 AM [info] GET /api/companies/current 304 in 31ms :: {"id":160,"name":"Ramp","description":"FinTech partner company Ramp","categor...
6:07:03 AM [info] GET /api/tasks 304 in 31ms :: [{"id":310,"title":"1. KYB Form: Ramp","description":"Complete KYB verificati...
6:07:04 AM [info] GET /api/companies/current 304 in 31ms :: {"id":160,"name":"Ramp","description":"FinTech partner company Ramp","categor...
6:07:04 AM [info] GET /api/tasks 304 in 32ms :: [{"id":310,"title":"1. KYB Form: Ramp","description":"Complete KYB verificati...
[WebSocket] Received pong
[WebSocket] Received pong
[WebSocket] Received message: {
  type: 'pong',
  payload: { timestamp: '2025-04-09T06:07:08.595Z' },
  connectionId: 'ws-1'
}
6:07:08 AM [info] GET /api/companies/current 304 in 30ms :: {"id":160,"name":"Ramp","description":"FinTech partner company Ramp","categor...
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 199, company_id: 160, email: 'eva.n.cnava.r.r.o@gmail.com' }
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 199',
    condition2: 'tasks.created_by = 199',
    condition3: "tasks.company_id = 160 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('eva.n.cnava.r.r.o@gmail.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
6:07:08 AM [info] GET /api/tasks 304 in 93ms :: [{"id":310,"title":"1. KYB Form: Ramp","description":"Complete KYB verificati...
6:07:09 AM [info] GET /api/companies/current 304 in 31ms :: {"id":160,"name":"Ramp","description":"FinTech partner company Ramp","categor...
6:07:09 AM [info] GET /api/tasks 304 in 31ms :: [{"id":310,"title":"1. KYB Form: Ramp","description":"Complete KYB verificati...
6:07:13 AM [info] GET /api/companies/current 304 in 34ms :: {"id":160,"name":"Ramp","description":"FinTech partner company Ramp","categor...
6:07:13 AM [info] GET /api/tasks 304 in 31ms :: [{"id":310,"title":"1. KYB Form: Ramp","description":"Complete KYB verificati...
[Current Company] Using cached company data: 160
6:07:14 AM [info] GET /api/companies/current 304 in 32ms :: {"id":160,"name":"Ramp","description":"FinTech partner company Ramp","categor...
6:07:14 AM [info] GET /api/tasks 304 in 31ms :: [{"id":310,"title":"1. KYB Form: Ramp","description":"Complete KYB verificati...
6:07:19 AM [info] GET /api/companies/current 304 in 36ms :: {"id":160,"name":"Ramp","description":"FinTech partner company Ramp","categor...
6:07:19 AM [info] GET /api/tasks 304 in 31ms :: [{"id":310,"title":"1. KYB Form: Ramp","description":"Complete KYB verificati...
6:07:19 AM [info] GET /api/companies/current 304 in 33ms :: {"id":160,"name":"Ramp","description":"FinTech partner company Ramp","categor...
6:07:19 AM [info] GET /api/tasks 304 in 31ms :: [{"id":310,"title":"1. KYB Form: Ramp","description":"Complete KYB verificati...
[Tasks Routes] Fetching task by ID (special .json endpoint): { taskId: 310, timestamp: '2025-04-09T06:07:21.387Z' }
[Tasks Routes] Task found by ID (special .json endpoint): {
  taskId: 310,
  title: '1. KYB Form: Ramp',
  type: 'company_kyb',
  timestamp: '2025-04-09T06:07:21.420Z'
}
6:07:21 AM [info] GET /api/tasks.json/310 304 in 63ms :: {"id":310,"title":"1. KYB Form: Ramp","description":"Complete KYB verificatio...
6:07:24 AM [info] GET /api/companies/current 304 in 32ms :: {"id":160,"name":"Ramp","description":"FinTech partner company Ramp","categor...
6:07:24 AM [info] GET /api/tasks 304 in 31ms :: [{"id":310,"title":"1. KYB Form: Ramp","description":"Complete KYB verificati...
6:07:26 AM [info] GET /api/tasks 304 in 32ms :: [{"id":310,"title":"1. KYB Form: Ramp","description":"Complete KYB verificati...
6:07:26 AM [info] GET /api/companies/current 304 in 32ms :: {"id":160,"name":"Ramp","description":"FinTech partner company Ramp","categor...
6:07:29 AM [info] GET /api/companies/current 304 in 31ms :: {"id":160,"name":"Ramp","description":"FinTech partner company Ramp","categor...
6:07:29 AM [info] GET /api/tasks 304 in 32ms :: [{"id":310,"title":"1. KYB Form: Ramp","description":"Complete KYB verificati...
[Auth] Using cached user data: 199
6:07:31 AM [info] GET /api/companies/current 304 in 32ms :: {"id":160,"name":"Ramp","description":"FinTech partner company Ramp","categor...
6:07:31 AM [info] GET /api/tasks 304 in 31ms :: [{"id":310,"title":"1. KYB Form: Ramp","description":"Complete KYB verificati...
6:07:34 AM [info] GET /api/companies/current 304 in 33ms :: {"id":160,"name":"Ramp","description":"FinTech partner company Ramp","categor...
[Auth] Using cached user data: 199
6:07:34 AM [info] GET /api/tasks 304 in 31ms :: [{"id":310,"title":"1. KYB Form: Ramp","description":"Complete KYB verificati...
[WebSocket] Received pong
[WebSocket] Received pong
[WebSocket] Received message: {
  type: 'pong',
  payload: { timestamp: '2025-04-09T06:07:36.487Z' },
  connectionId: 'ws-1'
}
6:07:36 AM [info] GET /api/tasks 304 in 31ms :: [{"id":310,"title":"1. KYB Form: Ramp","description":"Complete KYB verificati...
6:07:36 AM [info] GET /api/companies/current 304 in 36ms :: {"id":160,"name":"Ramp","description":"FinTech partner company Ramp","categor...
6:07:39 AM [info] GET /api/companies/current 304 in 32ms :: {"id":160,"name":"Ramp","description":"FinTech partner company Ramp","categor...
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 199, company_id: 160, email: 'eva.n.cnava.r.r.o@gmail.com' }
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 199',
    condition2: 'tasks.created_by = 199',
    condition3: "tasks.company_id = 160 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('eva.n.cnava.r.r.o@gmail.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
6:07:39 AM [info] GET /api/tasks 304 in 96ms :: [{"id":310,"title":"1. KYB Form: Ramp","description":"Complete KYB verificati...
[Current Company] Using cached company data: 160
6:07:41 AM [info] GET /api/tasks 304 in 31ms :: [{"id":310,"title":"1. KYB Form: Ramp","description":"Complete KYB verificati...
6:07:41 AM [info] GET /api/companies/current 304 in 31ms :: {"id":160,"name":"Ramp","description":"FinTech partner company Ramp","categor...
6:07:44 AM [info] GET /api/companies/current 304 in 30ms :: {"id":160,"name":"Ramp","description":"FinTech partner company Ramp","categor...
6:07:44 AM [info] GET /api/tasks 304 in 31ms :: [{"id":310,"title":"1. KYB Form: Ramp","description":"Complete KYB verificati...
6:07:46 AM [info] GET /api/tasks 304 in 31ms :: [{"id":310,"title":"1. KYB Form: Ramp","description":"Complete KYB verificati...
6:07:46 AM [info] GET /api/companies/current 304 in 32ms :: {"id":160,"name":"Ramp","description":"FinTech partner company Ramp","categor...