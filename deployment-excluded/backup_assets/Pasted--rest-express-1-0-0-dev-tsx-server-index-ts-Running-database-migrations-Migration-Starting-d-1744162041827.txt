 rest-express@1.0.0 dev
> tsx server/index.ts

Running database migrations...
[Migration] Starting database migrations
[Migration] Running security form tables migration
[DB Migration] Creating security form tables...
[EmailService] Initializing email service
[EmailService] Email service initialized successfully
[Auth] Setting up authentication...
[Auth] Authentication setup completed
[Routes] Routes setup completed
[WebSocket] Server initialized on path: /ws
1:26:22 AM [info] Setting up Vite development server
1:26:22 AM [express] Server running on port 5000
[2025-04-09T01:26:23.114Z] New client connected to the pool
[DB Migration] Security form tables created successfully.
[Migration] Populating security fields from card fields
[DB Migration] Populating security fields...
[DB Migration] Security fields already populated (25 fields exist)
[Migration] Updating existing task titles
[DB Migration] Updating existing task titles...
[DB Migration] Updated 0 KYB task titles
[DB Migration] Updated 0 Security Assessment task titles
[DB Migration] Updated 0 CARD task titles
[DB Migration] Task titles updated successfully
[Migration] Updating KYB form fields
[KYB Migration] Starting April 2025 KYB fields update migration
[KYB Migration] Verifying field groupings and order
[KYB Migration] Migration status: new fields present (2), tax fields to remove (0)
[KYB Migration] Updating existing fields
[KYB Migration] No fields to delete
[KYB Migration] Successfully updated KYB fields for April 2025 revision
[Migration] Adding task templates and component configurations
Adding task templates and configurations...
Error adding task templates: error: duplicate key value violates unique constraint "task_templates_task_type_key"
    at file:///home/runner/workspace/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/runner/workspace/node_modules/src/neon-serverless/session.ts:102:18)
    at async up (/home/runner/workspace/db/migrations/add_task_templates.ts:13:27)
    at async runMigrations (/home/runner/workspace/db/migrations/index.ts:39:5)
    at async <anonymous> (/home/runner/workspace/db/index.ts:112:5) {
  length: 242,
  severity: 'ERROR',
  code: '23505',
  detail: 'Key (task_type)=(company_kyb) already exists.',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'task_templates',
  column: undefined,
  dataType: undefined,
  constraint: 'task_templates_task_type_key',
  file: 'nbtinsert.c',
  line: '666',
  routine: '_bt_check_unique'
}
[Migration] Migration failed: error: duplicate key value violates unique constraint "task_templates_task_type_key"
    at file:///home/runner/workspace/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/runner/workspace/node_modules/src/neon-serverless/session.ts:102:18)
    at async up (/home/runner/workspace/db/migrations/add_task_templates.ts:13:27)
    at async runMigrations (/home/runner/workspace/db/migrations/index.ts:39:5)
    at async <anonymous> (/home/runner/workspace/db/index.ts:112:5) {
  length: 242,
  severity: 'ERROR',
  code: '23505',
  detail: 'Key (task_type)=(company_kyb) already exists.',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'task_templates',
  column: undefined,
  dataType: undefined,
  constraint: 'task_templates_task_type_key',
  file: 'nbtinsert.c',
  line: '666',
  routine: '_bt_check_unique'
}
Failed to run migrations: error: duplicate key value violates unique constraint "task_templates_task_type_key"
    at file:///home/runner/workspace/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/runner/workspace/node_modules/src/neon-serverless/session.ts:102:18)
    at async up (/home/runner/workspace/db/migrations/add_task_templates.ts:13:27)
    at async runMigrations (/home/runner/workspace/db/migrations/index.ts:39:5)
    at async <anonymous> (/home/runner/workspace/db/index.ts:112:5) {
  length: 242,
  severity: 'ERROR',
  code: '23505',
  detail: 'Key (task_type)=(company_kyb) already exists.',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'task_templates',
  column: undefined,
  dataType: undefined,
  constraint: 'task_templates_task_type_key',
  file: 'nbtinsert.c',
  line: '666',
  routine: '_bt_check_unique'
}
New WebSocket client connected
[Auth] Unauthenticated user session
WebSocket client disconnected with code 1001 and reason: 
[2025-04-09T01:26:43.210Z] New client connected to the pool
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[2025-04-09T01:26:43.477Z] New client connected to the pool
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[2025-04-09T01:26:43.883Z] New client connected to the pool
[2025-04-09T01:26:43.913Z] New client connected to the pool
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[2025-04-09T01:26:44.382Z] New client connected to the pool
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Returning user session data
New WebSocket client connected
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 199, company_id: 160, email: 'eva.n.cnava.r.r.o@gmail.com' }
[Current Company] Fetching company for user: { userId: 199, companyId: 160 }
[Tasks Routes] Fetching task by ID (special .json endpoint): { taskId: 310, timestamp: '2025-04-09T01:26:48.392Z' }
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 199',
    condition2: 'tasks.created_by = 199',
    condition3: "tasks.company_id = 160 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('eva.n.cnava.r.r.o@gmail.com')"
  }
}
[Current Company] Found company: { id: 160, name: 'Ramp', onboardingCompleted: false, riskScore: null }
[Tasks Routes] Task found by ID (special .json endpoint): {
  taskId: 310,
  title: '1. KYB Form: Ramp',
  type: 'company_kyb',
  timestamp: '2025-04-09T01:26:48.424Z'
}
[Tasks] Tasks found: { count: 4 }
1:26:48 AM [info] GET /api/companies/current 304 in 60ms :: {"id":160,"name":"Ramp","description":"FinTech partner company Ramp","categor...
1:26:48 AM [info] GET /api/tasks.json/310 304 in 61ms :: {"id":310,"title":"1. KYB Form: Ramp","description":"Complete KYB verificatio...
1:26:48 AM [info] GET /api/tasks 304 in 90ms :: [{"id":310,"title":"1. KYB Form: Ramp","description":"Complete KYB verificati...
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
New WebSocket client connected
[Auth] Deserializing user: 199
[2025-04-09T01:26:48.582Z] [INFO] [KYBRoutes] Fetching KYB fields for step 0
[2025-04-09T01:26:48.582Z] [INFO] [KYBRoutes] Fetching KYB fields
[KYB API Debug] Loading progress for task: 310
[2025-04-09T01:26:48.592Z] [INFO] [KYBRoutes] Fetching KYB fields for step 1
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 199, company_id: 160, email: 'eva.n.cnava.r.r.o@gmail.com' }
[2025-04-09T01:26:48.612Z] [INFO] [KYBRoutes] KYB fields for step 0 retrieved successfully {"fieldCount":8,"stepIndex":0,"groups":["Company Profile","companyProfile"]}
[2025-04-09T01:26:48.613Z] [INFO] [KYBRoutes] KYB fields retrieved successfully {"fieldCount":30,"groups":["Company Profile","Governance & Leadership","Operations & Compliance","companyProfile","financialProfile","governanceLeadership","operationsCompliance"]}
[KYB API Debug] Retrieved task: {
  taskId: 310,
  status: 'in_progress',
  progress: 27,
  metadata: [
    'company_id',
    'created_at',
    'statusFlow',
    'created_via',
    'lastUpdated',
    'status_flow',
    'company_name',
    'created_by_id',
    'prerequisite_for'
  ],
  timestamp: '2025-04-09T01:26:48.614Z'
}
[2025-04-09T01:26:48.622Z] [INFO] [KYBRoutes] KYB fields for step 1 retrieved successfully {"fieldCount":10,"stepIndex":1,"groups":["Governance & Leadership","governanceLeadership"]}
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 199',
    condition2: 'tasks.created_by = 199',
    condition3: "tasks.company_id = 160 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('eva.n.cnava.r.r.o@gmail.com')"
  }
}
1:26:48 AM [info] GET /api/form-fields/company_kyb/0 304 in 61ms :: [{"id":7,"field_key":"companyPhone","display_name":"Company Phone Number","fi...
1:26:48 AM [info] GET /api/kyb/fields 304 in 62ms :: [{"id":7,"field_key":"companyPhone","display_name":"Company Phone Number","fi...
[KYB API Debug] Retrieved responses: {
  responseCount: 8,
  fields: [
    { field: 'registrationNumber', status: 'COMPLETE', hasValue: true },
    { field: 'companyPhone', status: 'COMPLETE', hasValue: true },
    { field: 'legalEntityName', status: 'COMPLETE', hasValue: true },
    { field: 'incorporationDate', status: 'COMPLETE', hasValue: true },
    { field: 'businessType', status: 'COMPLETE', hasValue: true },
    { field: 'jurisdiction', status: 'COMPLETE', hasValue: true },
    { field: 'registeredAddress', status: 'COMPLETE', hasValue: true },
    { field: 'priorNames', status: 'COMPLETE', hasValue: true }
  ],
  timestamp: '2025-04-09T01:26:48.644Z'
}
[KYB API Debug] Retrieved task data: {
  id: 310,
  responseCount: 8,
  progress: 27,
  status: 'in_progress',
  formDataKeys: [
    'registrationNumber',
    'companyPhone',
    'legalEntityName',
    'incorporationDate',
    'businessType',
    'jurisdiction',
    'registeredAddress',
    'priorNames'
  ],
  formData: {
    registrationNumber: '160',
    companyPhone: 'f',
    legalEntityName: 'Ramp',
    incorporationDate: '2019',
    businessType: 'Private',
    jurisdiction: '123 Main Street, New York, NY, USA',
    registeredAddress: '123 Main Street, New York, NY, USA',
    priorNames: 'Ramp'
  }
}
1:26:48 AM [info] GET /api/form-fields/company_kyb/1 304 in 60ms :: [{"id":8,"field_key":"contactEmail","display_name":"Representative Email","fi...
[Tasks] Tasks found: { count: 4 }
1:26:48 AM [info] GET /api/kyb/progress/310 200 in 91ms :: {"formData":{"registrationNumber":"160","companyPhone":"f","legalEntityName":...
1:26:48 AM [info] GET /api/tasks 304 in 90ms :: [{"id":310,"title":"1. KYB Form: Ramp","description":"Complete KYB verificati...
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[2025-04-09T01:26:48.770Z] [INFO] [KYBRoutes] Fetching KYB fields for step 0
[KYB API Debug] Loading progress for task: 310
[2025-04-09T01:26:48.800Z] [INFO] [KYBRoutes] KYB fields for step 0 retrieved successfully {"fieldCount":8,"stepIndex":0,"groups":["Company Profile","companyProfile"]}
[KYB API Debug] Retrieved task: {
  taskId: 310,
  status: 'in_progress',
  progress: 27,
  metadata: [
    'company_id',
    'created_at',
    'statusFlow',
    'created_via',
    'lastUpdated',
    'status_flow',
    'company_name',
    'created_by_id',
    'prerequisite_for'
  ],
  timestamp: '2025-04-09T01:26:48.824Z'
}
1:26:48 AM [info] GET /api/form-fields/company_kyb/0 304 in 60ms :: [{"id":7,"field_key":"companyPhone","display_name":"Company Phone Number","fi...
[KYB API Debug] Retrieved responses: {
  responseCount: 8,
  fields: [
    { field: 'registrationNumber', status: 'COMPLETE', hasValue: true },
    { field: 'companyPhone', status: 'COMPLETE', hasValue: true },
    { field: 'legalEntityName', status: 'COMPLETE', hasValue: true },
    { field: 'incorporationDate', status: 'COMPLETE', hasValue: true },
    { field: 'businessType', status: 'COMPLETE', hasValue: true },
    { field: 'jurisdiction', status: 'COMPLETE', hasValue: true },
    { field: 'registeredAddress', status: 'COMPLETE', hasValue: true },
    { field: 'priorNames', status: 'COMPLETE', hasValue: true }
  ],
  timestamp: '2025-04-09T01:26:48.856Z'
}
[KYB API Debug] Retrieved task data: {
  id: 310,
  responseCount: 8,
  progress: 27,
  status: 'in_progress',
  formDataKeys: [
    'registrationNumber',
    'companyPhone',
    'legalEntityName',
    'incorporationDate',
    'businessType',
    'jurisdiction',
    'registeredAddress',
    'priorNames'
  ],
  formData: {
    registrationNumber: '160',
    companyPhone: 'f',
    legalEntityName: 'Ramp',
    incorporationDate: '2019',
    businessType: 'Private',
    jurisdiction: '123 Main Street, New York, NY, USA',
    registeredAddress: '123 Main Street, New York, NY, USA',
    priorNames: 'Ramp'
  }
}
1:26:48 AM [info] GET /api/kyb/progress/310 304 in 93ms :: {"formData":{"registrationNumber":"160","companyPhone":"f","legalEntityName":...
[Auth] Deserializing user: 199
[KYB API Debug] Loading progress for task: 310
[KYB API Debug] Retrieved task: {
  taskId: 310,
  status: 'in_progress',
  progress: 27,
  metadata: [
    'company_id',
    'created_at',
    'statusFlow',
    'created_via',
    'lastUpdated',
    'status_flow',
    'company_name',
    'created_by_id',
    'prerequisite_for'
  ],
  timestamp: '2025-04-09T01:26:49.034Z'
}
[KYB API Debug] Retrieved responses: {
  responseCount: 8,
  fields: [
    { field: 'registrationNumber', status: 'COMPLETE', hasValue: true },
    { field: 'companyPhone', status: 'COMPLETE', hasValue: true },
    { field: 'legalEntityName', status: 'COMPLETE', hasValue: true },
    { field: 'incorporationDate', status: 'COMPLETE', hasValue: true },
    { field: 'businessType', status: 'COMPLETE', hasValue: true },
    { field: 'jurisdiction', status: 'COMPLETE', hasValue: true },
    { field: 'registeredAddress', status: 'COMPLETE', hasValue: true },
    { field: 'priorNames', status: 'COMPLETE', hasValue: true }
  ],
  timestamp: '2025-04-09T01:26:49.070Z'
}
[KYB API Debug] Retrieved task data: {
  id: 310,
  responseCount: 8,
  progress: 27,
  status: 'in_progress',
  formDataKeys: [
    'registrationNumber',
    'companyPhone',
    'legalEntityName',
    'incorporationDate',
    'businessType',
    'jurisdiction',
    'registeredAddress',
    'priorNames'
  ],
  formData: {
    registrationNumber: '160',
    companyPhone: 'f',
    legalEntityName: 'Ramp',
    incorporationDate: '2019',
    businessType: 'Private',
    jurisdiction: '123 Main Street, New York, NY, USA',
    registeredAddress: '123 Main Street, New York, NY, USA',
    priorNames: 'Ramp'
  }
}
1:26:49 AM [info] GET /api/kyb/progress/310 304 in 100ms :: {"formData":{"registrationNumber":"160","companyPhone":"f","legalEntityName":...
[Auth] Deserializing user: 199
[Company Search Debug] Received search request: {
  body: { companyName: 'Ramp' },
  headers: {
    host: '9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev',
    'user-agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36',
    'content-length': '22',
    accept: '*/*',
    'accept-encoding': 'gzip, deflate, br, zstd',
    'accept-language': 'en-US,en;q=0.9',
    'content-type': 'application/json',
    cookie: 'connect.sid=s%3ArYKyfIEUCrRkZ03t4DIvwZefNjyjs7_P.ia7q2jIHExu1zWk9hcBc%2FeJaGd5J4ImzjucEXUA5jXE; sid=s%3AxAclcrUspMehbfKLMxw1eN8TxjzhaO-c.z%2BHOnGY7JIwdgNrfgE0HhPf8yXOT81CgXbRJ2lUpr2o',
    dnt: '1',
    origin: 'https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev',
    referer: 'https://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev/task-center/task/310',
    'sec-ch-ua': '"Not:A-Brand";v="24", "Chromium";v="134"',
    'sec-ch-ua-mobile': '?0',
    'sec-ch-ua-platform': '"macOS"',
    'sec-fetch-dest': 'empty',
    'sec-fetch-mode': 'cors',
    'sec-fetch-site': 'same-origin',
    'sec-fetch-storage-access': 'active',
    'x-forwarded-for': '35.145.39.149, 10.81.4.44',
    'x-forwarded-proto': 'https',
    'x-replit-user-bio': '',
    'x-replit-user-id': '',
    'x-replit-user-name': '',
    'x-replit-user-profile-image': '',
    'x-replit-user-roles': '',
    'x-replit-user-teams': '',
    'x-replit-user-url': ''
  }
}
[Company Search Debug] Validated company name: Ramp
[Company Search Debug] Executing database query
[Company Search Debug] Database query result: {
  id: 160,
  name: 'Ramp',
  description: 'FinTech partner company Ramp',
  category: 'FinTech',
  logo_id: null,
  stock_ticker: null,
  website_url: 'https://www.ramp.com',
  legal_structure: 'Private',
  market_position: null,
  hq_address: '123 Main Street, New York, NY, USA',
  products_services: '{"Expense Management Software","Corporate Card Solutions"}',
  incorporation_year: 2019,
  founders_and_leadership: '{"John Doe (CEO)","Jane Smith (CTO)"}',
  num_employees: 110,
  revenue: '$50 million',
  key_clients_partners: '{"Company A","Company B"}',
  investors: '{"Venture Capital Firm X","Angel Investor Y"}',
  funding_stage: 'Series B',
  exit_strategy_history: 'No known exits',
  certifications_compliance: '{"ISO 9001","PCI DSS"}',
  risk_score: null,
  accreditation_status: 'PENDING',
  onboarding_company_completed: false,
  registry_date: 2025-04-09T00:00:59.529Z,
  files_public: [],
  files_private: [],
  available_tabs: [ 'task-center' ],
  created_at: 2025-04-09T00:00:59.529Z,
  updated_at: 2025-04-09T00:00:59.529Z
}
[Company Search Debug] Found existing company: {
  id: 160,
  name: 'Ramp',
  description: 'FinTech partner company Ramp',
  category: 'FinTech',
  logo_id: null,
  stock_ticker: null,
  website_url: 'https://www.ramp.com',
  legal_structure: 'Private',
  market_position: null,
  hq_address: '123 Main Street, New York, NY, USA',
  products_services: '{"Expense Management Software","Corporate Card Solutions"}',
  incorporation_year: 2019,
  founders_and_leadership: '{"John Doe (CEO)","Jane Smith (CTO)"}',
  num_employees: 110,
  revenue: '$50 million',
  key_clients_partners: '{"Company A","Company B"}',
  investors: '{"Venture Capital Firm X","Angel Investor Y"}',
  funding_stage: 'Series B',
  exit_strategy_history: 'No known exits',
  certifications_compliance: '{"ISO 9001","PCI DSS"}',
  risk_score: null,
  accreditation_status: 'PENDING',
  onboarding_company_completed: false,
  registry_date: 2025-04-09T00:00:59.529Z,
  files_public: [],
  files_private: [],
  available_tabs: [ 'task-center' ],
  created_at: 2025-04-09T00:00:59.529Z,
  updated_at: 2025-04-09T00:00:59.529Z
}
[Company Matching] 🔍 Analyzing company fields for: Ramp
[Company Matching] ✓ Field 'description' has value: FinTech partner company Ramp
[Company Matching] 🔍 Field 'websiteUrl' is undefined
[Company Matching] 🔍 Field 'legalStructure' is undefined
[Company Matching] 🔍 Field 'hqAddress' is undefined
[Company Matching] 🔍 Field 'productsServices' is undefined
[Company Matching] 🔍 Field 'incorporationYear' is undefined
[Company Matching] 🔍 Field 'foundersAndLeadership' is undefined
[Company Matching] 🔍 Field 'numEmployees' is undefined
[Company Matching] ✓ Field 'revenue' has value: $50 million
[Company Matching] 🔍 Field 'keyClientsPartners' is undefined
[Company Matching] ✓ Field 'investors' has value: {"Venture Capital Firm X","Angel Investor Y"}
[Company Matching] 🔍 Field 'fundingStage' is undefined
[Company Matching] 🔍 Field 'exitStrategyHistory' is undefined
[Company Matching] 🔍 Field 'certificationsCompliance' is undefined
[Company Matching] 📋 Missing fields detected: [
  'websiteUrl',
  'legalStructure',
  'hqAddress',
  'productsServices',
  'incorporationYear',
  'foundersAndLeadership',
  'numEmployees',
  'keyClientsPartners',
  'fundingStage',
  'exitStrategyHistory',
  'certificationsCompliance'
]
[Company Search Debug] Missing fields: [
  'websiteUrl',
  'legalStructure',
  'hqAddress',
  'productsServices',
  'incorporationYear',
  'foundersAndLeadership',
  'numEmployees',
  'keyClientsPartners',
  'fundingStage',
  'exitStrategyHistory',
  'certificationsCompliance'
]
[Company Search Debug] Found 11 missing fields, searching for data: [
  'websiteUrl',
  'legalStructure',
  'hqAddress',
  'productsServices',
  'incorporationYear',
  'foundersAndLeadership',
  'numEmployees',
  'keyClientsPartners',
  'fundingStage',
  'exitStrategyHistory',
  'certificationsCompliance'
]
[OpenAI Search] 🚀 Starting search for missing company data
[OpenAI Search] 📊 Company: Ramp
[OpenAI Search] 🔍 Missing fields: [
  'websiteUrl',
  'legalStructure',
  'hqAddress',
  'productsServices',
  'incorporationYear',
  'foundersAndLeadership',
  'numEmployees',
  'keyClientsPartners',
  'fundingStage',
  'exitStrategyHistory',
  'certificationsCompliance'
]
[OpenAI Search] 📤 Sending request to OpenAI
[Auth] Deserializing user: 199
[Auth] Deserializing user: 199
[Current Company] Fetching company for user: { userId: 199, companyId: 160 }
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 199, company_id: 160, email: 'eva.n.cnava.r.r.o@gmail.com' }
[Current Company] Found company: { id: 160, name: 'Ramp', onboardingCompleted: false, riskScore: null }
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 199',
    condition2: 'tasks.created_by = 199',
    condition3: "tasks.company_id = 160 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('eva.n.cnava.r.r.o@gmail.com')"
  }
}
1:26:53 AM [info] GET /api/companies/current 304 in 68ms :: {"id":160,"name":"Ramp","description":"FinTech partner company Ramp","categor...
[Tasks] Tasks found: { count: 4 }
1:26:53 AM [info] GET /api/tasks 304 in 98ms :: [{"id":310,"title":"1. KYB Form: Ramp","description":"Complete KYB verificati...
[OpenAI Search] ⏱️ Search completed in 7154 ms
[OpenAI Search] 📥 Received raw data: {
  websiteUrl: { source: 'Official Website', data: 'https://www.ramp.com' },
  legalStructure: { source: 'Official Website', data: 'Private' },
  hqAddress: {
    source: 'Official Website',
    data: '123 Main Street, New York, NY, USA'
  },
  productsServices: {
    source: 'Official Website',
    data: [ 'Expense Management Software', 'Corporate Card Solutions' ]
  },
  incorporationYear: { source: 'Official Website', data: 2019 },
  foundersAndLeadership: {
    source: 'Official Website',
    data: [ 'John Doe (CEO)', 'Jane Smith (CTO)' ]
  },
  numEmployees: { source: 'ZoomInfo', data: 110 },
  keyClientsPartners: { source: 'Crunchbase', data: [ 'Company A', 'Company B' ] },
  fundingStage: { source: 'Crunchbase', data: 'Series B' },
  exitStrategyHistory: { source: 'Crunchbase', data: 'No known exits' },
  certificationsCompliance: { source: 'Official Website', data: [ 'ISO 9001', 'PCI DSS' ] }
}
[OpenAI Search] 🧹 Cleaned data for storage: {
  websiteUrl: 'https://www.ramp.com',
  legalStructure: 'Private',
  hqAddress: '123 Main Street, New York, NY, USA',
  productsServices: [ 'Expense Management Software', 'Corporate Card Solutions' ],
  incorporationYear: 2019,
  foundersAndLeadership: [ 'John Doe (CEO)', 'Jane Smith (CTO)' ],
  numEmployees: 110,
  keyClientsPartners: [ 'Company A', 'Company B' ],
  fundingStage: 'Series B',
  exitStrategyHistory: 'No known exits',
  certificationsCompliance: [ 'ISO 9001', 'PCI DSS' ]
}
[OpenAI Search] 📅 Parsing incorporation year: 2019
[OpenAI Search] 👥 Parsing employee count: 110
[Company Search Debug] Retrieved new data: {
  websiteUrl: 'https://www.ramp.com',
  legalStructure: 'Private',
  hqAddress: '123 Main Street, New York, NY, USA',
  productsServices: [ 'Expense Management Software', 'Corporate Card Solutions' ],
  incorporationYear: 2019,
  foundersAndLeadership: [ 'John Doe (CEO)', 'Jane Smith (CTO)' ],
  numEmployees: 110,
  keyClientsPartners: [ 'Company A', 'Company B' ],
  fundingStage: 'Series B',
  exitStrategyHistory: 'No known exits',
  certificationsCompliance: [ 'ISO 9001', 'PCI DSS' ]
}
[Company Search Debug] Formatted data for storage: {
  website_url: 'https://www.ramp.com',
  legal_structure: 'Private',
  hq_address: '123 Main Street, New York, NY, USA',
  products_services: '{"Expense Management Software","Corporate Card Solutions"}',
  incorporation_year: 2019,
  founders_and_leadership: '{"John Doe (CEO)","Jane Smith (CTO)"}',
  num_employees: 110,
  key_clients_partners: '{"Company A","Company B"}',
  funding_stage: 'Series B',
  exit_strategy_history: 'No known exits',
  certifications_compliance: '{"ISO 9001","PCI DSS"}'
}
[Company Matching] 🔄 Updating company data for ID: 160
[Company Matching] 📝 New data to be applied: {
  website_url: 'https://www.ramp.com',
  legal_structure: 'Private',
  hq_address: '123 Main Street, New York, NY, USA',
  products_services: '{"Expense Management Software","Corporate Card Solutions"}',
  incorporation_year: 2019,
  founders_and_leadership: '{"John Doe (CEO)","Jane Smith (CTO)"}',
  num_employees: 110,
  key_clients_partners: '{"Company A","Company B"}',
  funding_stage: 'Series B',
  exit_strategy_history: 'No known exits',
  certifications_compliance: '{"ISO 9001","PCI DSS"}'
}
[Company Matching] ✅ Successfully updated company data
[Company Search Debug] Updated company data: {
  id: 160,
  name: 'Ramp',
  description: 'FinTech partner company Ramp',
  category: 'FinTech',
  logo_id: null,
  stock_ticker: null,
  website_url: 'https://www.ramp.com',
  legal_structure: 'Private',
  market_position: null,
  hq_address: '123 Main Street, New York, NY, USA',
  products_services: '{"Expense Management Software","Corporate Card Solutions"}',
  incorporation_year: 2019,
  founders_and_leadership: '{"John Doe (CEO)","Jane Smith (CTO)"}',
  num_employees: 110,
  revenue: '$50 million',
  key_clients_partners: '{"Company A","Company B"}',
  investors: '{"Venture Capital Firm X","Angel Investor Y"}',
  funding_stage: 'Series B',
  exit_strategy_history: 'No known exits',
  certifications_compliance: '{"ISO 9001","PCI DSS"}',
  risk_score: null,
  accreditation_status: 'PENDING',
  onboarding_company_completed: false,
  registry_date: 2025-04-09T00:00:59.529Z,
  files_public: [],
  files_private: [],
  available_tabs: [ 'task-center' ],
  created_at: 2025-04-09T00:00:59.529Z,
  updated_at: 2025-04-09T00:00:59.529Z
}
[Company Search Debug] Formatting response data for frontend: {
  id: 160,
  name: 'Ramp',
  description: 'FinTech partner company Ramp',
  category: 'FinTech',
  logo_id: null,
  stock_ticker: null,
  website_url: 'https://www.ramp.com',
  legal_structure: 'Private',
  market_position: null,
  hq_address: '123 Main Street, New York, NY, USA',
  products_services: '{"Expense Management Software","Corporate Card Solutions"}',
  incorporation_year: 2019,
  founders_and_leadership: '{"John Doe (CEO)","Jane Smith (CTO)"}',
  num_employees: 110,
  revenue: '$50 million',
  key_clients_partners: '{"Company A","Company B"}',
  investors: '{"Venture Capital Firm X","Angel Investor Y"}',
  funding_stage: 'Series B',
  exit_strategy_history: 'No known exits',
  certifications_compliance: '{"ISO 9001","PCI DSS"}',
  risk_score: null,
  accreditation_status: 'PENDING',
  onboarding_company_completed: false,
  registry_date: 2025-04-09T00:00:59.529Z,
  files_public: [],
  files_private: [],
  available_tabs: [ 'task-center' ],
  created_at: 2025-04-09T00:00:59.529Z,
  updated_at: 2025-04-09T00:00:59.529Z
}
[Company Search Debug] Formatted data: {
  id: 160,
  name: 'Ramp',
  description: 'FinTech partner company Ramp',
  category: 'FinTech',
  logo_id: null,
  stock_ticker: null,
  website_url: 'https://www.ramp.com',
  legal_structure: 'Private',
  market_position: null,
  hq_address: '123 Main Street, New York, NY, USA',
  products_services: [ 'Expense Management Software', 'Corporate Card Solutions' ],
  incorporation_year: 2019,
  founders_and_leadership: '{"John Doe (CEO)","Jane Smith (CTO)"}',
  num_employees: 110,
  revenue: '$50 million',
  key_clients_partners: [ 'Company A', 'Company B' ],
  investors: '{"Venture Capital Firm X","Angel Investor Y"}',
  funding_stage: 'Series B',
  exit_strategy_history: 'No known exits',
  certifications_compliance: [ 'ISO 9001', 'PCI DSS' ],
  risk_score: null,
  accreditation_status: 'PENDING',
  onboarding_company_completed: false,
  registry_date: 2025-04-09T00:00:59.529Z,
  files_public: [],
  files_private: [],
  available_tabs: [ 'task-center' ],
  created_at: 2025-04-09T00:00:59.529Z,
  updated_at: 2025-04-09T00:00:59.529Z
}
1:26:56 AM [info] POST /api/company-search 200 in 7314ms :: {"success":true,"data":{"company":{"id":160,"name":"Ramp","description":"FinT...
[Auth] Deserializing user: 199
[Current Company] Fetching company for user: { userId: 199, companyId: 160 }
[Auth] Deserializing user: 199
[Current Company] Found company: { id: 160, name: 'Ramp', onboardingCompleted: false, riskScore: null }
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 199, company_id: 160, email: 'eva.n.cnava.r.r.o@gmail.com' }
1:26:58 AM [info] GET /api/companies/current 304 in 60ms :: {"id":160,"name":"Ramp","description":"FinTech partner company Ramp","categor...
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 199',
    condition2: 'tasks.created_by = 199',
    condition3: "tasks.company_id = 160 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('eva.n.cnava.r.r.o@gmail.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
1:26:58 AM [info] GET /api/tasks 304 in 90ms :: [{"id":310,"title":"1. KYB Form: Ramp","description":"Complete KYB verificati...