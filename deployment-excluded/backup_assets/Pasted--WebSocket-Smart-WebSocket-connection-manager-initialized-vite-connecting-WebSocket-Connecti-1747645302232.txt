[WebSocket] Smart WebSocket connection manager initialized
[vite] connecting...
[WebSocket] Connection to wss://localhost:undefined/ failed: Failed to construct 'WebSocket': The URL 'wss://localhost:undefined/' is invalid.
[vite] failed to connect to websocket.
your current setup:
  (browser) 9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev/ <--[HTTP]--> localhost:undefined/ (server)
  (browser) 9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev:/ <--[WebSocket (failing)]--> localhost:undefined/ (server)
Check out your Vite / network configuration and https://vite.dev/config/server-options.html#server-hmr .
[EnhancedKybServiceFactory] Error accessing user context manager: 
ReferenceError {}
[EnhancedKybServiceFactory] No company context found, using global instance - THIS MAY CAUSE DATA ISOLATION ISSUES
[EnhancedKybServiceFactory] Error accessing user context manager: 
ReferenceError {}
[EnhancedKybServiceFactory] Creating app-level EnhancedKybFormService instance
[Enhanced KYB Service] Enhanced KYB Form Service initialized with timestamp tracking
[KY3PFormService] [KY3P Form Service] Initializing KY3P Form Service 
Object {companyId: undefined, taskId: undefined}
[Enhanced KYB Service] Enhanced KYB Form Service initialized with timestamp tracking
INFO: [OpenBankingFormService] Initializing Open Banking Form Service 
Object {companyId: undefined, taskId: undefined}
[Enhanced KYB Service] Enhanced KYB Form Service initialized with timestamp tracking
[EnhancedKybServiceFactory] No company context found, using global instance
[2025-05-19T09:00:59.357Z] [PhaseStartup] PhaseStartup manager initialized 
[TutorialManager] Tutorial debug utilities not available
Risk Score Logger initialized: 
Object {showDiff: true, debugMode: true, enabledTags: {…}}
[WebSocket] Smart WebSocket connection manager initialized
[WebSocket] Connecting to WebSocket: wss://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev/ws
[WebSocket] Connection attempt initiated
[RiskScore]:init Risk Score Data Service initialized successfully
Risk Score Service exposed on window.__riskScoreService for development debugging
[RiskScore]:init Application services initialized successfully
[App] WebSocket connection managers initialized
[App] Application services initialized
[Router] Current location: /register
[Registration] URL code parameter: null
[2025-05-19T09:00:59.704Z] [WebSocket] WebSocket connection manager initialized 
[2025-05-19T09:00:59.704Z] [WebSocket] Scheduling initial WebSocket connection in 1000ms to ensure environment is ready 
[TanStack Query] Fetching: /api/user
[2025-05-19T09:00:59.705Z] [App] Initializing application with phased startup approach 
[2025-05-19T09:00:59.705Z] [PhaseStartup] Registering callback for phase: framework 
[2025-05-19T09:00:59.705Z] [PhaseStartup] Registering callback for phase: context 
[2025-05-19T09:00:59.705Z] [PhaseStartup] Registering callback for phase: services 
[2025-05-19T09:00:59.705Z] [PhaseStartup] Registering callback for phase: communication 
[2025-05-19T09:00:59.705Z] [PhaseStartup] Registering callback for phase: ready 
[2025-05-19T09:00:59.705Z] [PhaseStartup] Starting phased application initialization 
[2025-05-19T09:00:59.705Z] [PhaseStartup] Executing startup phase: framework 
[2025-05-19T09:00:59.705Z] [PhaseStartup] Executing 1 callbacks for phase framework 
[2025-05-19T09:00:59.705Z] [PhaseStartup] Executing callback 1/1 for phase framework 
[2025-05-19T09:00:59.705Z] [App] Framework phase initializing 
[2025-05-19T09:00:59.705Z] [App] Removing autofocus from element 
<input type="text" maxlength="1" class="w-full h-14 text-center font-mono text-xl font-medium border rounded-md bg-gray-50 focus:ring-2 focus:ring-primary focus:border-primary uppercase mx-1" aria-label="Code segment 1" value="D"></input>
[2025-05-19T09:00:59.708Z] [PhaseStartup] Phase framework completed successfully 
[2025-05-19T09:00:59.708Z] [PhaseStartup] Phase context dependencies satisfied, executing... 
[2025-05-19T09:00:59.708Z] [PhaseStartup] Executing startup phase: context 
[2025-05-19T09:00:59.708Z] [PhaseStartup] Executing 1 callbacks for phase context 
[2025-05-19T09:00:59.708Z] [PhaseStartup] Executing callback 1/1 for phase context 
[2025-05-19T09:00:59.708Z] [App] Context phase initializing 
[2025-05-19T09:00:59.708Z] [PhaseStartup] Phase context completed successfully 
[2025-05-19T09:00:59.708Z] [PhaseStartup] Phase services dependencies satisfied, executing... 
[2025-05-19T09:00:59.708Z] [PhaseStartup] Executing startup phase: services 
[2025-05-19T09:00:59.708Z] [PhaseStartup] Executing 1 callbacks for phase services 
[2025-05-19T09:00:59.708Z] [PhaseStartup] Executing callback 1/1 for phase services 
[2025-05-19T09:00:59.708Z] [App] Services phase initializing 
[2025-05-19T09:00:59.708Z] [App] Initializing unified service registration 
[2025-05-19T09:00:59.708Z] [UnifiedServiceRegistration] Initializing all services with unified registration 
[2025-05-19T09:00:59.709Z] [UnifiedServiceRegistration] Registering all services with options: 
Object {useUnified: true, clearExisting: true}
[ComponentFactory] Getting all registered form services (0 total)
[2025-05-19T09:00:59.709Z] [UnifiedServiceRegistration] No existing service registrations found 
[ComponentFactory] Getting all registered form services (0 total)
[ComponentFactory] Registering form service for task type: kyb 
Object {serviceType: "EnhancedKybFormService", timestamp: "2025-05-19T09:00:59.709Z"}
[ComponentFactory] Current registered services: [kyb: EnhancedKybFormService]
[2025-05-19T09:00:59.709Z] [UnifiedServiceRegistration] Registered KybService for task type: kyb 
[ComponentFactory] Registering form service for task type: company_kyb 
Object {serviceType: "EnhancedKybFormService", timestamp: "2025-05-19T09:00:59.709Z"}
[ComponentFactory] Current registered services: [kyb: EnhancedKybFormService, company_kyb: EnhancedKybFormService]
[2025-05-19T09:00:59.709Z] [UnifiedServiceRegistration] Registered KybService for task type: company_kyb 
[UnifiedKY3PFormService] [Unified KY3P] Initializing service 
Object {companyId: undefined, taskId: undefined, timestamp: "2025-05-19T09:00:59.709Z"}
[ComponentFactory] Registering form service for task type: ky3p 
Object {serviceType: "UnifiedKY3PFormService", timestamp: "2025-05-19T09:00:59.709Z"}
[ComponentFactory] Current registered services: [kyb: EnhancedKybFormService, company_kyb: EnhancedKybFormService, ky3p: UnifiedKY3PFormService]
[2025-05-19T09:00:59.709Z] [UnifiedServiceRegistration] Registered KY3PService for task type: ky3p 
[UnifiedKY3PFormService] [Unified KY3P] Initializing service 
Object {companyId: undefined, taskId: undefined, timestamp: "2025-05-19T09:00:59.709Z"}
[ComponentFactory] Registering form service for task type: sp_ky3p_assessment 
Object {serviceType: "UnifiedKY3PFormService", timestamp: "2025-05-19T09:00:59.709Z"}
[ComponentFactory] Current registered services: [kyb: EnhancedKybFormService, company_kyb: EnhancedKybFormService, ky3p: UnifiedKY3PFormService, sp_ky3p_assessment: UnifiedKY3PFormService]
[2025-05-19T09:00:59.709Z] [UnifiedServiceRegistration] Registered KY3PService for task type: sp_ky3p_assessment 
[UnifiedKY3PFormService] [Unified KY3P] Initializing service 
Object {companyId: undefined, taskId: undefined, timestamp: "2025-05-19T09:00:59.709Z"}
[ComponentFactory] Registering form service for task type: security 
Object {serviceType: "UnifiedKY3PFormService", timestamp: "2025-05-19T09:00:59.709Z"}
[ComponentFactory] Current registered services: [kyb: EnhancedKybFormService, company_kyb: EnhancedKybFormService, ky3p: UnifiedKY3PFormService, sp_ky3p_assessment: UnifiedKY3PFormService, security: UnifiedKY3PFormService]
[2025-05-19T09:00:59.709Z] [UnifiedServiceRegistration] Registered KY3PService for task type: security 
[UnifiedKY3PFormService] [Unified KY3P] Initializing service 
Object {companyId: undefined, taskId: undefined, timestamp: "2025-05-19T09:00:59.709Z"}
[ComponentFactory] Registering form service for task type: security_assessment 
Object {serviceType: "UnifiedKY3PFormService", timestamp: "2025-05-19T09:00:59.709Z"}
[ComponentFactory] Current registered services: [kyb: EnhancedKybFormService, company_kyb: EnhancedKybFormService, ky3p: UnifiedKY3PFormService, sp_ky3p_assessment: UnifiedKY3PFormService, security: UnifiedKY3PFormService, security_assessment: UnifiedKY3PFormService]
[2025-05-19T09:00:59.709Z] [UnifiedServiceRegistration] Registered KY3PService for task type: security_assessment 
[Enhanced KYB Service] Enhanced KYB Form Service initialized with timestamp tracking
INFO: [OpenBankingFormService] Initializing Open Banking Form Service 
Object {companyId: undefined, taskId: undefined}
[ComponentFactory] Registering form service for task type: open_banking 
Object {serviceType: "OpenBankingFormService", timestamp: "2025-05-19T09:00:59.709Z"}
[ComponentFactory] Current registered services: [kyb: EnhancedKybFormService, company_kyb: EnhancedKybFormService, ky3p: UnifiedKY3PFormService, sp_ky3p_assessment: UnifiedKY3PFormService, security: UnifiedKY3PFormService, security_assessment: UnifiedKY3PFormService, open_banking: OpenBankingFormService]
[2025-05-19T09:00:59.709Z] [UnifiedServiceRegistration] Registered OpenBankingService for task type: open_banking 
[Enhanced KYB Service] Enhanced KYB Form Service initialized with timestamp tracking
INFO: [OpenBankingFormService] Initializing Open Banking Form Service 
Object {companyId: undefined, taskId: undefined}
[ComponentFactory] Registering form service for task type: open_banking_survey 
Object {serviceType: "OpenBankingFormService", timestamp: "2025-05-19T09:00:59.709Z"}
[ComponentFactory] Current registered services: [kyb: EnhancedKybFormService, company_kyb: EnhancedKybFormService, ky3p: UnifiedKY3PFormService, sp_ky3p_assessment: UnifiedKY3PFormService, security: UnifiedKY3PFormService, security_assessment: UnifiedKY3PFormService, open_banking: OpenBankingFormService, open_banking_survey: OpenBankingFormService]
[2025-05-19T09:00:59.710Z] [UnifiedServiceRegistration] Registered OpenBankingService for task type: open_banking_survey 
[ComponentFactory] Getting all registered form services (8 total)
[ComponentFactory] Registered service: kyb -> EnhancedKybFormService
[ComponentFactory] Registered service: company_kyb -> EnhancedKybFormService
[ComponentFactory] Registered service: ky3p -> UnifiedKY3PFormService
[ComponentFactory] Registered service: sp_ky3p_assessment -> UnifiedKY3PFormService
[ComponentFactory] Registered service: security -> UnifiedKY3PFormService
[ComponentFactory] Registered service: security_assessment -> UnifiedKY3PFormService
[ComponentFactory] Registered service: open_banking -> OpenBankingFormService
[ComponentFactory] Registered service: open_banking_survey -> OpenBankingFormService
[2025-05-19T09:00:59.710Z] [UnifiedServiceRegistration] Successfully registered 8 services: 
(8) ["kyb", "company_kyb", "ky3p", "sp_ky3p_assessment", "security", "security_assessment", "open_banking", "open_banking_survey"]
[2025-05-19T09:00:59.710Z] [PhaseStartup] Phase services completed successfully 
[2025-05-19T09:00:59.710Z] [PhaseStartup] Phase communication dependencies satisfied, executing... 
[2025-05-19T09:00:59.710Z] [PhaseStartup] Executing startup phase: communication 
[2025-05-19T09:00:59.710Z] [PhaseStartup] Executing 1 callbacks for phase communication 
[2025-05-19T09:00:59.710Z] [PhaseStartup] Executing callback 1/1 for phase communication 
[2025-05-19T09:00:59.710Z] [App] Communication phase initializing 
[2025-05-19T09:00:59.710Z] [PhaseStartup] Phase ready dependencies satisfied, executing... 
[2025-05-19T09:00:59.710Z] [PhaseStartup] Executing startup phase: ready 
[2025-05-19T09:00:59.710Z] [PhaseStartup] Executing 1 callbacks for ready phase - will complete immediately 
[2025-05-19T09:00:59.710Z] [App] Application ready for user interaction 
[2025-05-19T09:00:59.710Z] [PhaseStartup] Phase ready marked as completed immediately 
[2025-05-19T09:00:59.710Z] [PhaseStartup] Phase communication completed successfully 
[Router] Current location: /register
[RiskScore]:websocket Initializing WebSocket connection
[WebSocket] Connection attempt initiated
[RiskScore]:websocket Initializing WebSocket connection
[WebSocket] Connection attempt initiated
[TanStack Query] Response for /api/user: Status 401
[TanStack Query] 401 Unauthorized for /api/user, returning null as configured
[2025-05-19T09:00:59.897Z] [UnifiedServiceRegistration] QueryClient not available, skipping Risk Score Data Service initialization 
[WebSocket] WebSocket connection established
[WebSocket] Received message: 
Object {type: "connection_established", clientId: "client-1747645260179-r31ggus", timestamp: "2025-05-19T09:01:00.179Z", message: "Connection established"}
[WebSocket] Server connection confirmed: Connection established
[WebSocket] Received message: 
Object {type: "authenticated", timestamp: "2025-05-19T09:01:00.298Z", message: "Authentication successful"}
[2025-05-19T09:01:00.705Z] [WebSocket] Connecting to WebSocket: wss://9606074c-a9ad-4fe1-8fe5-3d9c3eed0606-00-33ar2rv36ligj.picard.replit.dev/ws
[WebSocket] Connection established
[WebSocket] Received message: 
Object {type: "connection_established", clientId: "client-1747645260724-s37977w", timestamp: "2025-05-19T09:01:00.724Z", message: "Connection established"}
[WebSocket] Connection established
[WebSocket] Received message: 
Object {type: "connection_established", clientId: "client-1747645261211-zrgvbob", timestamp: "2025-05-19T09:01:01.211Z", message: "Connection established"}
[WebSocket] Connection established
[WebSocket] Received message: 
Object {type: "connection_established", clientId: "client-1747645261702-ko9vns4", timestamp: "2025-05-19T09:01:01.703Z", message: "Connection established"}
[2025-05-19T09:01:02.228Z] [WebSocket] WebSocket connection established 
[2025-05-19T09:01:02.228Z] [WebSocket] Fetching current user data for WebSocket authentication 
[2025-05-19T09:01:02.229Z] [WebSocket] Received message of type: connection_established 
[2025-05-19T09:01:02.229Z] [WebSocket] WebSocket server connection confirmed with ID: client-1747645262245-4cj53i2 
[2025-05-19T09:01:02.411Z] [WebSocket] Sending authentication message 
Object {userId: "8", companyId: "1", connectionId: "ws_1747645260706_ub5cvi0lg", hasUserData: false, hasCompanyData: false}
[2025-05-19T09:01:02.526Z] [WebSocket] Received message of type: authenticated 
[2025-05-19T09:01:02.526Z] [WebSocket] WebSocket authentication confirmed for client: unknown 
[Registration] Starting code validation for: D6284C
[Registration] Validating invitation code: D6284C
[Registration] Raw validation response: 
Object {valid: true, invitation: {…}}
[Registration] Full validation result: 
Object {status: "success", fetchStatus: "idle", isPending: false, isSuccess: true, isError: false, …}
[Registration] Extracted invitation data: 
Object {email: "e@e.com", invitee_name: "DemoTest", company_name: "Invela"}
[Registration] Pre-filling registration form with: 
Object {email: "e@e.com", company: "Invela", firstName: "DemoTest", lastName: "", fullName: "DemoTest"}
[Registration] Form values after pre-fill: 
Object {invitationCode: "D6284C", email: "e@e.com", company: "Invela", firstName: "DemoTest", lastName: "", …}
[Registration] Starting registration with values: 
Object {invitationCode: "D6284C", email: "e@e.com", password: "password", firstName: "Demo", lastName: "Test", …}
[Registration] Submitting registration with fullName: Demo Test
[Auth] Registration error response: 
Object {status: 400, statusText: "Bad Request", contentType: "text/html; charset=utf-8"}
contentType: "text/html; charset=utf-8"
status: 400
statusText: "Bad Request"
[[Prototype]]: Object
[Auth] Original registration error: This account already exists. Please try signing in instead.
[Registration] Registration error: 
Error {}

[WebSocket] Received message: 
Object {type: "pong", timestamp: "2025-05-19T09:01:30.299Z", echo: {…}}
[WebSocket] Received message: 
Object {type: "pong", timestamp: "2025-05-19T09:01:31.331Z", echo: {…}}
[WebSocket] Received message: 
Object {type: "pong", timestamp: "2025-05-19T09:01:31.821Z", echo: {…}}