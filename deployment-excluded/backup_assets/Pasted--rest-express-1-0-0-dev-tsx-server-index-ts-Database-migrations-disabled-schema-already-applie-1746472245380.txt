> rest-express@1.0.0 dev
> tsx server/index.ts

Database migrations disabled - schema already applied
[EmailService] Initializing email service
[EmailService] Email service initialized successfully
[OpenAI] Service initialized with API key: API key is set
Database module not found, creating a mock implementation
Database module not found, creating a mock implementation
[Auth] Setting up authentication...
[Auth] Setting up PostgreSQL session store
[Auth] PostgreSQL session store initialized successfully
[Auth] Authentication setup completed
[2025-05-05T19:06:14.918Z] [INFO] [KY3P-BATCH-UPDATE] Registering KY3P batch update routes
[2025-05-05T19:06:14.918Z] [INFO] Registering KY3P batch update routes
[2025-05-05T19:06:14.918Z] [INFO] [UnifiedKY3P] Registering unified KY3P update routes
[Routes] Registered KY3P field key router
[Routes] Registered KY3P field key router
[2025-05-05T19:06:14.918Z] [INFO] Registering KY3P field update routes
[2025-05-05T19:06:14.919Z] [INFO] [OpenBankingRoutes] Setting up routes...
[Routes] Setting up unified form submission router
[Routes] Successfully registered unified form submission router
[Routes] Setting up transactional form submission router
[Routes] Successfully registered transactional form submission router
[Routes] Routes setup completed
[INFO] Unified WebSocket server initialized successfully with details: {
  clients: 0,
  path: '/ws',
  id: 'entkh3',
  timestamp: '2025-05-05T19:06:14.922Z'
}
7:06:14 PM [info] [ServerStartup] WebSocket server initialized with unified implementation
[2025-05-05T19:06:14.940Z] [INFO] [TaskWebSocket] WebSocket server registered with unified implementation
7:06:14 PM [info] [ServerStartup] WebSocket server registered with task-update utility
[TaskBroadcast] WebSocket server reference set up
[TaskBroadcast] WebSocket server active with 0 connected clients
7:06:14 PM [info] [ServerStartup] WebSocket server registered with task-broadcast utility
7:06:14 PM [info] Setting up Vite development server
[ENV] Using PORT=5000 from environment (override: yes)
[ENV] Environment=development (production: no)
7:06:14 PM [express] Server running on 0.0.0.0:5000
7:06:14 PM [express] Environment: development
[Deployment] Server running on 0.0.0.0:5000
[Deployment] Environment: development
[Deployment] Port forwarding: Custom port: 5000
[Deployment] Development mode: Hot reloading enabled
7:06:14 PM [express] Starting periodic task reconciliation system...
[PeriodicTaskReconciliation] Stopped periodic reconciliation system
[PeriodicTaskReconciliation] Starting periodic reconciliation system (interval: 300000ms)
7:06:14 PM [express] Task reconciliation system initialized successfully
[2025-05-05T19:06:15.597Z] New client connected to the pool (1/3)
7:06:16 PM [info] [ServerStartup] WebSocket server active with 0 connected clients
[INFO] [WebSocket] Client connected: client-1746471976098-4o0ootn
[INFO] [WebSocket] Received message from client client-1746471976098-4o0ootn: {
  type: 'authenticate',
  userId: null,
  companyId: null,
  clientId: 'ws_1746465182841_cysidkymn',
  timestamp: '2025-05-05T19:06:16.057Z'
}
[INFO] [WebSocket] Authentication from client client-1746471976098-4o0ootn: { userId: null, companyId: null, hasToken: true }
[INFO] [WebSocket] Client connected: client-1746471977021-kdnqw1u
[INFO] [WebSocket] Received message from client client-1746471977021-kdnqw1u: {
  type: 'authenticate',
  data: { timestamp: '2025-05-05T19:06:16.983Z' }
}
[INFO] [WebSocket] Authentication from client client-1746471977021-kdnqw1u: { userId: undefined, companyId: undefined, hasToken: true }
[INFO] [WebSocket] Client connected: client-1746471979090-9kigz3v
[2025-05-05T19:06:20.250Z] New client connected to the pool (2/3)
[2025-05-05T19:06:20.251Z] New client connected to the pool (3/3)
[Auth] Returning user session data
[Current Company] Fetching company for user: { userId: 311, companyId: 268 }
[Current Company] Found company: {
  id: 268,
  name: 'DevTest13',
  onboardingCompleted: false,
  riskScore: null,
  chosenScore: null,
  isDemo: true
}
7:06:21 PM [info] GET /api/companies/current 304 in 81ms :: {"id":268,"name":"DevTest13","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746471979090-9kigz3v: {
  type: 'authenticate',
  userId: 311,
  companyId: 268,
  clientId: 'ws_1746471976511_17ekzuils',
  timestamp: '2025-05-05T19:06:21.004Z'
}
[INFO] [WebSocket] Authentication from client client-1746471979090-9kigz3v: { userId: 311, companyId: 268, hasToken: true }
[INFO] [WebSocket] Client connected: client-1746471983247-7k733lv
[Auth] Unauthenticated user session
[INFO] [WebSocket] Received message from client client-1746471983247-7k733lv: {
  type: 'authenticate',
  data: { timestamp: '2025-05-05T19:06:23.352Z' }
}
[INFO] [WebSocket] Authentication from client client-1746471983247-7k733lv: { userId: undefined, companyId: undefined, hasToken: false }
[INFO] [WebSocket] Client disconnected: client-1746471983247-7k733lv
[Auth] Returning user session data
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 311, company_id: 268, email: '13@e.com' }
[2025-05-05T19:06:32.239Z] [INFO] Performing dynamic task unlocking check for company {"companyId":268,"userId":311}
7:06:32 PM [info] GET /api/companies/current 304 in 31ms :: {"id":268,"name":"DevTest13","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-05T19:06:32.270Z] [INFO] No completed KYB tasks found, skipping security task unlock check {"companyId":268}
[Tasks] Automatically unlocking all tasks for company { userId: 311, companyId: 268, requestedBy: 'automatic_task_unlock' }
[2025-05-05T19:06:32.271Z] [INFO] [TaskDependencies] Unlocking ALL tasks for company {"companyId":268}
[2025-05-05T19:06:32.304Z] [INFO] [TaskDependencies] Found tasks to unlock {"companyId":268,"count":3,"taskIds":[742,743,744],"taskTypes":["company_kyb","ky3p","open_banking"],"ky3pTaskCount":1,"ky3pTaskIds":[743]}
[2025-05-05T19:06:32.334Z] [INFO] [UnifiedProgressCalc] Preserving existing progress for task 742 (company_kyb): 100% {"taskId":742,"taskType":"company_kyb","existingProgress":100,"operation":"preserve-existing"}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 100,
  currentStatus: 'ready_for_submission',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  effectiveHasResponses: true,
  timestamp: '2025-05-05T19:06:32.366Z'
}
[STATUS DETERMINATION] Task has 100% progress but is not submitted, setting to READY_FOR_SUBMISSION
[INFO] [WebSocket] Client connected: client-1746471992370-5666sfi
[2025-05-05T19:06:32.398Z] [INFO] [ProgressUpdate] Updated task 742 progress to 100% and status to ready_for_submission {"taskId":742,"taskType":"company_kyb","progress":100,"status":"ready_for_submission","previousStatus":"ready_for_submission"}
[2025-05-05T19:06:32.399Z] [INFO] Successfully retrieved unified WebSocket server for broadcast
[WebSocket] Broadcast task_update to 4 clients (0 errors) { messageId: 'msg_1746471992400_37zbtfd1u' }
[2025-05-05T19:06:32.400Z] [INFO] Successfully broadcasted task_update message
[2025-05-05T19:06:32.400Z] [INFO] [ProgressUpdate] Broadcasted progress update for task 742 {"taskId":742,"progress":100,"status":"ready_for_submission"}
[2025-05-05T19:06:32.400Z] [INFO] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":268,"taskId":742,"taskType":"company_kyb","isKy3pTask":false,"calculatedProgress":100,"previousProgress":100,"wasPreserved":true}
[2025-05-05T19:06:32.400Z] [INFO] [TaskDependencies] Processing KY3P task {"taskId":743,"taskType":"ky3p","currentProgress":100,"currentStatus":"ready_for_submission","timestamp":"2025-05-05T19:06:32.400Z"}
[2025-05-05T19:06:32.429Z] [INFO] [UnifiedProgressCalc] Preserving existing progress for task 743 (ky3p): 100% {"taskId":743,"taskType":"ky3p","existingProgress":100,"operation":"preserve-existing"}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 100,
  currentStatus: 'ready_for_submission',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  effectiveHasResponses: true,
  timestamp: '2025-05-05T19:06:32.459Z'
}
[STATUS DETERMINATION] Task has 100% progress but is not submitted, setting to READY_FOR_SUBMISSION
7:06:32 PM [info] GET /api/companies/current 304 in 31ms :: {"id":268,"name":"DevTest13","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-05T19:06:32.489Z] [INFO] [ProgressUpdate] Updated task 743 progress to 100% and status to ready_for_submission {"taskId":743,"taskType":"ky3p","progress":100,"status":"ready_for_submission","previousStatus":"ready_for_submission"}
[WebSocket] Broadcast task_update to 4 clients (0 errors) { messageId: 'msg_1746471992489_yrk6hjpd0' }
[2025-05-05T19:06:32.490Z] [INFO] Successfully broadcasted task_update message
[2025-05-05T19:06:32.490Z] [INFO] [ProgressUpdate] Broadcasted progress update for task 743 {"taskId":743,"progress":100,"status":"ready_for_submission"}
[2025-05-05T19:06:32.490Z] [INFO] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":268,"taskId":743,"taskType":"ky3p","isKy3pTask":true,"calculatedProgress":100,"previousProgress":100,"wasPreserved":true}
[INFO] [WebSocket] Received message from client client-1746471992370-5666sfi: {
  type: 'authenticate',
  data: { timestamp: '2025-05-05T19:06:32.331Z' }
}
[INFO] [WebSocket] Authentication from client client-1746471992370-5666sfi: { userId: undefined, companyId: undefined, hasToken: true }
[2025-05-05T19:06:32.601Z] [INFO] [UnifiedProgressCalc] Calculated progress for task 744 (open_banking): 0/44 = 0% {"taskId":744,"taskType":"open_banking","totalFields":"44","completedFields":"0","progress":0}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  effectiveHasResponses: false,
  timestamp: '2025-05-05T19:06:32.639Z'
}
[STATUS DETERMINATION] Task has 0% progress and no responses, setting to NOT_STARTED
[2025-05-05T19:06:32.671Z] [INFO] [ProgressUpdate] Updated task 744 progress to 0% and status to not_started {"taskId":744,"taskType":"open_banking","progress":0,"status":"not_started","previousStatus":"not_started"}
[WebSocket] Broadcast task_update to 4 clients (0 errors) { messageId: 'msg_1746471992672_bqqvu9pvs' }
[2025-05-05T19:06:32.673Z] [INFO] Successfully broadcasted task_update message
[2025-05-05T19:06:32.673Z] [INFO] [ProgressUpdate] Broadcasted progress update for task 744 {"taskId":744,"progress":0,"status":"not_started"}
[2025-05-05T19:06:32.673Z] [INFO] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":268,"taskId":744,"taskType":"open_banking","isKy3pTask":false,"calculatedProgress":0,"previousProgress":0,"wasPreserved":false}
[2025-05-05T19:06:32.673Z] [INFO] [TaskDependencies] Successfully unlocked all tasks {"companyId":268,"count":3}
[Tasks] Successfully unlocked all tasks for company: 268
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 311',
    condition2: 'tasks.created_by = 311',
    condition3: "tasks.company_id = 268 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('13@e.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
7:06:32 PM [info] GET /api/tasks 200 in 541ms :: [{"id":742,"title":"1. KYB Form: DevTest13","description":"Complete KYB verif...
7:06:32 PM [info] GET /api/tasks 304 in 30ms :: [{"id":742,"title":"1. KYB Form: DevTest13","description":"Complete KYB verif...
[INFO] [WebSocket] Client connected: client-1746471992978-a2tcl82
[INFO] [WebSocket] Received message from client client-1746471992978-a2tcl82: {
  type: 'authenticate',
  userId: null,
  companyId: null,
  clientId: 'ws_1746471991797_ty8rsblq4',
  timestamp: '2025-05-05T19:06:32.937Z'
}
[INFO] [WebSocket] Authentication from client client-1746471992978-a2tcl82: { userId: null, companyId: null, hasToken: true }
[INFO] [WebSocket] Client connected: client-1746471993475-hm1uhu8
[Auth] Returning user session data
7:06:33 PM [info] GET /api/companies/current 304 in 31ms :: {"id":268,"name":"DevTest13","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746471993475-hm1uhu8: {
  type: 'authenticate',
  userId: 311,
  companyId: 268,
  clientId: 'ws_1746471992843_i4qphgujp',
  timestamp: '2025-05-05T19:06:33.930Z'
}
[INFO] [WebSocket] Authentication from client client-1746471993475-hm1uhu8: { userId: 311, companyId: 268, hasToken: true }
7:06:35 PM [info] GET /api/companies/current 304 in 40ms :: {"id":268,"name":"DevTest13","category":"FinTech","is_demo":true,"revenue_tie...
7:06:38 PM [info] GET /api/companies/current 304 in 42ms :: {"id":268,"name":"DevTest13","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746471979090-9kigz3v: {
  type: 'ping',
  timestamp: '2025-05-05T19:06:39.512Z',
  connectionId: 'ws_1746471976511_17ekzuils'
}
7:06:41 PM [info] GET /api/companies/current 304 in 31ms :: {"id":268,"name":"DevTest13","category":"FinTech","is_demo":true,"revenue_tie...
7:06:44 PM [info] GET /api/companies/current 304 in 47ms :: {"id":268,"name":"DevTest13","category":"FinTech","is_demo":true,"revenue_tie...
[PeriodicTaskReconciliation] Reconciling batch of 10 tasks: [
  685, 679, 697, 699,
  691, 702, 710, 714,
  707, 689
]
[Task Progress] Calculated progress for task 685 (company_kyb): 30/30 = 100%
[Task Progress] Calculated progress for task 679 (open_banking): 44/44 = 100%
[Task Progress] Calculated progress for task 697 (company_kyb): 30/30 = 100%
[Task Progress] Calculated progress for task 699 (open_banking): 0/44 = 0%
[Task Progress] Calculated progress for task 691 (open_banking): 0/44 = 0%
[Task Progress] Calculated progress for task 702 (ky3p): 0/0 = 0%
[Task Progress] Calculated progress for task 710 (ky3p): 0/120 = 0%
[Task Progress] Calculated progress for task 714 (ky3p): 0/0 = 0%
[Task Progress] Calculated progress for task 707 (open_banking): 0/44 = 0%
[Task Progress] Calculated progress for task 689 (company_kyb): 30/30 = 100%
7:06:47 PM [info] GET /api/companies/current 304 in 32ms :: {"id":268,"name":"DevTest13","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746471977021-kdnqw1u: { type: 'ping' }
7:06:47 PM [info] GET /api/tasks 304 in 31ms :: [{"id":742,"title":"1. KYB Form: DevTest13","description":"Complete KYB verif...
7:06:50 PM [info] GET /api/companies/current 304 in 31ms :: {"id":268,"name":"DevTest13","category":"FinTech","is_demo":true,"revenue_tie...
7:06:53 PM [info] GET /api/companies/current 304 in 47ms :: {"id":268,"name":"DevTest13","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746471993475-hm1uhu8: {
  type: 'ping',
  timestamp: '2025-05-05T19:06:53.440Z',
  connectionId: 'ws_1746471992843_i4qphgujp'
}
7:06:56 PM [info] GET /api/companies/current 304 in 31ms :: {"id":268,"name":"DevTest13","category":"FinTech","is_demo":true,"revenue_tie...
[Auth] Processing logout request
[Auth] Clearing user 311 from cache during logout
[Auth] Clearing company 268 from cache during logout
[Cache] Invalidating company cache for company 268
[Auth] Cache invalidation result for company 268: true
[Auth] Broadcasting cache invalidation WebSocket message
[WebSocket] Broadcast cache_invalidation to 6 clients (0 errors) { messageId: 'msg_1746472017498_djqyjxbvw' }
[2025-05-05T19:06:57.499Z] [INFO] Successfully broadcasted cache_invalidation message
[Auth] Logout successful for user: 311
[Auth] Session successfully destroyed
[Auth] Unauthenticated user session
[INFO] [WebSocket] Received message from client client-1746471979090-9kigz3v: {
  type: 'ping',
  timestamp: '2025-05-05T19:06:59.512Z',
  connectionId: 'ws_1746471976511_17ekzuils'
}
[INFO] [WebSocket] Received message from client client-1746471992370-5666sfi: { type: 'ping' }
7:07:05 PM [warn] GET /api/companies/current 401 in 0ms :: {"error":"Unauthorized","message":"Authentication required","details":{"authe...
[Invite Debug] Starting validation for code: 15A1F0
[Invite Debug] Found valid invitation: {
  id: 319,
  email: '14@e.com',
  status: 'pending',
  expires_at: 2025-05-10T19:18:58.978Z
}
7:07:11 PM [info] GET /api/invitations/15A1F0/validate 200 in 31ms :: {"valid":true,"invitation":{"email":"14@e.com","invitee_name":"John Doe","com...
[INFO] [WebSocket] Received message from client client-1746471993475-hm1uhu8: {
  type: 'ping',
  timestamp: '2025-05-05T19:07:13.440Z',
  connectionId: 'ws_1746471992843_i4qphgujp'
}
[Account Setup] Processing setup request for: 14@e.com
[Account Setup] Updated user: { id: 312, email: '14@e.com', onboarding_completed: false }
[Account Setup] Updated task status: { taskId: 745, status: 'completed', progress: 100 }
[INFO] [WebSocket] Broadcast task_update to 6 clients
[Auth] Serializing user: 312
[Account Setup] Login successful for user ID: 312
7:07:14 PM [info] POST /api/account/setup 200 in 382ms :: {"id":312,"email":"14@e.com","full_name":"John Doe","first_name":"John","last...
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 312, company_id: 269, email: '14@e.com' }
[2025-05-05T19:07:15.170Z] [INFO] Performing dynamic task unlocking check for company {"companyId":269,"userId":312}
[Current Company] Fetching company for user: { userId: 312, companyId: 269 }
[Current Company] Found company: {
  id: 269,
  name: 'DevTest14',
  onboardingCompleted: false,
  riskScore: null,
  chosenScore: null,
  isDemo: true
}
[2025-05-05T19:07:15.204Z] [INFO] No completed KYB tasks found, skipping security task unlock check {"companyId":269}
[Tasks] Automatically unlocking all tasks for company { userId: 312, companyId: 269, requestedBy: 'automatic_task_unlock' }
[2025-05-05T19:07:15.205Z] [INFO] [TaskDependencies] Unlocking ALL tasks for company {"companyId":269}
7:07:15 PM [info] GET /api/companies/current 200 in 61ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-05T19:07:15.234Z] [INFO] [TaskDependencies] Found tasks to unlock {"companyId":269,"count":3,"taskIds":[747,746,748],"taskTypes":["ky3p","company_kyb","open_banking"],"ky3pTaskCount":1,"ky3pTaskIds":[747]}
[2025-05-05T19:07:15.234Z] [INFO] [TaskDependencies] Processing KY3P task {"taskId":747,"taskType":"ky3p","currentProgress":60,"currentStatus":"in_progress","timestamp":"2025-05-05T19:07:15.234Z"}
[2025-05-05T19:07:15.266Z] [INFO] [UnifiedProgressCalc] Preserving existing progress for task 747 (ky3p): 60% {"taskId":747,"taskType":"ky3p","existingProgress":60,"operation":"preserve-existing"}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 60,
  currentStatus: 'in_progress',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  effectiveHasResponses: true,
  timestamp: '2025-05-05T19:07:15.295Z'
}
[STATUS DETERMINATION] Task has partial progress or responses, setting to IN_PROGRESS
[2025-05-05T19:07:15.326Z] [INFO] [ProgressUpdate] Updated task 747 progress to 60% and status to in_progress {"taskId":747,"taskType":"ky3p","progress":60,"status":"in_progress","previousStatus":"in_progress"}
[WebSocket] Broadcast task_update to 6 clients (0 errors) { messageId: 'msg_1746472035327_355yfsbut' }
[2025-05-05T19:07:15.327Z] [INFO] Successfully broadcasted task_update message
[2025-05-05T19:07:15.327Z] [INFO] [ProgressUpdate] Broadcasted progress update for task 747 {"taskId":747,"progress":60,"status":"in_progress"}
[2025-05-05T19:07:15.327Z] [INFO] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":269,"taskId":747,"taskType":"ky3p","isKy3pTask":true,"calculatedProgress":60,"previousProgress":60,"wasPreserved":true}
[2025-05-05T19:07:15.428Z] [INFO] [UnifiedProgressCalc] Calculated progress for task 746 (company_kyb): 0/30 = 0% {"taskId":746,"taskType":"company_kyb","totalFields":"30","completedFields":"0","progress":0}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  effectiveHasResponses: false,
  timestamp: '2025-05-05T19:07:15.458Z'
}
[STATUS DETERMINATION] Task has 0% progress and no responses, setting to NOT_STARTED
7:07:15 PM [info] GET /api/companies/current 304 in 30ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
[2025-05-05T19:07:15.487Z] [INFO] [ProgressUpdate] Updated task 746 progress to 0% and status to not_started {"taskId":746,"taskType":"company_kyb","progress":0,"status":"not_started","previousStatus":"not_started"}
[WebSocket] Broadcast task_update to 6 clients (0 errors) { messageId: 'msg_1746472035488_qju2zrt6o' }
[2025-05-05T19:07:15.489Z] [INFO] Successfully broadcasted task_update message
[2025-05-05T19:07:15.489Z] [INFO] [ProgressUpdate] Broadcasted progress update for task 746 {"taskId":746,"progress":0,"status":"not_started"}
[2025-05-05T19:07:15.489Z] [INFO] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":269,"taskId":746,"taskType":"company_kyb","isKy3pTask":false,"calculatedProgress":0,"previousProgress":0,"wasPreserved":false}
[2025-05-05T19:07:15.576Z] [INFO] [UnifiedProgressCalc] Calculated progress for task 748 (open_banking): 0/44 = 0% {"taskId":748,"taskType":"open_banking","totalFields":"44","completedFields":"0","progress":0}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  effectiveHasResponses: false,
  timestamp: '2025-05-05T19:07:15.606Z'
}
[STATUS DETERMINATION] Task has 0% progress and no responses, setting to NOT_STARTED
[2025-05-05T19:07:15.637Z] [INFO] [ProgressUpdate] Updated task 748 progress to 0% and status to not_started {"taskId":748,"taskType":"open_banking","progress":0,"status":"not_started","previousStatus":"not_started"}
[WebSocket] Broadcast task_update to 6 clients (0 errors) { messageId: 'msg_1746472035637_5wpijxbu5' }
[2025-05-05T19:07:15.638Z] [INFO] Successfully broadcasted task_update message
[2025-05-05T19:07:15.638Z] [INFO] [ProgressUpdate] Broadcasted progress update for task 748 {"taskId":748,"progress":0,"status":"not_started"}
[2025-05-05T19:07:15.638Z] [INFO] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":269,"taskId":748,"taskType":"open_banking","isKy3pTask":false,"calculatedProgress":0,"previousProgress":0,"wasPreserved":false}
[2025-05-05T19:07:15.638Z] [INFO] [TaskDependencies] Successfully unlocked all tasks {"companyId":269,"count":3}
[Tasks] Successfully unlocked all tasks for company: 269
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 312',
    condition2: 'tasks.created_by = 312',
    condition3: "tasks.company_id = 269 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('14@e.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
7:07:15 PM [info] GET /api/tasks 200 in 568ms :: [{"id":745,"title":"New User Invitation: 14@e.com","description":"Complete us...
7:07:15 PM [info] GET /api/tasks 304 in 33ms :: [{"id":745,"title":"New User Invitation: 14@e.com","description":"Complete us...
[INFO] [WebSocket] Received message from client client-1746471977021-kdnqw1u: { type: 'ping' }
[User Onboarding] Completing onboarding for user: 312
[User Onboarding] Updated user onboarding status: { id: 312, onboarding_completed: true }
7:07:18 PM [info] POST /api/user/complete-onboarding 200 in 107ms :: {"id":312,"email":"14@e.com","full_name":"John Doe","first_name":"John","last...
[Auth] Returning user session data
7:07:18 PM [info] GET /api/companies/current 304 in 31ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
7:07:18 PM [info] GET /api/tasks 304 in 36ms :: [{"id":745,"title":"New User Invitation: 14@e.com","description":"Complete us...
7:07:18 PM [info] GET /api/tasks 304 in 30ms :: [{"id":745,"title":"New User Invitation: 14@e.com","description":"Complete us...
[INFO] [WebSocket] Received message from client client-1746471979090-9kigz3v: {
  type: 'ping',
  timestamp: '2025-05-05T19:07:19.511Z',
  connectionId: 'ws_1746471976511_17ekzuils'
}
7:07:21 PM [info] GET /api/companies/current 304 in 32ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
7:07:24 PM [info] GET /api/companies/current 304 in 29ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
7:07:27 PM [info] GET /api/companies/current 304 in 35ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
7:07:27 PM [info] GET /api/tasks/747 200 in 61ms :: {"id":747,"title":"2. S&P KY3P Security Assessment: DevTest14","description":...
[Task Templates API] Fetching template for task type: ky3p, user: 312
[Task Templates API] Found template: 48 (S&P KY3P Security Assessment) for task type: ky3p
7:07:27 PM [info] GET /api/companies/current 304 in 32ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
7:07:27 PM [info] GET /api/tasks/747 304 in 61ms :: {"id":747,"title":"2. S&P KY3P Security Assessment: DevTest14","description":...
[Task Templates API] Retrieved 10 configuration items for template ID: 48
7:07:27 PM [info] GET /api/task-templates/by-type/ky3p 304 in 228ms :: {"id":48,"name":"S&P KY3P Security Assessment","description":"S&P KY3P Securi...
[2025-05-05T19:07:27.984Z] [INFO] Fetching all KY3P fields
[2025-05-05T19:07:28.089Z] [INFO] Successfully retrieved 120 KY3P fields
7:07:28 PM [info] GET /api/ky3p-fields 304 in 148ms :: [{"id":1,"order":1,"field_key":"externalSystems","display_name":"External Sys...
[2025-05-05T19:07:28.301Z] [INFO] Fetching KY3P progress for task 747
[2025-05-05T19:07:28.382Z] [INFO] Retrieved 10 responses for task 747
7:07:28 PM [info] GET /api/ky3p/progress/747 200 in 160ms :: {"success":true,"taskId":747,"status":"in_progress","responses":[{"id":122290...
[2025-05-05T19:07:28.621Z] [INFO] Fetching KY3P progress for task 747
[2025-05-05T19:07:28.682Z] [INFO] Retrieved 10 responses for task 747
7:07:28 PM [info] GET /api/tasks/747 304 in 61ms :: {"id":747,"title":"2. S&P KY3P Security Assessment: DevTest14","description":...
[2025-05-05T19:07:28.836Z] [INFO] Fetching KY3P responses for task 747
7:07:28 PM [info] GET /api/ky3p/progress/747 304 in 219ms :: {"success":true,"taskId":747,"status":"in_progress","responses":[{"id":122290...
[2025-05-05T19:07:28.894Z] [INFO] Retrieved 10 responses for task 747
7:07:28 PM [info] GET /api/tasks/747/ky3p-responses 200 in 92ms :: {"success":true,"taskId":747,"status":"in_progress","responses":[{"id":122290...
7:07:29 PM [info] GET /api/tasks/747 304 in 74ms :: {"id":747,"title":"2. S&P KY3P Security Assessment: DevTest14","description":...
[2025-05-05T19:07:29.114Z] [INFO] Fetching KY3P progress for task 747
[2025-05-05T19:07:29.175Z] [INFO] Retrieved 10 responses for task 747
[2025-05-05T19:07:29.224Z] [INFO] Fetching KY3P responses for task 747
7:07:29 PM [info] GET /api/ky3p/progress/747 304 in 151ms :: {"success":true,"taskId":747,"status":"in_progress","responses":[{"id":122290...
[2025-05-05T19:07:29.299Z] [INFO] Retrieved 10 responses for task 747
7:07:29 PM [info] GET /api/tasks/747/ky3p-responses 304 in 108ms :: {"success":true,"taskId":747,"status":"in_progress","responses":[{"id":122290...
[2025-05-05T19:07:29.483Z] [INFO] Fetching KY3P progress for task 747
[2025-05-05T19:07:29.548Z] [INFO] Retrieved 10 responses for task 747
7:07:29 PM [info] GET /api/ky3p/progress/747 304 in 128ms :: {"success":true,"taskId":747,"status":"in_progress","responses":[{"id":122290...
7:07:30 PM [info] GET /api/companies/current 304 in 31ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746471992370-5666sfi: { type: 'ping' }
7:07:33 PM [info] GET /api/tasks 304 in 30ms :: [{"id":745,"title":"New User Invitation: 14@e.com","description":"Complete us...
[INFO] [WebSocket] Received message from client client-1746471993475-hm1uhu8: {
  type: 'ping',
  timestamp: '2025-05-05T19:07:33.440Z',
  connectionId: 'ws_1746471992843_i4qphgujp'
}
7:07:33 PM [info] GET /api/companies/current 304 in 40ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
7:07:33 PM [info] GET /api/tasks 304 in 40ms :: [{"id":745,"title":"New User Invitation: 14@e.com","description":"Complete us...
7:07:34 PM [info] GET /api/tasks 304 in 63ms :: [{"id":745,"title":"New User Invitation: 14@e.com","description":"Complete us...
7:07:34 PM [info] GET /api/tasks/746 200 in 58ms :: {"id":746,"title":"1. KYB Form: DevTest14","description":"Complete KYB verifi...
7:07:34 PM [info] GET /api/companies/current 304 in 60ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
[Task Templates API] Fetching template for task type: company_kyb, user: 312
[Task Templates API] Found template: 1 (KYB Form) for task type: company_kyb
[Task Templates API] Retrieved 9 configuration items for template ID: 1
7:07:34 PM [info] GET /api/tasks/746 304 in 88ms :: {"id":746,"title":"1. KYB Form: DevTest14","description":"Complete KYB verifi...
7:07:34 PM [info] GET /api/task-templates/by-type/company_kyb 304 in 98ms :: {"id":1,"name":"KYB Form","description":"Know Your Business form for company ...
[2025-05-05T19:07:35.143Z] [INFO] Fetching KYB fields
[2025-05-05T19:07:35.174Z] [INFO] KYB fields retrieved successfully {"fieldCount":30,"groups":["companyProfile","financialProfile","governanceLeadership","operationsCompliance"]}
7:07:35 PM [info] GET /api/kyb/fields 304 in 61ms :: [{"id":1,"field_key":"legalEntityName","display_name":"Legal Entity Name","fi...
[KYB API Debug] Loading progress for task: 746
[Task Reconciliation] Found 0 responses for task 746 (type: company_kyb)
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  effectiveHasResponses: false,
  timestamp: '2025-05-05T19:07:35.437Z'
}
[STATUS DETERMINATION] Task has 0% progress and no responses, setting to NOT_STARTED
[Task Reconciliation] Progress calculation: {
  taskId: 746,
  currentProgress: 0,
  calculatedProgress: 0,
  currentStatus: 'not_started',
  calculatedStatus: 'not_started',
  responseCount: 0,
  completeCount: 0
}
[Task Reconciliation] No updates needed for task 746
[KYB API Debug] Retrieved task: {
  taskId: 746,
  status: 'not_started',
  progress: 0,
  metadata: [
    'locked',
    'company_id',
    'created_at',
    'isKy3pTask',
    'created_via',
    'status_flow',
    'company_name',
    'created_by_id',
    'previousStatus',
    'prerequisite_for',
    'previousProgress',
    'lastProgressUpdate',
    'progressHistoryEntry',
    'prerequisite_completed',
    'dependencyUnlockOperation',
    'prerequisite_completed_at'
  ],
  timestamp: '2025-05-05T19:07:35.466Z'
}
[KYB API Debug] Retrieved responses: { responseCount: 0, fields: [], timestamp: '2025-05-05T19:07:35.495Z' }
[SERVER DEBUG] No savedFormData found in task table
[SERVER DEBUG] No KYB form file ID found in task metadata
[KYB API Debug] Retrieved task data: {
  id: 746,
  responseCount: 0,
  progress: 0,
  status: 'not_started',
  formDataKeys: []
}
===============================================
[SERVER DEBUG] PREPARING GET RESPONSE at 2025-05-05T19:07:35.495Z
[SERVER DEBUG] Task ID: 746, Found 0 fields in database
===============================================
[SERVER DEBUG] Checking field corporateRegistration in retrieved data: NOT PRESENT
[SERVER DEBUG] Checking field goodStanding in retrieved data: NOT PRESENT
[SERVER DEBUG] Checking field regulatoryActions in retrieved data: NOT PRESENT
[SERVER DEBUG] Checking field investigationsIncidents in retrieved data: NOT PRESENT
[SERVER DEBUG] No fields with value "asdf" found in GET response data
[SERVER DEBUG] Sending GET response with 0 fields, status: not_started, progress: 0%
===============================================
7:07:35 PM [info] GET /api/kyb/progress/746 200 in 154ms :: {"formData":{},"progress":0,"status":"not_started"}
[KYB API Debug] Loading progress for task: 746
[Task Reconciliation] Found 0 responses for task 746 (type: company_kyb)
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  effectiveHasResponses: false,
  timestamp: '2025-05-05T19:07:35.737Z'
}
[STATUS DETERMINATION] Task has 0% progress and no responses, setting to NOT_STARTED
[Task Reconciliation] Progress calculation: {
  taskId: 746,
  currentProgress: 0,
  calculatedProgress: 0,
  currentStatus: 'not_started',
  calculatedStatus: 'not_started',
  responseCount: 0,
  completeCount: 0
}
[Task Reconciliation] No updates needed for task 746
[KYB API Debug] Retrieved task: {
  taskId: 746,
  status: 'not_started',
  progress: 0,
  metadata: [
    'locked',
    'company_id',
    'created_at',
    'isKy3pTask',
    'created_via',
    'status_flow',
    'company_name',
    'created_by_id',
    'previousStatus',
    'prerequisite_for',
    'previousProgress',
    'lastProgressUpdate',
    'progressHistoryEntry',
    'prerequisite_completed',
    'dependencyUnlockOperation',
    'prerequisite_completed_at'
  ],
  timestamp: '2025-05-05T19:07:35.766Z'
}
[KYB API Debug] Retrieved responses: { responseCount: 0, fields: [], timestamp: '2025-05-05T19:07:35.800Z' }
[SERVER DEBUG] No savedFormData found in task table
[SERVER DEBUG] No KYB form file ID found in task metadata
[KYB API Debug] Retrieved task data: {
  id: 746,
  responseCount: 0,
  progress: 0,
  status: 'not_started',
  formDataKeys: []
}
===============================================
[SERVER DEBUG] PREPARING GET RESPONSE at 2025-05-05T19:07:35.801Z
[SERVER DEBUG] Task ID: 746, Found 0 fields in database
===============================================
[SERVER DEBUG] Checking field corporateRegistration in retrieved data: NOT PRESENT
[SERVER DEBUG] Checking field goodStanding in retrieved data: NOT PRESENT
[SERVER DEBUG] Checking field regulatoryActions in retrieved data: NOT PRESENT
[SERVER DEBUG] Checking field investigationsIncidents in retrieved data: NOT PRESENT
[SERVER DEBUG] No fields with value "asdf" found in GET response data
[SERVER DEBUG] Sending GET response with 0 fields, status: not_started, progress: 0%
===============================================
7:07:35 PM [info] GET /api/kyb/progress/746 304 in 160ms :: {"formData":{},"progress":0,"status":"not_started"}
7:07:37 PM [info] GET /api/companies/current 304 in 29ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
7:07:37 PM [info] GET /api/tasks 304 in 32ms :: [{"id":745,"title":"New User Invitation: 14@e.com","description":"Complete us...
7:07:38 PM [info] GET /api/tasks 304 in 38ms :: [{"id":745,"title":"New User Invitation: 14@e.com","description":"Complete us...
[INFO] [WebSocket] Received message from client client-1746471979090-9kigz3v: {
  type: 'ping',
  timestamp: '2025-05-05T19:07:39.511Z',
  connectionId: 'ws_1746471976511_17ekzuils'
}
7:07:40 PM [info] GET /api/companies/current 304 in 33ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
7:07:43 PM [info] GET /api/companies/current 304 in 35ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
7:07:47 PM [info] GET /api/companies/current 304 in 37ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746471977021-kdnqw1u: { type: 'ping' }
7:07:49 PM [info] GET /api/companies/current 304 in 30ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
7:07:53 PM [info] GET /api/companies/current 304 in 41ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 312, company_id: 269, email: '14@e.com' }
[2025-05-05T19:07:53.134Z] [INFO] Performing dynamic task unlocking check for company {"companyId":269,"userId":312}
[2025-05-05T19:07:53.172Z] [INFO] No completed KYB tasks found, skipping security task unlock check {"companyId":269}
[Tasks] Automatically unlocking all tasks for company { userId: 312, companyId: 269, requestedBy: 'automatic_task_unlock' }
[2025-05-05T19:07:53.174Z] [INFO] [TaskDependencies] Unlocking ALL tasks for company {"companyId":269}
[2025-05-05T19:07:53.203Z] [INFO] [TaskDependencies] Found tasks to unlock {"companyId":269,"count":3,"taskIds":[747,746,748],"taskTypes":["ky3p","company_kyb","open_banking"],"ky3pTaskCount":1,"ky3pTaskIds":[747]}
[2025-05-05T19:07:53.204Z] [INFO] [TaskDependencies] Processing KY3P task {"taskId":747,"taskType":"ky3p","currentProgress":60,"currentStatus":"in_progress","timestamp":"2025-05-05T19:07:53.204Z"}
[2025-05-05T19:07:53.241Z] [INFO] [UnifiedProgressCalc] Preserving existing progress for task 747 (ky3p): 60% {"taskId":747,"taskType":"ky3p","existingProgress":60,"operation":"preserve-existing"}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 60,
  currentStatus: 'in_progress',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  effectiveHasResponses: true,
  timestamp: '2025-05-05T19:07:53.275Z'
}
[STATUS DETERMINATION] Task has partial progress or responses, setting to IN_PROGRESS
[2025-05-05T19:07:53.305Z] [INFO] [ProgressUpdate] Updated task 747 progress to 60% and status to in_progress {"taskId":747,"taskType":"ky3p","progress":60,"status":"in_progress","previousStatus":"in_progress"}
[WebSocket] Broadcast task_update to 6 clients (0 errors) { messageId: 'msg_1746472073306_grlwlnnv7' }
[2025-05-05T19:07:53.307Z] [INFO] Successfully broadcasted task_update message
[2025-05-05T19:07:53.307Z] [INFO] [ProgressUpdate] Broadcasted progress update for task 747 {"taskId":747,"progress":60,"status":"in_progress"}
[2025-05-05T19:07:53.307Z] [INFO] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":269,"taskId":747,"taskType":"ky3p","isKy3pTask":true,"calculatedProgress":60,"previousProgress":60,"wasPreserved":true}
[2025-05-05T19:07:53.447Z] [INFO] [UnifiedProgressCalc] Calculated progress for task 746 (company_kyb): 0/30 = 0% {"taskId":746,"taskType":"company_kyb","totalFields":"30","completedFields":"0","progress":0}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  effectiveHasResponses: false,
  timestamp: '2025-05-05T19:07:53.481Z'
}
[STATUS DETERMINATION] Task has 0% progress and no responses, setting to NOT_STARTED
[2025-05-05T19:07:53.515Z] [INFO] [ProgressUpdate] Updated task 746 progress to 0% and status to not_started {"taskId":746,"taskType":"company_kyb","progress":0,"status":"not_started","previousStatus":"not_started"}
[WebSocket] Broadcast task_update to 6 clients (0 errors) { messageId: 'msg_1746472073516_k1ie3rt5y' }
[2025-05-05T19:07:53.517Z] [INFO] Successfully broadcasted task_update message
[2025-05-05T19:07:53.517Z] [INFO] [ProgressUpdate] Broadcasted progress update for task 746 {"taskId":746,"progress":0,"status":"not_started"}
[2025-05-05T19:07:53.517Z] [INFO] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":269,"taskId":746,"taskType":"company_kyb","isKy3pTask":false,"calculatedProgress":0,"previousProgress":0,"wasPreserved":false}
[INFO] [WebSocket] Received message from client client-1746471993475-hm1uhu8: {
  type: 'ping',
  timestamp: '2025-05-05T19:07:53.440Z',
  connectionId: 'ws_1746471992843_i4qphgujp'
}
[2025-05-05T19:07:53.624Z] [INFO] [UnifiedProgressCalc] Calculated progress for task 748 (open_banking): 0/44 = 0% {"taskId":748,"taskType":"open_banking","totalFields":"44","completedFields":"0","progress":0}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  effectiveHasResponses: false,
  timestamp: '2025-05-05T19:07:53.669Z'
}
[STATUS DETERMINATION] Task has 0% progress and no responses, setting to NOT_STARTED
[2025-05-05T19:07:53.718Z] [INFO] [ProgressUpdate] Updated task 748 progress to 0% and status to not_started {"taskId":748,"taskType":"open_banking","progress":0,"status":"not_started","previousStatus":"not_started"}
[WebSocket] Broadcast task_update to 6 clients (0 errors) { messageId: 'msg_1746472073719_i8ote88kx' }
[2025-05-05T19:07:53.720Z] [INFO] Successfully broadcasted task_update message
[2025-05-05T19:07:53.720Z] [INFO] [ProgressUpdate] Broadcasted progress update for task 748 {"taskId":748,"progress":0,"status":"not_started"}
[2025-05-05T19:07:53.720Z] [INFO] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":269,"taskId":748,"taskType":"open_banking","isKy3pTask":false,"calculatedProgress":0,"previousProgress":0,"wasPreserved":false}
[2025-05-05T19:07:53.720Z] [INFO] [TaskDependencies] Successfully unlocked all tasks {"companyId":269,"count":3}
[Tasks] Successfully unlocked all tasks for company: 269
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 312',
    condition2: 'tasks.created_by = 312',
    condition3: "tasks.company_id = 269 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('14@e.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
7:07:53 PM [info] GET /api/tasks 200 in 692ms :: [{"id":748,"title":"3. Open Banking Survey: DevTest14","description":"Complet...
7:07:55 PM [info] GET /api/companies/current 304 in 35ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
7:07:58 PM [info] GET /api/companies/current 304 in 30ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
7:08:02 PM [info] GET /api/companies/current 304 in 39ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746471992370-5666sfi: { type: 'ping' }
7:08:04 PM [info] GET /api/companies/current 304 in 32ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746471979090-9kigz3v: {
  type: 'ping',
  timestamp: '2025-05-05T19:08:05.514Z',
  connectionId: 'ws_1746471976511_17ekzuils'
}
7:08:05 PM [info] GET /api/companies/current 304 in 38ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
7:08:07 PM [info] GET /api/companies/current 304 in 30ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
7:08:09 PM [info] GET /api/tasks 304 in 30ms :: [{"id":748,"title":"3. Open Banking Survey: DevTest14","description":"Complet...
7:08:09 PM [info] GET /api/companies/current 304 in 29ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
7:08:11 PM [info] GET /api/companies/current 304 in 47ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
7:08:12 PM [info] GET /api/companies/current 304 in 32ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746471993475-hm1uhu8: {
  type: 'ping',
  timestamp: '2025-05-05T19:08:13.441Z',
  connectionId: 'ws_1746471992843_i4qphgujp'
}
7:08:14 PM [info] GET /api/companies/current 304 in 94ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
[Current Company] Fetching company for user: { userId: 312, companyId: 269 }
[Current Company] Found company: {
  id: 269,
  name: 'DevTest14',
  onboardingCompleted: false,
  riskScore: null,
  chosenScore: null,
  isDemo: true
}
7:08:15 PM [info] GET /api/companies/current 304 in 60ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746471976098-4o0ootn: { type: 'ping' }
7:08:16 PM [info] GET /api/companies/current 304 in 32ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746471977021-kdnqw1u: { type: 'ping' }
7:08:19 PM [info] GET /api/companies/current 304 in 32ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
7:08:23 PM [info] GET /api/companies/current 304 in 31ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 312, company_id: 269, email: '14@e.com' }
[2025-05-05T19:08:24.175Z] [INFO] Performing dynamic task unlocking check for company {"companyId":269,"userId":312}
[2025-05-05T19:08:24.210Z] [INFO] No completed KYB tasks found, skipping security task unlock check {"companyId":269}
[Tasks] Automatically unlocking all tasks for company { userId: 312, companyId: 269, requestedBy: 'automatic_task_unlock' }
[2025-05-05T19:08:24.211Z] [INFO] [TaskDependencies] Unlocking ALL tasks for company {"companyId":269}
[2025-05-05T19:08:24.243Z] [INFO] [TaskDependencies] Found tasks to unlock {"companyId":269,"count":3,"taskIds":[748,747,746],"taskTypes":["open_banking","ky3p","company_kyb"],"ky3pTaskCount":1,"ky3pTaskIds":[747]}
[2025-05-05T19:08:24.354Z] [INFO] [UnifiedProgressCalc] Calculated progress for task 748 (open_banking): 0/44 = 0% {"taskId":748,"taskType":"open_banking","totalFields":"44","completedFields":"0","progress":0}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  effectiveHasResponses: false,
  timestamp: '2025-05-05T19:08:24.397Z'
}
[STATUS DETERMINATION] Task has 0% progress and no responses, setting to NOT_STARTED
[2025-05-05T19:08:24.440Z] [INFO] [ProgressUpdate] Updated task 748 progress to 0% and status to not_started {"taskId":748,"taskType":"open_banking","progress":0,"status":"not_started","previousStatus":"not_started"}
[WebSocket] Broadcast task_update to 6 clients (0 errors) { messageId: 'msg_1746472104441_62ys4ewkx' }
[2025-05-05T19:08:24.441Z] [INFO] Successfully broadcasted task_update message
[2025-05-05T19:08:24.441Z] [INFO] [ProgressUpdate] Broadcasted progress update for task 748 {"taskId":748,"progress":0,"status":"not_started"}
[2025-05-05T19:08:24.441Z] [INFO] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":269,"taskId":748,"taskType":"open_banking","isKy3pTask":false,"calculatedProgress":0,"previousProgress":0,"wasPreserved":false}
[2025-05-05T19:08:24.441Z] [INFO] [TaskDependencies] Processing KY3P task {"taskId":747,"taskType":"ky3p","currentProgress":60,"currentStatus":"in_progress","timestamp":"2025-05-05T19:08:24.441Z"}
[2025-05-05T19:08:24.483Z] [INFO] [UnifiedProgressCalc] Preserving existing progress for task 747 (ky3p): 60% {"taskId":747,"taskType":"ky3p","existingProgress":60,"operation":"preserve-existing"}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 60,
  currentStatus: 'in_progress',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  effectiveHasResponses: true,
  timestamp: '2025-05-05T19:08:24.527Z'
}
[STATUS DETERMINATION] Task has partial progress or responses, setting to IN_PROGRESS
[2025-05-05T19:08:24.577Z] [INFO] [ProgressUpdate] Updated task 747 progress to 60% and status to in_progress {"taskId":747,"taskType":"ky3p","progress":60,"status":"in_progress","previousStatus":"in_progress"}
[WebSocket] Broadcast task_update to 6 clients (0 errors) { messageId: 'msg_1746472104580_vd8vsil17' }
[2025-05-05T19:08:24.580Z] [INFO] Successfully broadcasted task_update message
[2025-05-05T19:08:24.580Z] [INFO] [ProgressUpdate] Broadcasted progress update for task 747 {"taskId":747,"progress":60,"status":"in_progress"}
[2025-05-05T19:08:24.580Z] [INFO] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":269,"taskId":747,"taskType":"ky3p","isKy3pTask":true,"calculatedProgress":60,"previousProgress":60,"wasPreserved":true}
[2025-05-05T19:08:24.695Z] [INFO] [UnifiedProgressCalc] Calculated progress for task 746 (company_kyb): 0/30 = 0% {"taskId":746,"taskType":"company_kyb","totalFields":"30","completedFields":"0","progress":0}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  effectiveHasResponses: false,
  timestamp: '2025-05-05T19:08:24.728Z'
}
[STATUS DETERMINATION] Task has 0% progress and no responses, setting to NOT_STARTED
[2025-05-05T19:08:24.765Z] [INFO] [ProgressUpdate] Updated task 746 progress to 0% and status to not_started {"taskId":746,"taskType":"company_kyb","progress":0,"status":"not_started","previousStatus":"not_started"}
[WebSocket] Broadcast task_update to 6 clients (0 errors) { messageId: 'msg_1746472104766_q4iqg1yd3' }
[2025-05-05T19:08:24.766Z] [INFO] Successfully broadcasted task_update message
[2025-05-05T19:08:24.766Z] [INFO] [ProgressUpdate] Broadcasted progress update for task 746 {"taskId":746,"progress":0,"status":"not_started"}
[2025-05-05T19:08:24.766Z] [INFO] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":269,"taskId":746,"taskType":"company_kyb","isKy3pTask":false,"calculatedProgress":0,"previousProgress":0,"wasPreserved":false}
[2025-05-05T19:08:24.766Z] [INFO] [TaskDependencies] Successfully unlocked all tasks {"companyId":269,"count":3}
[Tasks] Successfully unlocked all tasks for company: 269
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 312',
    condition2: 'tasks.created_by = 312',
    condition3: "tasks.company_id = 269 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('14@e.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
7:08:24 PM [info] GET /api/tasks 200 in 692ms :: [{"id":745,"title":"New User Invitation: 14@e.com","description":"Complete us...
7:08:26 PM [info] GET /api/companies/current 304 in 37ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
7:08:28 PM [info] GET /api/companies/current 304 in 37ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
7:08:31 PM [info] GET /api/companies/current 304 in 36ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746471992370-5666sfi: { type: 'ping' }
[INFO] [WebSocket] Received message from client client-1746471992978-a2tcl82: { type: 'ping' }
[INFO] [WebSocket] Received message from client client-1746471993475-hm1uhu8: {
  type: 'ping',
  timestamp: '2025-05-05T19:08:33.439Z',
  connectionId: 'ws_1746471992843_i4qphgujp'
}
7:08:34 PM [info] GET /api/companies/current 304 in 31ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
7:08:37 PM [info] GET /api/companies/current 304 in 38ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
[Tasks] Using cached task data for user: 312
7:08:40 PM [info] GET /api/tasks 304 in 30ms :: [{"id":745,"title":"New User Invitation: 14@e.com","description":"Complete us...
7:08:40 PM [info] GET /api/companies/current 304 in 30ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
7:08:43 PM [info] GET /api/companies/current 304 in 31ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
7:08:47 PM [info] GET /api/companies/current 304 in 51ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Client disconnected: client-1746471992978-a2tcl82
[INFO] [WebSocket] Client connected: client-1746472128596-in26dza
[INFO] [WebSocket] Received message from client client-1746472128596-in26dza: {
  type: 'authenticate',
  userId: null,
  companyId: null,
  clientId: 'ws_1746471991797_ty8rsblq4',
  timestamp: '2025-05-05T19:08:48.554Z'
}
[INFO] [WebSocket] Authentication from client client-1746472128596-in26dza: { userId: null, companyId: null, hasToken: true }
7:08:49 PM [info] GET /api/companies/current 304 in 31ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
7:08:52 PM [info] GET /api/companies/current 304 in 30ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746471993475-hm1uhu8: {
  type: 'ping',
  timestamp: '2025-05-05T19:08:53.440Z',
  connectionId: 'ws_1746471992843_i4qphgujp'
}
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 312, company_id: 269, email: '14@e.com' }
[2025-05-05T19:08:55.211Z] [INFO] Performing dynamic task unlocking check for company {"companyId":269,"userId":312}
[2025-05-05T19:08:55.242Z] [INFO] No completed KYB tasks found, skipping security task unlock check {"companyId":269}
[Tasks] Automatically unlocking all tasks for company { userId: 312, companyId: 269, requestedBy: 'automatic_task_unlock' }
[2025-05-05T19:08:55.243Z] [INFO] [TaskDependencies] Unlocking ALL tasks for company {"companyId":269}
[2025-05-05T19:08:55.272Z] [INFO] [TaskDependencies] Found tasks to unlock {"companyId":269,"count":3,"taskIds":[748,747,746],"taskTypes":["open_banking","ky3p","company_kyb"],"ky3pTaskCount":1,"ky3pTaskIds":[747]}
[2025-05-05T19:08:55.365Z] [INFO] [UnifiedProgressCalc] Calculated progress for task 748 (open_banking): 0/44 = 0% {"taskId":748,"taskType":"open_banking","totalFields":"44","completedFields":"0","progress":0}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  effectiveHasResponses: false,
  timestamp: '2025-05-05T19:08:55.401Z'
}
[STATUS DETERMINATION] Task has 0% progress and no responses, setting to NOT_STARTED
[2025-05-05T19:08:55.436Z] [INFO] [ProgressUpdate] Updated task 748 progress to 0% and status to not_started {"taskId":748,"taskType":"open_banking","progress":0,"status":"not_started","previousStatus":"not_started"}
[WebSocket] Broadcast task_update to 6 clients (0 errors) { messageId: 'msg_1746472135437_vam8p81o6' }
[2025-05-05T19:08:55.437Z] [INFO] Successfully broadcasted task_update message
[2025-05-05T19:08:55.437Z] [INFO] [ProgressUpdate] Broadcasted progress update for task 748 {"taskId":748,"progress":0,"status":"not_started"}
[2025-05-05T19:08:55.437Z] [INFO] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":269,"taskId":748,"taskType":"open_banking","isKy3pTask":false,"calculatedProgress":0,"previousProgress":0,"wasPreserved":false}
[2025-05-05T19:08:55.437Z] [INFO] [TaskDependencies] Processing KY3P task {"taskId":747,"taskType":"ky3p","currentProgress":60,"currentStatus":"in_progress","timestamp":"2025-05-05T19:08:55.437Z"}
[2025-05-05T19:08:55.474Z] [INFO] [UnifiedProgressCalc] Preserving existing progress for task 747 (ky3p): 60% {"taskId":747,"taskType":"ky3p","existingProgress":60,"operation":"preserve-existing"}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 60,
  currentStatus: 'in_progress',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  effectiveHasResponses: true,
  timestamp: '2025-05-05T19:08:55.509Z'
}
[STATUS DETERMINATION] Task has partial progress or responses, setting to IN_PROGRESS
[2025-05-05T19:08:55.545Z] [INFO] [ProgressUpdate] Updated task 747 progress to 60% and status to in_progress {"taskId":747,"taskType":"ky3p","progress":60,"status":"in_progress","previousStatus":"in_progress"}
[WebSocket] Broadcast task_update to 6 clients (0 errors) { messageId: 'msg_1746472135550_0xsqspvwh' }
[2025-05-05T19:08:55.550Z] [INFO] Successfully broadcasted task_update message
[2025-05-05T19:08:55.550Z] [INFO] [ProgressUpdate] Broadcasted progress update for task 747 {"taskId":747,"progress":60,"status":"in_progress"}
[2025-05-05T19:08:55.550Z] [INFO] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":269,"taskId":747,"taskType":"ky3p","isKy3pTask":true,"calculatedProgress":60,"previousProgress":60,"wasPreserved":true}
[2025-05-05T19:08:55.644Z] [INFO] [UnifiedProgressCalc] Calculated progress for task 746 (company_kyb): 0/30 = 0% {"taskId":746,"taskType":"company_kyb","totalFields":"30","completedFields":"0","progress":0}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  effectiveHasResponses: false,
  timestamp: '2025-05-05T19:08:55.676Z'
}
[STATUS DETERMINATION] Task has 0% progress and no responses, setting to NOT_STARTED
[2025-05-05T19:08:55.708Z] [INFO] [ProgressUpdate] Updated task 746 progress to 0% and status to not_started {"taskId":746,"taskType":"company_kyb","progress":0,"status":"not_started","previousStatus":"not_started"}
[WebSocket] Broadcast task_update to 6 clients (0 errors) { messageId: 'msg_1746472135709_z54bad610' }
[2025-05-05T19:08:55.709Z] [INFO] Successfully broadcasted task_update message
[2025-05-05T19:08:55.710Z] [INFO] [ProgressUpdate] Broadcasted progress update for task 746 {"taskId":746,"progress":0,"status":"not_started"}
[2025-05-05T19:08:55.710Z] [INFO] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":269,"taskId":746,"taskType":"company_kyb","isKy3pTask":false,"calculatedProgress":0,"previousProgress":0,"wasPreserved":false}
[2025-05-05T19:08:55.710Z] [INFO] [TaskDependencies] Successfully unlocked all tasks {"companyId":269,"count":3}
[Tasks] Successfully unlocked all tasks for company: 269
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 312',
    condition2: 'tasks.created_by = 312',
    condition3: "tasks.company_id = 269 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('14@e.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
7:08:55 PM [info] GET /api/tasks 200 in 600ms :: [{"id":748,"title":"3. Open Banking Survey: DevTest14","description":"Complet...
7:08:55 PM [info] GET /api/companies/current 304 in 31ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
[Current Company] Using cached company data: 269
7:08:58 PM [info] GET /api/companies/current 304 in 31ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
7:09:01 PM [info] GET /api/companies/current 304 in 34ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746471992370-5666sfi: { type: 'ping' }
[Current Company] Using cached company data: 269
7:09:04 PM [info] GET /api/companies/current 304 in 31ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746471977021-kdnqw1u: { type: 'ping' }
[INFO] [WebSocket] Received message from client client-1746471979090-9kigz3v: {
  type: 'ping',
  timestamp: '2025-05-05T19:09:05.513Z',
  connectionId: 'ws_1746471976511_17ekzuils'
}
7:09:05 PM [info] GET /api/companies/current 304 in 31ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
7:09:07 PM [info] GET /api/companies/current 304 in 32ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
7:09:10 PM [info] GET /api/companies/current 304 in 35ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
Suppressing further connection logs. Pool size: 3
7:09:11 PM [info] GET /api/tasks 304 in 32ms :: [{"id":748,"title":"3. Open Banking Survey: DevTest14","description":"Complet...
[INFO] [WebSocket] Received message from client client-1746471993475-hm1uhu8: {
  type: 'ping',
  timestamp: '2025-05-05T19:09:13.440Z',
  connectionId: 'ws_1746471992843_i4qphgujp'
}
7:09:13 PM [info] GET /api/companies/current 304 in 31ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
[Current Company] Fetching company for user: { userId: 312, companyId: 269 }
[Current Company] Found company: {
  id: 269,
  name: 'DevTest14',
  onboardingCompleted: false,
  riskScore: null,
  chosenScore: null,
  isDemo: true
}
7:09:17 PM [info] GET /api/companies/current 304 in 66ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
7:09:19 PM [info] GET /api/companies/current 304 in 30ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
7:09:22 PM [info] GET /api/companies/current 304 in 31ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
7:09:25 PM [info] GET /api/companies/current 304 in 32ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 312, company_id: 269, email: '14@e.com' }
[2025-05-05T19:09:26.256Z] [INFO] Performing dynamic task unlocking check for company {"companyId":269,"userId":312}
[2025-05-05T19:09:26.286Z] [INFO] No completed KYB tasks found, skipping security task unlock check {"companyId":269}
[Tasks] Automatically unlocking all tasks for company { userId: 312, companyId: 269, requestedBy: 'automatic_task_unlock' }
[2025-05-05T19:09:26.287Z] [INFO] [TaskDependencies] Unlocking ALL tasks for company {"companyId":269}
[2025-05-05T19:09:26.318Z] [INFO] [TaskDependencies] Found tasks to unlock {"companyId":269,"count":3,"taskIds":[748,747,746],"taskTypes":["open_banking","ky3p","company_kyb"],"ky3pTaskCount":1,"ky3pTaskIds":[747]}
[2025-05-05T19:09:26.407Z] [INFO] [UnifiedProgressCalc] Calculated progress for task 748 (open_banking): 0/44 = 0% {"taskId":748,"taskType":"open_banking","totalFields":"44","completedFields":"0","progress":0}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  effectiveHasResponses: false,
  timestamp: '2025-05-05T19:09:26.438Z'
}
[STATUS DETERMINATION] Task has 0% progress and no responses, setting to NOT_STARTED
[2025-05-05T19:09:26.470Z] [INFO] [ProgressUpdate] Updated task 748 progress to 0% and status to not_started {"taskId":748,"taskType":"open_banking","progress":0,"status":"not_started","previousStatus":"not_started"}
[WebSocket] Broadcast task_update to 6 clients (0 errors) { messageId: 'msg_1746472166471_i588u1qct' }
[2025-05-05T19:09:26.472Z] [INFO] Successfully broadcasted task_update message
[2025-05-05T19:09:26.472Z] [INFO] [ProgressUpdate] Broadcasted progress update for task 748 {"taskId":748,"progress":0,"status":"not_started"}
[2025-05-05T19:09:26.472Z] [INFO] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":269,"taskId":748,"taskType":"open_banking","isKy3pTask":false,"calculatedProgress":0,"previousProgress":0,"wasPreserved":false}
[2025-05-05T19:09:26.472Z] [INFO] [TaskDependencies] Processing KY3P task {"taskId":747,"taskType":"ky3p","currentProgress":60,"currentStatus":"in_progress","timestamp":"2025-05-05T19:09:26.472Z"}
[2025-05-05T19:09:26.502Z] [INFO] [UnifiedProgressCalc] Preserving existing progress for task 747 (ky3p): 60% {"taskId":747,"taskType":"ky3p","existingProgress":60,"operation":"preserve-existing"}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 60,
  currentStatus: 'in_progress',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  effectiveHasResponses: true,
  timestamp: '2025-05-05T19:09:26.533Z'
}
[STATUS DETERMINATION] Task has partial progress or responses, setting to IN_PROGRESS
[2025-05-05T19:09:26.565Z] [INFO] [ProgressUpdate] Updated task 747 progress to 60% and status to in_progress {"taskId":747,"taskType":"ky3p","progress":60,"status":"in_progress","previousStatus":"in_progress"}
[WebSocket] Broadcast task_update to 6 clients (0 errors) { messageId: 'msg_1746472166566_ypr53u950' }
[2025-05-05T19:09:26.566Z] [INFO] Successfully broadcasted task_update message
[2025-05-05T19:09:26.566Z] [INFO] [ProgressUpdate] Broadcasted progress update for task 747 {"taskId":747,"progress":60,"status":"in_progress"}
[2025-05-05T19:09:26.566Z] [INFO] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":269,"taskId":747,"taskType":"ky3p","isKy3pTask":true,"calculatedProgress":60,"previousProgress":60,"wasPreserved":true}
[2025-05-05T19:09:26.657Z] [INFO] [UnifiedProgressCalc] Calculated progress for task 746 (company_kyb): 0/30 = 0% {"taskId":746,"taskType":"company_kyb","totalFields":"30","completedFields":"0","progress":0}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  effectiveHasResponses: false,
  timestamp: '2025-05-05T19:09:26.687Z'
}
[STATUS DETERMINATION] Task has 0% progress and no responses, setting to NOT_STARTED
[2025-05-05T19:09:26.718Z] [INFO] [ProgressUpdate] Updated task 746 progress to 0% and status to not_started {"taskId":746,"taskType":"company_kyb","progress":0,"status":"not_started","previousStatus":"not_started"}
[WebSocket] Broadcast task_update to 6 clients (0 errors) { messageId: 'msg_1746472166719_d6gbcrwrb' }
[2025-05-05T19:09:26.719Z] [INFO] Successfully broadcasted task_update message
[2025-05-05T19:09:26.719Z] [INFO] [ProgressUpdate] Broadcasted progress update for task 746 {"taskId":746,"progress":0,"status":"not_started"}
[2025-05-05T19:09:26.720Z] [INFO] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":269,"taskId":746,"taskType":"company_kyb","isKy3pTask":false,"calculatedProgress":0,"previousProgress":0,"wasPreserved":false}
[2025-05-05T19:09:26.720Z] [INFO] [TaskDependencies] Successfully unlocked all tasks {"companyId":269,"count":3}
[Tasks] Successfully unlocked all tasks for company: 269
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 312',
    condition2: 'tasks.created_by = 312',
    condition3: "tasks.company_id = 269 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('14@e.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
7:09:26 PM [info] GET /api/tasks 200 in 558ms :: [{"id":747,"title":"2. S&P KY3P Security Assessment: DevTest14","description"...
7:09:28 PM [info] GET /api/companies/current 304 in 31ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
7:09:31 PM [info] GET /api/companies/current 304 in 31ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746471992370-5666sfi: { type: 'ping' }
[INFO] [WebSocket] Received message from client client-1746471993475-hm1uhu8: {
  type: 'ping',
  timestamp: '2025-05-05T19:09:33.440Z',
  connectionId: 'ws_1746471992843_i4qphgujp'
}
7:09:34 PM [info] GET /api/companies/current 304 in 32ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
7:09:37 PM [info] GET /api/companies/current 304 in 32ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
7:09:40 PM [info] GET /api/companies/current 304 in 32ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
7:09:42 PM [info] GET /api/tasks 304 in 31ms :: [{"id":747,"title":"2. S&P KY3P Security Assessment: DevTest14","description"...
7:09:43 PM [info] GET /api/companies/current 304 in 32ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
7:09:46 PM [info] GET /api/companies/current 304 in 32ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
7:09:49 PM [info] GET /api/companies/current 304 in 32ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
7:09:52 PM [info] GET /api/companies/current 304 in 31ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746471993475-hm1uhu8: {
  type: 'ping',
  timestamp: '2025-05-05T19:09:53.441Z',
  connectionId: 'ws_1746471992843_i4qphgujp'
}
7:09:55 PM [info] GET /api/companies/current 304 in 32ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 312, company_id: 269, email: '14@e.com' }
[2025-05-05T19:09:57.163Z] [INFO] Performing dynamic task unlocking check for company {"companyId":269,"userId":312}
[2025-05-05T19:09:57.193Z] [INFO] No completed KYB tasks found, skipping security task unlock check {"companyId":269}
[Tasks] Automatically unlocking all tasks for company { userId: 312, companyId: 269, requestedBy: 'automatic_task_unlock' }
[2025-05-05T19:09:57.194Z] [INFO] [TaskDependencies] Unlocking ALL tasks for company {"companyId":269}
[2025-05-05T19:09:57.226Z] [INFO] [TaskDependencies] Found tasks to unlock {"companyId":269,"count":3,"taskIds":[747,746,748],"taskTypes":["ky3p","company_kyb","open_banking"],"ky3pTaskCount":1,"ky3pTaskIds":[747]}
[2025-05-05T19:09:57.226Z] [INFO] [TaskDependencies] Processing KY3P task {"taskId":747,"taskType":"ky3p","currentProgress":60,"currentStatus":"in_progress","timestamp":"2025-05-05T19:09:57.226Z"}
[2025-05-05T19:09:57.258Z] [INFO] [UnifiedProgressCalc] Preserving existing progress for task 747 (ky3p): 60% {"taskId":747,"taskType":"ky3p","existingProgress":60,"operation":"preserve-existing"}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 60,
  currentStatus: 'in_progress',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  effectiveHasResponses: true,
  timestamp: '2025-05-05T19:09:57.288Z'
}
[STATUS DETERMINATION] Task has partial progress or responses, setting to IN_PROGRESS
[2025-05-05T19:09:57.319Z] [INFO] [ProgressUpdate] Updated task 747 progress to 60% and status to in_progress {"taskId":747,"taskType":"ky3p","progress":60,"status":"in_progress","previousStatus":"in_progress"}
[WebSocket] Broadcast task_update to 6 clients (0 errors) { messageId: 'msg_1746472197320_zfohuudsb' }
[2025-05-05T19:09:57.321Z] [INFO] Successfully broadcasted task_update message
[2025-05-05T19:09:57.321Z] [INFO] [ProgressUpdate] Broadcasted progress update for task 747 {"taskId":747,"progress":60,"status":"in_progress"}
[2025-05-05T19:09:57.321Z] [INFO] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":269,"taskId":747,"taskType":"ky3p","isKy3pTask":true,"calculatedProgress":60,"previousProgress":60,"wasPreserved":true}
[2025-05-05T19:09:57.415Z] [INFO] [UnifiedProgressCalc] Calculated progress for task 746 (company_kyb): 0/30 = 0% {"taskId":746,"taskType":"company_kyb","totalFields":"30","completedFields":"0","progress":0}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  effectiveHasResponses: false,
  timestamp: '2025-05-05T19:09:57.445Z'
}
[STATUS DETERMINATION] Task has 0% progress and no responses, setting to NOT_STARTED
[2025-05-05T19:09:57.476Z] [INFO] [ProgressUpdate] Updated task 746 progress to 0% and status to not_started {"taskId":746,"taskType":"company_kyb","progress":0,"status":"not_started","previousStatus":"not_started"}
[WebSocket] Broadcast task_update to 6 clients (0 errors) { messageId: 'msg_1746472197477_04rac8a33' }
[2025-05-05T19:09:57.477Z] [INFO] Successfully broadcasted task_update message
[2025-05-05T19:09:57.477Z] [INFO] [ProgressUpdate] Broadcasted progress update for task 746 {"taskId":746,"progress":0,"status":"not_started"}
[2025-05-05T19:09:57.477Z] [INFO] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":269,"taskId":746,"taskType":"company_kyb","isKy3pTask":false,"calculatedProgress":0,"previousProgress":0,"wasPreserved":false}
[2025-05-05T19:09:57.568Z] [INFO] [UnifiedProgressCalc] Calculated progress for task 748 (open_banking): 0/44 = 0% {"taskId":748,"taskType":"open_banking","totalFields":"44","completedFields":"0","progress":0}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  effectiveHasResponses: false,
  timestamp: '2025-05-05T19:09:57.599Z'
}
[STATUS DETERMINATION] Task has 0% progress and no responses, setting to NOT_STARTED
[2025-05-05T19:09:57.639Z] [INFO] [ProgressUpdate] Updated task 748 progress to 0% and status to not_started {"taskId":748,"taskType":"open_banking","progress":0,"status":"not_started","previousStatus":"not_started"}
[WebSocket] Broadcast task_update to 6 clients (0 errors) { messageId: 'msg_1746472197640_cvj09zjon' }
[2025-05-05T19:09:57.640Z] [INFO] Successfully broadcasted task_update message
[2025-05-05T19:09:57.640Z] [INFO] [ProgressUpdate] Broadcasted progress update for task 748 {"taskId":748,"progress":0,"status":"not_started"}
[2025-05-05T19:09:57.640Z] [INFO] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":269,"taskId":748,"taskType":"open_banking","isKy3pTask":false,"calculatedProgress":0,"previousProgress":0,"wasPreserved":false}
[2025-05-05T19:09:57.640Z] [INFO] [TaskDependencies] Successfully unlocked all tasks {"companyId":269,"count":3}
[Tasks] Successfully unlocked all tasks for company: 269
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 312',
    condition2: 'tasks.created_by = 312',
    condition3: "tasks.company_id = 269 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('14@e.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
7:09:57 PM [info] GET /api/tasks 200 in 570ms :: [{"id":745,"title":"New User Invitation: 14@e.com","description":"Complete us...
7:09:59 PM [info] GET /api/companies/current 304 in 31ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
7:10:01 PM [info] GET /api/companies/current 304 in 32ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746471992370-5666sfi: { type: 'ping' }
7:10:04 PM [info] GET /api/companies/current 304 in 32ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746471977021-kdnqw1u: { type: 'ping' }
[INFO] [WebSocket] Received message from client client-1746471979090-9kigz3v: {
  type: 'ping',
  timestamp: '2025-05-05T19:10:05.512Z',
  connectionId: 'ws_1746471976511_17ekzuils'
}
7:10:05 PM [info] GET /api/companies/current 304 in 32ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
7:10:07 PM [info] GET /api/companies/current 304 in 31ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
7:10:10 PM [info] GET /api/companies/current 304 in 32ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
[Tasks] Using cached task data for user: 312
7:10:12 PM [info] GET /api/tasks 304 in 31ms :: [{"id":745,"title":"New User Invitation: 14@e.com","description":"Complete us...
[INFO] [WebSocket] Received message from client client-1746471993475-hm1uhu8: {
  type: 'ping',
  timestamp: '2025-05-05T19:10:13.440Z',
  connectionId: 'ws_1746471992843_i4qphgujp'
}
7:10:13 PM [info] GET /api/companies/current 304 in 31ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746471976098-4o0ootn: { type: 'ping' }
[Current Company] Fetching company for user: { userId: 312, companyId: 269 }
[Current Company] Found company: {
  id: 269,
  name: 'DevTest14',
  onboardingCompleted: false,
  riskScore: null,
  chosenScore: null,
  isDemo: true
}
7:10:17 PM [info] GET /api/companies/current 304 in 62ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
7:10:19 PM [info] GET /api/companies/current 304 in 31ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
7:10:22 PM [info] GET /api/companies/current 304 in 31ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
7:10:25 PM [info] GET /api/companies/current 304 in 36ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
[Tasks] ====== Starting task fetch =====
[Tasks] User details: { id: 312, company_id: 269, email: '14@e.com' }
[2025-05-05T19:10:28.079Z] [INFO] Performing dynamic task unlocking check for company {"companyId":269,"userId":312}
[2025-05-05T19:10:28.112Z] [INFO] No completed KYB tasks found, skipping security task unlock check {"companyId":269}
[Tasks] Automatically unlocking all tasks for company { userId: 312, companyId: 269, requestedBy: 'automatic_task_unlock' }
[2025-05-05T19:10:28.113Z] [INFO] [TaskDependencies] Unlocking ALL tasks for company {"companyId":269}
[2025-05-05T19:10:28.143Z] [INFO] [TaskDependencies] Found tasks to unlock {"companyId":269,"count":3,"taskIds":[747,746,748],"taskTypes":["ky3p","company_kyb","open_banking"],"ky3pTaskCount":1,"ky3pTaskIds":[747]}
[2025-05-05T19:10:28.143Z] [INFO] [TaskDependencies] Processing KY3P task {"taskId":747,"taskType":"ky3p","currentProgress":60,"currentStatus":"in_progress","timestamp":"2025-05-05T19:10:28.143Z"}
[2025-05-05T19:10:28.174Z] [INFO] [UnifiedProgressCalc] Preserving existing progress for task 747 (ky3p): 60% {"taskId":747,"taskType":"ky3p","existingProgress":60,"operation":"preserve-existing"}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 60,
  currentStatus: 'in_progress',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  effectiveHasResponses: true,
  timestamp: '2025-05-05T19:10:28.203Z'
}
[STATUS DETERMINATION] Task has partial progress or responses, setting to IN_PROGRESS
[2025-05-05T19:10:28.236Z] [INFO] [ProgressUpdate] Updated task 747 progress to 60% and status to in_progress {"taskId":747,"taskType":"ky3p","progress":60,"status":"in_progress","previousStatus":"in_progress"}
[WebSocket] Broadcast task_update to 6 clients (0 errors) { messageId: 'msg_1746472228237_aquwzgxnc' }
[2025-05-05T19:10:28.238Z] [INFO] Successfully broadcasted task_update message
[2025-05-05T19:10:28.238Z] [INFO] [ProgressUpdate] Broadcasted progress update for task 747 {"taskId":747,"progress":60,"status":"in_progress"}
[2025-05-05T19:10:28.238Z] [INFO] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":269,"taskId":747,"taskType":"ky3p","isKy3pTask":true,"calculatedProgress":60,"previousProgress":60,"wasPreserved":true}
[2025-05-05T19:10:28.326Z] [INFO] [UnifiedProgressCalc] Calculated progress for task 746 (company_kyb): 0/30 = 0% {"taskId":746,"taskType":"company_kyb","totalFields":"30","completedFields":"0","progress":0}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  effectiveHasResponses: false,
  timestamp: '2025-05-05T19:10:28.360Z'
}
[STATUS DETERMINATION] Task has 0% progress and no responses, setting to NOT_STARTED
[2025-05-05T19:10:28.391Z] [INFO] [ProgressUpdate] Updated task 746 progress to 0% and status to not_started {"taskId":746,"taskType":"company_kyb","progress":0,"status":"not_started","previousStatus":"not_started"}
[WebSocket] Broadcast task_update to 6 clients (0 errors) { messageId: 'msg_1746472228391_6l9ed6v7c' }
[2025-05-05T19:10:28.392Z] [INFO] Successfully broadcasted task_update message
[2025-05-05T19:10:28.392Z] [INFO] [ProgressUpdate] Broadcasted progress update for task 746 {"taskId":746,"progress":0,"status":"not_started"}
[2025-05-05T19:10:28.392Z] [INFO] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":269,"taskId":746,"taskType":"company_kyb","isKy3pTask":false,"calculatedProgress":0,"previousProgress":0,"wasPreserved":false}
[2025-05-05T19:10:28.480Z] [INFO] [UnifiedProgressCalc] Calculated progress for task 748 (open_banking): 0/44 = 0% {"taskId":748,"taskType":"open_banking","totalFields":"44","completedFields":"0","progress":0}
[STATUS DETERMINATION] Calculating status for task with: {
  progress: 0,
  currentStatus: 'not_started',
  hasSubmissionDate: false,
  hasSubmittedFlag: false,
  hasResponses: false,
  effectiveHasResponses: false,
  timestamp: '2025-05-05T19:10:28.511Z'
}
[STATUS DETERMINATION] Task has 0% progress and no responses, setting to NOT_STARTED
[2025-05-05T19:10:28.543Z] [INFO] [ProgressUpdate] Updated task 748 progress to 0% and status to not_started {"taskId":748,"taskType":"open_banking","progress":0,"status":"not_started","previousStatus":"not_started"}
[WebSocket] Broadcast task_update to 6 clients (0 errors) { messageId: 'msg_1746472228544_l2ezlbaw3' }
[2025-05-05T19:10:28.544Z] [INFO] Successfully broadcasted task_update message
[2025-05-05T19:10:28.544Z] [INFO] [ProgressUpdate] Broadcasted progress update for task 748 {"taskId":748,"progress":0,"status":"not_started"}
[2025-05-05T19:10:28.544Z] [INFO] [TaskDependencies] Unlocked task using unified progress calculator {"companyId":269,"taskId":748,"taskType":"open_banking","isKy3pTask":false,"calculatedProgress":0,"previousProgress":0,"wasPreserved":false}
[2025-05-05T19:10:28.544Z] [INFO] [TaskDependencies] Successfully unlocked all tasks {"companyId":269,"count":3}
[Tasks] Successfully unlocked all tasks for company: 269
[Tasks] KYB tasks found: { count: 1 }
[Tasks] Query conditions: {
  conditions: {
    condition1: 'tasks.assigned_to = 312',
    condition2: 'tasks.created_by = 312',
    condition3: "tasks.company_id = 269 AND tasks.assigned_to IS NULL AND tasks.task_scope = 'company'",
    condition4: "tasks.task_type = 'user_onboarding' AND LOWER(tasks.user_email) = LOWER('14@e.com')"
  }
}
[Tasks] Tasks found: { count: 4 }
7:10:28 PM [info] GET /api/tasks 200 in 560ms :: [{"id":747,"title":"2. S&P KY3P Security Assessment: DevTest14","description"...
[Current Company] Using cached company data: 269
7:10:28 PM [info] GET /api/companies/current 304 in 32ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
7:10:32 PM [info] GET /api/companies/current 304 in 34ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
[INFO] [WebSocket] Received message from client client-1746471992370-5666sfi: { type: 'ping' }
[INFO] [WebSocket] Received message from client client-1746471993475-hm1uhu8: {
  type: 'ping',
  timestamp: '2025-05-05T19:10:33.439Z',
  connectionId: 'ws_1746471992843_i4qphgujp'
}
7:10:34 PM [info] GET /api/companies/current 304 in 31ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
7:10:38 PM [info] GET /api/companies/current 304 in 30ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...
[Current Company] Using cached company data: 269
7:10:40 PM [info] GET /api/companies/current 304 in 34ms :: {"id":269,"name":"DevTest14","category":"FinTech","is_demo":true,"revenue_tie...