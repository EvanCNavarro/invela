The edited code adds functionality to retrieve the sender's company name from the database and the host from the request headers.  It integrates this information into the invitation URL and the email template. The changes are incorporated within the existing transaction block, ensuring atomicity.  The email sending logic is added after the transaction is successfully completed.
The import statement is updated to include the `companies` table from the database schema.  The `senderCompany` variable is introduced to store the retrieved company information. This information is then used to populate the task description and the email template.  The invitation URL is constructed dynamically using the host and protocol from the request headers.